var WPACS=WPACS||{};WPACS.wp0bj1={printf:function(){var a=[].slice.call(arguments),b=a.shift(),c=0;return b.replace(/%(\w)?(\d)?([dfsx])/ig,function(g,e,b,f){var d=b?(new Array(b-0+1)).join(e||""):"";if(f=="d")d+=parseInt(a[c++]);return b?d.slice(b*-1):d})},isNumberType:function(a){return typeof a==="number"&&isFinite(a)},isBooleanType:function(a){return typeof a==="boolean"},isStringType:function(a){return typeof a==="string"},isUndefined:function(a){return typeof a==="undefined"},isObject:function(a){return a===null||typeof a==="undefined"?false:typeof a==="object"},ifCanvas:function(){try{document.createElement("canvas").getContext("2d")}catch(a){alert("\u4f60\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301HTML5 Canvas\r\n\u90e8\u5206\u529f\u80fd\u4e0d\u80fd\u6b63\u5e38\u4f7f\u7528!");return false}return true},ifArrayBuff:function(){try{var a=new ArrayBuffer(1);a=null}catch(b){alert("\u4f60\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301HTML5 ArrayBuffer\r\n\u90e8\u5206\u529f\u80fd\u4e0d\u80fd\u6b63\u5e38\u4f7f\u7528!");return false}return true},ifStorage:function(){return window.localStorage?true:false},rgbToHex:function(d,c,b){var a="00000"+(d<<16|c<<8|b).toString(16);return a.substr(a.length-6)},RGBToHex:function(d){var c=/^rgb\D*([0-9]{0,3})\D*([0-9]{0,3})\D*([0-9]{0,3})\D*/g,a=d.replace(c,"$1 $2 $3").split(" "),g=parseInt(a[0]),f=parseInt(a[1]),e=parseInt(a[2]),b="00000"+(g<<16|f<<8|e).toString(16);return b.substr(b.length-6)},ToFixed:function(c,a){var b=Math.pow(10,a);return c.toFixed(a)*b/b}};WPACS.wp0bj1.Browser={Versions:function(){var a=navigator.userAgent,b=navigator.appVersion;return{ie:!!a.match(/MSIE/i),ie11:a.indexOf("Trident/7.0")>-1&&a.indexOf("rv:11")>-1,trident:a.indexOf("Trident")>-1,presto:a.indexOf("Presto")>-1,webKit:a.indexOf("AppleWebKit")>-1,gecko:a.indexOf("Gecko")>-1&&a.indexOf("KHTML")==-1,mobile:!!a.match(/AppleWebKit.*Mobile.*/)||!!a.match(/AppleWebKit/),ios:!!a.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:a.indexOf("Android")>-1||a.indexOf("Linux")>-1,iPhone:a.indexOf("iPhone")>-1||a.indexOf("Mac")>-1,iPad:a.indexOf("iPad")>-1,webApp:a.indexOf("Safari")==-1}}(),Mobile:function(){var a=navigator.userAgent;return{Android:!!navigator.userAgent.match(/Android/i),BlackBerry:!!navigator.userAgent.match(/BlackBerry/i),iOS:!!navigator.userAgent.match(/iPhone|iPad|iPod/i),Windows:!!navigator.userAgent.match(/IEMobile/i)}}(),Language:(navigator.browserLanguage||navigator.language).toLowerCase()};WPACS.wp0bj1.IsMobile=WPACS.wp0bj1.Browser.Mobile.Android||WPACS.wp0bj1.Browser.Mobile.iOS||WPACS.wp0bj1.Browser.Mobile.Windows||WPACS.wp0bj1.Browser.Mobile.BlackBerry;WPACS.wp0bj1.Canvas=WPACS.wp0bj1.ifCanvas();WPACS.wp0bj1.Storage=WPACS.wp0bj1.ifStorage();WPACS.wp0bj1.ArrayBuff=WPACS.wp0bj1.Canvas?WPACS.wp0bj1.ifArrayBuff():false;WPACS.wp0bj1.NoLocalStorage=false;if(WPACS.CONSTDEF.CROSSORIGIN&&WPACS.wp0bj1.Browser.Versions.ie11)WPACS.CONSTDEF.CROSSORIGIN=false;WPACS.wp0bj1.HasVideo=!!document.createElement("video").canPlayType;WPACS.CONSTDEF.WPURL_ROOT="./";WPACS.CONSTDEF.wpu1="prndcm.aspx";WPACS.CONSTDEF.wpu2="view3d.aspx";WPACS.CONSTDEF.wpu3="webpacs/wpsd3v.aspx";WPACS.CONSTDEF.wpu4="webpacs/wpsdcm.aspx";WPACS.CONSTDEF.wpu5="webpacs/wpswado.aspx";WPACS.CONSTDEF.wpu6="webpacs/wpsqry.aspx";WPACS.CONSTDEF.MGLASS_FILTER=true;WPACS.CONSTDEF.VMODE_WADO=0;WPACS.CONSTDEF.FUSION_MODE=1;WPACS.CONSTDEF.wps0=0;WPACS.CONSTDEF.wps1=1;WPACS.CONSTDEF.wpu2=2;WPACS.CONSTDEF.wps3=3;WPACS.CONSTDEF.wps4=4;WPACS.CONSTDEF.wps5=5;WPACS.CONSTDEF.wpe1=1;WPACS.CONSTDEF.wpe2=2;WPACS.CONSTDEF.wpe3=3;WPACS.CONSTDEF.wpe4=4;WPACS.CONSTDEF.wpe5=5;WPACS.CONSTDEF.wpe6=6;WPACS.CONSTDEF.wpe7=7;WPACS.CONSTDEF.wpe8=8;WPACS.CONSTDEF.wpe9=9;WPACS.CONSTDEF.wpe11=11;WPACS.CONSTDEF.wpe12=12;WPACS.CONSTDEF.wpe13=13;WPACS.CONSTDEF.wpe14=14;WPACS.CONSTDEF.wpo1=1;WPACS.CONSTDEF.wpo2=2;WPACS.CONSTDEF.wpo3=3;WPACS.CONSTDEF.wpo5=5;WPACS.CONSTDEF.wpo6=6;WPACS.CONSTDEF.wpo7=7;WPACS.CONSTDEF.wpo10=10;WPACS.CONSTDEF.wpo30=30;WPACS.CONSTDEF.wpd1=1;WPACS.CONSTDEF.wpd2=2;WPACS.CONSTDEF.wpd3=3;WPACS.CONSTDEF.wpd4=4;WPACS.CONSTDEF.wpd5=5;WPACS.CONSTDEF.wpd6=6;WPACS.CONSTDEF.wpdt0=0;WPACS.CONSTDEF.wpdt1=1;WPACS.CONSTDEF.wpdt2=2;WPACS.CONSTDEF.wpdt3=3;WPACS.CONSTDEF.wpdt4=4;WPACS.CONSTDEF.wpdt5=5;WPACS.CONSTDEF.wpdt6=6;WPACS.CONSTDEF.STR_SETS1='onselectstart="return false" style="-moz-user-select:none;overflow:hidden;"';WPACS.CONSTDEF.STR_SETS2='onselectstart="return false" style="-moz-user-select:none;overflow:hidden;padding:5px;"';WPACS.DEBUGLOG=function(a){window.console&&console.log(a)};WPACS.wpRect=function(b,c,d,a){this.left=b;this.top=c;this.width=d;this.height=a};WPACS.wpRect.prototype.right=function(){return this.left+this.width-1};WPACS.wpRect.prototype.bottom=function(){return this.top+this.height-1};WPACS.wpRect.prototype.xCenter=function(){return this.left+this.width/2|0};WPACS.wpRect.prototype.yCenter=function(){return this.top+this.height/2|0};WPACS.wpRect.prototype.translate=function(a,b){this.left+=a;this.top+=b};WPACS.wpRect.prototype.Intersect=function(a,b,l,k){var i=this.left>=a?this.left:a,j=this.top>=b?this.top:b,d=this.left+this.width-1,c=this.top+this.height-1,f=a+l-1,e=b+k-1,h=d<=f?d:f,g=c<=e?c:e;return!(i>h||j>g)};WPACS.wp0bj2=function(a,b){this.x=a;this.y=b};WPACS.wp0bj2.prototype.inRect=function(b,a){return this.x<0||this.x>=b?false:this.y<0||this.y>=a?false:true};WPACS.wp0bj2.prototype.InPolygon=function(a){for(var g=this.x,d=this.y,e=false,b=-1,f=a.length,c=f-1;++b<f;c=b)(a[b].y<=d&&d<a[c].y||a[c].y<=d&&d<a[b].y)&&g<(a[c].x-a[b].x)*(d-a[b].y)/(a[c].y-a[b].y)+a[b].x&&(e=!e);return e};WPACS.wp0bj2.InPolygon=function(k,b,a){for(var f=false,d=-1,i=a.length,g=i-1;++d<i;g=d){var h=a[d].x,c=a[d].y,j=a[g].x,e=a[g].y;(c<=b&&b<e||e<=b&&b<c)&&k<(j-h)*(b-c)/(e-c)+h&&(f=!f)}return f};WPACS.wp0bj2.OutRect=function(a){var d,f,e,b;d=e=a[0].x;f=b=a[0].y;for(var c=1;c<a.length;c++){var g=a[c].x,h=a[c].y;if(g<d)d=g;if(g>e)e=g;if(h<f)f=h;if(h>b)b=h}return{l:d,t:f,r:e,b:b}};WPACS.wp0bj2.InnerRect=function(a){for(var c=0,d=0,e=2147483647,b=0;b<a.length;b++){c+=a[b].x;d+=a[b].y}c/=a.length;d/=a.length;if(!WPACS.wp0bj2.InPolygon(c,d,a))return{l:0,t:0,r:-1,b:-1};for(var f,g,h,b=0;b<a.length;b++){f=a[b].x-c;g=a[b].y-d;if((h=Math.sqrt(f*f+g*g))<e)e=h}return{l:c-e,t:d-e,r:c+e,b:d+e}};WPACS.wp0bj2.Center=function(a){for(var c=0,d=0,b=0;b<a.length;b++){c+=a[b].x;d+=a[b].y}c/=a.length;d/=a.length;return{x:c,y:d}};WPACS.wp0bj2.InPolygon1=function(e,f){var c=document.createElement("canvas"),a=c.getContext("2d");a.beginPath();a.moveTo(ptArray[0].x,ptArray[0].y);for(var b=1;b<ptArray.length;b++)a.lineTo(ptArray[b].x,ptArray[b].y);a.closePath();var d=a.isPointInPath(e,f);c=null;return d};WPACS.wp0bj3=function(){_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";this.encode=function(a){var f="",g,b,c,i,j,h,d,e=0;a=_utf8_encode(a);while(e<a.length){g=a.charCodeAt(e++);b=a.charCodeAt(e++);c=a.charCodeAt(e++);i=g>>2;j=(g&3)<<4|b>>4;h=(b&15)<<2|c>>6;d=c&63;if(isNaN(b))h=d=64;else if(isNaN(c))d=64;f=f+_keyStr.charAt(i)+_keyStr.charAt(j)+_keyStr.charAt(h)+_keyStr.charAt(d)}return f};this.decode=function(b){var a="",g,h,i,j,e,d,f,c=0;b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(c<b.length){j=_keyStr.indexOf(b.charAt(c++));e=_keyStr.indexOf(b.charAt(c++));d=_keyStr.indexOf(b.charAt(c++));f=_keyStr.indexOf(b.charAt(c++));g=j<<2|e>>4;h=(e&15)<<4|d>>2;i=(d&3)<<6|f;a=a+String.fromCharCode(g);if(d!=64)a=a+String.fromCharCode(h);if(f!=64)a=a+String.fromCharCode(i)}a=_utf8_decode(a);return a};_utf8_encode=function(d){for(var b="",c=0;c<d.length;c++){var a=d.charCodeAt(c);if(a<128)b+=String.fromCharCode(a);else if(a>127&&a<2048){b+=String.fromCharCode(a>>6|192);b+=String.fromCharCode(a&63|128)}else{b+=String.fromCharCode(a>>12|224);b+=String.fromCharCode(a>>6&63|128);b+=String.fromCharCode(a&63|128)}}return b};_utf8_decode=function(c){var d="",a=0,b=c1=c2=0;while(a<c.length){b=c.charCodeAt(a);if(b<128){d+=String.fromCharCode(b);a++}else if(b>191&&b<224){c2=c.charCodeAt(a+1);d+=String.fromCharCode((b&31)<<6|c2&63);a+=2}else{c2=c.charCodeAt(a+1);c3=c.charCodeAt(a+2);d+=String.fromCharCode((b&15)<<12|(c2&63)<<6|c3&63);a+=3}}return d}};WPACS.wp0bj4=function(){var a=" _0123456789abcdefghijklmnopqrstuvwxyz";this.EncryptStr=function(b,k,h){var g=GetKeyFromPhase(k);if(!g)return b;if(!h||!(typeof h==="boolean"))b=_utf8_encode(b);for(var f="",j=b.length>>3,i=b.length%8,d=0;d<j;d++){for(var c=[0,0,0,0,0,0,0,0],a=0,e=d*8;a<8;a++,e++)c[a]=b.charCodeAt(e);EncipherChunk(c,g,d);for(var a=0;a<8;a++)f+=String.fromCharCode(c[a])}if(i!=0){var c=[0,0,0,0,0,0,0,0];EncipherChunk(c,g,0);for(var a=0,e=j*8;a<i;a++,e++)f+=String.fromCharCode(b.charCodeAt(e)^c[a])}return f};this.DecryptStr=function(c,k,h){var g=GetKeyFromPhase(k);if(!g)return c;for(var b="",j=c.length>>3,i=c.length%8,e=0;e<j;e++){for(var d=[0,0,0,0,0,0,0,0],a=0,f=e*8;a<8;a++,f++)d[a]=c.charCodeAt(f);DecipherChunk(d,g,e);for(var a=0;a<8;a++)b+=String.fromCharCode(d[a])}if(i!=0){var d=[0,0,0,0,0,0,0,0];EncipherChunk(d,g,0);for(var a=0,f=j*8;a<i;a++,f++)b+=String.fromCharCode(c.charCodeAt(f)^d[a])}if(!h||!(typeof h==="boolean"))b=_utf8_decode(b);return b};EncipherChunk=function(a,e,h){var b=a[0]+(a[1]<<8)+(a[2]<<16)+(a[3]<<24),c=a[4]+(a[5]<<8)+(a[6]<<16)+(a[7]<<24),d=0,g=2654435769;b^=h;for(var f=0;f<32;f++){b+=(c<<4^c>>>5)+(c^d)+e[d&3];d+=g;c+=(b<<4^b>>>5)+(b^d)+e[d>>11&3]}a[0]=b&255;a[1]=b>>8&255;a[2]=b>>16&255;a[3]=b>>24&255;a[4]=c&255;a[5]=c>>8&255;a[6]=c>>16&255;a[7]=c>>24&255};DecipherChunk=function(a,e,h){for(var b=a[0]+(a[1]<<8)+(a[2]<<16)+(a[3]<<24),c=a[4]+(a[5]<<8)+(a[6]<<16)+(a[7]<<24),d=3337565984,g=2654435769,f=0;f<32;f++){c-=(b<<4^b>>>5)+(b^d)+e[d>>11&3];d-=g;b-=(c<<4^c>>>5)+(c^d)+e[d&3]}b^=h;a[0]=b&255;a[1]=b>>8&255;a[2]=b>>16&255;a[3]=b>>24&255;a[4]=c&255;a[5]=c>>8&255;a[6]=c>>16&255;a[7]=c>>24&255};GetKeyFromPhase=function(h){var b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],f=0;function i(a){return a&&a<=32}var j=h.length,c=0;while(c<j){var d=h.charCodeAt(c);if(i(d)){d=32;while(c+1<j&&i(h.charCodeAt(c+1)))c++}if(d>=65&&d<=90)d+=32;for(var g=-1,e=0;e<a.length;e++){var m=a.charCodeAt(e);if(m==d){g=e;break}}if(g!=-1){var k=f&15,l=b[k];f++;b[k]=l<<1^l>>1^g}c++}if(!f)return null;var n=b[0]+(b[1]<<8)+(b[2]<<16)+(b[3]<<24),o=b[4]+(b[5]<<8)+(b[6]<<16)+(b[7]<<24),p=b[8]+(b[9]<<8)+(b[10]<<16)+(b[11]<<24),q=b[12]+(b[13]<<8)+(b[14]<<16)+(b[15]<<24);return[n,o,p,q]};_utf8_encode=function(d){for(var b="",c=0;c<d.length;c++){var a=d.charCodeAt(c);if(a<128)b+=String.fromCharCode(a);else if(a>127&&a<2048){b+=String.fromCharCode(a>>6|192);b+=String.fromCharCode(a&63|128)}else{b+=String.fromCharCode(a>>12|224);b+=String.fromCharCode(a>>6&63|128);b+=String.fromCharCode(a&63|128)}}return b};_utf8_decode=function(c){var d="",a=0,b=c1=c2=0;while(a<c.length){b=c.charCodeAt(a);if(b<128){d+=String.fromCharCode(b);a++}else if(b>191&&b<224){c2=c.charCodeAt(a+1);d+=String.fromCharCode((b&31)<<6|c2&63);a+=2}else{c2=c.charCodeAt(a+1);c3=c.charCodeAt(a+2);d+=String.fromCharCode((b&15)<<12|(c2&63)<<6|c3&63);a+=3}}return d}};WPACS.Vector=function(a,b){this.x=a;this.y=b};WPACS.Vector.prototype.Set=function(a,c,b,d){this.x=b-a;this.y=d-c};WPACS.Vector.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};WPACS.Vector.prototype.Normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);if(a==0)return;this.x=this.x/a;this.y=this.y/a};WPACS.Vector.DotMul=function(a,b){return a.x*b.x+a.y*b.y};WPACS.Vector.CrossMul=function(a,b){return a.x*b.y-a.y*b.x};WPACS.Vector.ChkCross=function(a,d,b,e){var f=new WPACS.Vector,g=new WPACS.Vector,c=new WPACS.Vector;f.Set(b.x,b.y,a.x,a.y);g.Set(b.x,b.y,d.x,d.y);c.Set(b.x,b.y,e.x,e.y);var h=WPACS.Vector.CrossMul(f,c)*WPACS.Vector.CrossMul(g,c);f.Set(a.x,a.y,b.x,b.y);g.Set(a.x,a.y,e.x,e.y);c.Set(a.x,a.y,d.x,d.y);var i=WPACS.Vector.CrossMul(f,c)*WPACS.Vector.CrossMul(g,c);return h<=0&&i<=0?true:false};WPACS.Vector.Intersect=function(a,b,c,d){if(!WPACS.Vector.ChkCross(a,b,c,d))return null;var e=new WPACS.Vector,f=new WPACS.Vector;e.Set(a.x,a.y,b.x,b.y);f.Set(a.x,a.y,c.x,c.y);var h=Math.asb(WPACS.Vector.CrossMul(e,f));e.Set(a.x,a.y,b.x,b.y);f.Set(a.x,a.y,d.x,d.y);var i=Math.asb(WPACS.Vector.CrossMul(e,f)),g=h/i;return{x:(c.x+g*d.x)/(1+g),y:(c.y+g*d.y)/(1+g)}};WPACS.wp0bj5=function(a,b,c){this.x=a;this.y=b;this.z=c};WPACS.wp0bj5.Create=function(a,b){var c=b.x-a.x,d=b.y-a.y,e=b.z-a.z;return new WPACS.wp0bj5(c,d,e)};WPACS.wp0bj5.prototype.Set=function(a,c,e,b,d,f){this.x=b-a;this.y=d-c;this.z=f-e};WPACS.wp0bj5.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};WPACS.wp0bj5.prototype.Normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);if(a==0)return;this.x=this.x/a;this.y=this.y/a;this.z=this.z/a};WPACS.wp0bj5.prototype.Scale=function(a){this.x*=a;this.y*=a;this.z*=a};WPACS.wp0bj5.prototype.Add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z};WPACS.wp0bj5.prototype.Translate=function(a,b,c){this.x+=a;this.y+=b;this.z+=c};WPACS.wp0bj5.DotMul=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};WPACS.wp0bj5.CrossMul=function(a,b){var c=a.y*b.z-b.y*a.z,d=a.z*b.x-b.z*a.x,e=a.x*b.y-a.y*b.x;return new WPACS.wp0bj5(c,d,e)};WPACS.wp0bj5.ProjLen=function(b,a){return(b.x*a.x+b.y*a.y+b.z*a.z)/a.Length()};WPACS.wp0bj6=function(){};WPACS.wp0bj6.Create=function(c){var b=WPACS.wp0bj1.ArrayBuff?new Float32Array(16):new Array(16);if(c)for(var a=0;a<16;a++)b[a]=c[a];return b};WPACS.wp0bj6.identity=function(a){if(!a)a=WPACS.wp0bj1.ArrayBuff?new Float32Array(16):new Array(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};WPACS.wp0bj6.log=function(a){WPACS.DEBUGLOG("*********Matrix Begin*********");WPACS.DEBUGLOG(a[0]+" "+a[1]+" "+a[2]+" "+a[3]);WPACS.DEBUGLOG(a[4]+" "+a[5]+" "+a[6]+" "+a[7]);WPACS.DEBUGLOG(a[8]+" "+a[9]+" "+a[10]+" "+a[11]);WPACS.DEBUGLOG(a[12]+" "+a[13]+" "+a[14]+" "+a[15]);WPACS.DEBUGLOG("*********Matrix  End *********")};WPACS.wp0bj6.multiply=function(b,c,a){if(!a)a=WPACS.wp0bj1.ArrayBuff?new Float32Array(16):new Array(16);var e=b[0],f=b[1],i=b[2],k=b[3],m=b[4],n=b[5],p=b[6],s=b[7],u=b[8],w=b[9],x=b[10],z=b[11],C=b[12],D=b[13],G=b[14],I=b[15],d=c[0],g=c[1],h=c[2],j=c[3],l=c[4],o=c[5],q=c[6],r=c[7],t=c[8],v=c[9],y=c[10],A=c[11],B=c[12],E=c[13],F=c[14],H=c[15];a[0]=d*e+g*m+h*u+j*C;a[1]=d*f+g*n+h*w+j*D;a[2]=d*i+g*p+h*x+j*G;a[3]=d*k+g*s+h*z+j*I;a[4]=l*e+o*m+q*u+r*C;a[5]=l*f+o*n+q*w+r*D;a[6]=l*i+o*p+q*x+r*G;a[7]=l*k+o*s+q*z+r*I;a[8]=t*e+v*m+y*u+A*C;a[9]=t*f+v*n+y*w+A*D;a[10]=t*i+v*p+y*x+A*G;a[11]=t*k+v*s+y*z+A*I;a[12]=B*e+E*m+F*u+H*C;a[13]=B*f+E*n+F*w+H*D;a[14]=B*i+E*p+F*x+H*G;a[15]=B*k+E*s+F*z+H*I;return a};WPACS.wp0bj6.scale=function(b,c,a){if(!a)a=WPACS.wp0bj1.ArrayBuff?new Float32Array(16):new Array(16);a[0]=b[0]*c[0];a[1]=b[1]*c[0];a[2]=b[2]*c[0];a[3]=b[3]*c[0];a[4]=b[4]*c[1];a[5]=b[5]*c[1];a[6]=b[6]*c[1];a[7]=b[7]*c[1];a[8]=b[8]*c[2];a[9]=b[9]*c[2];a[10]=b[10]*c[2];a[11]=b[11]*c[2];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};WPACS.wp0bj6.translate=function(a,c,b){if(!b)b=WPACS.wp0bj1.ArrayBuff?new Float32Array(16):new Array(16);if(a!=b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11]}b[12]=a[0]*c[0]+a[4]*c[1]+a[8]*c[2]+a[12];b[13]=a[1]*c[0]+a[5]*c[1]+a[9]*c[2]+a[13];b[14]=a[2]*c[0]+a[6]*c[1]+a[10]*c[2]+a[14];b[15]=a[3]*c[0]+a[7]*c[1]+a[11]*c[2]+a[15];return b};WPACS.wp0bj6.rotate=function(b,t,c,a){var h=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);if(!h)return null;if(!a)a=WPACS.wp0bj1.ArrayBuff?new Float32Array(16):new Array(16);var d=c[0],e=c[1],f=c[2];if(h!=1){h=1/h;d*=h;e*=h;f*=h}var i=Math.sin(t),k=Math.cos(t),g=1-k,u=b[0],v=b[1],w=b[2],x=b[3],y=b[4],z=b[5],A=b[6],B=b[7],C=b[8],D=b[9],E=b[10],F=b[11],l=d*d*g+k,m=e*d*g+f*i,n=f*d*g-e*i,o=d*e*g-f*i,p=e*e*g+k,q=f*e*g+d*i,r=d*f*g+e*i,s=e*f*g-d*i,j=f*f*g+k;if(t){if(b!=a){a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15]}}else a=b;a[0]=u*l+y*m+C*n;a[1]=v*l+z*m+D*n;a[2]=w*l+A*m+E*n;a[3]=x*l+B*m+F*n;a[4]=u*o+y*p+C*q;a[5]=v*o+z*p+D*q;a[6]=w*o+A*p+E*q;a[7]=x*o+B*p+F*q;a[8]=u*r+y*s+C*j;a[9]=v*r+z*s+D*j;a[10]=w*r+A*s+E*j;a[11]=x*r+B*s+F*j;return a};WPACS.wp0bj6.lookAt=function(p,l,q,a){var m=p[0],n=p[1],o=p[2],r=q[0],s=q[1],t=q[2],u=l[0],v=l[1],w=l[2];if(!a)a=WPACS.wp0bj1.ArrayBuff?new Float32Array(16):new Array(16);if(m==u&&n==v&&o==w)return WPACS.wp0bj6.identity(a);var f,g,h,i,j,k,c,d,e,b;c=m-l[0];d=n-l[1];e=o-l[2];b=1/Math.sqrt(c*c+d*d+e*e);c*=b;d*=b;e*=b;f=s*e-t*d;g=t*c-r*e;h=r*d-s*c;b=Math.sqrt(f*f+g*g+h*h);if(!b){f=0;g=0;h=0}else{b=1/b;f*=b;g*=b;h*=b}i=d*h-e*g;j=e*f-c*h;k=c*g-d*f;b=Math.sqrt(i*i+j*j+k*k);if(!b){i=0;j=0;k=0}else{b=1/b;i*=b;j*=b;k*=b}a[0]=f;a[1]=i;a[2]=c;a[3]=0;a[4]=g;a[5]=j;a[6]=d;a[7]=0;a[8]=h;a[9]=k;a[10]=e;a[11]=0;a[12]=-(f*m+g*n+h*o);a[13]=-(i*m+j*n+k*o);a[14]=-(c*m+d*n+e*o);a[15]=1;return a};WPACS.wp0bj6.perspective=function(g,f,b,c,a){if(!a)a=WPACS.wp0bj1.ArrayBuff?new Float32Array(16):new Array(16);var e=b*Math.tan(g*Math.PI/360),j=e*f,h=j*2,i=e*2,d=c-b;a[0]=b*2/h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b*2/i;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=-(c+b)/d;a[11]=-1;a[12]=0;a[13]=0;a[14]=-(c*b*2)/d;a[15]=0;return a};WPACS.wp0bj6.perspective1=function(g,f,e,h,b,c,a){if(!a)a=WPACS.wp0bj1.ArrayBuff?new Float32Array(16):new Array(16);var i=f-g,j=h-e,d=c-b;a[0]=b*2/i;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b*2/j;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=-(c+b)/d;a[11]=-1;a[12]=0;a[13]=0;a[14]=-(c*b*2)/d;a[15]=0;return a};WPACS.wp0bj6.ortho=function(g,f,e,h,b,c,a){if(!a)a=WPACS.wp0bj1.ArrayBuff?new Float32Array(16):new Array(16);var i=f-g,j=h-e,d=c-b;a[0]=2/i;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2/j;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=-2/d;a[11]=0;a[12]=0;a[13]=0;a[14]=-(c+b)/d;a[15]=1;return a};WPACS.wp0bj6.transpose=function(b,a){if(!a)a=WPACS.wp0bj1.ArrayBuff?new Float32Array(16):new Array(16);a[0]=b[0];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=b[1];a[5]=b[5];a[6]=b[9];a[7]=b[13];a[8]=b[2];a[9]=b[6];a[10]=b[10];a[11]=b[14];a[12]=b[3];a[13]=b[7];a[14]=b[11];a[15]=b[15];return a};WPACS.wp0bj6.inverse=function(c,a){var d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],i=c[5],j=c[6],k=c[7],l=c[8],m=c[9],n=c[10],o=c[11],p=c[12],q=c[13],r=c[14],s=c[15],v=d*i-e*h,w=d*j-f*h,x=d*k-g*h,y=e*j-f*i,z=e*k-g*i,A=f*k-g*j,B=l*q-m*p,C=l*r-n*p,D=l*s-o*p,E=m*r-n*q,t=m*s-o*q,u=n*s-o*r,b=1/(v*u-w*t+x*E+y*D-z*C+A*B);if(!a)a=WPACS.wp0bj1.ArrayBuff?new Float32Array(16):new Array(16);a[0]=(i*u-j*t+k*E)*b;a[1]=(-e*u+f*t-g*E)*b;a[2]=(q*A-r*z+s*y)*b;a[3]=(-m*A+n*z-o*y)*b;a[4]=(-h*u+j*D-k*C)*b;a[5]=(d*u-f*D+g*C)*b;a[6]=(-p*A+r*x-s*w)*b;a[7]=(l*A-n*x+o*w)*b;a[8]=(h*t-i*D+k*B)*b;a[9]=(-d*t+e*D-g*B)*b;a[10]=(p*z-q*x+s*v)*b;a[11]=(-l*z+m*x-o*v)*b;a[12]=(-h*E+i*C-j*B)*b;a[13]=(d*E-e*C+f*B)*b;a[14]=(-p*y+q*w-r*v)*b;a[15]=(l*y-m*w+n*v)*b;return a};WPACS.wp0bj6.vecxmul=function(j,a,e,l){var b=j.x,c=j.y,d=j.z,f=WPACS.wp0bj1.isBooleanType(l)&&l?0:1,m=a[3]*b+a[7]*c+a[11]*d+a[15],g,h,i;if(m==1){g=a[0]*b+a[4]*c+a[8]*d+a[12]*f;h=a[1]*b+a[5]*c+a[9]*d+a[13]*f;i=a[2]*b+a[6]*c+a[10]*d+a[14]*f}else{var k=1/m;g=(a[0]*b+a[4]*c+a[8]*d+a[12]*f)*k;h=(a[1]*b+a[5]*c+a[9]*d+a[13]*f)*k;i=(a[2]*b+a[6]*c+a[10]*d+a[14]*f)*k}if(!e)e=new WPACS.wp0bj5(g,h,i);else{e.x=g;e.y=h;e.z=i}return e};WPACS.Matrix=function(b){this.a=1;this.b=0;this.c=0;this.d=1;this.e=0;this.f=0;if(b!=null&&b!=undefined){var a=b.split(",");if(a.length==6){this.a=Number(a[0]);this.b=Number(a[1]);this.c=Number(a[2]);this.d=Number(a[3]);this.e=Number(a[4]);this.f=Number(a[5])}}};WPACS.Matrix.prototype.setValues=function(a){if(a.length==6){this.a=a[0];this.b=a[1];this.c=a[2];this.d=a[3];this.e=a[4];this.f=a[5]}else if(a.length==9){this.a=a[0];this.b=a[3];this.c=a[1];this.d=a[4];this.e=a[2];this.f=a[5]}};WPACS.Matrix.prototype.setScale=function(a,b){this.b=0;this.c=0;this.e=0;this.f=0;this.a=a;this.d=b};WPACS.Matrix.prototype.setTranslate=function(){this.a=1;this.b=0;this.c=0;this.d=1;this.e=sx;this.f=sy};WPACS.Matrix.prototype.setRotation=function(a){a=a*Math.PI/180;this.a=Math.cos(a);this.b=Math.sin(a);this.c=-Math.sin(a);this.d=Math.cos(a);this.e=0;this.f=0};WPACS.Matrix.prototype.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.e+","+this.f};WPACS.Matrix.prototype.postConcat=function(a){var b=a.a*this.a+a.c*this.b,c=a.b*this.a+a.d*this.b,d=a.a*this.c+a.c*this.d,e=a.b*this.c+a.d*this.d,f=a.a*this.e+a.c*this.f+a.e,g=a.b*this.e+a.d*this.f+a.f;this.a=b;this.b=c;this.c=d;this.d=e;this.e=f;this.f=g};WPACS.Matrix.prototype.inverse=function(){function e(f,c){if(c==1)return f[0][0];for(var d,b,j,k,g=0,h=[],a=0;a<c;++a)h[a]=new Array(c);for(a=0;a<c;++a){for(d=0;d<c-1;++d)for(b=0;b<c-1;++b){j=d+1;k=b>=a?b+1:b;h[d][b]=f[j][k]}var i=e(h,c-1);if(a%2==0)g+=f[0][a]*i;else g-=f[0][a]*i}return g}function h(k,g,c){if(c==1){g[0][0]=1;return}for(var b,d,f,i,j,h=[],a=0;a<c;++a)h[a]=new Array(c);for(a=0;a<c;++a)for(b=0;b<c;++b){for(d=0;d<c-1;++d)for(f=0;f<c-1;++f){i=d>=a?d+1:d;j=f>=b?f+1:f;h[d][f]=k[i][j]}g[b][a]=e(h,c-1);if((a+b)%2==1)g[b][a]=-1*g[b][a]}}for(var a=[],f=[],c=3,b=0;b<c;++b){a[b]=new Array(c);f[b]=new Array(c)}a[0][0]=this.a;a[0][1]=this.c;a[0][2]=this.e;a[1][0]=this.b;a[1][1]=this.d;a[1][2]=this.f;a[2][0]=0;a[2][1]=0;a[2][2]=1;var g=e(a,c);if(Math.abs(g-0)<=1e-5)return false;h(a,f,c);for(var b=0;b<c;++b)for(var d=0;d<c;++d)a[b][d]=f[b][d]/g;this.a=a[0][0];this.b=a[1][0];this.c=a[0][1];this.d=a[1][1];this.e=a[0][2];this.f=a[1][2];return true};WPACS.Matrix.prototype.getTranslateX=function(){return this.e};WPACS.Matrix.prototype.getTranslateY=function(){return this.f};WPACS.Matrix.prototype.getShearX=function(){return this.c};WPACS.Matrix.prototype.getShearY=function(){return this.b};WPACS.Matrix.prototype.getScaleX=function(){return this.a};WPACS.Matrix.prototype.getScaleY=function(){return this.d};WPACS.Matrix.prototype.calNewPoint=function(a,b){var c=this.a*a+this.c*b+this.e,d=this.b*a+this.d*b+this.f;return new WPACS.wp0bj2(c,d)};Date.prototype.isLeapYear=function(){return 0==this.getYear()%4&&(this.getYear()%100!=0||this.getYear()%400==0)};Date.prototype.Format=function(c){var a=c,d=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"];a=a.replace(/yyyy|YYYY/,this.getFullYear());a=a.replace(/yy|YY/,this.getYear()%100>9?(this.getYear()%100).toString():"0"+this.getYear()%100);var b=this.getMonth()+1;a=a.replace(/MM/,b>9?b.toString():"0"+b);a=a.replace(/M/g,b);a=a.replace(/w|W/g,d[this.getDay()]);a=a.replace(/dd|DD/,this.getDate()>9?this.getDate().toString():"0"+this.getDate());a=a.replace(/d|D/g,this.getDate());a=a.replace(/hh|HH/,this.getHours()>9?this.getHours().toString():"0"+this.getHours());a=a.replace(/h|H/g,this.getHours());a=a.replace(/mm/,this.getMinutes()>9?this.getMinutes().toString():"0"+this.getMinutes());a=a.replace(/m/g,this.getMinutes());a=a.replace(/ss|SS/,this.getSeconds()>9?this.getSeconds().toString():"0"+this.getSeconds());a=a.replace(/s|S/g,this.getSeconds());return a};Date.prototype.DateDiff=function(c,a){var b=this;if(typeof a=="string")a=StringToDate(a);switch(c){case"s":return parseInt((a-b)/1e3);case"n":return parseInt((a-b)/6e4);case"h":return parseInt((a-b)/3.6e6);case"d":return parseInt((a-b)/8.64e7);case"w":return parseInt((a-b)/(8.64e7*7));case"m":return a.getMonth()+1+(a.getFullYear()-b.getFullYear())*12-(b.getMonth()+1);case"y":return a.getFullYear()-b.getFullYear()}};Date.prototype.DateAdd=function(c,b){var a=this;switch(c){case"s":return new Date(a.valueOf()+1e3*b);case"n":return new Date(a.valueOf()+6e4*b);case"h":return new Date(a.valueOf()+3.6e6*b);case"d":return new Date(a.valueOf()+8.64e7*b);case"w":return new Date(a.valueOf()+8.64e7*7*b);case"q":return new Date(a.getFullYear(),a.getMonth()+b*3,a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds());case"m":return new Date(a.getFullYear(),a.getMonth()+b,a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds());case"y":return new Date(a.getFullYear()+b,a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds())}};Date.prototype.toString=function(c){var a=this,b=a.toLocaleDateString();if(c){var d=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"];b+=" \u661f\u671f"+d[a.getDay()]}return b};Date.prototype.toArray=function(){var b=this,a=Array();a[0]=b.getFullYear();a[1]=b.getMonth();a[2]=b.getDate();a[3]=b.getHours();a[4]=b.getMinutes();a[5]=b.getSeconds();return a};Date.prototype.DatePart=function(c){var b=this,a="",d=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"];switch(c){case"y":a=b.getFullYear();break;case"m":a=b.getMonth()+1;break;case"d":a=b.getDate();break;case"w":a=d[b.getDay()];break;case"ww":a=b.WeekNumOfYear();break;case"h":a=b.getHours();break;case"n":a=b.getMinutes();break;case"s":a=b.getSeconds()}return a};Date.prototype.MaxDayOfDate=function(){var c=this,b=c.toArray(),a=new Date(b[0],b[1]+1,1),e=a.dateAdd(1,"m",1),d=dateDiff(a.Format("yyyy-MM-dd"),e.Format("yyyy-MM-dd"));return d};Date.prototype.WeekNumOfYear=function(){var b=this,a=b.toArray(),d=a[0],c=a[1]+1,e=a[2];document.write('< script language="VBScript"> \n');document.write('myDate = DateValue("'+c+"-"+e+"-"+d+'") \n');document.write('result = DatePart("ww", myDate) \n');document.write(" \n");return result};WPACS.wpDate={daysBetween:function(a,b){var c=a.substring(5,a.lastIndexOf("-")),g=a.substring(a.length,a.lastIndexOf("-")+1),e=a.substring(0,a.indexOf("-")),d=b.substring(5,b.lastIndexOf("-")),h=b.substring(b.length,b.lastIndexOf("-")+1),f=b.substring(0,b.indexOf("-")),i=(Date.parse(c+"/"+g+"/"+e)-Date.parse(d+"/"+h+"/"+f))/8.64e7;return Math.abs(i)},StringToDate:function(c){var d=Date.parse(c),a=new Date(d);if(isNaN(a)){var b=c.split("-");a=new Date(b[0],--b[1],b[2])}return a},IsValidDate:function(d){var a=d.replace(/(^\s+|\s+$)/g,"");if(a=="")return true;var e=a.replace(/[\d]{ 4,4 }[\-/]{ 1 }[\d]{ 1,2 }[\-/]{ 1 }[\d]{ 1,2 }/g,"");if(e==""){var c=new Date(a.replace(/\-/g,"/")),b=a.split(/[-/:]/);if(b[0]!=c.getYear()||b[1]!=c.getMonth()+1||b[2]!=c.getDate())return false}else return false;return true},CheckDateTime:function(d){var c=/^(\d+)-(\d{ 1,2 })-(\d{ 1,2 }) (\d{ 1,2 }):(\d{ 1,2 }):(\d{ 1,2 })$/,a=d.match(c);if(a==null)return false;a[2]=a[2]-1;var b=new Date(a[1],a[2],a[3],a[4],a[5],a[6]);return b.getFullYear()!=a[1]?false:b.getMonth()!=a[2]?false:b.getDate()!=a[3]?false:b.getHours()!=a[4]?false:b.getMinutes()!=a[5]?false:b.getSeconds()!=a[6]?false:true}};Image.prototype.PixelData=null;Image.prototype.OvlayData=null;Image.prototype.StrechData=function(f,i,b){if(!b)b=this.PixelData;if(!b)return false;var h=this.width,g=this.height,a,d,j=i-f,e=0,c=WPACS.wp0bj8(256,"i32");if(c==null)return false;for(a=0;a<256;a++)c[a]=f+a*j/255|0;for(a=0;a<g;a++)for(d=0;d<h;d++){var k=b[e];b[e++]=c[k]}c=null;b=null;return true};Image.prototype.SetSource=function(f,e,a,c,b){var d=this.onload;this.onload=function(){var k=this.width,i=this.height,g,h=null,q=null,v=document.createElement("canvas"),D=v.getContext("2d");v.width=k+1;v.height=i+1;D.drawImage(this,0,0,k,i);g=D.getImageData(0,0,k,i);v=null;var n=0,m=0,p=k,u=k*4;if(a>8&&a<=16){if(!WPACS.wp0bj1.isBooleanType(c))c=a==16?false:true;h=WPACS.wp0bj8(i*p,c?"i16":"u16");if(e){for(var l=0;l<i;l++){for(var f=m,j=n,o=0;o<k;o++){h[j]=g.data[f];f+=4;j++}n+=p;m+=u}var s=0,r=0;if(b){if(b.minv)s=b.minv;if(b.maxv)r=b.maxv}if(s==0&&r==0)if(c){s=-Math.pow(2,a-1)|0;r=Math.pow(2,a-1)-1|0}else{s=0;r=Math.pow(2,a)-1|0}this.StrechData(s,r,h)}else{if(b&&b.ovlinc){var C=Math.ceil(k*i/8);q=WPACS.wp0bj8(C,"u8");for(var l=0;l<C;l++)q[l]=0}for(var E=WPACS.wp0bj1.ArrayBuff?true:false,l=0;l<i;l++){for(var f=m,j=n,o=0;o<k;o++){var t=0,y=0,x=0;if(g.data[f+3]!=0){t=g.data[f];y=g.data[f+1];x=g.data[f+2]}var w=x&63|(y&31)<<6|(t&31)<<11;if(E)h[j]=w;else h[j]=c&&w>32768?w-65535-1:w;if(q!=null&&(t&32)!=0){var B=j/8|0,F=j-B*8;q[B]|=1<<F}f+=4;j++}n+=p;m+=u}}}else if(a==-32){h=WPACS.wp0bj8(i*p,"u32");for(var l=0;l<i;l++){for(var f=m,j=n,o=0;o<k;o++){var t=0,y=0,x=0;if(g.data[f+3]!=0){t=g.data[f];y=g.data[f+1];x=g.data[f+2]}h[j]=x|y<<8|t<<16;f+=4;j++}n+=p;m+=u}}else{var A=(a+7)/8|0,p=k*A;h=WPACS.wp0bj8(i*p,"u8");for(var l=0;l<i;l++){for(var f=m,j=n,o=0;o<k;o++){for(var z=0;z<A;z++)h[j+z]=g.data[f+z];f+=4;j+=A}n+=p;m+=u}}this.PixelData=h;this.OvlayData=q;h=q=null;g=null;d&&d.call(this)};if(WPACS.CONSTDEF.CROSSORIGIN||WPACS.CONSTDEF.WPURL_ROOT.substring(0,4).toLowerCase()=="http")this.crossOrigin="";this.src=f};Image.prototype.DestroyObj=function(){if(this.PixelData)this.PixelData=null;if(this.OvlayData)this.OvlayData=null};WPACS.fmtLayOut=function(c,b){var a=null;this.options={type:1,n:4,nm:[2,2]};this.save=function(){a=this.options};this.restore=function(){if(a!=null)this.options=a;a=null};this.DestroyObj=function(){a=null;this.options={}};this.SetNormal(c,b)};WPACS.fmtLayOut.prototype.IsOne_One=function(){return this.options.type==1&&this.options.n==1};WPACS.fmtLayOut.prototype.IsEqual=function(a){if(this.options.type!=a.options.type)return false;if(this.options.n!=a.options.n)return false;if(this.options.nm.length!=a.options.nm.length)return false;for(var b=0;b<this.options.nm.length;b++)if(this.options.nm[b]!=a.options.nm[b])return false;return true};WPACS.fmtLayOut.prototype.SetNormal=function(b,a){if(b==undefined&&a==undefined)return false;if(a==undefined){var c=b.split(",");if(c.length<2)return false;b=c[0];a=c[1]}if(WPACS.wp0bj1.isStringType(b))b=parseInt(b);if(WPACS.wp0bj1.isStringType(a))a=parseInt(a);var d=b*a;if(d<=0)return false;this.options={type:1,n:d,nm:[]};this.options.nm[0]=b;this.options.nm[1]=a;return true};WPACS.fmtLayOut.prototype.SetRows=function(c){var a,d=0,b=[];try{if(WPACS.wp0bj1.isStringType(c)){var e=c.split(",");for(a=0;a<e.length;a++)b[a]=parseInt(e[a])}else if(WPACS.wp0bj1.isObject(c))for(a=0;a<c.length;a++)b[a]=WPACS.wp0bj1.isStringType(c[a])?parseInt(c[a]):c[a];for(a=0;a<b.length;a++)if(b[a]>0)d+=b[a];else break;if(a<b.length)d=0}catch(f){d=0}if(d<=0){b=null;return false}this.options={type:2,n:d,nm:[]};for(a=0;a<b.length;a++)this.options.nm[a]=b[a];b=null;return true};WPACS.fmtLayOut.prototype.SetCols=function(c){var a,d=0,b=[];try{if(WPACS.wp0bj1.isStringType(c)){var e=c.split(",");for(a=0;a<e.length;a++)b[a]=parseInt(e[a])}else if(WPACS.wp0bj1.isObject(c))for(a=0;a<c.length;a++)b[a]=WPACS.wp0bj1.isStringType(c[a])?parseInt(c[a]):c[a];for(a=0;a<b.length;a++)if(b[a]>0)d+=b[a];else break;if(a<b.length)d=0}catch(f){d=0}if(d<=0){b=null;return false}this.options={type:3,n:d,nm:[]};for(a=0;a<b.length;a++)this.options.nm[a]=b[a];b=null;return true};WPACS.fmtLayOut.prototype.toString=function(){if(this.options.type==1)return"STANDARD\\"+this.options.nm[1]+","+this.options.nm[0];if(this.options.type==2){for(var b="ROW\\"+this.options.nm[0],a=1;a<this.options.nm.length;a++)b+=","+this.options.nm[a];return b}if(this.options.type==3){for(var b="COL\\"+this.options.nm[0],a=1;a<this.options.nm.length;a++)b+=","+this.options.nm[a];return b}return""};WPACS.fmtLayOut.prototype.HitIndex=function(i,j,h,g){if(this.options.type==1){var f=h/this.options.nm[1]|0,e=g/this.options.nm[0]|0,d=j/e|0,c=i/f|0;return d*this.options.nm[1]+c}if(this.options.type==2){for(var e=g/this.options.nm.length|0,d=j/e|0,f=h/this.options.nm[d]|0,b=0,a=0;a<d;a++)b+=this.options.nm[a];return b+i/f|0}if(this.options.type==3){for(var f=h/this.options.nm.length|0,c=i/f|0,e=g/this.options.nm[c]|0,b=0,a=0;a<c;a++)b+=this.options.nm[a];return b+j/e|0}return 0};WPACS.wp0bj7=function(){var a={metaclr:WPACS.CONSTDEF.CLR_IMETA,txtclr:WPACS.CONSTDEF.CLR_MTEXT,text:"",closed:true,alpha:0,hitoff:WPACS.wp0bj7.HitOffset,allowmm:true,visible:true};this.options=a;this.itype=0;this.ptArray=null;this.UserTag=undefined;this.DestroyObj=function(){a={};this.ptArray=null;this.UserTag=undefined}};WPACS.wp0bj7.AllowMetaMove=true;WPACS.wp0bj7.HitOffset=WPACS.wp0bj1.IsMobile?8:5;WPACS.wp0bj7.DrawMetaText=function(a,j,n,o,h,i,l,e){if(WPACS.wp0bj1.isUndefined(j)||j=="")return;var m="12px arial",b=15;if(!WPACS.wp0bj1.isUndefined(e)&&e!=""){m=e;b=parseInt(e)+3}var k="start";if(!WPACS.wp0bj1.isUndefined(i)&&i!="")k=i;if(!WPACS.wp0bj1.isUndefined(l)&&l=="bottom")b=0-b;a.save();a.fillStyle=n;a.strokeStyle=n;a.font=m;a.textAlign=k;var f=j.split("\\n");if(b>0)for(var c=0;c<f.length;c++)for(var g=f[c].split("\n"),d=0;d<g.length;d++){a.fillText(g[d],o,h);h+=b}else for(var c=f.length-1;c>=0;c--)for(var g=f[c].split("\n"),d=g.length-1;d>=0;d--){a.fillText(g[d],o,h);h+=b}a.restore()};WPACS.wp0bj7.DrawMetaHScale=function(a,m,p,n,l){var d=m/2|0,e=(m-d)/2|0,b=p-15,f=e+d,o=b,c,i=12,q=6,j=10,h=WPACS.CONSTDEF.CLR_SCALE;a.save();a.lineWidth=1;a.fillStyle=h;a.strokeStyle=h;a.beginPath();a.moveTo(e,b);a.lineTo(f,o);var k=d/j;for(c=0;c<j;c++){var g=e+c*k;a.moveTo(g,b);a.lineTo(g,b-i)}a.moveTo(f,b);a.lineTo(f,b-i);for(c=0;c<j;c++){var g=e+c*k+k/2;a.moveTo(g,b);a.lineTo(g,b-q)}a.stroke();a.restore();var r=WPACS.wp0bj1.isUndefined(l)?(1*d/n|0).toString()+"pt":(l*d/n|0).toString()+"mm";WPACS.wp0bj7.DrawMetaText(a,r,h,f,o-i-5,"end")};WPACS.wp0bj7.DrawMetaVScale=function(a,p,l,n,k){var d=l/2|0,e=(l-d)/2|0,b=p-15,f=e+d,o=b,c,m=12,q=6,i=10,h=WPACS.CONSTDEF.CLR_SCALE;a.save();a.lineWidth=1;a.fillStyle=h;a.strokeStyle=h;a.beginPath();a.moveTo(b,e);a.lineTo(o,f);var j=d/i;for(c=0;c<i;c++){var g=e+c*j;a.moveTo(b,g);a.lineTo(b-m,g)}a.moveTo(b,f);a.lineTo(b-m,f);for(c=0;c<i;c++){var g=e+c*j+j/2;a.moveTo(b,g);a.lineTo(b-q,g)}a.stroke();a.restore();var r=WPACS.wp0bj1.isUndefined(k)?(1*d/n|0).toString()+"pt":(k*d/n|0).toString()+"mm";WPACS.wp0bj7.DrawMetaText(a,r,h,o,f+16,"end")};WPACS.wp0bj7.prototype.SetColor=function(a){this.itype==7?(this.options.txtclr=a):(this.options.metaclr=a)};WPACS.wp0bj7.prototype.CreateLine=function(a,c,b,d){this.options.text="";this.options.metaclr=WPACS.CONSTDEF.CLR_LINE;this.itype=1;this.ptArray=new Array(2);this.ptArray[0]={x:a,y:c};this.ptArray[1]={x:b,y:d}};WPACS.wp0bj7.prototype.CreateRect=function(a,c,b,d){this.options.text="";this.options.metaclr=WPACS.CONSTDEF.CLR_RECT;this.itype=2;this.ptArray=new Array(2);this.ptArray[0]={x:a,y:c};this.ptArray[1]={x:b,y:d}};WPACS.wp0bj7.prototype.CreateCircle=function(a,c,b,d){this.options.text="";this.options.metaclr=WPACS.CONSTDEF.CLR_CIRCLE;this.itype=3;this.ptArray=new Array(2);this.ptArray[0]={x:a,y:c};this.ptArray[1]={x:b,y:d}};WPACS.wp0bj7.prototype.CreatePolygon=function(b){this.options.text="";this.options.metaclr=WPACS.CONSTDEF.CLR_POLYGON;this.itype=4;this.ptArray=[];for(var a=0;a<b.length;a++)this.ptArray[a]={x:b[a].x,y:b[a].y}};WPACS.wp0bj7.prototype.CreateAngle=function(a,d,b,e,c,f){this.options.text="";this.options.metaclr=WPACS.CONSTDEF.CLR_ANGLE;this.itype=5;this.ptArray=new Array(3);this.ptArray[0]={x:a,y:d};this.ptArray[1]={x:b,y:e};this.ptArray[2]={x:c,y:f}};WPACS.wp0bj7.prototype.CreateArrow=function(a,c,b,d){this.options.text="";this.options.metaclr=WPACS.CONSTDEF.CLR_ARROW;this.itype=6;this.ptArray=new Array(2);this.ptArray[0]={x:a,y:c};this.ptArray[1]={x:b,y:d}};WPACS.wp0bj7.prototype.CreateText=function(b,c,a){this.options.text=a;this.itype=7;this.ptArray=new Array(1);this.ptArray[0]={x:b,y:c}};WPACS.wp0bj7.prototype.CreateHCR=function(a,c,b,d){this.options.text="";this.options.metaclr=WPACS.CONSTDEF.CLR_HCR;this.itype=8;this.ptArray=new Array(6);var e=a+(b-a)/2|0;this.ptArray[0]={x:a,y:c};this.ptArray[1]={x:e,y:c};this.ptArray[2]={x:b,y:c};this.ptArray[3]={x:a,y:d};this.ptArray[4]={x:e,y:d};this.ptArray[5]={x:b,y:d}};WPACS.wp0bj7.prototype.ModifyHCR=function(b,d){var a=this.ptArray[0].x,c=this.ptArray[0].y,e=a+(b-a)/2|0;this.ptArray[0]={x:a,y:c};this.ptArray[1]={x:e,y:c};this.ptArray[2]={x:b,y:c};this.ptArray[3]={x:a,y:d};this.ptArray[4]={x:e,y:d};this.ptArray[5]={x:b,y:d}};WPACS.wp0bj7.prototype.AutoText=function(d,h){if(this.ptArray==null||this.ptArray.length<1)return;function n(a,d,b,e,c,f){var g=Math.sqrt((a-b)*(a-b)+(d-e)*(d-e)),h=Math.sqrt((c-b)*(c-b)+(f-e)*(f-e)),i=Math.sqrt((a-c)*(a-c)+(d-f)*(d-f)),j=(g*g+h*h-i*i)/(2*g*h);return 180*Math.acos(j)/Math.PI}switch(this.itype){case 1:var a=this.ptArray[1].x-this.ptArray[0].x,b=this.ptArray[1].y-this.ptArray[0].y,w=Math.sqrt(a*a+b*b);if(!WPACS.wp0bj1.isUndefined(d))this.options.text=(d*w).toFixed(1)+"mm";else this.options.text=""+(w|0)+"pt";return;case 2:var j=Math.abs(this.ptArray[1].x-this.ptArray[0].x)/2,k=Math.abs(this.ptArray[1].y-this.ptArray[0].y)/2,g=(j+k)*4,f=4*j*k;if(!WPACS.wp0bj1.isUndefined(d))this.options.text="\u5468\u957f: "+(d*g).toFixed(1)+"mm \u9762\u79ef: "+(d*f).toFixed(1)+"mm2\r\n";else this.options.text="\u5468\u957f: "+(g|0)+"pt \u9762\u79ef: "+(f|0)+"pt2\r\n";var c=!WPACS.wp0bj1.isUndefined(h)?h(2,this.ptArray):null;if(c!=null)this.options.text+="\u6700\u5927\u503c:"+c.max+" \u6700\u5c0f\u503c:"+c.min+" \u5747\u503c:"+(c.av|0);return;case 3:var j=Math.abs(this.ptArray[1].x-this.ptArray[0].x)/2,k=Math.abs(this.ptArray[1].y-this.ptArray[0].y)/2,g=(j+k)*Math.PI,f=Math.PI*j*k;if(!WPACS.wp0bj1.isUndefined(d))this.options.text="\u5468\u957f: "+(d*g).toFixed(1)+"mm \u9762\u79ef: "+(d*f).toFixed(1)+"mm2\r\n";else this.options.text="\u5468\u957f: "+(g|0)+"pt \u9762\u79ef: "+(f|0)+"pt2\r\n";var c=!WPACS.wp0bj1.isUndefined(h)?h(3,this.ptArray):null;if(c!=null)this.options.text+="\u6700\u5927\u503c:"+c.max+" \u6700\u5c0f\u503c:"+c.min+" \u5747\u503c:"+(c.av|0);return;case 4:for(var a,b,g=0,f=0,i=this.ptArray.length,e=1;e<i;e++){a=this.ptArray[e].x-this.ptArray[e-1].x;b=this.ptArray[e].y-this.ptArray[e-1].y;g+=Math.sqrt(a*a+b*b);f+=(this.ptArray[e-1].y+this.ptArray[e].y)*(this.ptArray[e-1].x-this.ptArray[e].x)}a=this.ptArray[0].x-this.ptArray[i-1].x;b=this.ptArray[0].y-this.ptArray[i-1].y;g+=Math.sqrt(a*a+b*b);f+=(this.ptArray[i-1].y+this.ptArray[0].y)*(this.ptArray[i-1].x-this.ptArray[0].x);f=Math.abs(f/2);if(!WPACS.wp0bj1.isUndefined(d))this.options.text="\u5468\u957f: "+(d*g).toFixed(1)+"mm \u9762\u79ef: "+(d*f).toFixed(1)+"mm2\r\n";else this.options.text="\u5468\u957f: "+(g|0)+"pt \u9762\u79ef: "+(f|0)+"pt2\r\n";var c=!WPACS.wp0bj1.isUndefined(h)?h(4,this.ptArray):null;if(c!=null)this.options.text+="\u6700\u5927\u503c:"+c.max+" \u6700\u5c0f\u503c:"+c.min+" \u5747\u503c:"+(c.av|0);return;case 5:var l=n(this.ptArray[0].x,this.ptArray[0].y,this.ptArray[1].x,this.ptArray[1].y,this.ptArray[2].x,this.ptArray[2].y);this.options.text="@ "+Math.floor(l);return;case 6:this.options.text="";return;case 7:return;case 8:var a,b,o,m,p,l;a=this.ptArray[0].x-this.ptArray[2].x;b=this.ptArray[0].y-this.ptArray[2].y;o=Math.sqrt(a*a+b*b);a=this.ptArray[3].x-this.ptArray[5].x;b=this.ptArray[3].y-this.ptArray[5].y;m=Math.sqrt(a*a+b*b);if(m==0)return;p=o/m;var q,t,r,u,s,v;a=this.ptArray[3].x-this.ptArray[0].x;b=this.ptArray[3].y-this.ptArray[0].y;q=this.ptArray[5].x-a,t=this.ptArray[5].y-b;r=this.ptArray[0].x,u=this.ptArray[0].y;s=this.ptArray[2].x,v=this.ptArray[2].y;l=n(q,t,r,u,s,v);this.options.text="\u6bd4\u7387: "+p.toFixed(1)+"\r\n\u5939\u89d2: "+Math.floor(l)+"deg";return}};WPACS.wp0bj7.prototype.DrawMeta=function(p,x){if(!this.options.visible)return;if(this.ptArray==null||this.ptArray.length<1)return;var d,a=new Array(this.ptArray.length);if(!WPACS.wp0bj1.isUndefined(x)){var C=p[0].width,A=p[0].height;for(d=0;d<this.ptArray.length;d++)a[d]=x(C,A,this.ptArray[d].x,this.ptArray[d].y)}else for(d=0;d<this.ptArray.length;d++)a[d]=new WPACS.wp0bj2(this.ptArray[d].x,this.ptArray[d].y);function z(h,g,j,i){function b(b,a){return{x:b.x*Math.cos(a)+b.y*Math.sin(a),y:b.y*Math.cos(a)-b.x*Math.sin(a)}}var c=Math.atan((g.x-h.x)/(g.y-h.y)),a=b(g,-c),k=b(h,-c),e={x:0,y:0},f={x:0,y:0},d=a.y-k.y>0?100:-100;e.x=a.x+d*(i||.04);e.y=a.y-d*(j||.08);f.x=a.x-d*(i||.04);f.y=a.y-d*(j||.08);var l=b(e,c),m=b(f,c);return{h1:l,h2:m}}var b=p[0].getContext("2d"),c=[],e=-1,f=-1,g=WPACS.wp0bj7.AllowMetaMove&&this.options.allowmm;b.save();b.lineWidth=1;b.strokeStyle=this.options.metaclr;b.fillStyle=this.options.metaclr;b.beginPath();switch(this.itype){case 1:b.moveTo(a[0].x,a[0].y);b.lineTo(a[1].x,a[1].y);e=a[1].x+5;f=a[1].y+5;if(g){c[0]={x:a[0].x,y:a[0].y};c[1]={x:a[1].x,y:a[1].y}}break;case 2:b.rect(a[0].x,a[0].y,a[1].x-a[0].x+1,a[1].y-a[0].y+1);if(this.options.alpha>0){var q=b.globalAlpha;b.globalAlpha=this.options.alpha;b.fill();b.globalAlpha=q}e=a[0].x;f=a[1].y+15;if(g){var l=a[0].x+(a[1].x-a[0].x)/2,m=a[0].y+(a[1].y-a[0].y)/2;c[0]={x:a[0].x,y:m};c[1]={x:a[1].x,y:m};c[2]={x:l,y:a[0].y};c[3]={x:l,y:a[1].y}}break;case 3:var i=Math.abs(a[1].x-a[0].x)/2,n=Math.abs(a[1].y-a[0].y)/2,v=a[0].x+(a[1].x-a[0].x)/2|0,w=a[0].y+(a[1].y-a[0].y)/2|0;if(i!=n){var u=i>n?i:n,r=i/u,s=n/u;b.scale(r,s);b.moveTo((v+i)/r,w/s);b.arc(v/r,w/s,u,0,2*Math.PI)}else b.arc(v,w,i,0,2*Math.PI);e=a[0].x-5;f=a[1].y+15;if(this.options.alpha>0){var q=b.globalAlpha;b.globalAlpha=this.options.alpha;b.fill();b.globalAlpha=q}if(g){var l=a[0].x+(a[1].x-a[0].x)/2,m=a[0].y+(a[1].y-a[0].y)/2;c[0]={x:a[0].x,y:m};c[1]={x:a[1].x,y:m};c[2]={x:l,y:a[0].y};c[3]={x:l,y:a[1].y}}break;case 4:var k,D,E,j;k=D=a[0].x;E=j=a[0].y;b.moveTo(a[0].x,a[0].y);for(var d=1;d<a.length;d++){b.lineTo(a[d].x,a[d].y);if(k>a[d].x)k=a[d].x;if(j<a[d].y)j=a[d].y}this.options.closed&&b.closePath();if(this.options.alpha>0){var q=b.globalAlpha;b.globalAlpha=this.options.alpha;b.fill();b.globalAlpha=q}e=k;f=j+15;if(g){var y=WPACS.wp0bj2.Center(a);c[0]={x:y.x,y:y.y}}break;case 5:b.moveTo(a[0].x,a[0].y);b.lineTo(a[1].x,a[1].y);b.lineTo(a[2].x,a[2].y);e=a[1].x+5;f=a[1].y+5;if(g){c[0]={x:a[0].x,y:a[0].y};c[1]={x:a[1].x,y:a[1].y};c[2]={x:a[2].x,y:a[2].y}}break;case 6:var t={x:a[0].x|0,y:a[0].y|0},h={x:a[1].x|0,y:a[1].y|0};b.moveTo(t.x,t.y);b.lineTo(h.x,h.y);var o=z(t,h);b.moveTo(h.x,h.y);b.lineTo(o.h1.x,o.h1.y);b.lineTo(o.h2.x,o.h2.y);b.lineTo(h.x,h.y);b.fill();if(g)c[0]={x:a[0].x,y:a[0].y};break;case 7:e=a[0].x;f=a[0].y;break;case 8:b.moveTo(a[0].x,a[0].y);b.lineTo(a[2].x,a[2].y);b.moveTo(a[3].x,a[3].y);b.lineTo(a[5].x,a[5].y);b.moveTo(a[1].x,a[1].y);b.lineTo(a[4].x,a[4].y);e=a[1].x+((a[4].x-a[1].x)/2|0)+5;f=a[1].y+((a[4].y-a[1].y)/2|0);if(g){c[0]={x:a[0].x,y:a[0].y};c[1]={x:a[1].x,y:a[1].y};c[2]={x:a[2].x,y:a[2].y};c[3]={x:a[3].x,y:a[3].y};c[4]={x:a[4].x,y:a[4].y};c[5]={x:a[5].x,y:a[5].y}}}b.stroke();b.restore();if(c.length>0){b.save();b.lineWidth=1;b.strokeStyle="#FF0000";for(var d=0;d<c.length;d++){b.beginPath();b.arc(c[d].x,c[d].y,3,0,2*Math.PI);b.stroke()}b.restore()}var B=WPACS.CONSTDEF.FNT_MTEXT;this.mesaText!=""&&WPACS.wp0bj7.DrawMetaText(b,this.options.text,this.options.txtclr,e,f,"start","",B);a=null;c=null;return};WPACS.wp0bj7.prototype.IsPointInMeta=function(b,c,o){if(!this.options.visible)return 0;if(this.ptArray==null||this.ptArray.length<1)return 0;var n=WPACS.wp0bj7.AllowMetaMove&&this.options.allowmm;if(o)if(!n)return 0;var g=this.options.hitoff;function d(k,l,c,d,i,j){var a,b,f,h,e;a=k-c;b=l-d;f=Math.sqrt(a*a+b*b);if(f<g)return 2;a=k-i;b=l-j;h=Math.sqrt(a*a+b*b);if(h<g)return 3;a=i-c;b=j-d;e=Math.sqrt(a*a+b*b);if(f+h-e>g)return 0;a=k-(c+(i-c)/2);b=l-(d+(j-d)/2);e=Math.sqrt(a*a+b*b);return e<g?4:1}if(this.itype==1){var a=d(b,c,this.ptArray[0].x,this.ptArray[0].y,this.ptArray[1].x,this.ptArray[1].y);if(a>0)return a>3?1:a}else if(this.itype==2){var a=d(b,c,this.ptArray[0].x,this.ptArray[0].y,this.ptArray[0].x,this.ptArray[1].y);if(a>0)return a==4?2:1;a=d(b,c,this.ptArray[1].x,this.ptArray[0].y,this.ptArray[1].x,this.ptArray[1].y);if(a>0)return a==4?3:1;a=d(b,c,this.ptArray[0].x,this.ptArray[0].y,this.ptArray[1].x,this.ptArray[0].y);if(a>0)return a==4?4:1;a=d(b,c,this.ptArray[0].x,this.ptArray[1].y,this.ptArray[1].x,this.ptArray[1].y);if(a>0)return a==4?5:1}else if(this.itype==3){var l=Math.abs(this.ptArray[1].x-this.ptArray[0].x)/2,m=Math.abs(this.ptArray[1].y-this.ptArray[0].y)/2,j=this.ptArray[0].x+(this.ptArray[1].x-this.ptArray[0].x)/2|0,k=this.ptArray[0].y+(this.ptArray[1].y-this.ptArray[0].y)/2|0,h=(b-j)*(b-j)/(l*l)+(c-k)*(c-k)/(m*m);if(Math.abs(h-1)>.15)return 0;var e=this.ptArray[0].x,f=this.ptArray[0].y+(this.ptArray[1].y-this.ptArray[0].y)/2,h=Math.sqrt((b-e)*(b-e)+(c-f)*(c-f));if(h<g)return 2;e=this.ptArray[1].x;f=this.ptArray[0].y+(this.ptArray[1].y-this.ptArray[0].y)/2;var h=Math.sqrt((b-e)*(b-e)+(c-f)*(c-f));if(h<g)return 3;f=this.ptArray[0].y;e=this.ptArray[0].x+(this.ptArray[1].x-this.ptArray[0].x)/2;var h=Math.sqrt((b-e)*(b-e)+(c-f)*(c-f));if(h<g)return 4;f=this.ptArray[1].y;e=this.ptArray[0].x+(this.ptArray[1].x-this.ptArray[0].x)/2;var h=Math.sqrt((b-e)*(b-e)+(c-f)*(c-f));return h<g?5:1}else if(this.itype==4){var i=WPACS.wp0bj2.Center(this.ptArray),h=Math.sqrt((b-i.x)*(b-i.x)+(c-i.y)*(c-i.y));return h<g?1:0}else if(this.itype==5){var a=d(b,c,this.ptArray[0].x,this.ptArray[0].y,this.ptArray[1].x,this.ptArray[1].y);if(a>0)return a==4?1:a;a=d(b,c,this.ptArray[2].x,this.ptArray[2].y,this.ptArray[1].x,this.ptArray[1].y);if(a>0)return a==4?1:a==2?4:a}else if(this.itype==6){var a=d(b,c,this.ptArray[0].x,this.ptArray[0].y,this.ptArray[1].x,this.ptArray[1].y);if(a>0)return a>3?1:a}else if(this.itype==7){if(b>this.ptArray[0].x-2&&b<this.ptArray[0].x+50&&c>this.ptArray[0].y-20&&c<this.ptArray[0].y+2)return 1}else if(this.itype==8){var a=d(b,c,this.ptArray[0].x,this.ptArray[0].y,this.ptArray[2].x,this.ptArray[2].y);if(a>0)return a;a=d(b,c,this.ptArray[3].x,this.ptArray[3].y,this.ptArray[5].x,this.ptArray[5].y);if(a>0)return a!=1?a+3:1;a=d(b,c,this.ptArray[1].x,this.ptArray[1].y,this.ptArray[4].x,this.ptArray[4].y);if(a>0)return 1}return 0};WPACS.wp0bj7.prototype.MoveMeta=function(a,b,c){if(this.ptArray==null||this.ptArray.length<1)return;switch(this.itype){case 1:case 6:if(a==2){this.ptArray[0].x+=b;this.ptArray[0].y+=c;return}if(a==3){this.ptArray[1].x+=b;this.ptArray[1].y+=c;return}break;case 2:case 3:if(a==2){this.ptArray[0].x+=b;return}if(a==3){this.ptArray[1].x+=b;return}if(a==4){this.ptArray[0].y+=c;return}if(a==5){this.ptArray[1].y+=c;return}break;case 5:if(a==2){this.ptArray[0].x+=b;this.ptArray[0].y+=c;return}if(a==3){this.ptArray[1].x+=b;this.ptArray[1].y+=c;return}if(a==4){this.ptArray[2].x+=b;this.ptArray[2].y+=c;return}break;case 8:if(a==2||a==3){if(a==2){this.ptArray[0].x+=b;this.ptArray[0].y+=c}else{this.ptArray[2].x+=b;this.ptArray[2].y+=c}var e=this.ptArray[0].x+(this.ptArray[2].x-this.ptArray[0].x)/2|0,f=this.ptArray[0].y+(this.ptArray[2].y-this.ptArray[0].y)/2|0;this.ptArray[1].x=e;this.ptArray[1].y=f;return}if(a==4){this.ptArray[0].x+=b;this.ptArray[0].y+=c;this.ptArray[1].x+=b;this.ptArray[1].y+=c;this.ptArray[2].x+=b;this.ptArray[2].y+=c;return}if(a==5||a==6){if(a==5){this.ptArray[3].x+=b;this.ptArray[3].y+=c}else{this.ptArray[5].x+=b;this.ptArray[5].y+=c}var e=this.ptArray[3].x+(this.ptArray[5].x-this.ptArray[3].x)/2|0,f=this.ptArray[3].y+(this.ptArray[5].y-this.ptArray[3].y)/2|0;this.ptArray[4].x=e;this.ptArray[4].y=f;return}if(a==7){this.ptArray[3].x+=b;this.ptArray[3].y+=c;this.ptArray[4].x+=b;this.ptArray[4].y+=c;this.ptArray[5].x+=b;this.ptArray[5].y+=c;return}}if(a!=1)return;for(var d=0;d<this.ptArray.length;d++){this.ptArray[d].x+=b;this.ptArray[d].y+=c}};WPACS.wp0bj7.prototype.IsValidMeta=function(){if(this.ptArray==null||this.ptArray.length<1)return false;var c=20;switch(this.itype){case 1:case 2:case 3:case 6:var a=this.ptArray[1].x-this.ptArray[0].x,b=this.ptArray[1].y-this.ptArray[0].y,d=Math.sqrt(a*a+b*b);return d>c;case 4:return this.ptArray.length>10;case 5:var a=this.ptArray[2].x-this.ptArray[1].x,b=this.ptArray[2].y-this.ptArray[1].y,d=Math.sqrt(a*a+b*b);return d>c;case 8:var a=this.ptArray[5].x-this.ptArray[0].x,b=this.ptArray[5].y-this.ptArray[0].y,d=Math.sqrt(a*a+b*b);return d>c}return true};WPACS.wp0bj7.prototype.MergePoly=function(b){for(var c,h=b.length,q=WPACS.wp0bj2.InPolygon(b[0].x,b[0].y,this.ptArray),e=1;e<h;e++){var j=WPACS.wp0bj2.InPolygon(b[e].x,b[e].y,this.ptArray);if(j!=q)break}if(e>=h)return false;var r=WPACS.wp0bj2.InPolygon(b[h-1].x,b[h-1].y,this.ptArray);for(c=h-2;c>=0;c--){var j=WPACS.wp0bj2.InPolygon(b[c].x,b[c].y,this.ptArray);if(j!=r)break}if(c<0||e>=c)return false;for(var d=-1,f=-1,k={x:b[e-1].x,y:b[e-1].y},l={x:b[e].x,y:b[e].y},a=1;a<this.ptArray.length;a++){var o={x:this.ptArray[a-1].x,y:this.ptArray[a-1].y},p={x:this.ptArray[a].x,y:this.ptArray[a].y};if(WPACS.Vector.ChkCross(k,l,o,p)){d=a;break}}k={x:b[c+1].x,y:b[c+1].y},l={x:b[c].x,y:b[c].y};for(var a=1;a<this.ptArray.length;a++){var o={x:this.ptArray[a-1].x,y:this.ptArray[a-1].y},p={x:this.ptArray[a].x,y:this.ptArray[a].y};if(WPACS.Vector.ChkCross(k,l,o,p)){f=a;break}}if(d==-1||f==-1)return false;var g=[],i=this.ptArray.length,t=this.ptArray[d].x,v=this.ptArray[d].y,j=WPACS.wp0bj2.InPolygon(t,v,b),u=this.ptArray[f].x,w=this.ptArray[f].y,s=WPACS.wp0bj2.InPolygon(u,w,b);if(j===s)return false;if(j)if(d<f)for(var m=i-f+d,a=0;a<m;a++){var n=(d-a+i)%i;g.push(this.ptArray[n])}else for(var a=d;a>f;a--)g.push(this.ptArray[a]);else if(d>f)for(var m=i-d+f,a=0;a<m;a++){var n=(d+a)%i;g.push(this.ptArray[n])}else for(var a=d;a<f;a++)g.push(this.ptArray[a]);for(var a=c;a>=e;a--)g.push(b[a]);this.ptArray=g;return true};WPACS.wp0b39=function(){this.metaItems=[];this.visible=true};WPACS.wp0b39.prototype.DrawMetas=function(c,b){if(!this.visible)return;for(var a=0;a<this.metaItems.length;a++)this.metaItems[a].DrawMeta(c,b)};WPACS.wp0b39.prototype.IfHit=function(d,e,c){c=c||false;if(!this.visible)return null;for(var b=0,a=0;a<this.metaItems.length;a++){b=this.metaItems[a].IsPointInMeta(d,e,c);if(b>0)break}return b==0?null:{idx:a,pos:b}};WPACS.wp0b39.prototype.FindMeta=function(c){for(var b=[],a=0;a<this.metaItems.length;a++)this.metaItems[a].UserTag===c&&b.push(this.metaItems[a]);return b};WPACS.wp0b39.prototype.RemoveMetas=function(d){var c=0,a=this.metaItems,e=null;this.metaItems=[];for(var b=0;b<a.length;b++){if(a[b].UserTag!=d)this.metaItems.push(a[b]);else c++;a[b]=null}a=null;return c};WPACS.wp0b39.prototype.Clear=function(){for(var a=0;a<this.metaItems.length;a++){this.metaItems[a].DestroyObj();this.metaItems[a]=null}this.metaItems=[]};WPACS.wp0b39.prototype.Remove=function(a){if(a<0||a>=this.metaItems.length)return null;var b=this.metaItems.splice(a,1);return b.length==1?b[0]:null};WPACS.wp0b39.prototype.AddMeta=function(a){if(WPACS.wp0bj1.isUndefined(a))return;var b=this.metaItems.length;this.metaItems[b]=a;return this.metaItems.length};WPACS.wp0b39.prototype.AddText=function(d,e,b){var a=new WPACS.wp0bj7;a.CreateText(d,e,b);var c=this.metaItems.length;this.metaItems[c]=a};WPACS.wp0b39.prototype.MergePoly=function(e){for(var a=WPACS.wp0bj2.OutRect(e),f=new WPACS.wpRect(a.l,a.t,a.r-a.l+1,a.b-a.t+1),c=-1,b=0;b<this.metaItems.length;b++){if(this.metaItems[b].itype!=4||!this.metaItems[b].options.closed)continue;a=WPACS.wp0bj2.OutRect(this.metaItems[b].ptArray);if(!f.Intersect(a.l,a.t,a.r-a.l+1,a.b-a.t+1))continue;if(!this.metaItems[b].MergePoly(e))continue;c=b;break}if(c==-1)return null;var d=this.metaItems.splice(c,1);return d.length==1?d[0]:null};WPACS.wp0b39.prototype.ToString=function(){for(var d=new WPACS.wp0bj3,a="[",b=0;b<this.metaItems.length;b++){if(b==0)a+="{";else a+=",{";a+="type:"+this.metaItems[b].itype;a+=",";var e=this.metaItems[b].options.text!=""?"base64:"+d.encode(this.metaItems[b].options.text):"";a+="text:'"+e+"'";a+=",";a+="txtclr:'"+this.metaItems[b].options.txtclr+"'";a+=",";a+="metaclr:'"+this.metaItems[b].options.metaclr+"'";a+=",";a+="visible:"+(this.metaItems[b].options.visible?1:0);a+=",";a+="closed:"+(this.metaItems[b].options.closed?1:0);a+=",";a+="points:[";for(var c=0;this.metaItems[b].ptArray&&c<this.metaItems[b].ptArray.length;c++){if(c!=0)a+=",";a+=this.metaItems[b].ptArray[c].x+","+this.metaItems[b].ptArray[c].y}a+="]";a+="}"}return a+"]"};WPACS.wp0b39.prototype.SetMetas=function(a){if(!a||a.length==0)return;for(var g=new WPACS.wp0bj3,b=0;b<a.length;b++){var f=a[b].type;if(f>0&&a[b].points){var c=new WPACS.wp0bj7;c.itype=f;if(a[b].text!=""&&a[b].text.substr(0,7)=="base64:")c.options.text=g.decode(a[b].text.substr(7));c.options.txtclr=a[b].txtclr;c.options.metaclr=a[b].metaclr;c.options.visible=a[b].visible==1;c.options.closed=a[b].closed==1;var e=a[b].points.length/2|0;if(e>0){c.ptArray=new Array(e);for(var d=0;d<e;d++)c.ptArray[d]={x:a[b].points[d*2],y:a[b].points[d*2+1]}}var h=this.metaItems.length;this.metaItems[h]=c}}};WPACS.wp0b40=function(d,a,b){var c=new WPACS.wp0bj7;switch(d){case 1:c.CreateLine(a,b,a,b);break;case 2:c.CreateRect(a,b,a,b);break;case 3:c.CreateCircle(a,b,a,b);break;case 4:c.options.closed=false;c.CreatePolygon({x:a,y:b});break;case 5:c.CreateAngle(a,b,a,b,a,b);break;case 6:c.CreateArrow(a,b,a,b);break;case 7:c.CreateText(a,b,"");break;case 8:c.CreateHCR(a,b,a,b);break;default:c=null}return c};WPACS.wpContextMenu=function(){this.eleParent=$("body");this.menuid=Math.random()*300|0};WPACS.wpContextMenu.prototype.GetMenu=function(a){if(a=="")return;var b=a[0]=="#"?a+this.menuid.toString():"#"+a+this.menuid.toString();return this.eleParent.children(b)};WPACS.wpContextMenu.prototype.GetMenuName=function(a){return a+this.menuid.toString()};WPACS.wpContextMenu.prototype.GetMenuTitle=function(a){if(a!=""&&a[0]=="#")a=a.substr(1);for(var b=0;b<WPACS.MENUDEF.length;b++)if(WPACS.MENUDEF[b].name==a)return WPACS.MENUDEF[b].title;return""};WPACS.wpContextMenu.prototype.CreateMenu=function(f,c){for(var a=null,b=0;b<c.length;b++){if(c[b].name!=f)continue;a=c[b].menu;break}if(a==null||a.length==0)return null;var e=f+this.menuid.toString(),g='<div id="'+e+'" class="easyui-menu" >'+d(a)+"</div>";this.eleParent.append(g);return this.eleParent.children("#"+e);function d(b){for(var c="",a=0;a<b.length;a++)if(b[a].text!="-"){var f="",g="",e="";if(b[a].icon!="")e="iconCls:'"+b[a].icon+"'";if(b[a].fnid!="")g='fnid="'+b[a].fnid+'" vl="'+b[a].vl+'"';if(b[a].disabled=="true")f=e==""?"disabled:true":",disabled:true";else if(b[a].disabled=="canvas"&&!WPACS.wp0bj1.Canvas)f=e==""?"disabled:true":",disabled:true";if(b[a].submenu&&b[a].submenu.length>0){c+="<div "+g+' data-options="'+e+f+'"><span>'+b[a].text+"</span>";c+='<div style="width:150px;">';c+=d(b[a].submenu);c+="</div></div>"}else c+="<div "+g+' data-options="'+e+f+'">'+b[a].text+"</div>"}else if(b[a].link){var h=eval(b[a].link);c+=d(h)}else c+='<div class="menu-sep"></div>';return c}};WPACS.wpContextMenu.prototype.InitMainMenu=function(c){for(var a=0;a<WPACS.MENUDEF.length;a++){var b=this.CreateMenu(WPACS.MENUDEF[a].name,WPACS.MENUDEF);b!=null&&b.menu({onClick:c})}};WPACS.wpContextMenu.prototype.Init3dMenu=function(c){for(var a=0;WPACS.MENUDEF_V3D&&a<WPACS.MENUDEF_V3D.length;a++){var b=this.CreateMenu(WPACS.MENUDEF_V3D[a].name,WPACS.MENUDEF_V3D);b!=null&&b.menu({onClick:c})}};WPACS.wpContextMenu.prototype.InitPrnMenu=function(c){for(var a=0;a<WPACS.MENUDEF_PRN.length;a++){var b=this.CreateMenu(WPACS.MENUDEF_PRN[a].name,WPACS.MENUDEF_PRN);b!=null&&b.menu({onClick:c})}};WPACS.wpContextMenu.prototype.Destroy=function(d){if(d){var c=d+this.menuid.toString(),a=this.eleParent.children("#"+c);a.length>0&&a.remove();a=null}else{for(var b=0;b<WPACS.MENUDEF.length;b++){var c=WPACS.MENUDEF[b].name+this.menuid.toString(),a=this.eleParent.children("#"+c);a.length>0&&a.remove();a=null}for(var b=0;b<WPACS.MENUDEF_PRN.length;b++){var c=WPACS.MENUDEF_PRN[b].name+this.menuid.toString(),a=this.eleParent.children("#"+c);a.length>0&&a.remove();a=null}for(var b=0;WPACS.MENUDEF_V3D&&b<WPACS.MENUDEF_V3D.length;b++){var c=WPACS.MENUDEF_V3D[b].name+this.menuid.toString(),a=this.eleParent.children("#"+c);a.length>0&&a.remove();a=null}}};WPACS.wpContextMenu.prototype.SetMenuState=function(g,i,f){for(var d=0;d<WPACS.MENUDEF.length;d++){var h="#"+WPACS.MENUDEF[d].name+this.menuid.toString(),a=this.eleParent.children(h);if(a.length!=1)continue;for(var c=a.children("div[fnid='"+i+"']"),b=0;b<c.length;b++){if(f&&c[b].getAttribute("vl")!=f)continue;var e=a.menu("getItem",c[b]);g?a.menu("enableItem",e.target):a.menu("disableItem",e.target)}}};WPACS.wpContextMenu.prototype.SetMenuGroupState=function(j,e,i,g){var h="#"+j+this.menuid.toString(),a=this.eleParent.children(h);if(a.length!=1)return;for(var c=a.children("div[fnid='"+i+"']"),b=0;b<c.length;b++){var d,f=a.menu("getItem",c[b]);if(g===undefined||g===c[b].getAttribute("vl"))d=e;else d=!e;d?a.menu("enableItem",f.target):a.menu("disableItem",f.target)}};WPACS.wpContextMenu.prototype.SetMenuGroupIcon=function(i,g,e){var f="#"+i+this.menuid.toString(),a=this.eleParent.children(f);if(a.length!=1)return;for(var c=a.children("div[fnid='"+g+"']"),b=0;b<c.length;b++){var d="",h=a.menu("getItem",c[b]);if(e===undefined||e===c[b].getAttribute("vl"))d="icon-ok";a.menu("setIcon",{target:h.target,iconCls:d})}};WPACS.wpContextMenu.prototype.SetMenuText=function(g,h,e){for(var d=0;d<WPACS.MENUDEF.length;d++){var f="#"+WPACS.MENUDEF[d].name+this.menuid.toString(),a=this.eleParent.children(f);if(a.length!=1)continue;for(var c=a.children("div[fnid='"+h+"']"),b=0;b<c.length;b++){if(e!=undefined&&c[b].getAttribute("vl")!=e)continue;var i=a.menu("getItem",c[b]);a.menu("setText",{target:i.target,text:g})}}};WPACS.BindContextMenu=function(b,a,c){if(!WPACS.wp0bj1.isObject(b))return;if(WPACS.wp0bj1.isUndefined(a)||a==="")a="contextmenu";if(WPACS.wp0bj1.isUndefined(c)){b.unbind(a);return}if(a=="rightclick")b.on("mouseup",function(a){a.which==3&&$("#"+c).menu("show",{left:a.pageX,top:a.pageY,alignTo:null})});else b.on(a,null,function(e){var a=!WPACS.wp0bj1.IsMobile?e:event.touches.length!=0?event.touches[0]:event.changedTouches[0],b=a.pageX,d=a.pageY;$("#"+c).menu("show",{left:b,top:d,alignTo:null})})};WPACS.wp0bj8=function(a,b){if(!WPACS.wp0bj1.ArrayBuff)return new Array(a);switch(b){case"u8":return new Uint8Array(a);case"i8":return new Int8Array(a);case"u16":return new Uint16Array(a);case"i16":return new Int16Array(a);case"u32":return new Uint32Array(a);case"i32":return new Int32Array(a);case"f32":return new Float32Array(a);case"f64":return new Float64Array(a)}return null};WPACS.wp0bj9=function(){var c=0,f=255,g=0,d=1,a=null,b=0,e=0;this.ww=0;this.wc=0;this.gamma=1;this.DestroyObj=function(){a=null};this.IsValid=function(){return a!=null};this.Init=function(i,h){c=i;f=h;g=0;d=1;a=null;b=e=0;this.ww=this.wc=0};this.LutType=function(b,a){g=b;if(a!=undefined)d=a};this.Create=function(c,f){if(c<1)return false;if(a!=null)if(this.ww==c&&this.wc==f)if(Math.abs(this.gamma-d)<.01)return true;b=Math.floor(f-c/2);e=b+c-1;if(g==1){h();this.gamma=d}else{i();this.gamma=1}this.ww=c;this.wc=f;return true};this.Lookup=function(d){return d<b?c:d>e?f:a[d-b]};function i(){var g=e-b,h=f-c;a=WPACS.wp0bj8(g+1,h==255?"u8":"i16");for(var d=0;d<=g;d++)a[d]=c+Math.floor(h*d/g)}function h(){var h=e-b,i=f-c;a=WPACS.wp0bj8(h+1,i==255?"u8":"i16");for(var g=0;g<=h;g++)a[g]=c+Math.floor(i*Math.pow(g/h,d))}};WPACS.wp0b10={MaxValue:function(g,i,h){for(var c=524287,b=0-524287,d,f=0,e=0;e<h;e++)for(d=0;d<i;d++){var a=g[f++];if(a>b)b=a;if(a<c)c=a}return{max:b,min:c}},StrechIn:function(l,v,u,h,a){for(var m=v,t=u,b=h>8&&h<=16?1:Math.floor((h+7)/8),j=a*b,k=m*j,s=(a-1)*k,g=a*a,n=0,f=0,p=new Array(g),c=0;c<a;c++)for(var d=0;d<a;d++)p[c*a+d]=c*k+d*b;for(var r=0;r<t;r++){for(var q=0;q<m;q++){for(var e=0;e<b;e++){for(var o=0,i=0;i<g;i++)o+=l[f+p[i]+e];l[n+e]=o/g|0}n+=b;f+=j}f+=s}},StrechOut:function(e,u,t,q,c){for(var f=u,l=t,b=q>8&&q<=16?1:Math.floor((q+7)/8),i=(c-1)*f*b,r=f%c==0?f-c+1:f-f%c+1,s=l%c==0?l-c+1:l-l%c+1,h,o,m,k=0,d=0;k<l;k+=c){for(var g=0;g<r;g++){if((h=g%c)!=0){o=c-h;for(var j=d-h*b,p=j+c*b,a=0;a<b;a++)e[d+a]=(e[j+a]*o+e[p+a]*h)/c|0}d+=b}m=d-b;for(var g=r;g<f;g++){for(var a=0;a<b;a++)e[d+a]=e[m+a];d+=b}d+=i}i=f*b;for(var k=0,d=0;k<s;k++){if((h=k%c)!=0){o=c-h;for(var n=d,j=d-h*i,p=j+c*i,g=0;g<f;g++){for(var a=0;a<b;a++)e[n+a]=(e[j+a]*o+e[p+a]*h)/c|0;n+=b;j+=b;p+=b}}d+=i}m=d-i;for(var k=s;k<l;k++){for(var n=d,j=m,g=0;g<f;g++){for(var a=0;a<b;a++)e[n+a]=e[j+a];n+=b;j+=b}d+=i}},AvFilter:function(k,s,r,h,a){for(var j=s,p=r,b=h>8&&h<=16?1:Math.floor((h+7)/8),q=j*b,f=0,g=a*a,m=new Array(g),c=0;c<a;c++)for(var d=0;d<a;d++)m[c*a+d]=c*q+d*b;for(var o=0;o<p-a;o++)for(var n=0;n<j-a;n++){for(var e=0;e<b;e++){for(var l=0,i=0;i<g;i++)l+=k[f+m[i]+e];k[f+e]=l/g|0}f+=b}}};WPACS.wp0b41={ViewSR:function(e,b,c){var d=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu5,a=d+"?requesttype=WADO";if(WPACS.wp0bj1.isStringType(c)&&c!="")a=a+"&stuuid="+c;if(WPACS.wp0bj1.isStringType(b)&&b!="")a=a+"&srsuid="+b;window.open(a+"&objectuid="+e)},ViewSRUrl:function(e,b,c){var d=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu5,a=d+"?requesttype=WADO";if(WPACS.wp0bj1.isStringType(c)&&c!="")a=a+"&stuuid="+c;if(WPACS.wp0bj1.isStringType(b)&&b!="")a=a+"&srsuid="+b;return a+"&objectuid="+e},ViewInfo:function(e,a,b){var d=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu5,f="&contenttype=application/dump",c=d+"?requesttype=WADO";if(WPACS.wp0bj1.isStringType(b)&&b!="")c+="&stuuid="+b;if(WPACS.wp0bj1.isStringType(a)&&a!="")c+="&srsuid="+a;window.open(c+"&objectuid="+e+f)},DownDicom:function(e,c,a,d){if(WPACS.wp0bj1.isStringType(e)&&e!=""){var f="";if(!WPACS.wp0bj1.isBooleanType(d))d=false;var h="&contenttype=application/dicom",g=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu5,b=g+"?requesttype=WADO";if(WPACS.wp0bj1.isStringType(a)&&a!="")b+="&stuuid="+a;if(WPACS.wp0bj1.isStringType(c)&&c!="")b+="&srsuid="+c;b+="&objectuid="+e+h;if(d)b+="&anonymize=yes";if(f!="")b+="&transfersyntax="+f;window.location.href=b;return}if(WPACS.wp0bj1.isStringType(c)&&c!=""){var b=WPACS.CONSTDEF.WPURL_ROOT+"dwload.aspx?srsuid="+c;if(WPACS.wp0bj1.isStringType(a)&&a!="")b+="&stuuid="+a;window.location.href=b;return}if(WPACS.wp0bj1.isStringType(a)&&a!=""){var b=WPACS.CONSTDEF.WPURL_ROOT+"dwload.aspx?stuuid="+a;window.location.href=b;return}},IsImage:function(a){return a=="ECG"?false:a=="SR"||a=="KO"||a=="PR"?false:a.substr(0,2)=="RT"&&a!="RTIMAGE"?false:true},IsVisible:function(a){return a=="SR"||a=="KO"?false:a.substr(0,2)=="RT"&&a!="RTIMAGE"?false:true}};WPACS.wpSetBitVal=function(a,d){var b=1<<d,c=(a&b)==0;a=c?a|b:a&~b;return a};WPACS.wfn37=function(f,g,h){for(var d="",j=f<0?"R":"L",k=g<0?"A":"P",l=h<0?"F":"H",a=Math.abs(f),b=Math.abs(g),c=Math.abs(h),e=.1,i=0;i<2;++i)if(a>e&&a>b&&a>c){d+=j;a=0}else if(b>e&&b>a&&b>c){d+=k;b=0}else if(c>e&&c>a&&c>b){d+=l;c=0}else break;return d};WPACS.wpGetZoomRatio=function(a){return a>100?.5:.3};WPACS.wpGetWwwlRatio=function(a,b){return a>=14?b?8:6:a>=12?4:a>=10?3:2};WPACS.wpSetCursorMode=function(a,b){switch(b){case WPACS.CONSTDEF.wpo1:a.css("cursor","pointer");return;case WPACS.CONSTDEF.wpo2:a.css("cursor","crosshair");return;case WPACS.CONSTDEF.wpo3:a.css("cursor","crosshair");return;case WPACS.CONSTDEF.wpo5:a.css("cursor","url(webpacs/cursor/zoom.cur),default");return;case WPACS.CONSTDEF.wpo6:a.css("cursor","url(webpacs/cursor/pan.cur),default");return;case WPACS.CONSTDEF.wpo7:a.css("cursor","url(webpacs/cursor/windowlevel.cur),default");return;case 11:a.css("cursor","url(webpacs/cursor/line.cur),default");return;case 12:a.css("cursor","url(webpacs/cursor/line.cur),default");return;case 13:a.css("cursor","url(webpacs/cursor/ellipse.cur),default");return;case 14:a.css("cursor","url(webpacs/cursor/line.cur),default");return;case 15:a.css("cursor","url(webpacs/cursor/line.cur),default");return;case 16:a.css("cursor","url(webpacs/cursor/arrow.cur),default");return;case 17:a.css("cursor","url(webpacs/cursor/text.cur),default");return;default:a.css("cursor","default")}};if(!WPACS.PREVRTHRESHOLD||WPACS.PREVRTHRESHOLD.length==0)WPACS.PREVRTHRESHOLD=[{name:"tf0",data:[[130,180,75,193,19,61],[180,200,110,233,156,79],[200,256,230,233,156,100],[256,4095,420,255,211,211]]},{name:"tf1",data:[[130,180,75,193,19,61],[180,236,110,233,156,79],[236,1496,371,225,211,211],[1496,4095,406,13,134,247]]},{name:"tf2",data:[[60,130,100,218,163,81],[130,250,187,201,153,73],[250,4095,409,199,191,193],[-10,60,80,218,17,81]]},{name:"tf3",data:[[93,175,72,193,19,61],[175,289,201,231,189,83],[289,4095,559,225,208,196]]},{name:"tf4",data:[[95,110,72,193,19,61],[142,240,325,233,156,79],[240,4095,469,225,211,211],[110,142,108,193,30,71]]},{name:"tf5",data:[[90,126,112,193,19,61],[163,273,415,195,140,117],[273,4095,413,204,206,204],[126,163,119,208,135,50]]},{name:"tf6",data:[[125,160,80,224,25,83],[200,290,433,221,150,172],[290,4095,435,213,205,198],[160,200,130,220,150,80]]},{name:"tf7",data:[[-918,-837,108,205,35,90],[-837,-625,162,225,157,79],[-625,-543,216,221,43,70]]},{name:"tf8",data:[[60,191,433,211,103,49],[191,207,463,231,163,71],[207,4095,495,191,199,193],[-600,60,469,211,83,49]]},{name:"tf9",data:[[110,165,311,255,128,0],[165,259,595,255,255,184],[259,4095,791,255,255,255]]}];WPACS.ttClick=null;WPACS.ClickEvent=function(b,a){if(WPACS.ttClick==null)WPACS.ttClick=window.setTimeout(function(){WPACS.ttClick=null;b()},300);else{window.clearTimeout(WPACS.ttClick);WPACS.ttClick=null;a()}};WPACS.DeleSetting=function(){function b(b){var a,c=new RegExp("(^| )"+b+"=([^;]*)(;|$)");return(a=document.cookie.match(c))?unescape(a[2]):undefined}function a(d){var a=new Date;a.setTime(a.getTime()-1);var c=b(d);if(c!==undefined)document.cookie=d+"="+c+";expires="+a.toGMTString()}if(WPACS.wp0bj1.Storage)return;a("d3mode");a("dlossy");a("mglass")};WPACS.SaveSetting=function(){function a(d,b){var c=30,a=new Date;a.setTime(a.getTime()+c*24*60*60*1e3);document.cookie=d+"="+escape(b)+";expires="+a.toGMTString()}if(WPACS.wp0bj1.Storage){var b="mglass="+(WPACS.CONSTDEF.MGLASS_FILTER?1:0)+";d3mode="+(WPACS.CONSTDEF.DAT3NATIV?1:0)+";dlossy="+(WPACS.CONSTDEF.DATALOSSY?1:0)+";";localStorage.wpsettings=b}else{a("mglass",WPACS.CONSTDEF.MGLASS_FILTER?1:0);a("d3mode",WPACS.CONSTDEF.DAT3NATIV?1:0);a("dlossy",WPACS.CONSTDEF.DATALOSSY?1:0)}};WPACS.LoadSetting=function(){function c(d,b){var a,c=new RegExp(b+"=([^;]*)(;|$)");return(a=d.match(c))?unescape(a[1]):undefined}var b="";if(WPACS.wp0bj1.Storage)b=localStorage.wpsettings;else b=document.cookie;if(!b)return;var a=c(b,"d3mode");if(a!=undefined)WPACS.CONSTDEF.DAT3NATIV=a==1;a=c(b,"dlossy");if(a!=undefined)WPACS.CONSTDEF.DATALOSSY=a==1;a=c(b,"mglass");if(a!=undefined)WPACS.CONSTDEF.MGLASS_FILTER=a==1};WPACS.CONSTDEF.USERSETTINGS&&WPACS.LoadSetting();var WPACS=WPACS||{};WPACS.wp0b16=function(){};WPACS.wp0b16.MaxCache=WPACS.wp0bj1.IsMobile?WPACS.CONSTDEF.DCACHE_MB_MAX:WPACS.CONSTDEF.DCACHE_PC_MAX;WPACS.wp0b16.DataMap=[];WPACS.wp0b16.Add=function(d,b){if(WPACS.wp0b16.MaxCache==-1)WPACS.wp0b16.MaxCache=5e3;if(WPACS.wp0b16.MaxCache<1)return false;var e,a=WPACS.wp0b16.DataMap.length;if(a>=WPACS.wp0b16.MaxCache){var c=WPACS.wp0b16.DataMap.shift();c.val.DestroyObj();c.val=null;a--}b.FreeExtData();WPACS.wp0b16.DataMap[a]={key:d,val:b};return true};WPACS.wp0b16.Get=function(d){for(var b=WPACS.wp0b16.DataMap.length,a=0;a<b;a++)if(WPACS.wp0b16.DataMap[a].key==d)break;if(a>=b)return null;var c=WPACS.wp0b16.DataMap[a].val;WPACS.wp0b16.DataMap.splice(a,1);return c};WPACS.wp0b16.Clear=function(){for(var c=WPACS.wp0b16.DataMap.length,a=0;a<c;a++){var b=WPACS.wp0b16.DataMap[a];b.val.DestroyObj();b.val=null;WPACS.wp0b16.DataMap[a]={}}WPACS.wp0b16.DataMap=[]};WPACS.wp0b16.MakeKey=function(d,a,b){var c=d+(b!=""?a+b:a);return $.md5(c)};WPACS.CONSTDEF.DATAFAILED="failed";WPACS.CONSTDEF.DT_RAWDATA=0;WPACS.CONSTDEF.DT_FUSDATA=1;WPACS.CONSTDEF.DT_SUBDATA=2;WPACS.CONSTDEF.FAILRELOAD=2e3;WPACS.wp0b17=function(v){var f={ovlinc:false,subloaded:false,fusloaded:false,onStatus:v?v:null},q=new WPACS.wp0bj9;this.Options=function(){return f};this.wob1=q;this.wfn30=function(){if(c<=8||c>16||b==null)return false;var d=WPACS.wp0b10.MaxValue(b,a,e),f=d.max-d.min+1,g=d.min+Math.floor(f/2);this.wob1.Create(f,g);d=null;return true};this.DestroyObj=function(){this.FreeData(true);this.wob1=q=null;f.onStatus=null;f={}};this.FreeData=function(a){if(d!=null&&h==WPACS.CONSTDEF.wps1)d.readyState!=undefined?d.abort():(d.src="");d=null;h=WPACS.CONSTDEF.wps0;b=null;k=null;g=null;f.subloaded=f.fusloaded=false;(!WPACS.wp0bj1.isBooleanType(a)||a)&&this.wob1.DestroyObj()};this.FreeExtData=function(){g=null;f.fusloaded=false};this.IfLoaded=function(){return h==WPACS.CONSTDEF.wpu2&&WPACS.CONSTDEF.DATALOSSY==w};this.IfLoading=function(){return h==WPACS.CONSTDEF.wps1};this.Init=function(j,h,b,d,g){this.FreeData(false);this.wob1.Init(0,255);a=j;e=h;c=0;i=1;l=false;f.ovlinc=WPACS.wp0bj1.isBooleanType(g)?g:false;if(b>8&&b<16){l=WPACS.wp0bj1.isBooleanType(d)?d:true;c=b}else if(b==16){l=WPACS.wp0bj1.isBooleanType(d)?d:false;c=b}else if(b==24||b==32){c=8;i=b/8}else if(b>0&&b<=8)c=b;return c!=0};this.wfn22=function(){return b};this.wfn23=function(a){this.FreeData(false);(b=a)&&j(WPACS.CONSTDEF.wpu2)};this.wfn24=function(b,d,e,c){this.FreeData(false);var a=n(b,c,undefined);p=(new Date).getTime();if(a&&a.vpath!=""){o(a.vpath,WPACS.CONSTDEF.DT_RAWDATA,a.minv,a.maxv);WPACS.CONSTDEF.FAILRELOAD>0&&window.setTimeout(function(){h==-1&&m(b,d,e,c)},WPACS.CONSTDEF.FAILRELOAD)}else m(b,d,e,c)};this.wfn25=function(b,d,e,c){if(f.fusloaded)return;else f.fusloaded=true;var a=n(b,c,undefined);p=(new Date).getTime();if(a&&a.vpath!=""){o(a.vpath,WPACS.CONSTDEF.DT_FUSDATA,a.minv,a.maxv);WPACS.CONSTDEF.FAILRELOAD>0&&window.setTimeout(function(){h==-1&&m(b,d,e,c,WPACS.CONSTDEF.DT_FUSDATA)},WPACS.CONSTDEF.FAILRELOAD)}else m(b,d,e,c,WPACS.CONSTDEF.DT_FUSDATA)};this.wfn26=function(b,d,e,c){if(f.subloaded)return;else f.subloaded=true;var a=n(b,c,undefined);p=(new Date).getTime();if(a&&a.vpath!=""){o(a.vpath,WPACS.CONSTDEF.DT_SUBDATA,a.minv,a.maxv);WPACS.CONSTDEF.FAILRELOAD>0&&window.setTimeout(function(){h==-1&&m(b,d,e,c,WPACS.CONSTDEF.DT_SUBDATA)},WPACS.CONSTDEF.FAILRELOAD)}else m(b,d,e,c,WPACS.CONSTDEF.DT_SUBDATA)};this.wfn27=function(){if(b==null||i!=1)return null;for(var o=WPACS.wp0b10.MaxValue(b,a,e),k,m=o.max,f=o.min,c,h=0,j=a*e,l,n,p=m-f+1,g=WPACS.wp0bj8(p,"u32"),d=0;d<p;d++)g[d]=0;for(d=0,n=0;d<e;d++)for(l=0;l<a;l++){k=b[n++];c=++g[k-f];if(c<j)j=c;if(c>h)h=c;g[k-f]=c}return{maxVal:m,minVal:f,maxCount:h,minCount:j,hsg:g,ww:this.wob1.ww,wc:this.wob1.wc,gamma:this.wob1.gamma}};this.GetPixel=function(f,g){if(b==null)return undefined;if(f<0||f>=a)return undefined;if(g<0||g>=e)return undefined;if(c>8&&c<=16)return b[g*a+f];else if(i==1&&c<=8)return b[g*a+f];for(var h=i*Math.floor((c+7)/8),k=0,j=(g*a+f)*h,d=0;d<h;d++)k+=b[j+d]*Math.pow(256,d);return d};this.wfn28=function(u,f){if(b==null)return null;if(i>1||c>16)return null;var d,m,g,j,k,l,n=0-65535,o=65535,y=0,D=0,p=0,s=0;function t(){if(g<0)g=0;else if(g>=a)g=a-1;if(k<0)k=0;else if(k>=a)k=a-1;if(j<0)j=0;else if(j>=e)j=e-1;if(l<0)l=0;else if(l>=e)l=e-1}function z(c,g,b,f,d,e){var a=(1-(c-b)*(c-b)/d)*e;if(a<0)return false;a=Math.sqrt(a);return Math.abs(g-f)>(a|0)?false:true}if(u==2){if(f.length!=2)return null;g=f[0].x;j=f[0].y;k=f[1].x;l=f[1].y;t();for(d=j;d<l;d++){var q=d*a+g;for(m=g;m<k;m++){var h=b[q++];if(h>n)n=h;if(h<o)o=h;s+=h;p++}}}else if(u==3){if(f.length!=2)return null;g=f[0].x;j=f[0].y;k=f[1].x;l=f[1].y;t();var v=Math.abs(k-g)/2,w=Math.abs(l-j)/2,A=v*v,B=w*w;for(d=j;d<l;d++){var q=d*a+g;for(m=g;m<k;m++){if(!z(m-g,d-j,v,w,A,B)){q++;continue}var h=b[q++];if(h>n)n=h;if(h<o)o=h;s+=h;p++}}}else if(u==4){if(f.length<3)return null;g=k=f[0].x;j=l=f[0].y;for(d=1;d<f.length;d++){if(g>f[d].x)g=f[d].x;if(k<f[d].x)k=f[d].x;if(j>f[d].y)j=f[d].y;if(l<f[d].y)l=f[d].y}t();var x=document.createElement("canvas"),r=x.getContext("2d");r.beginPath();r.moveTo(f[0].x,f[0].y);for(var d=1;d<f.length;d++)r.lineTo(f[d].x,f[d].y);r.closePath();for(d=j;d<l;d++){var q=d*a+g;for(m=g;m<k;m++){if(!r.isPointInPath(m,d)){q++;continue}var h=b[q++];if(h>n)n=h;if(h<o)o=h;s+=h;p++}}x=null}else return null;if(p>0)y=s/p;return{max:n,min:o,av:y}};this.wfn29=function(o,s,G,z,n,C){if(b==null)return null;if(o==-1)o=WPACS.wpPsuedoTable.length-1;if(o<0||o>=WPACS.wpPsuedoTable.length)o=0;if(!WPACS.wp0bj1.isBooleanType(s))s=false;var j=G==null?new WPACS.wpRect(0,0,a,e):G;if(!WPACS.wp0bj1.isBooleanType(z)||k==null)z=false;if(!WPACS.wp0bj1.isNumberType(n))n=0;if(n<0||n>100)n=0;var H=g!=null&&n!=0,B=J(C),F=document.createElement("canvas");F.width=j.width;F.height=j.height;var I=F.getContext("2d"),f=I.createImageData(j.width,j.height),K=(new Date).getTime(),d=0,r=0;if(c>8&&c<=16){!this.wob1.IsValid()&&this.wob1.Create(this.wob1.ww,this.wob1.wc);var q=j.top*a+j.left;if(B==null&&!z)if(o!=0)for(var l=0;l<j.height;l++){for(var p=q,m=0;m<j.width;m++){var h=this.wob1.Lookup(b[p]);if(s)h=255-h;f.data[d]=WPACS.wpPsuedoTable[o][h][0];f.data[d+1]=WPACS.wpPsuedoTable[o][h][1];f.data[d+2]=WPACS.wpPsuedoTable[o][h][2];f.data[d+3]=255;d+=4;p+=1}q+=a}else if(H)for(var l=0;l<j.height;l++){for(var p=q,m=0;m<j.width;m++){var h=this.wob1.Lookup(b[p]);if(s)h=255-h;var y=g[r],x=g[r+1],w=g[r+2];if(y!=x||y!=w||x!=w){h*=100-n;f.data[d]=(h+y*n)/100|0;f.data[d+1]=(h+x*n)/100|0;f.data[d+2]=(h+w*n)/100|0}else f.data[d]=f.data[d+1]=f.data[d+2]=h;r+=3;f.data[d+3]=255;d+=4;p+=1}q+=a}else for(var l=0;l<j.height;l++){for(var p=q,m=0;m<j.width;m++){var h=this.wob1.Lookup(b[p]);if(s)h=255-h;f.data[d]=f.data[d+1]=f.data[d+2]=h;f.data[d+3]=255;d+=4;p+=1}q+=a}else if(o!=0)for(var l=0;l<j.height;l++){for(var p=q,m=0;m<j.width;m++){var h=0,t=m+j.left,u=l+j.top;if(E(t,u,B,C)){if(!z||!D(t,u,k,a))h=this.wob1.Lookup(b[p]);else h=255;if(s)h=255-h}f.data[d]=WPACS.wpPsuedoTable[o][h][0];f.data[d+1]=WPACS.wpPsuedoTable[o][h][1];f.data[d+2]=WPACS.wpPsuedoTable[o][h][2];f.data[d+3]=255;d+=4;p+=1}q+=a}else if(H)for(var l=0;l<j.height;l++){for(var p=q,m=0;m<j.width;m++){var h=0,t=m+j.left,u=l+j.top;if(E(t,u,B,C)){if(!z||!D(t,u,k,a))h=this.wob1.Lookup(b[p]);else h=255;if(s)h=255-h}var y=g[r],x=g[r+1],w=g[r+2];if(y!=x||y!=w||x!=w){h*=100-n;f.data[d]=(h+y*n)/100|0;f.data[d+1]=(h+x*n)/100|0;f.data[d+2]=(h+w*n)/100|0}else f.data[d]=f.data[d+1]=f.data[d+2]=h;r+=3;f.data[d+3]=255;d+=4;p+=1}q+=a}else for(var l=0;l<j.height;l++){for(var p=q,m=0;m<j.width;m++){var h=0,t=m+j.left,u=l+j.top;if(E(t,u,B,C)){if(!z||!D(t,u,k,a))h=this.wob1.Lookup(b[p]);else h=255;if(s)h=255-h}f.data[d]=f.data[d+1]=f.data[d+2]=h;f.data[d+3]=255;d+=4;p+=1}q+=a}}else if(c<=8&&i==1)for(var q=j.top*a+j.left,l=0;l<j.height;l++){for(var p=q,m=0;m<j.width;m++){var h=0,t=m+j.left,u=l+j.top;if(E(t,u,B,C))if(!z||!D(t,u,k,a))h=b[p];else h=255;if(s)h=255-h;if(o!=0){f.data[d]=WPACS.wpPsuedoTable[o][h][0];f.data[d+1]=WPACS.wpPsuedoTable[o][h][1];f.data[d+2]=WPACS.wpPsuedoTable[o][h][2]}else if(H){var y=g[r],x=g[r+1],w=g[r+2];if(y!=x||y!=w||x!=w){h*=100-n;f.data[d]=(h+y*n)/100|0;f.data[d+1]=(h+x*n)/100|0;f.data[d+2]=(h+w*n)/100|0}else f.data[d]=f.data[d+1]=f.data[d+2]=h;r+=3}else f.data[d]=f.data[d+1]=f.data[d+2]=h;f.data[d+3]=255;d+=4;p+=1}q+=a}else for(var A=i*Math.floor((c+7)/8),q=j.top*a*A+j.left*A,l=0;l<j.height;l++){for(var p=q,m=0;m<j.width;m++){f.data[d+3]=255;var t=m+j.left,u=l+j.top;if(E(t,u,B,C))if(!z||!D(t,u,k,a))for(var v=0;v<A;v++)f.data[d+v]=s?255-b[p+v]:b[p+v];else for(var v=0;v<A;v++)f.data[d+v]=s?0:255;else for(var v=0;v<A;v++)f.data[d+v]=s?255:0;d+=4;p+=A}q+=a*A}I.putImageData(f,0,0);f=null;if(G==null)j=null;return F;function J(a){if(a==null)return null;if(a.type=="c"){var d=Math.abs(a.points[1].x-a.points[0].x)/2,b=Math.abs(a.points[1].y-a.points[0].y)/2,h=d*d,i=b*b;return{a:d,b:b,aa:h,bb:i,l:0,t:0,r:0,m:0}}if(a.type=="p"){for(var e=-9999,g=-9999,f=9999,b=9999,c=0;c<a.points.length;c++){if(e<a.points[c].x)e=t;if(f>a.points[c].x)f=t;if(g<a.points[c].y)g=u;if(b>a.points[c].y)b=u}return{l:e,t:g,r:f,b:b}}return a.type=="r"?{}:null}function E(c,d,a,b){if(a==null)return true;var f=b.points[0].x,g=b.points[0].y,h=b.points[1].x,i=b.points[1].y;if(b.type=="c")return!e(c,d,f,g,h,i)?false:k(c-f,d-g,a.a,a.b,a.aa,a.bb);else if(b.type=="p")return!e(c,d,a.l,a.t,a.r,a.b)?false:j(c,d,b.points);else if(b.type=="r")return e(c,d,f,g,h,i);return true;function e(a,b,d,f,e,c){return a>=d&&a<=e&&b>=f&&b<c}function k(c,g,b,f,d,e){var a=(1-(c-b)*(c-b)/d)*e;if(a<0)return false;a=Math.sqrt(a);return Math.abs(g-f)>(a|0)?false:true}function j(f,g,a){var d=document.createElement("canvas"),b=d.getContext("2d");b.beginPath();b.moveTo(a[0].x,a[0].y);for(var c=1;c<a.length;c++)b.lineTo(a[c].x,a[c].y);b.closePath();var e=b.isPointInPath(f,g);d=null;return e}}function D(f,g,c,d){var b=g*d+f,a=b/8|0,e=b-a*8;return(c[a]&1<<e)!=0}};this.GetSize=function(){return[a,e,c]};function x(){var b=i*Math.floor((c+7)/8);return e*a*b}function r(m){if(b==null||i!=1)return null;for(var h,d=0,g=WPACS.wp0bj8(a*e,"i16"),k=0;k<e;k++)for(h=0;h<a;h++){g[d]=b[d]-m[d];d++}b=null;b=g;g=null;l=true;c=16;var f=WPACS.wp0b10.MaxValue(b,a,e),j=f.max-f.min+1,n=f.min+Math.floor(j/2);q.Create(j,n);f=null;return}function n(h,i,g){if(!WPACS.wp0bj1.ifStorage()||WPACS.wp0bj1.NoLocalStorage)return null;var d=new WPACS.wp0bj4,c=new WPACS.wp0bj3,e="WPACS.3X",f=WPACS.CONSTDEF.DATALOSSY?WPACS.wp0b16.MakeKey("rdlsy",h,i):WPACS.wp0b16.MakeKey("rdata",h,i);if(g==undefined){var a=localStorage[f];if(a&&a[0]!="{")a=d.DecryptStr(c.decode(localStorage[f]),e);return a&&a[0]=="{"?eval("("+a+")"):null}else{var b=c.encode(d.EncryptStr(g,e));try{var j=eval("("+d.DecryptStr(c.decode(b),e)+")")}catch(k){b=g}localStorage[f]=b}return null}function o(o,a,q,p){if(o==WPACS.CONSTDEF.DATAFAILED){WPACS.DEBUGLOG("[IMGDATA] \u672a\u627e\u5230\u5bf9\u5e94\u878d\u5408\u5207\u7247\u6216\u878d\u5408\u5931\u8d25");return}j(WPACS.CONSTDEF.wps1);if(!WPACS.wp0bj1.isNumberType(a))a=WPACS.CONSTDEF.DT_RAWDATA;d=new Image;d.onerror=u;d.onabort=t;d.onprogress=s;d.onload=function(){if(a==WPACS.CONSTDEF.DT_FUSDATA)g=this.PixelData;else if(a==WPACS.CONSTDEF.DT_SUBDATA)r(this.PixelData);else{b=this.PixelData;k=this.OvlayData}this.DestroyObj();j(WPACS.CONSTDEF.wpu2)};var n=WPACS.CONSTDEF.DATALOSSY,m=false,h,e;if(a!=WPACS.CONSTDEF.DT_FUSDATA){h=c*i;m=l;if(n)e={minv:q,maxv:p};else e={ovlinc:f.ovlinc}}else h=24;d.SetSource(o,n,h,m,e)}function m(h,k,m,f,e){d=new XMLHttpRequest;j(WPACS.CONSTDEF.wps1);var v=WPACS.CONSTDEF.WPURL_ROOT,q=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu4,g=true,i="IMGDATA";if(!WPACS.wp0bj1.isNumberType(e))e=WPACS.CONSTDEF.DT_RAWDATA;if(e==WPACS.CONSTDEF.DT_FUSDATA)i="FUSDATA";else if(e==WPACS.CONSTDEF.DT_SUBDATA)i="SUBDATA";var p=q+"?requesttype="+i+"&objectuid="+h,a="bsize="+x();if(WPACS.wp0bj1.isStringType(k)&&k!="")a+="&srsuid="+k;if(WPACS.wp0bj1.isStringType(m)&&m!="")a+="&stuuid="+m;if(WPACS.wp0bj1.isStringType(f)&&f!="")a+=f;if(WPACS.CONSTDEF.DATALOSSY)a+="&datalossy=1";if(!g){p=p+"&"+a;a=""}d.open(g?"POST":"GET",p,true);g&&d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");d.responseType="arraybuffer";d.onerror=u;d.onabort=t;d.onprogress=s;d.onload=function(){if(this.status==200){var d=this.response;if(e==WPACS.CONSTDEF.DT_SUBDATA){var m=c<=8||c>16?new Uint8Array(d):l?new Int16Array(d):new Uint16Array(d);r(m);m=null}else if(c>8&&c<=16)b=l?new Int16Array(d):new Uint16Array(d);else b=new Uint8Array(d);j(WPACS.CONSTDEF.wpu2)}else if(this.status==202){var a=this.getResponseHeader("vpath");if(a.substr(0,3).toLowerCase()=="&p=")a=q+"?requesttype=IMGPATH"+a;else if(v!="./")a=a.replace("./",v);var p=this.getResponseHeader("lsdata"),g=p?eval("("+p+")"):null,k=g?g.minv:0,i=g?g.maxv:0;if(k==0&&i==0)n(h,f,"{vpath:'"+a+"',minv:0,maxv:0}");else n(h,f,"{vpath:'"+a+"',minv:"+k+",maxv:"+i+"}");o(a,e,k,i);a==WPACS.CONSTDEF.DATAFAILED&&j(WPACS.CONSTDEF.wpu2)}else j(-3)};g?d.send(a):d.send()}function j(a){h=a;if(WPACS.CONSTDEF.wpu2==h)w=WPACS.CONSTDEF.DATALOSSY;if(f.onStatus!=null){var b=h==WPACS.CONSTDEF.wps1&&d&&d.readyState!=undefined?0:-1;f.onStatus(h,b)}if(h!=WPACS.CONSTDEF.wps1)d=null}function u(){j(-1)}function t(){j(-2);window.console&&console.log("[IMGDATA] \u8c03\u7528abort()\u65b9\u6cd5\u7ec8\u6b62!")}function s(a){if(f.onStatus==null)return;if(!a.lengthComputable)return;var b=100*a.loaded/a.total|0;f.onStatus(WPACS.CONSTDEF.wps1,b)}var a=0,e=0,c=0,i=1,l=false,b=null,k=null,d=null,h=WPACS.CONSTDEF.wps0,p=0,g=null,w=WPACS.CONSTDEF.DATALOSSY};WPACS.wp0b18=function(){var a={imguid:"",srsuid:"",stuuid:"",vidurl:"",vwmode:WPACS.wp0bj1.Canvas?1:WPACS.CONSTDEF.VMODE_WADO,iframe:0,flip:0,rotate:0,offX:0,offY:0,iratio:0,dratio:0,invert:false,psuedo:0,textv:true,metav:true,ww:0,wc:0,dw:0,dc:0,xasub:false,enh_nlevel:0,enh_foef:.7,petct:"",fus_foef:.5,onloaded:null,onloadp:0,vimgHandle:null,onstatus:null},d=null,b=null,h=new WPACS.wp0b39,c=null,e=null,w=this;this.DestroyObj=function(){B()};this.Options=function(){return a};this.IfLoading=function(){return c!=null&&c.IfLoading()};this.SetViewMode=function(b){if(!WPACS.wp0bj1.isNumberType(b))return;if(b!=WPACS.CONSTDEF.VMODE_WADO&&!WPACS.wp0bj1.Canvas)return;if(b==a.vwmode)return;f();a.vwmode=b;a.onstatus!=null&&g()};this.OnBindView=function(b){if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps4,0);a.onstatus=b;a.onstatus!=null?g():f()};this.wfn31=function(){return h};this.GetFrames=function(){return b!=null?b.image.n:0};this.SetFrame=function(a){return C(a)};this.GetPixel=function(b,a,c,d){return z(b,a,c,d)};this.wfn22=function(){return c?c.wfn22():null};this.IsSigned=function(){return b!=null?b.image.is!=0:true};this.GetBpp=function(){return b!=null?b.image.b:0};this.DicomInfo=function(a){a=a||false;if(!a)return b;b==null&&s(false);return b};this.GetImageData=function(f,b,c,e,d,a){return x(f,b,c,e,d,a)};this.wfn32=function(a){return l(a)};this.GetClipRect=function(){return d};this.AutoText=function(g,j,i){if(b==null)return false;var d=b.image.fx;if(b.image.fu&&b.image.fu.toLowerCase()=="pt")d=undefined;if(a.vwmode!=WPACS.CONSTDEF.VMODE_WADO){if(c==null)return false;g.AutoText(d,c.wfn28);return true}var f=j,e=i;g.AutoText(d,h);return true;function h(d,c){for(var b="",g=[],a=0;a<c.length;a++){var h=n(f,e,c[a].x,c[a].y);g[a]={x:h.x,y:h.y}}if(d==2)b="rect";else if(d==3)b="circle";else if(d==4)b="poly";return u(b,g,f,e)}};this.SetDicom=function(c,d,e){r();m();f();b=null;a.imguid=c;a.srsuid=d;a.stuuid=e;a.vidurl=""};this.Clone=function(e){var b=e.Options();this.SetDicom(b.imguid,b.srsuid,b.stuuid);a.textv=b.textv;a.metav=b.metav;a.iframe=b.iframe;a.flip=b.flip;a.rotate=b.rotate;a.invert=b.invert;a.psuedo=b.psuedo;a.ww=b.ww;a.wc=b.wc;a.dw=b.dw;a.dc=b.dc;a.enh_nlevel=b.enh_nlevel;a.enh_foef=b.enh_foef;a.petct=b.petct;a.fus_foef=b.fus_foef;var c=e.GetClipRect();if(c!=null)d=new WPACS.wpRect(c.left,c.top,c.width,c.height);g()};this.wfn34=function(a){WPACS.wp0bj1.isBooleanType(a)&&a&&r();g()};this.wfn33=function(a){window.setTimeout(this.wfn34,a)};this.wfn36=function(){if(b==null||b.image.n<2)return"";if(a.vidurl==""&&WPACS.CONSTDEF.WSVIDURL&&WPACS.wp0bj1.isStringType(WPACS.CONSTDEF.WSVIDURL)){var c=WPACS.CONSTDEF.WSVIDURL+"&imguid="+a.imguid;$.ajax({type:"GET",url:c,dataType:"text",async:false,success:function(b){a.vidurl=b},error:function(){a.vidurl="video_null"}})}return a.vidurl.toLowerCase()!="video_null"?a.vidurl:""};this.wfn35=function(c,b,a){return o(c,b,a)};this.GetJpegUrl=function(l,k,i){var g=true,e=o(l,k,i),d=b!=null?b.image.uid:a.imguid,c=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu5;if(!g)return c+"?requesttype=WADO&objectuid="+d+e;var j=c+"?requesttype=WADO_PATH&objectuid="+d,h={type:"POST",url:j,data:e,dataType:"text",async:false},f=$.ajax(h);return f.status!=200?"":c+"?requesttype=VURL"+f.responseText};this.PreView=function(b,d,c){if(a.vwmode==WPACS.CONSTDEF.VMODE_WADO)return false;if(!this.wfn07(b,d,c))return false;b.show();return true};this.wfn07=function(c,i,h,k){var j=false;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps1,-1);t(i,h);var f=o(i,h,k),e=b!=null?b.image.uid:a.imguid,d=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu5;if(j)$.ajax({type:"POST",data:f,dataType:"text",async:true,url:d+"?requesttype=WADO_PATH&objectuid="+e,success:function(e){var b=d+"?requesttype=VURL"+e;if(c.attr("src")!=b)c.attr("src",b);else if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wpu2,0)},error:function(){if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wpu2,0)}});else{var g=d+"?requesttype=WADO&objectuid="+e+f;if(c.attr("src")!=g)c.attr("src",g);else if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wpu2,0)}return true};this.wfn05=function(f){if(a.vwmode==WPACS.CONSTDEF.VMODE_WADO)return false;if(e==null&&!y())return false;var h=f[0].width,g=f[0].height;t(h,g);var j=a.iratio*e.width/100|0,i=a.iratio*e.height/100|0,d=new WPACS.wpRect(-j/2|0,-i/2|0,j,i),c=f[0].getContext("2d");c.save();c.setTransform(1,0,0,1,0,0);c.translate(h/2,g/2);var b=l();c.transform(b.a,b.b,b.c,b.d,b.e,b.f);c.drawImage(e,d.left,d.top,d.width,d.height);c.restore();d=null;b=null;return true};this.wfn08=function(k){if(!a.textv||b==null)return;var f=k[0].width,e=k[0].height,d=k[0].getContext("2d"),i=a.iratio/100,o=b.image.fx,p=b.image.fy;if(b.image.fu&&b.image.fu.toLowerCase()=="pt"){WPACS.wp0bj7.DrawMetaHScale(d,f,e,i,undefined);WPACS.wp0bj7.DrawMetaVScale(d,f,e,i,undefined)}else{WPACS.wp0bj7.DrawMetaHScale(d,f,e,i,o);WPACS.wp0bj7.DrawMetaVScale(d,f,e,i,p)}var q=b.image.ox,r=b.image.oy,j=n(q,r),h=WPACS.CONSTDEF.FNT_TEXT4,g=WPACS.CONSTDEF.CLR_SCALE;j.x!=0&&WPACS.wp0bj7.DrawMetaText(d,l(j.x),g,f-40,e/2-6|0,"end","",h);j.y!=0&&WPACS.wp0bj7.DrawMetaText(d,l(j.y),g,f/2-15|0,e-40,"center","",h);g=WPACS.CONSTDEF.CLR_TEXT4;b.lttext!=""&&WPACS.wp0bj7.DrawMetaText(d,b.lttext,g,5,15,"start","",h);b.rttext!=""&&WPACS.wp0bj7.DrawMetaText(d,b.rttext,g,f-5,15,"end","",h);b.lbtext!=""&&WPACS.wp0bj7.DrawMetaText(d,b.lbtext,g,5,e-5,"start","bottom",h);var m=b.rbtext;if(c!=null)m+="\r\n"+(a.iframe+1)+" / "+b.image.n+"    "+a.iratio+"%"+(WPACS.CONSTDEF.DATALOSSY?"  LS\r\n":"\r\n")+"W / L:  "+c.wob1.ww+" / "+c.wob1.wc;WPACS.wp0bj7.DrawMetaText(d,m,g,f-5,e-5,"end","bottom",h);return;function l(a){switch(a){case 1:return"[L]";case-1:return"[R]";case 2:return"[P]";case-2:return"[A]";case 3:return"[H]";case-3:return"[F]"}return""}function n(e,f){var b=new WPACS.Matrix("1,0,0,1,0,0");(a.flip&1)!=0&&b.postConcat(new WPACS.Matrix("-1,0,0,1,0,0"));(a.flip&2)!=0&&b.postConcat(new WPACS.Matrix("1,0,0,-1,0,0"));if(a.rotate!=0){var d=new WPACS.Matrix;d.setRotation(a.rotate);b.postConcat(d);d=null}var c=b.calNewPoint(e,f);c.x=Math.round(c.x);c.y=Math.round(c.y);b=null;return c}};this.wfn06=function(b){if(!a.metav)return;h!=null&&h.DrawMetas(b,n)};this.DrawMeta=function(a,b){b.DrawMeta(a,n)};this.Cvt2ImageXY=function(a,d,e){var c=a[0].width,b=a[0].height;return k(c,b,d,e)};this.ClipImage=function(c,f,g,h){if(b==null)return;if(c<0)c=0;else if(c>=b.image.w)c=b.image.w-1;if(f<0)f=0;else if(f>=b.image.h)f=b.image.h-1;if(g<0)g=0;else if(g>=b.image.w)g=b.image.w-1;if(h<0)h=0;else if(h>=b.image.h)h=b.image.h-1;var k,l,j=g-c,i=h-f,m=c+j/2,n=f+i/2;j=Math.abs(j);i=Math.abs(i);k=m-j/2|0,l=n-i/2|0;d=new WPACS.wpRect(k,l,j,i);a.iratio=a.dratio=0;e=null;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0)};this.GetHistgram=function(){return a.vwmode==WPACS.CONSTDEF.VMODE_WADO?null:c!=null?c.wfn27():null};this.Action=function(b,a){A(b,a)};function A(q,d){switch(q){case"reload":r();d=="1"&&m();a.onstatus!=null&&g();return;case"review":f();a.onstatus!=null&&g();return;case"refresh":if(WPACS.wp0bj1.isBooleanType(d)&&d)e=null;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"psuedo":if(d>-2&&d<WPACS.wpPsuedoTable.length)a.psuedo=a.psuedo==d?0:d;e=null;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"invert":a.invert=!a.invert;e=null;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"flip":if(WPACS.wp0bj1.isBooleanType(d)&&d)a.flip=WPACS.wpSetBitVal(a.flip,1);else a.flip=WPACS.wpSetBitVal(a.flip,0);if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"rotate":var o=WPACS.wp0bj1.isBooleanType(d)&&d,p=a.rotate+(o?90:-90);a.rotate=p%360;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"zoom":var n=d.iratio,k=d.dratio;if(n>0){a.iratio=n;a.dratio=k}else a.dratio+=k;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"move":if(d.dx==0&&d.dy==0)return;a.offX+=d.dx;a.offY+=d.dy;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"wwwl":if(!a.xasub){if(d.ww!=0){a.ww=d.ww;a.wc=d.wc;a.dw=d.dw;a.dc=d.dc}else{a.dw+=d.dw;a.dc+=d.dc}c!=null&&c.wob1.DestroyObj()}else if(c!=null){var i,h;if(d.ww!=0){i=d.ww;h=d.wc}else{i=c.wob1.ww;h=c.wob1.wc}i+=d.dw;h+=d.dc;c.wob1.Create(i,h)}e=null;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"gamma":if(a.vwmode!=WPACS.CONSTDEF.VMODE_WADO){if(c==null)return;var i=d.ww,h=d.wc,l=d.gamma;if(Math.abs(l-1)<.02)c.wob1.LutType(0,undefined);else c.wob1.LutType(1,l);c.wob1.Create(i,h);e=null;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0)}return;case"textv":if(WPACS.wp0bj1.isBooleanType(d))a.textv=d;else a.textv=!a.textv;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"metav":if(WPACS.wp0bj1.isBooleanType(d))a.metav=d;else a.metav=!a.metav;e=null;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"clearmetas":m();if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"fitwnd":a.iratio=a.dratio=0;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"enhance":f();b=null;a.ww=a.wc=a.dw=a.dc=0;a.petct="";a.enh_nlevel=d.n;a.enh_foef=d.f;a.onstatus!=null&&g();return;case"petct":if(WPACS.wp0bj1.isStringType(d)&&d!=""){if(WPACS.CONSTDEF.FUSION_MODE==0||a.vwmode==WPACS.CONSTDEF.VMODE_WADO){f();b=null;a.enh_nlevel=0}var j=d.split(",");if(j.length>1){if(j[0]!="")a.petct=j[0];a.fus_foef=parseFloat(j[1])}else{a.petct=d;a.fus_foef=.5}}else a.petct="";e=null;a.onstatus!=null&&g();return;case"xasub":if(b&&b.image.n>1){a.xasub&&f();a.xasub=!a.xasub;e=null;a.onstatus!=null&&g()}return}}function B(){m();h=null;c!=null&&c.DestroyObj();e=null;c=null;b=null;w=null;a.vimgHandle=null;a.onstatus=null;a={}}function r(){a.iframe=0;d=null;a.offX=a.offY=0;a.iratio=a.dratio=0;a.flip=a.rotate=0;a.psuedo=0;a.invert=false;if(a.enh_nlevel!=0||a.petct!="")b=null;a.enh_nlevel=0;a.enh_foef=.7;a.petct="";a.fus_foef=.5;a.xasub&&f();a.xasub=false;a.ww=a.wc=a.dw=a.dc=0;if(b!=null&&b.image.ww!=0){a.ww=b.image.ww;a.wc=b.image.wc}e=null}function m(){h.Clear()}function j(d,c){if(!WPACS.wp0bj1.isBooleanType(c))c=WPACS.CONSTDEF.FUSION_MODE==0||a.vwmode==WPACS.CONSTDEF.VMODE_WADO;var b=d!=0?"&framenumber="+d:"";if(c){if(a.enh_nlevel)b+="&musica="+a.enh_nlevel+","+a.enh_foef.toFixed(1);else if(a.petct)b+="&petuid="+a.petct+",srsuid,"+a.fus_foef.toFixed(1)+",2,1"}else if(a.enh_nlevel)b+="&musica="+a.enh_nlevel+","+a.enh_foef.toFixed(1);return b}function f(){if(c!=null){if(!a.xasub){var f=j(a.iframe),d=WPACS.wp0b16.MakeKey("rdat",b.image.uid,f);!WPACS.wp0b16.Add(d,c)&&c.DestroyObj()}else c.DestroyObj();c=null}e=null}function q(d,l){if(a.onloaded!=null)a.onloaded(d,a.onloadp);if(d==WPACS.CONSTDEF.wpu2)if(a.vwmode!=WPACS.CONSTDEF.VMODE_WADO&&c!=null)if(a.onstatus!=null)if(WPACS.CONSTDEF.FUSION_MODE!=0&&a.petct!=""){var e=b.image.uid,h=b.series.uid,i=b.study.uid,g=j(a.iframe,false);g+="&petuid="+a.petct+",srsuid,0,2,1";c.wfn25(e,h,i,g)}else if(a.xasub&&b.image.n>1){var e=b.image.uid,h=b.series.uid,i=b.study.uid,k=b.masksub?b.masksub.frames:1;c.wfn26(e,h,i,"&maskframes="+k)}else v();else f();if(a.onstatus==null)return;a.onstatus(d,l);if(d==WPACS.CONSTDEF.wpu2)a.onstatus(WPACS.CONSTDEF.wps3,0)}function p(e){if(a.vwmode!=WPACS.CONSTDEF.VMODE_WADO){var d=new WPACS.wp0bj3;if(b.lttext!=""&&b.lttext.substr(0,7)=="base64:")b.lttext=d.decode(b.lttext.substr(7));if(b.rttext!=""&&b.rttext.substr(0,7)=="base64:")b.rttext=d.decode(b.rttext.substr(7));if(b.lbtext!=""&&b.lbtext.substr(0,7)=="base64:")b.lbtext=d.decode(b.lbtext.substr(7));if(b.rbtext!=""&&b.rbtext.substr(0,7)=="base64:")b.rbtext=d.decode(b.rbtext.substr(7));d=null;var p=b.series.mod?b.series.mod.toUpperCase():"";if(!WPACS.wp0b41.IsImage(p))f();else{var g=j(a.iframe);if(c==null){var k=WPACS.wp0b16.MakeKey("rdat",b.image.uid,g);c=WPACS.wp0b16.Get(k);if(c==null){c=new WPACS.wp0b17(q);e=true}else c.Options().onStatus=q}if(e){var s=b.image.w,r=b.image.h,o=b.image.b,i=b.image.is!=0,h=b.image.ov==1;c.Init(s,r,o,i,h)}if(c.IfLoading())return;if(!c.IfLoaded()){var l=b.image.uid,m=b.series.uid,n=b.study.uid;c.wfn24(l,m,n,g);return}}}q(WPACS.CONSTDEF.wpu2,0)}function s(c){if(!WPACS.wp0bj1.isBooleanType(c))c=true;var f=j(0),e=WPACS.wp0b16.MakeKey("idcm",a.imguid,f);if(WPACS.wp0bj1.ifStorage()&&!WPACS.wp0bj1.NoLocalStorage)if(localStorage[e]){var g=new WPACS.wp0bj3,l=g.decode(localStorage[e]);g=null;try{b=eval("("+l+")")}catch(o){b=null}if(!c)return b!=null;p(true);return true}var d="",m=a.imguid,h=a.srsuid,i=a.stuuid,k=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu4,n=k+"?requesttype=IMGINFO&objectuid="+m;if(h!="")d+="&srsuid="+h;if(i!="")d+="&stuuid="+i;if(f!="")d+=f;$.ajax({type:"POST",data:d,url:n,dataType:"json",async:c,success:function(d){if(d.image.w!=undefined)b=d;if(b!=null&&WPACS.wp0bj1.ifStorage()){var a=new WPACS.wp0bj3,f=JSON.stringify(b);localStorage[e]=a.encode(f);a=null;f=""}c&&p(true)},error:function(d,c,b){WPACS.DEBUGLOG("AjaxError: "+b);if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wpu2,0);window.console&&console.log("failed to get dicominfo")}});return c?true:b!=null}function g(){if(a.imguid=="")return;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps1,-1);if(!b){s(true);return}window.setTimeout(function(){p(false)},0)}function C(c){if(b==null)return false;var d=b.image.n;if(c==-1)c=a.iframe-1;else if(c==-2)c=a.iframe+1;else if(c==-3)c=d-1;if(c<0||c>=d)return false;f();a.iframe=c;g();return true}function o(o,m,g){var h,i,c="";h=b!=null?b.series.uid:a.srsuid;i=b!=null?b.study.uid:a.stuuid;if(h!="")c+="&srsuid="+h;if(i!="")c+="&stuuid="+i;c+="&columns="+(o|0)+"&rows="+(m|0);if(a.textv)c+="&annotation=patient,technique";if(a.ww!=0)c+="&windowwidth="+a.ww+"&windowcenter="+a.wc;if(a.dw!=0||a.dc!=0)c+="&dwl="+a.dw+","+a.dc;if(a.psuedo!=0)c+="&pseudo="+a.psuedo;if(a.invert)c+="&invert=1";else c+="&invert=0";if(a.flip!=0)c+="&mirror="+a.flip;if(a.rotate!=0)c+="&rotate="+a.rotate;if(a.dratio!=0)c+="&zoom="+a.dratio;if(a.iratio>0)c+="&iratio="+a.iratio;if(a.offX!=0||a.offY!=0)c+="&move="+a.offX+","+a.offY;if(!a.metav)c+="&ovl=0";c+=j(a.iframe);if(d!=null){var k=d.left,e=d.top,n=d.right(),f=d.bottom();if(b!=null){e=b.image.h-1-e;f=b.image.h-1-f;if(e>f){var l=e;e=f;f=l}}c+="&cliprc="+k+","+e+","+(n-k+1)+","+(f-e+1)}if(g!=undefined&&g!="")c+=g;return c}function t(h,g){if(a.iratio==0){var f=0,c=0;if(e!=null){f=e.width;c=e.height}else if(d!=null||b!=null){f=d==null?b.image.w:d.width;c=d==null?b.image.h:d.height}if(f==0||c==0)return;var i=Math.floor(g*f/c);a.iratio=i<=h?g*100/c|0:h*100/f|0}if(a.iratio==0||a.dratio==0)return;a.iratio+=a.dratio;a.dratio=0;if(a.iratio<WPACS.CONSTDEF.ZOOM_MIN)a.iratio=WPACS.CONSTDEF.ZOOM_MIN;else if(a.iratio>WPACS.CONSTDEF.ZOOM_MAX)a.iratio=WPACS.CONSTDEF.ZOOM_MAX}function v(){if(c==null)return;if(b.image.b<=8||b.image.b>16)return;if(a.ww==0){if(b.image.ww==0){c.wfn30();b.image.ww=c.wob1.ww;b.image.wc=c.wob1.wc}a.ww=b.image.ww;a.wc=b.image.wc}if(a.ww==0)return;a.ww+=a.dw;a.wc+=a.dc;a.dw=a.dc=0;c.wob1.LutType(0,1);c.wob1.Create(a.ww,a.wc)}function y(){if(c==null)return false;var j=a.psuedo,f=a.invert;if(b!=null&&b.image.iv!=0)f=!f;var g=null,i=a.metav;if(a.metav&&b!=null&&b.shutter)g=b.shutter;!c.wob1.IsValid()&&v();var h=0;if(WPACS.CONSTDEF.FUSION_MODE!=0&&a.vwmode!=WPACS.CONSTDEF.VMODE_WADO&&a.petct!="")h=100-(a.fus_foef*100|0);e=c.wfn29(j,f,d,i,h,g);if(e==null)return false;a.vimgHandle&&a.vimgHandle(w,e);return true}function z(f,e,g,h){if(a.vwmode!=WPACS.CONSTDEF.VMODE_WADO){var b=k(f,e,g,h);if(b==null)return null;var d=c!=null?c.GetPixel(b.x,b.y):undefined;return d==undefined?null:{x:b.x,y:b.y,pixel:d}}return u("pixel",{x:g,y:h},f,e)}function x(h,g,m,o,n,l){if(e==null)return null;var c=k(h,g,m,o),f=k(h,g,n,l),j=e.getContext("2d"),d=j.getImageData(c.x,c.y,f.x-c.x,f.y-c.y);WPACS.CONSTDEF.MGLASS_FILTER&&a.psuedo==0&&b.image.b<=16&&i(d);return d;function i(d){var k=d.width,j=d.height,a,e,b,c,f=255,g=0;for(b=0,a=0;a<j;a++)for(e=0;e<k;e++){c=d.data[b];if(f>c)f=c;if(g<c)g=c;b+=4}if(g==255&&f==0)return;var h=g-f;if(h<1)return;var i=WPACS.wp0bj8(h+1,"u8");for(a=0;a<=h;a++)i[a]=a*255/h;for(b=0,a=0;a<j;a++)for(e=0;e<k;e++){c=d.data[b];c=i[c-f];d.data[b]=d.data[b+1]=d.data[b+2]=c;b+=4}dataBuffer=null;i=null}}function l(c){var b=new WPACS.Matrix("1,0,0,1,0,0");(a.flip&1)!=0&&b.postConcat(new WPACS.Matrix("-1,0,0,1,0,0"));(a.flip&2)!=0&&b.postConcat(new WPACS.Matrix("1,0,0,-1,0,0"));if(a.rotate!=0){var d=new WPACS.Matrix;d.setRotation(a.rotate);b.postConcat(d)}b.e+=a.offX;b.f+=a.offY;WPACS.wp0bj1.isBooleanType(c)&&c&&b.inverse();return b}function k(m,j,h,i){if(b==null)return null;var n=b.image.w,k=b.image.h,q=d==null?n/2|0:d.xCenter(),r=d==null?k/2|0:d.yCenter(),o=m/2|0,p=j/2|0;h-=o;i-=p;var e=l(true),c=e.calNewPoint(h,i),f=c.x*100/a.iratio|0,g=c.y*100/a.iratio|0;f+=q;g+=r;e=null;c=null;return new WPACS.wp0bj2(f,g)}function n(m,j,h,i){if(b==null)return null;var n=b.image.w,k=b.image.h,q=d==null?n/2|0:d.xCenter(),r=d==null?k/2|0:d.yCenter();h-=q;i-=r;var c=h*a.iratio/100|0,e=i*a.iratio/100|0,g=l(false),f=g.calNewPoint(c,e);c=f.x|0;e=f.y|0;var o=m/2|0,p=j/2|0;c+=o;e+=p;g=null;f=null;return new WPACS.wp0bj2(c,e)}function u(s,c,q,p){var o=true,e="";switch(s){case"pixel":e="&measu=v,"+c.x+","+c.y;break;case"rect":e="&measu=r,"+c[0].x+","+c[0].y+","+c[1].x+","+c[1].y;break;case"circle":e="&measu=c,"+c[0].x+","+c[0].y+","+c[1].x+","+c[1].y;break;case"poly":e="&measu=p,"+c[0].x+","+c[0].y;for(var m=1;m<c.length;m++)e+=","+c[i].x+","+c[i].y}if(b==null||e=="")return null;var h=b.image.uid,g=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu5,f,j=n(b.series.uid,b.study.uid);if(o){var k=g+"?requesttype=JSON&objectuid="+h+e;f={type:"POST",url:k,data:j,dataType:"json",async:false}}else{var k=g+"?requesttype=JSON&objectuid="+h+e+j;f={type:"GET",url:k,dataType:"json",async:false}}var l=$.ajax(f),r=l.status==200?eval("("+l.responseText+")"):null;return r;function n(h,i,g){var c="";if(h!="")c+="&srsuid="+h;if(i!="")c+="&stuuid="+i;c+="&columns="+(q|0)+"&rows="+(p|0);if(a.flip!=0)c+="&mirror="+a.flip;if(a.rotate!=0)c+="&rotate="+a.rotate;if(a.dratio!=0)c+="&zoom="+a.dratio;if(a.iratio!=0)c+="&iratio="+a.iratio;if(a.offX!=0||a.offY!=0)c+="&move="+a.offX+","+a.offY;if(a.iframe>0)c+="&framenumber="+a.iframe;if(d!=null){var j=d.left,e=d.top,l=d.right(),f=d.bottom();if(b!=null){e=b.image.h-1-e;f=b.image.h-1-f;if(e>f){var k=e;e=f;f=k}}c+="&cliprc="+j+","+e+","+(l-j+1)+","+(f-e+1)}if(g!=undefined)c+=g;return c}}};eval(function(d,f,a,c,b,e){b=function(a){return a.toString(f)};if(!"".replace(/^/,String)){for(;a--;)e[b(a)]=c[a]||b(a);c=[function(a){return e[a]}];b=function(){return"\\w+"};a=1}for(;a--;)c[a]&&(d=d.replace(new RegExp("\\b"+b(a)+"\\b","g"),c[a]));return d}("(5(){2 a='7'+'f'+'4',1='\u975e\u6cd5'+'\u4f7f\u7528'+a;6{2 0=8(a);9(b 0!=='c'||!0.d)3(1)}g(e){3(1)}})();",17,17,"o warn var alert ACS function try W eval if  typeof object CONSTDEF  P catch".split(" "),0,{}));WPACS.wp0b19=function(){var a={imguid:"",srsuid:"",stuuid:"",vwmode:WPACS.CONSTDEF.VMODE_WADO,nframes:0,iframe:0,textv:true,metav:true,vfmt:"3*4",vgrid:"",vtxt:"",vgain:"",vrate:"",vfilter:"",vinvert:false,vborder:false,vpulse:false,onloaded:null,onloadp:0,onstatus:null},b=null,d=new WPACS.wp0b39;this.DestroyObj=function(){n()};this.Options=function(){return a};this.IfLoading=function(){return false};this.SetViewMode=function(b){if(!WPACS.wp0bj1.isNumberType(b))return;if(b!=WPACS.CONSTDEF.VMODE_WADO)return;if(b==a.vwmode)return;e();a.vwmode=b;a.onstatus!=null&&c()};this.OnBindView=function(b){if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps4,0);a.onstatus=b;a.onstatus!=null?c():e()};this.wfn31=function(){return d};this.GetFrames=function(){return a.nframes};this.SetFrame=function(a){return p(a)};this.GetPixel=function(){return null};this.GetBpp=function(){return 0};this.IsSigned=function(){return true};this.DicomInfo=function(){return null};this.GetImageData=function(){return null};this.wfn32=function(){return new WPACS.Matrix};this.AutoText=function(b,d,c){var a=k("measu",b.ptArray,d,c);if(!a)return false;b.options.txtclr=WPACS.CONSTDEF.CLR_ETEXT;b.options.text=a.spos+"\ndx: "+a.dx+" ms\ndy: "+a.dy+" uV\nhr: "+a.bpm+" bpm";a=null;return true};this.SetDicom=function(c,d,g){h();f();e();b=null;a.imguid=c;a.srsuid=d;a.stuuid=g};this.Clone=function(d){var b=d.Options();this.SetDicom(b.imguid,b.srsuid,b.stuuid);a.textv=b.textv;a.metav=b.metav;a.iframe=b.iframe;a.nframes=b.nframes;a.vfmt=b.vfmt;a.vgrid=b.vgrid;a.vtxt=b.vtxt;a.vgain=b.vgain;a.vrate=b.vrate;a.vfilter=b.vfilter;a.vinvert=b.vinvert;a.vborder=b.vborder;a.vpulse=b.vpulse;c()};this.wfn34=function(a){WPACS.wp0bj1.isBooleanType(a)&&a&&h();c()};this.wfn33=function(a){window.setTimeout(this.wfn34,a)};this.wfn36=function(){return""};this.wfn35=function(c,b,a){return g(c,b,a)};this.GetJpegUrl=function(l,k,i){var f=true,d=g(l,k,i),c=a.imguid,b=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu5;if(!f)return b+"?requesttype=WADO&objectuid="+c+d;var j=b+"?requesttype=WADO_PATH&objectuid="+c,h={type:"POST",url:j,data:d,dataType:"text",async:false},e=$.ajax(h);return e.status!=200?"":b+"?requesttype=VURL"+e.responseText};this.PreView=function(){return a.vwmode==WPACS.CONSTDEF.VMODE_WADO?false:false};this.wfn07=function(b,i,h,k){var j=true;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps1,-1);o(i,h,false);var e=g(i,h,k),d=a.imguid,c=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu5;if(j)$.ajax({type:"POST",data:e,dataType:"text",async:true,url:c+"?requesttype=WADO_PATH&objectuid="+d,success:function(e){var d=c+"?requesttype=VURL"+e;if(b.attr("src")!=d)b.attr("src",d);else if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wpu2,0)},error:function(){if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wpu2,0)}});else{var f=c+"?requesttype=WADO&objectuid="+d+e;if(b.attr("src")!=f)b.attr("src",f);else if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wpu2,0)}return true};this.wfn05=function(){return a.vwmode==WPACS.CONSTDEF.VMODE_WADO?false:false};this.wfn08=function(){};this.wfn06=function(b){if(!a.metav)return;d!=null&&d.DrawMetas(b,undefined)};this.DrawMeta=function(a,b){b.DrawMeta(a,undefined)};this.Cvt2ImageXY=function(c,a,b){return new WPACS.wp0bj2(a,b)};this.ClipImage=function(){};this.GetHistgram=function(){return null};this.Action=function(b,a){return m(b,a)};function m(g,d){switch(g){case"reload":h();d=="1"&&f();a.onstatus!=null&&c();return;case"review":e();a.onstatus!=null&&c();return;case"refresh":if(WPACS.wp0bj1.isBooleanType(d)&&d)b=null;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"vinvert":a.vinvert=!a.vinvert;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"vborder":a.vborder=!a.vborder;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"vpulse":a.vpulse=!a.vpulse;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"vfilter":if(!WPACS.wp0bj1.isStringType(d))return;a.vfilter=d;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"vgrid":if(!WPACS.wp0bj1.isStringType(d))return;if((a.vgrid=d)=="1mm")a.vgrid="";if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"vgain":if(!WPACS.wp0bj1.isStringType(d))return;if((a.vgain=d)=="10")a.vgain="";if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);break;case"vtxt":if(!WPACS.wp0bj1.isStringType(d))return;if((a.vtxt=d)=="TOP")a.vtxt="";b=null;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"vrate":if(!WPACS.wp0bj1.isStringType(d))return;if((a.vrate=d)=="25")a.vrate="";b=null;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"vfmt":if(!WPACS.wp0bj1.isStringType(d))return;if((a.vfmt=d)=="12")a.vfmt="";b=null;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"textv":if(WPACS.wp0bj1.isBooleanType(d))a.textv=d;else a.textv=!a.textv;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"metav":return;case"clearmetas":f();if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return}}function n(){f();d=null;b=null;a.onstatus=null;a={}}function h(){a.iframe=a.nframes=0;a.vfmt="3*4";a.vgrid=a.vtxt=a.vgain=a.vrate=a.vfilter="";a.vinvert=a.vborder=a.vpulse=false;b=null}function f(){d.Clear()}function e(){}function l(b,c){if(a.onloaded!=null)a.onloaded(b,a.onloadp);if(a.onstatus==null)return;a.onstatus(b,c);if(b==WPACS.CONSTDEF.wpu2)a.onstatus(WPACS.CONSTDEF.wps3,0)}function j(){l(WPACS.CONSTDEF.wpu2,0)}function c(){if(a.imguid=="")return;j(false);return}function p(b){if(b==-1)b=a.iframe-1;else if(b==-2)b=a.iframe+1;else if(b==-3)b=a.nframes-1;if(b<0||b>=a.nframes)return false;a.iframe=b;e();c();return true}function o(d,c,g){if(b!=null&&b.w==d&&b.h==c)return;b=null;a.nframes=a.iframe=0;var e=a.imguid;if(e=="")return;var h=i(d,c,""),f=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu5,j=f+"?requesttype=JSON&objectuid="+e+"&ecginfo=";$.ajax({type:"POST",data:h,url:j,dataType:"json",async:g,success:function(e){b={w:d,h:c,l_ms:parseInt(e.l_ms),v_ms:parseInt(e.v_ms),s_ms:parseInt(e.s_ms)};var f=b.s_ms>0?b.l_ms-b.v_ms+b.s_ms-1:0;a.nframes=f>0?Math.ceil(f/b.s_ms):1},error:function(){}})}function g(h,g,d){var e,f,c="";e=a.srsuid;f=a.stuuid;if(e!="")c+="&srsuid="+e;if(f!="")c+="&stuuid="+f;c+="&columns="+(h|0)+"&rows="+(g|0);if(a.textv)c+="&annotation=patient,technique";if(a.vfmt!="")c+="&vfmt="+a.vfmt;if(a.vtxt!="")c+="&vtxt="+a.vtxt;if(a.vgrid!="")c+="&grid="+a.vgrid;if(a.vgain!="")c+="&vgain="+a.vgain;if(a.vrate!="")c+="&vrate="+a.vrate;if(a.vfilter!="")c+="&filter="+a.vfilter;if(a.vborder)c+="&border=TRUE";if(a.vinvert)c+="&invert=TRUE";if(a.vpulse)c+="&pulse=TRUE";if(a.iframe>0)c+="&vpos="+a.iframe*b.s_ms;if(d!=undefined&&d!="")c+=d;return c}function i(h,g,d){var c="",e=a.srsuid,f=a.stuuid;if(e!="")c+="&srsuid="+e;if(f!="")c+="&stuuid="+f;c+="&columns="+(h|0)+"&rows="+(g|0);if(a.vfmt!="")c+="&vfmt="+a.vfmt;if(a.vgain!="")c+="&vgain="+a.vgain;if(a.vrate!="")c+="&vrate="+a.vrate;if(a.iframe>0)c+="&vpos="+a.iframe*b.s_ms;if(d!=undefined)c+=d;return c}function k(o,f,q,p){var m=true,c="";switch(o){case"measu":c="&measu=l";for(var d=0;d<f.length;d++)c+=","+f[d].x+","+f[d].y}if(b==null||c=="")return null;var h=a.imguid,e,j=i(q,p,""),g=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu5;if(m){var k=g+"?requesttype=JSON&objectuid="+h+c;e={type:"POST",url:k,data:j,dataType:"json",async:false}}else{var k=g+"?requesttype=JSON&objectuid="+h+c+j;e={type:"GET",url:k,dataType:"json",async:false}}var l=$.ajax(e),n=l.status==200?eval("("+l.responseText+")"):null;return n}};WPACS.wp0b20=function(){var b={srsuid:"",mod:"",finish:0,success:0,failed:0,onCreate:null,onEvent:[null,null]},a=[],c=true,g=0,i=true;this.Options=function(){return b};this.DestroyObj=function(){l()};this.Length=function(){return a.length};this.Clear=function(){f()};this.GetImage=function(b){return b>=0&&b<a.length?a[b].dcmo:null};this.DelImage=function(c){if(c<0||c>=a.length)return;a[c].dcmo.Options().onloaded=null;a[c].dcmo.DestroyObj();a[c].dcmo=null;a.splice(c,1);for(var d=0;d<b.onEvent.length;d++)b.onEvent[d]!=null&&b.onEvent[d](WPACS.CONSTDEF.wpe1,a.length)};this.IfLoading=function(){return e()};this.SortSlice=function(c,d){if(a.length<2)return;d=d||false;if(d)for(var e=0;e<a.length;e++)a[e].dcmo.DicomInfo(true);var b=c>=0?1:-1;a.sort(function(e,f){var a=e.dcmo.DicomInfo(),d=f.dcmo.DicomInfo();return a==null?b:d==null?-b:c==1||c==-1?a.image.id>d.image.id?b:-b:c==2||c==-2?a.image.loc>d.image.loc?b:-b:c==3||c==-3?a.image.z0>d.image.z0?b:-b:c==4||c==-4?a.image.y0>d.image.y0?b:-b:a.image.x0>d.image.x0?b:-b})};this.AddEcg=function(e,f,g){var c=new WPACS.wp0b19;c.SetDicom(e,f,g);c.Options().onloadp=a.length;c.Options().onloaded=d;if(b.onCreate!=null)b.onCreate(WPACS.CONSTDEF.wpe12,c);a[a.length]={dcmo:c,state:0,loading:0};c=null;return a.length};this.AddDicom=function(e,f,g){if(!a)return 0;var c=new WPACS.wp0b18;c.SetDicom(e,f,g);c.Options().onloadp=a.length;c.Options().onloaded=d;if(b.onCreate!=null)b.onCreate(WPACS.CONSTDEF.wpe12,c);a[a.length]={dcmo:c,state:0,loading:0};c=null;return a.length};this.CloneDicom=function(e){var c=e.Options().vfmt?new WPACS.wp0b19:new WPACS.wp0b18;if(c==null)return false;c.Options().onloadp=a.length;c.Options().onloaded=d;if(b.onCreate!=null)b.onCreate(WPACS.CONSTDEF.wpe12,c);c.Clone(e);a[a.length]={dcmo:c,state:0,loading:0};c=null;return true};this.AddSeries=function(c,e,m,i,d){if(c=="")return;var g=m.toUpperCase(),f=this;b.srsuid=c;b.mod=g;var k=WPACS.wp0bj1.isBooleanType(i)?i:true;if(!WPACS.wp0bj1.isBooleanType(d))d=false;var j=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu6,l=j+"?itype=4&srsuid="+c+"&stuuid="+e;$.ajax({type:"GET",url:l,dataType:"xml",async:k,success:function(n){var k,j=[];$(n).find("record").each(function(d,c){var b=$(c).find("image").attr("uid"),a=$(c).find("image").attr("id");if(!isNaN(a))k=WPACS.wp0bj1.printf("%04d",a)+","+b+","+a;else k=a+","+b+","+a;j[j.length]=k});if(j.length==0)return;else j.sort();for(var m=g=="ECG",i=0;i<j.length;i++){var l=j[i].split(",");m?f.AddEcg(l[1],c,e):f.AddDicom(l[1],c,e)}d&&h();for(var i=0;i<b.onEvent.length;i++)b.onEvent[i]!=null&&b.onEvent[i](WPACS.CONSTDEF.wpe1,a.length)}})};this.StopLoad=function(){j()};this.StartLoad=function(a,b){h(a,b)};this.ToggleLoad=function(){if(c)this.StartLoad();else this.StopLoad()};this.Action=function(e,d){switch(e){case"vwmode":for(var c=0;c<a.length;c++)a[c].dcmo.SetViewMode(d);return;case"dlossy":b.finish=b.success=b.failed=0;for(var c=0;c<a.length;c++){a[c].state=a[c].loading=0;a[c].dcmo.Action("review")}return}for(var c=0;c<a.length;c++)a[c].dcmo.Action(e,d)};function f(){j();for(var c=0;c<a.length;c++){a[c].dcmo.Options().onloaded=null;a[c].dcmo.DestroyObj();a[c].dcmo=null;a[c]={}}a=[];for(var c=0;c<b.onEvent.length;c++)b.onEvent[c]!=null&&b.onEvent[c](WPACS.CONSTDEF.wpe1,a.length)}function l(){for(var c=0;c<b.onEvent.length;c++)b.onEvent[c]=null;f();a=null;b.onCreate=null;b={}}function j(){c=true}function h(a,b){if(WPACS.wp0bj1.isNumberType(a))g=a;if(WPACS.wp0bj1.isBooleanType(b))i=b;if(!c)return;else c=false;window.setTimeout(function(){for(var b=4,a=0;a<b;a++)d(0,0)},0)}function k(h){var f=WPACS.CONSTDEF.MAXLOAD_THREADS;if(f>0&&e()>f)return-1;var d=a!=null?a.length:0,j=0,b=g,k=h>0?h:32767,l=i?1:-1;while(k>0&&j<d){if(c)return-1;if(b<0)b=d-1;else if(b>=d)b=0;if(a[b].state==0&&a[b].loading==0)return b;k--;j++;b+=l}return-1}function e(){for(var c=0,b=0;b<a.length;b++)if(a[b].loading!=0)c++;return c}function d(e,c){if(c<0||!a||c>=a.length)return;var d=-1;if(e!=WPACS.CONSTDEF.wps1){if(e==WPACS.CONSTDEF.wpu2||e<0){if(a[c].state==0){b.finish+=1;e<0?(b.failed+=1):(b.success+=1)}a[c].state=1;a[c].loading=0}d=k(-1)}else a[c].loading=1;if(d!=-1){a[d].loading=1;if(WPACS.wp0bj1.Browser.Versions.ie)a[d].dcmo.wfn33(0);else window.setTimeout(function(a){a.wfn34()},0,a[d].dcmo)}for(var f=0;f<b.onEvent.length;f++)b.onEvent[f]!=null&&b.onEvent[f](WPACS.CONSTDEF.wpe2,a.length)}};WPACS.wp0b21=function(){var h={onstatus:null,reconW:512,reconH:512,mod:"CT",sdir:[0,0,1]},n=null,f=null,k=new WPACS.wp0b27,l=new WPACS.wp0b28,w=false;this.DestroyObj=function(){f&&f.DestroyObj();f=null;n=null;b=c=d=0;i=false;C=1;k&&k.DestroyObj();k=null;l&&l.DestroyObj();l=null;for(var e=0;e<a.length;e++)a[e]=null;a=[];j=null;h.onstatus=null;h={}};this.Options=function(){return h};this.DicomInfo=function(){return n};this.IfLoaded=function(){return a.length!=0};this.GetVolSize=function(){return{x:b,y:c,z:d}};this.GetSliceSize=function(g,f){var e=h.reconW,a=h.reconH;switch(g){case WPACS.CONSTDEF.wpdt0:if(f==1)return[b,c];else if(f==2)return[b,d];else if(f==3)return[c,d];break;case WPACS.CONSTDEF.wpdt2:return[e,a,0];case WPACS.CONSTDEF.wpdt3:return[e,a,8];case WPACS.CONSTDEF.wpdt4:return[e,a,24];case WPACS.CONSTDEF.wpdt5:return[e,a,8];case WPACS.CONSTDEF.wpdt6:return[e,a,8]}return[0,0,0]};this.SetSeries=function(c,d,e){f&&f.DestroyObj();f=null;for(var b=0;b<a.length;b++)a[b]=null;a=[];j=null;n=null;if(c=="")return false;f=new WPACS.wp0b20;f.Options().onEvent[0]=A;f.AddSeries(c,d,e,false,false);if(f.Length()<10)return false;for(var b=0;b<f.Length();b++)f.GetImage(b).Options().onstatus=function(){};if(h.onstatus)h.onstatus(WPACS.CONSTDEF.wps0,f.Length());f.ToggleLoad();return true};this.SetDcmSet=function(c){f&&f.DestroyObj();f=null;for(var b=0;b<a.length;b++)a[b]=null;a=[];j=null;n=null;if(!c||c.Length()<10)return false;f=new WPACS.wp0b20;f.Options().onEvent[0]=A;for(var b=0;b<c.Length();b++){var d=c.GetImage(b).Options();f.AddDicom(d.imguid,d.srsuid,d.stuuid)}for(var b=0;b<f.Length();b++)f.GetImage(b).Options().onstatus=function(){};if(h.onstatus)h.onstatus(WPACS.CONSTDEF.wps0,f.Length());f.ToggleLoad();return true};this.ReSet=function(){k&&k.Reset();l&&l.Reset();j=null};this.SetClipPoly=function(b,a){Q(b,a)};this.wfn01=function(a){var b=null,d=a.mprth?a.mprth:0,c=a.mprfn?a.mprfn:0;if(a.pts)if(a.pts.length==2)b=I(a.pts[0].x,a.pts[0].y,a.pts[1].x,a.pts[1].y);else b=F(a.pts);else b=R(a.loc,d,c);return b};this.wfn02=function(a){var b=null,d=a.mprth?a.mprth:0,c=a.mprfn?a.mprfn:0;if(a.pts)if(a.pts.length==2)b=J(a.pts[0].x,a.pts[0].y,a.pts[1].x,a.pts[1].y);else b=G(a.pts);else b=O(a.loc,d,c);return b};this.wfn03=function(a){var b=null,d=a.mprth?a.mprth:0,c=a.mprfn?a.mprfn:0;if(a.pts)if(a.pts.length==2)b=K(a.pts[0].x,a.pts[0].y,a.pts[1].x,a.pts[1].y);else b=H(a.pts);else b=N(a.loc,d,c);return b};var u=null;this.wfn04=function(a,b){u!=null&&window.clearTimeout(u);u=window.setTimeout(function(){var c=W(a,b);if(h.onstatus)h.onstatus(WPACS.CONSTDEF.wps3,{data:c,type:a});if(c)c.d=null;c=null;u=null},0);return null};this.GetPerspProj=function(){return l};this.GetOrthoProj=function(){return k};this.GetScaleOfCast=function(){var a=k.GetSizeX()/h.reconW,b=k.GetSizeY()/h.reconH;return[a,b]};this.GetCoordOfCast=function(d,a){var f=h.reconW,e=h.reconH,c=d==WPACS.CONSTDEF.wpdt6?l:k,b=c.wfn09(a.x,a.y,a.z),g=(1+b.x)*f/2,i=(1+b.y)*e/2;return{x:g,y:i}};this.GetSliceSorted=function(){return U()};function U(a){if(!a&&n)a=n.image.pp;return a&&a.substr(0,2)=="FF"?true:false}function z(){var d=h.sdir[0],e=h.sdir[1],f=h.sdir[2],a=Math.abs(d),b=Math.abs(e),c=Math.abs(f);return c>b&&c>a?f>0?-3:3:b>c&&b>a?e>0?4:-4:a>c&&a>b?d>0?5:-5:-3}function A(d){if(d==WPACS.CONSTDEF.wpe2){var c=f.Length(),a=f.Options().finish,b=f.Options().success;if(h.onstatus)h.onstatus(WPACS.CONSTDEF.wps1,a*100/c|0);if(c==a){if(b==a)window.setTimeout(T,10);else window.setTimeout(function(){f.DestroyObj();f=null},10);if(h.onstatus)b==a?h.onstatus(WPACS.CONSTDEF.wpu2,0):h.onstatus(WPACS.CONSTDEF.wps5,"\u5207\u7247\u672a\u5168\u4e0b\u8f7d")}}}function M(l,c){f.SortSlice(c);var j=f.Length(),h=j-1,i=j/2|0,b,d,k,a=f.GetImage(0).DicomInfo(),e=f.GetImage(h).DicomInfo(),g=f.GetImage(i).DicomInfo();if(c==3||c==-3){b=Math.abs(e.image.z0-a.image.z0);d=Math.abs(g.image.z0-a.image.z0)}else if(c==4||c==-4){b=Math.abs(e.image.y0-a.image.y0);d=Math.abs(g.image.y0-a.image.y0)}else if(c==5||c==-5){b=Math.abs(e.image.x0-a.image.x0);d=Math.abs(g.image.x0-a.image.x0)}else if(e.image.loc||a.image.loc){b=Math.abs(e.image.loc-a.image.loc);d=Math.abs(g.image.loc-a.image.loc)}else{b=Math.abs(e.image.z0-a.image.z0);d=Math.abs(g.image.z0-a.image.z0)}b/=h;d/=i;return b}function T(){if(f==null)return;var r=-3;function B(a){return a==1||a==-1?[a,0,0]:a==2||a==-2?[0,a/2,0]:a==3||a==-3?[0,0,a/3]:[0,0,0]}h.mod=f.Options().mod;var s=f.GetImage(0).DicomInfo(),y=B(s.image.ox),A=B(s.image.oy),H=y[1]*A[2]-A[1]*y[2],I=y[2]*A[0]-A[2]*y[0],J=y[0]*A[1]-y[1]*A[0];h.sdir=[H,I,J];r=z();var C=M(f,r),s=f.GetImage(0).DicomInfo(),G=s.image.w,F=s.image.h,E=s.image.b,D=s.image.fx;cb(G,F,E,s.image.is!=0,f.Length(),D,C);n=s;s=null;var q=0,u=D/C,K=(new Date).getTime();if(a.length==1)if(r==4||r==-4)for(var j=0;j<d;j++)for(var i=0,k=0;k<c;k++){for(var e=i|0,t=e+1,o=i-e,v=1-o,l=f.GetImage(e).wfn22(),m=f.GetImage(t).wfn22(),g=b*j,p=0;p<b;p++){var w=l[g]*v+m[g]*o;a[0][q++]=w;g++}i+=u;l=m=null}else if(r==5||r==-5)for(var j=0;j<d;j++)for(var i=0,k=0;k<b;k++){q=j*b*c+k;for(var e=i|0,t=e+1,o=i-e,v=1-o,l=f.GetImage(e).wfn22(),m=f.GetImage(t).wfn22(),g=c*j,p=0;p<c;p++){var w=l[g]*v+m[g]*o;a[0][q]=w;g++;q+=b}i+=u;l=m=null}else for(var i=0,j=0;j<d;j++){for(var e=i|0,t=e+1,o=i-e,v=1-o,l=f.GetImage(e).wfn22(),m=f.GetImage(t).wfn22(),g=0,k=0;k<c;k++)for(var p=0;p<b;p++){var w=l[g]*v+m[g]*o;a[0][q++]=w;g++}i+=u;l=m=null}else if(a.length>1)if(r==4||r==-4)for(var j=0;j<d;j++)for(var i=0,k=0;k<c;k++){for(var e=i|0,t=e+1,o=i-e,v=1-o,l=f.GetImage(e).wfn22(),m=f.GetImage(t).wfn22(),g=b*j,p=0;p<b;p++){var w=l[g]*v+m[g]*o;x(q++,w);g++}i+=u;l=m=null}else if(r==5||r==-5)for(var j=0;j<d;j++)for(var i=0,k=0;k<b;k++){q=j*b*c+k;for(var e=i|0,t=e+1,o=i-e,v=1-o,l=f.GetImage(e).wfn22(),m=f.GetImage(t).wfn22(),g=c*j,p=0;p<c;p++){var w=l[g]*v+m[g]*o;x(q,w);g++;q+=b}i+=u;l=m=null}else for(var i=0,j=0;j<d;j++){for(var e=i|0,t=e+1,o=i-e,v=1-o,l=f.GetImage(e).wfn22(),m=f.GetImage(t).wfn22(),g=0,k=0;k<c;k++)for(var p=0;p<b;p++){var w=l[g]*v+m[g]*o;x(q++,w);g++}i+=u;l=m=null}f.DestroyObj();f=null;if(h.onstatus)h.onstatus(WPACS.CONSTDEF.wpu2,1)}function cb(t,s,e,u,r,o,p){for(var f=0;f<a.length;f++)a[f]=null;a=[];var h=z();if(h==4||h==-4){b=t;d=s;c=(r-1)*p/o|0}else if(h==5||h==-5){c=t;d=s;b=(r-1)*p/o|0}else{b=t;c=s;d=(r-1)*p/o|0}i=false;C=1;if(e>8&&e<16){i=true;g=e}else if(e==16){i=WPACS.wp0bj1.isBooleanType(u)?u:false;g=e}else if(e>0&&e<=8)g=e;else return;var q=0,v=[d,(d+1)/2|0,(d+2)/3|0];while(q<v.length){var m,j=d,n=v[q++];try{while(j>0){var x=j>n?n:j;m=b*c*x;j-=x;var w=g>8&&g<=16?WPACS.wp0bj8(m,i?"i16":"u16"):WPACS.wp0bj8(m,"u8");a.push(w);w=null}break}catch(y){for(var f=0;f<a.length;f++)a[f]=null;a=[];WPACS.DEBUGLOG(q+" failed to malloc("+m+"),"+n+" - "+y.message)}}k&&k.Init(b,c,d);l&&l.Init(b,c,d);if(a.length!=0)return;if(!WPACS.wp0bj1.IsMobile)WPACS.DEBUGLOG("failed to malloc "+d+" slices memory");else alert("failed to malloc "+d+" slices memory")}function e(b){if(b<a[0].length)return a[0][b];b-=a[0].length;for(var c=1;c<a.length;c++){if(b<a[c].length)return a[c][b];b-=a[c].length}return 0}function x(b,d){if(b<a[0].length){a[0][b]=d;return}b-=a[0].length;for(var c=1;c<a.length;c++){if(b<a[c].length){a[c][b]=d;return}b-=a[c].length}}function R(s,z,x){if(a.length==0)return null;if(s<0||s>=d)return null;if(w&&j)return L(s);var y=g>8&&g<=16?i?"i16":"u16":"u8",k=b*c,t=WPACS.wp0bj8(k,y),o=k*s,v=0,p=1+z/n.image.fx|0;if(s+p>=d)p=d-s;var m=a.length==1;if(x==1)for(var q=0;q<c;q++){for(var h=0;h<b;h++){var f=o+h,l=m?a[0][f]:e(f);f+=k;for(var r=1;r<p;r++){var u=m?a[0][f]:e(f);f+=k;if(l<u)l=u}t[v++]=l}o+=b}else if(x==2)for(var q=0;q<c;q++){for(var h=0;h<b;h++){var f=o+h,l=m?a[0][f]:e(f);f+=k;for(var r=1;r<p;r++){var u=m?a[0][f]:e(f);f+=k;if(l>u)l=u}t[v++]=l}o+=b}else for(var q=0;q<c;q++){for(var h=0;h<b;h++){var f=o+h,l=m?a[0][f]:e(f);f+=k;for(var r=1;r<p;r++)l+=m?a[0][f]:e(f);f+=k;t[v++]=l/p|0}o+=b}return{w:b,h:c,b:g,s:i,d:t}}function L(l){var o=g>8&&g<=16?i?"i16":"u16":"u8",h=WPACS.wp0bj8(b*c,o),k=b*c*l,j=0,n=g>8&&g<=16?i?-32767:0:0;if(a.length==1)for(var d=0;d<c;d++)for(var f=0;f<b;f++)if(!m(f,d,l))h[j++]=a[0][k++];else{h[j++]=n;k++}else for(var d=0;d<c;d++)for(var f=0;f<b;f++)if(!m(f,d,l))h[j++]=e(k++);else{h[j++]=n;k++}return{w:b,h:c,b:g,s:i,d:h}}function O(r,z,x){if(a.length==0)return null;if(r<0||r>=c)return null;if(w&&j)return E(r);var y=g>8&&g<=16?i?"i16":"u16":"u8",s=WPACS.wp0bj8(b*d,y),m=b*r,u=0,v=b*c,o=1+z/n.image.fx|0;if(r+o>=c)o=c-r;var l=a.length==1;if(x==1)for(var p=0;p<d;p++){for(var h=0;h<b;h++){var f=m+h,k=l?a[0][f]:e(f);f+=b;for(var q=1;q<o;q++){var t=l?a[0][f]:e(f);f+=b;if(k<t)k=t}s[u++]=k}m+=v}else if(x==2)for(var p=0;p<d;p++){for(var h=0;h<b;h++){var f=m+h,k=l?a[0][f]:e(f);f+=b;for(var q=1;q<o;q++){var t=l?a[0][f]:e(f);f+=b;if(k>t)k=t}s[u++]=k}m+=v}else for(var p=0;p<d;p++){for(var h=0;h<b;h++){var f=m+h,k=l?a[0][f]:e(f);f+=b;for(var q=1;q<o;q++)k+=l?a[0][f]:e(f);f+=b;s[u++]=k/o|0}m+=v}return{w:b,h:d,b:g,s:i,d:s}}function E(o){var r=g>8&&g<=16?i?"i16":"u16":"u8",k=WPACS.wp0bj8(b*d,r),n=b*o,l=0,q=b*c,p=g>8&&g<=16?i?-32767:0:0;if(a.length==1)for(var h=0;h<d;h++){for(var f=0;f<b;f++)if(!m(f,o,h))k[l++]=a[0][n+f];else k[l++]=p;n+=q}else for(var h=0;h<d;h++){for(var f=0;f<b;f++)if(!j||!m(f,o,h))k[l++]=e(n+f);else k[l++]=p;n+=q}return{w:b,h:d,b:g,s:i,d:k}}function N(s,A,y){if(a.length==0)return null;if(s<0||s>=b)return null;if(w&&j)return D(s);var z=g>8&&g<=16?i?"i16":"u16":"u8",t=WPACS.wp0bj8(c*d,z),l=s,v=0,x=b*c,m=1+A/n.image.fx|0;if(s+m>=b)m=b-s;var k=a.length==1;if(y==1)for(var o=0;o<d;o++){for(var p=0,r=0;p<c;p++,r+=b){var f=l+r,h=k?a[0][f]:e(f);f+=1;for(var q=1;q<m;q++){var u=k?a[0][f]:e(f);f+=1;if(h<u)h=u}t[v++]=h}l+=x}else if(y==2)for(var o=0;o<d;o++){for(var p=0,r=0;p<c;p++,r+=b){var f=l+r,h=k?a[0][f]:e(f);f+=1;for(var q=1;q<m;q++){var u=k?a[0][f]:e(f);f+=1;if(h>u)h=u}t[v++]=h}l+=x}else for(var o=0;o<d;o++){for(var p=0,r=0;p<c;p++,r+=b){var f=l+r,h=k?a[0][f]:e(f);f+=1;for(var q=1;q<m;q++)h+=k?a[0][f]:e(f);f+=1;t[v++]=h/m|0}l+=x}return{w:c,h:d,b:g,s:i,d:t}}function D(o){var r=g>8&&g<=16?i?"i16":"u16":"u8",j=WPACS.wp0bj8(c*d,r),l=o,k=0,q=b*c,p=g>8&&g<=16?i?-32767:0:0;if(a.length==1)for(var f=0;f<d;f++){for(var h=0,n=0;h<c;h++,n+=b)if(!m(o,h,f))j[k++]=a[0][l+n];else j[k++]=p;l+=q}else for(var f=0;f<d;f++){for(var h=0,n=0;h<c;h++,n+=b)if(!m(o,h,f))j[k++]=e(l+n);else j[k++]=p;l+=q}return{w:c,h:d,b:g,s:i,d:j}}function y(k,r){if(!r)r=k.length/2|0;var z=g>8&&g<=16?i?"i16":"u16":"u8",l=WPACS.wp0bj8(r*d,z),s=0,m=0,w=b*c;if(a.length==1)for(var u=0;u<d;u++){for(var h=0;h<r;h++){var o=k[h*2]|0,j=k[h*2]-o,p=k[h*2+1]|0,n=k[h*2+1]-p,f=s+p*b+o;if(o<b-1&&p<c-1){var t=f+1,q=f+b,v=q+1,x=a[0][f]*(1-j)+a[0][t]*j,y=a[0][q]*(1-j)+a[0][v]*j;l[m++]=x*(1-n)+y*n|0}else if(p<c-1){var q=f+b;l[m++]=a[0][f]*(1-n)+a[0][q]*n|0}else if(o<b-1){var t=f+1;l[m++]=a[0][f]*(1-j)+a[0][t]*j|0}else l[m++]=a[0][f]}s+=w}else for(var u=0;u<d;u++){for(var h=0;h<r;h++){var o=k[h*2]|0,j=k[h*2]-o,p=k[h*2+1]|0,n=k[h*2+1]-p,f=s+p*b+o;if(o<b-1&&p<c-1){var t=f+1,q=f+b,v=q+1,x=e(f)*(1-j)+e(t)*j,y=e(q)*(1-j)+e(v)*j;l[m++]=x*(1-n)+y*n|0}else if(p<c-1){var q=f+b;l[m++]=e(f)*(1-n)+e(q)*n|0}else if(o<b-1){var t=f+1;l[m++]=e(f)*(1-j)+e(t)*j|0}else l[m++]=e(f)}s+=w}return{w:r,h:d,b:g,s:i,d:l}}function I(l,m,q,r){if(a.length==0)return null;for(var h=q-l,i=r-m,e=Math.sqrt(h*h+i*i)|0,p=i/e,o=h/e,d=0,f=WPACS.wp0bj8(e*2,"f32"),g=0;g<e;g++){var j=g*o+l,k=g*p+m;if(j<0||j>=b||k<0||k>=c)continue;f[d*2]=j;f[d*2+1]=k;d++}var n=y(f,d);f=null;return n}function F(g){if(a.length==0)return null;for(var f=[],d=0;d<g.length-1;d++)for(var n=g[d].x,o=g[d].y,j=g[d+1].x-n,k=g[d+1].y-o,e=Math.sqrt(j*j+k*k)|0,r=k/e,q=j/e,i=0;i<e;i++){var l=i*q+n,m=i*r+o;if(l<0||l>=b||m<0||m>=c)continue;f.push({x:l,y:m})}for(var e=f.length,h=WPACS.wp0bj8(e*2,"f32"),d=0;d<e;d++){h[d*2]=f[d].x;h[d*2+1]=f[d].y}f=null;var p=y(h,e);h=null;return p}function v(k,r){if(!r)r=k.length/2|0;var z=g>8&&g<=16?i?"i16":"u16":"u8",l=WPACS.wp0bj8(r*c,z),t=0,m=0,s=b*c;if(a.length==1)for(var v=0;v<c;v++){for(var h=0;h<r;h++){var o=k[h*2]|0,j=k[h*2]-o,p=k[h*2+1]|0,n=k[h*2+1]-p,f=t+p*s+o;if(o<b-1&&p<d-1){var u=f+1,q=f+s,w=q+1,x=a[0][f]*(1-j)+a[0][u]*j,y=a[0][q]*(1-j)+a[0][w]*j;l[m++]=x*(1-n)+y*n|0}else if(p<d-1){var q=f+s;l[m++]=a[0][f]*(1-n)+a[0][q]*n|0}else if(o<b-1){var u=f+1;l[m++]=a[0][f]*(1-j)+a[0][u]*j|0}else l[m++]=a[0][f]}t+=b}else for(var v=0;v<c;v++){for(var h=0;h<r;h++){var o=k[h*2]|0,j=k[h*2]-o,p=k[h*2+1]|0,n=k[h*2+1]-p,f=t+p*s+o;if(o<b-1&&p<d-1){var u=f+1,q=f+s,w=q+1,x=e(f)*(1-j)+e(u)*j,y=e(q)*(1-j)+e(w)*j;l[m++]=x*(1-n)+y*n|0}else if(p<d-1){var q=f+s;l[m++]=e(f)*(1-n)+e(q)*n|0}else if(o<b-1){var u=f+1;l[m++]=e(f)*(1-j)+e(u)*j|0}else l[m++]=e(f)}t+=b}return{w:r,h:c,b:g,s:i,d:l}}function J(l,m,q,r){if(a.length==0)return null;for(var h=q-l,i=r-m,e=Math.sqrt(h*h+i*i)|0,p=i/e,o=h/e,c=0,f=WPACS.wp0bj8(e*2,"f32"),g=0;g<e;g++){var j=g*o+l,k=g*p+m;if(j<0||j>=b||k<0||k>=d)continue;f[c*2]=j;f[c*2+1]=k;c++}var n=v(f,c);f=null;return n}function G(g){if(a.length==0)return null;for(var f=[],c=0;c<g.length-1;c++)for(var n=g[c].x,o=g[c].y,j=g[c+1].x-n,k=g[c+1].y-o,e=Math.sqrt(j*j+k*k)|0,r=k/e,q=j/e,i=0;i<e;i++){var l=i*q+n,m=i*r+o;if(l<0||l>=b||m<0||m>=d)continue;f.push({x:l,z:m})}for(var e=f.length,h=WPACS.wp0bj8(e*2,"f32"),c=0;c<e;c++){h[c*2]=f[c].x;h[c*2+1]=f[c].z}f=null;var p=v(h,e);h=null;return p}function P(k,r){if(!r)r=k.length/2|0;var z=g>8&&g<=16?i?"i16":"u16":"u8",l=WPACS.wp0bj8(r*b,z),t=0,m=0,s=b*c;if(a.length==1)for(var v=0;v<b;v++){for(var h=0;h<r;h++){var o=k[h*2]|0,j=k[h*2]-o,p=k[h*2+1]|0,n=k[h*2+1]-p,f=t+p*s+o*c;if(o<c-1&&p<d-1){var u=f+c,q=f+s,w=q+c,x=a[0][f]*(1-j)+a[0][u]*j,y=a[0][q]*(1-j)+a[0][w]*j;l[m++]=x*(1-n)+y*n|0}else if(p<d-1){var q=f+s;l[m++]=a[0][f]*(1-n)+a[0][q]*n|0}else if(o<c-1){var u=f+c;l[m++]=a[0][f]*(1-j)+a[0][u]*j|0}else l[m++]=a[0][f]}t++}else for(var v=0;v<b;v++){for(var h=0;h<r;h++){var o=k[h*2]|0,j=k[h*2]-o,p=k[h*2+1]|0,n=k[h*2+1]-p,f=t+p*s+o*c;if(o<c-1&&p<d-1){var u=f+c,q=f+s,w=q+c,x=e(f)*(1-j)+e(u)*j,y=e(q)*(1-j)+e(w)*j;l[m++]=x*(1-n)+y*n|0}else if(p<d-1){var q=f+s;l[m++]=e(f)*(1-n)+e(q)*n|0}else if(o<c-1){var u=f+c;l[m++]=e(f)*(1-j)+e(u)*j|0}else l[m++]=e(f)}t++}return{w:r,h:b,b:g,s:i,d:l}}function K(l,m,q,r){if(a.length==0)return null;for(var h=q-l,i=r-m,e=Math.sqrt(h*h+i*i)|0,p=i/e,o=h/e,b=0,f=WPACS.wp0bj8(e*2,"f32"),g=0;g<e;g++){var j=g*o+l,k=g*p+m;if(j<0||j>=c||k<0||k>=d)continue;f[b*2]=j;f[b*2+1]=k;b++}var n=P(f,b);f=null;return n}function H(g){if(a.length==0)return null;for(var f=[],b=0;b<g.length-1;b++)for(var n=g[b].x,o=g[b].y,j=g[b+1].x-n,k=g[b+1].y-o,e=Math.sqrt(j*j+k*k)|0,r=k/e,q=j/e,i=0;i<e;i++){var l=i*q+n,m=i*r+o;if(l<0||l>=c||m<0||m>=d)continue;f.push({y:l,z:m})}for(var e=f.length,h=WPACS.wp0bj8(e*2,"f32"),b=0;b<e;b++){h[b*2]=f[b].y;h[b*2+1]=f[b].z}f=null;var p=v(h,e);h=null;return p}function r(l,m,n){var f=l|0,g=m|0,h=n|0;if(f<0||f>=b||g<0||g>=c||h<0||h>=d)return[];var j=b*c,i=h*j+g*b+f,k=a.length==1?a[0][i]:e(i);return[k]}function q(F,G,H){var i=F|0,j=G|0,k=H|0;if(i<0||i>=b||j<0||j>=c||k<0||k>=d)return[];var B=b*c,f=k*B+j*b+i;if(i==b-1||j==c-1||k==d-1){var D=a.length==1?a[0][f]:e(f);return[D]}var w=f+1,v=f+b,x=f+b+1,g=f+B,z=g+1,y=g+b,A=g+b+1,m,n,o,p,q,r,s,t;if(a.length==1){m=a[0][f];n=a[0][w];o=a[0][v];p=a[0][x];q=a[0][g];r=a[0][z];s=a[0][y];t=a[0][A]}else{m=e(f);n=e(w);o=e(v);p=e(x);q=e(g);r=e(z);s=e(y);t=e(A)}var h=F-i,u=G-j,E=H-k,l=1-h,C=1-u,O=1-E,I=m*l+n*h,J=o*l+p*h,K=I*C+J*u,L=q*l+r*h,M=s*l+t*h,N=L*C+M*u,D=K*O+N*E;return[D]}function W(A,H){var G={skip:2,step:1,inp:true},c=$.extend({},G,H||{}),o=c.skip<1?1/c.skip|0:1,d=o==1?c.skip|0:1,q=h.reconW*o,r=h.reconH*o,e=null,a=0,b=k;switch(A){case WPACS.CONSTDEF.wpdt2:a=g;e=V;break;case WPACS.CONSTDEF.wpdt3:a=8;e=X;break;case WPACS.CONSTDEF.wpdt4:a=24;e=ab;break;case WPACS.CONSTDEF.wpdt5:a=8;if(c.vrww>0)e=bb;break;case WPACS.CONSTDEF.wpdt6:a=8;c.focal&&l.SetFocal(c.focal[0],c.focal[1],c.focal[2]);if(c.vrww&&c.vrww>0)e=Z;else e=Y;b=l}if(e==null)return null;var F=a>8&&a<=16?i?"i16":"u16":"u8",n=a>8&&a<=16?1:Math.floor((a+7)/8),p=WPACS.wp0bj8(q*r*n,F),j=0,z=(d-1)*q*n,y=(d-1)*n,I=(new Date).getTime(),f=b.GetOrgin(),w=b.GetRight(),x=b.GetUp();w.Scale(b.GetSizeX()*d/q);x.Scale(b.GetSizeY()*d/r);var B=b.wfn10(),D=b.wfn11();if(A==WPACS.CONSTDEF.wpdt6)for(var E=b.GetFocal(),v=b.GetLook(),u=0;u<r;u+=d){for(var s=new WPACS.wp0bj5(f.x,f.y,f.z),t=0;t<q;t+=d){var v=WPACS.wp0bj5.Create(s,E);v.Normalize();for(var C=e(E,v,c,B,D),m=0;m<n;m++)p[j++]=C[m];j+=y;s.Add(w)}j+=z;f.Add(x)}else for(var v=b.GetLook(),u=0;u<r;u+=d){for(var s=new WPACS.wp0bj5(f.x,f.y,f.z),t=0;t<q;t+=d){for(var C=e(s,v,c,B,D),m=0;m<n;m++)p[j++]=C[m];j+=y;s.Add(w)}j+=z;f.Add(x)}e=null;b=null;if(o>1)WPACS.wp0b10.StrechIn(p,h.reconW,h.reconH,a,o);else d>1&&WPACS.wp0b10.StrechOut(p,h.reconW,h.reconH,a,d);return{w:h.reconW,h:h.reconH,b:a,s:i,d:p}}function V(s,c,g,n,o){var l=!g.inp,f=g.step,b=p(s,c,n,o);if(!b)return[0];var a=b.nearpos,t=b.farpos,h=b.dist;b=null;var i=new WPACS.wp0bj5(c.x,c.y,c.z);i.Scale(f);var k=l?r:q,d=0;while(h>0){if(!j||!m(a.x|0,a.y|0,a.z|0)){var e=k(a.x,a.y,a.z);if(e.length>0&&e[0]>d)d=e[0]}h-=f;a.Add(i)}return[d]}function X(A,b,c,y,z){var h=!c.inp,g=c.step,i=c.light?c.light:0,x=c.thre?c.thre:160,d=p(A,b,y,z);if(!d)return[0];var a=d.nearpos,B=d.farpos,k=d.dist;d=null;var n=new WPACS.wp0bj5(b.x,b.y,b.z);n.Scale(g);var u=h?r:q,v=h?t:s;while(k>0){if(!j||!m(a.x|0,a.y|0,a.z|0)){var l=u(a.x,a.y,a.z);if(l.length>0&&l[0]>x){var e=v(a.x,a.y,a.z);if(e.length>0){var o=Math.abs(e[0]*b.x+e[1]*b.y+e[2]*b.z),w=i==0?0:i*Math.pow(o,16),f=(250+w)*o;if(f>255)f=255;return[f]}}}k-=g;a.Add(n)}return[0]}function ab(K,d,f,I,J){var w=!f.inp,v=f.step,y=f.light?f.light:0,c=f.vrset,e=p(K,d,I,J);if(!e)return[0,0,0];var a=e.nearpos,L=e.farpos,z=e.dist;e=null;var A=new WPACS.wp0bj5(d.x,d.y,d.z);A.Scale(v);var F=.01,G=w?r:q,H=w?t:s,g=1,D=0,C=0,B=0;while(z>0&&g>F){if(!j||!m(a.x|0,a.y|0,a.z|0)){var k=G(a.x,a.y,a.z);if(k.length>0)for(var b=0;b<c.length;b++)if(k[0]>=c[b][0]&&k[0]<c[b][1]){var h=H(a.x,a.y,a.z);if(h.length>0){var x=c[b][2]/1e3,E=Math.abs(h[0]*d.x+h[1]*d.y+h[2]*d.z),i=y==0?0:y*Math.pow(E,16),l=g*x*E;g=g*(1-x);D+=(c[b][3]+i)*l;C+=(c[b][4]+i)*l;B+=(c[b][5]+i)*l}break}}z-=v;a.Add(A)}var u=D|0,o=C|0,n=B|0;if(u>255)u=255;if(o>255)o=255;if(n>255)n=255;return[u,o,n]}function bb(J,b,c,G,H){var v=!c.inp,u=c.step,i=c.light?c.light:0,l=c.vrww,g=c.vrwl-(l/2|0),o=g+l,E=i<100?false:true,d=p(J,b,G,H);if(!d)return[0];var a=d.nearpos,K=d.farpos,x=d.dist;d=null;var z=new WPACS.wp0bj5(b.x,b.y,b.z);z.Scale(u);var B=.01,C=v?r:q,D=v?t:s,w=0,f=1;while(x>0&&f>B){if(!j||!m(a.x|0,a.y|0,a.z|0)){var y=C(a.x,a.y,a.z),n=y.length>0?y[0]:o;if(n>=g&&n<o){var h=(n-g)/l,e=E?D(a.x,a.y,a.z):[],A=e.length==0?1:Math.abs(e[0]*b.x+e[1]*b.y+e[2]*b.z),F=i==0?0:i*Math.pow(A,16),I=f*h*A;f*=1-h;w+=(h*255+F)*I}}x-=u;a.Add(z)}var k=w|0;if(k>255)k=255;return[k]}function Y(y,b,c,w,x){var h=!c.inp,g=c.step,i=c.light?c.light:0,v=c.thre?c.thre:-160,d=p(y,b,w,x);if(!d)return[0];var a=d.nearpos,z=d.farpos,j=d.dist;d=null;var l=new WPACS.wp0bj5(b.x,b.y,b.z);l.Scale(g);var n=h?r:q,o=h?t:s;while(j>0){var k=n(a.x,a.y,a.z);if(k.length>0&&k[0]>v){var e=o(a.x,a.y,a.z);if(e.length>0){var m=Math.abs(e[0]*b.x+e[1]*b.y+e[2]*b.z),u=i==0?0:i*Math.pow(m,16),f=(250+u)*m;if(f>255)f=255;return[f]}}j-=g;a.Add(l)}return[0]}function Z(H,b,c,E,F){var o=!c.inp,n=c.step,i=c.light?c.light:0,k=c.vrww,g=c.vrwl-(k/2|0),m=g+k,C=i<100?false:true,d=p(H,b,E,F);if(!d)return[0];var a=d.nearpos,I=d.farpos,v=d.dist;d=null;var x=new WPACS.wp0bj5(b.x,b.y,b.z);x.Scale(n);var z=.01,A=o?r:q,B=o?t:s,u=0,f=1;while(v>0&&f>z){var w=A(a.x,a.y,a.z),l=w.length>0?w[0]:m;if(l>=g&&l<m){var h=(l-g)/k,e=C?B(a.x,a.y,a.z):[],y=e.length==0?1:Math.abs(e[0]*b.x+e[1]*b.y+e[2]*b.z),D=i==0?0:i*Math.pow(y,16),G=f*h*y;f*=1-h;u+=(h*255+D)*G}v-=n;a.Add(x)}var j=u|0;if(j>255)j=255;return[j]}function o(p,q,r){var i=b*c,d=r*i+q*b+p,n=d-1,o=d+1,l=d-b,m=d+b,j=d-i,k=d+i,f,g,h;if(a.length==1){f=a[0][o]-a[0][n];g=a[0][m]-a[0][l];h=a[0][k]-a[0][j]}else{f=e(o)-e(n);g=e(m)-e(l);h=e(k)-e(j)}return[f,g,h]}function t(i,j,k){var f=i|0,g=j|0,h=k|0;if(f<1||f>=b-1||g<1||g>=c-1||h<1||h>=d-1)return[];var a=o(f,g,h),e=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);if(e==0)return a;a[0]=a[0]/e;a[1]=a[1]/e;a[2]=a[2]/e;return a}function s(y,z,A){var g=y|0,h=z|0,i=A|0,k=g+1,l=h+1,m=i+1;if(g<1||k>=b-1||h<1||l>=c-1||i<1||m>=d-1)return[];var B=o(g,h,i),D=o(k,h,i),C=o(g,l,i),E=o(k,l,i),F=o(g,h,m),H=o(k,h,m),G=o(g,l,m),I=o(k,l,m),j=y-g,p=z-h,x=A-i,n=1-j,w=1-p,J=1-x,q=f(a(B,n),a(D,j)),r=f(a(C,n),a(E,j)),s=f(a(F,n),a(H,j)),t=f(a(G,n),a(I,j));e(q);e(r);e(s);e(t);var u=f(a(q,w),a(r,p)),v=f(a(s,w),a(t,p));e(u);e(v);var K=f(a(u,J),a(v,x));return e(K);function e(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);if(b==0)return a;a[0]=a[0]/b;a[1]=a[1]/b;a[2]=a[2]/b;return a}function a(a,b){a[0]*=b;a[1]*=b;a[2]*=b;return a}function f(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2]]}}function p(i,h,f,g){var q=b,p=c,r=d,a,e;if(h.x!=0){a=(0-i.x)/h.x;e=(q-1-i.x)/h.x;if(a<e){if(a>f)f=a;if(e<g)g=e}else{if(e>f)f=e;if(a<g)g=a}}if(h.y!=0){a=(0-i.y)/h.y;e=(p-1-i.y)/h.y;if(a<e){if(a>f)f=a;if(e<g)g=e}else{if(e>f)f=e;if(a<g)g=a}}if(h.z!=0){a=(0-i.z)/h.z;e=(r-1-i.z)/h.z;if(a<e){if(a>f)f=a;if(e<g)g=e}else{if(e>f)f=e;if(a<g)g=a}}var j=i.x+f*h.x+.5,k=i.y+f*h.y+.5,l=i.z+f*h.z+.5,m=i.x+g*h.x+.5,n=i.y+g*h.y+.5,o=i.z+g*h.z+.5;if(j<0||j>=q)return null;if(k<0||k>=p)return null;if(l<0||l>=r)return null;if(m<0||m>=q)return null;if(n<0||n>=p)return null;if(o<0||o>=r)return null;var s=m-j,t=n-k,u=o-l,x=Math.sqrt(s*s+t*t+u*u),v=new WPACS.wp0bj5(j,k,l),w=new WPACS.wp0bj5(m,n,o);return{nearpos:v,farpos:w,dist:x}}function B(h,i,k){var e=b*c,a=[0,0,0,0,0,0,0,0];a[0]=k*e+i*b+h;a[1]=a[0]+1;a[2]=a[0]+b+1;a[3]=a[0]+b;a[4]=a[0]+e;a[5]=a[4]+1;a[6]=a[4]+b+1;a[7]=a[4]+b;for(var d=0;d<a.length;d++){var f=a[d]>>3,g=a[d]%8;j[f]|=1<<g}}function m(h,i,k){var e=b*c,a=[0,0,0];a[0]=k*e+i*b+h;a[1]=a[0]+b+1;a[2]=a[0]+e+b+1;for(var d=0;d<3;d++){var f=a[d]>>3,g=a[d]%8;if((j[f]&1<<g)!=0)return true}return false}function S(f){var e=b*c*d+7>>3;if(!j)j=WPACS.wp0bj8(e,"u8");if(f&&j)for(var a=0;a<e;a++)j[a]=0;return j?true:false}function Q(a,z){if(!a||a.length<2||!S())return;var e,d,y=z||false;if(a.length==2){var q,s,r,o;if(a[0].x<a[1].x){q=a[0].x;r=a[1].x}else{r=a[0].x;q=a[1].x}if(a[0].y<a[1].y){s=a[0].y;o=a[1].y}else{o=a[0].y;s=a[1].y}e={l:q,t:s,r:r,b:o};d={l:q,t:s,r:r,b:o}}else{e=WPACS.wp0bj2.OutRect(a);d=WPACS.wp0bj2.InnerRect(a)}var v=h.reconW,u=h.reconH,t=.6,l=k.GetLook(),n=k.GetRight(),x=k.GetUp();n.Scale(k.GetSizeX()*1/v);x.Scale(k.GetSizeY()*1/u);var f=k.GetOrgin(),w=new WPACS.wp0bj5(l.x,l.y,l.z);w.Scale(t);if(y)for(var c=0;c<u;c++){for(var j=new WPACS.wp0bj5(f.x,f.y,f.z),b=0;b<v;b++){if(b>=e.l&&b<=e.r&&c>=e.t&&c<=e.b)if(b>=d.l&&b<=d.r&&c>=d.t&&c<=d.b||WPACS.wp0bj2.InPolygon(b,c,a)){j.Add(n);continue}var g=p(j,l,-1e4,1e4);if(g){var i=g.nearpos,m=g.dist;g=null;while(m>0){B(i.x|0,i.y|0,i.z|0);m-=t;i.Add(w)}}j.Add(n)}f.Add(x)}else for(var c=0;c<u;c++){for(var j=new WPACS.wp0bj5(f.x,f.y,f.z),b=0;b<v;b++){if(b>=e.l&&b<=e.r&&c>=e.t&&c<=e.b)if(b>=d.l&&b<=d.r&&c>=d.t&&c<=d.b||WPACS.wp0bj2.InPolygon(b,c,a)){var g=p(j,l,-1e4,1e4);if(g){var i=g.nearpos,m=g.dist;g=null;while(m>0){B(i.x|0,i.y|0,i.z|0);m-=t;i.Add(w)}}}j.Add(n)}f.Add(x)}ypos=j=null}var b=0,c=0,d=0,g=0,C=1,i=false,a=[],j=null};var WPACS=WPACS||{};WPACS.MouseHandler=function(){var e=null,r=null,s=null,t=null,o=null,j=null,i=null,q=null,k=null,p=null,u=false;this.GetBtnStatus=function(){return a};this.GetBindElem=function(){return e};this.SetBindElem=function(h,a,c){var d=!WPACS.wp0bj1.IsMobile?"mousedown":"touchstart",f=!WPACS.wp0bj1.IsMobile?"mousemove":"touchmove",g=!WPACS.wp0bj1.IsMobile?"mouseup":"touchend",b=!WPACS.wp0bj1.IsMobile?"mousewheel":"";if(e){e.off(d);e.off(f);e.off(g);b!=""&&i&&e.off(b)}r=s=t=null;o=j=null;i=null;u=false;_SwipeLeft=_SwipeRight=_SwipeUp=_SwipeDown=null;if(h!==undefined)e=h;if(!a)e=null;if(!e)return;if(a.mousedown)r=a.mousedown;if(a.mousemove)s=a.mousemove;if(a.mouseup)t=a.mouseup;if(a.mouseclick)o=a.mouseclick;if(a.mousedblclick)j=a.mousedblclick;if(a.mouseswipe)q=a.mouseswipe;if(a.mouserotate)k=a.mouserotate;if(a.mousepinch)p=a.mousepinch;if(a.mousewheel)i=a.mousewheel;else if(a.mousewheelx){i=a.mousewheelx;u=true}e.on(d,null,c,z);e.on(f,null,c,A);e.on(g,null,c,B);if(b!=""&&i)e.on(b,null,c,x)};var a=0,d=0,v=[0,0],f=[0,0],g=[0,0],b=[0,0],c=[0,0],m=[0,0],n=[0,0],l=[0,0],h=null;function z(i){var h=$(this);if(WPACS.wp0bj1.IsMobile){var j=i.originalEvent;a=1;d=j.touches.length;if(d>2)return;for(var e=0;e<d;e++){v[e]=j.touches[e].identifier;var k=j.touches[e].pageX-h.offset().left,o=j.touches[e].pageY-h.offset().top;f[e]=b[e]=k;g[e]=c[e]=o;m[e]=k;n[e]=o;l[e]=1}}else{a=i.which;d=1;v[0]=0;var k=i.pageX-h.offset().left,o=i.pageY-h.offset().top;f[0]=b[0]=k;g[0]=c[0]=o;m[0]=k;n[0]=o;l[0]=1}d==1&&r&&r.call(h,{type:"down",event:i,x:f[0],y:g[0],which:a})}function A(r){if(d>2)return;var j,e=$(this),t,u=10;if(WPACS.wp0bj1.IsMobile){j=r.originalEvent;if(j.touches.length!=d)return;t=j.touches[0]}else{u=5;t=r}var h=t.pageX-e.offset().left,i=t.pageY-e.offset().top;if(d>1){var o=j.touches[1].pageX-e.offset().left,q=j.touches[1].pageY-e.offset().top;if(p||k){var A=b[1]-b[0],C=c[1]-c[0],B=o-h,D=q-i,I=Math.sqrt(A*A+C*C),J=Math.sqrt(B*B+D*D),v=J-I|0,F=Math.abs(v),L=w(f[0],g[0],f[1],g[1],h,i,o,q),z=Math.abs(L)|0;if(z>20){var E=w(b[0],c[0],b[1],c[1],h,i,o,q),G=Math.abs(E)|0;if(G>30){var K=E>0?"right":"left";k&&k.call(e,{type:"rotate",dir:K,event:r,which:a})}else return}else if(z<10&&F>u)p&&p.call(e,{type:"pinch",dis:v,event:r,which:a});else return}b[1]=o;c[1]=q;m[1]+=o;n[1]+=q;l[1]++}else if(s){var x=h-b[0]|0,y=i-c[0]|0,v=Math.sqrt(x*x+y*y)|0;if(v<u)return;var H=d==1?a:0;s.call(e,{type:"move",event:r,x:h,y:i,which:H,dx:x,dy:y})}b[0]=h;c[0]=i;m[0]+=h;n[0]+=i;l[0]++}function B(p){if(d>2)return;var i=$(this),x,e=-1,B=0;if(WPACS.wp0bj1.IsMobile){var D=p.originalEvent;x=D.changedTouches[0];for(var L=x.identifier,A=0;A<d;A++)if(L==v[A]){e=A;break}B=D.touches.length}else{x=p;e=0;B=0}if(e==-1)return;var u=x.pageX-i.offset().left,w=x.pageY-i.offset().top;b[e]=u;c[e]=w;m[e]+=u;n[e]+=w;l[e]++;if(B!=0)return;if(d>1){if(j){var r=b[0]-f[0],s=c[0]-g[0],z=Math.sqrt(r*r+s*s)|0,H=b[1]-f[1],I=c[1]-g[1],K=Math.sqrt(H*H+I*I)|0;z<=1&&K<=1&&j.call(i,{type:"dblclick",event:p,x:u,y:w,which:a})}}else{var r=b[0]-f[0],s=c[0]-g[0],z=Math.sqrt(r*r+s*s)|0;t&&t.call(i,{type:"up",event:p,x:u,y:w,which:a,dis:z});if(z<=1){if(j||o)if(h==null){var J=a;h=window.setTimeout(function(){o&&o.call(i,{type:"click",event:p,x:u,y:w,which:J});h=null},300)}else{window.clearTimeout(h);h=null;j&&j.call(i,{type:"dblclick",event:p,x:u,y:w,which:a});a=0;d=0;return false}}else if(z>10)if(q||k){var M=m[0]/l[0]|0,N=n[0]/l[0]|0,E=y(f[0],g[0],M,N,b[0],c[0]);if(E==0){if(q){var C="",F=Math.abs(r),G=Math.abs(s);if(F/3>G)C=r>0?"right":"left";else if(G/3>F)C=s>0?"down":"up";q.call(i,{type:"swipe",dir:C,event:p,which:a})}}else k&&k.call(i,{type:"rotate",dir:E==1?"right":"left",event:p,which:a})}}a=0;d=0}function x(b,c){if(!i)return;var a=$(this);i.call(a,{type:"wheel",event:b,delta:c});if(u){h&&window.clearTimeout(h);h=window.setTimeout(function(){h=null;i.call(a,{type:"wheel",event:b,delta:0})},1e3)}}function y(b,c,d,e,f,g){function h(a,d,b,e,c,f){var g=Math.sqrt((a-b)*(a-b)+(d-e)*(d-e)),h=Math.sqrt((c-b)*(c-b)+(f-e)*(f-e)),i=Math.sqrt((a-c)*(a-c)+(d-f)*(d-f)),j=(g*g+h*h-i*i)/(2*g*h);return 180*Math.acos(j)/Math.PI}var k=h(b,c,d,e,f,g);if(k>150)return 0;var i=Math.atan2(e-c,d-b)*180/Math.PI,j=Math.atan2(g-c,f-b)*180/Math.PI,a=j-i|0;if(a>180)a=a-360;return a>0?1:2}function w(b,d,c,e,f,h,g,i){var j=c-b,l=e-d,k=g-f,m=i-h,n=Math.atan2(l,j)*180/Math.PI,o=Math.atan2(m,k)*180/Math.PI,a=o-n|0;if(a>180)a=a-360;return a}};WPACS.MouseHandlers=function(){var a=[];this.GetHandler=function(d){if(WPACS.wp0bj1.isNumberType(d))return a[d];for(var c=-1,b=0;b<a.length;b++)if(a[b].GetBindElem()[0]===d[0]){c=b;break}return c==-1?null:a[c]};this.BindElem=function(e,c,g){if(e){for(var d=-1,f=0;f<a.length;f++)if(a[f].GetBindElem()[0]===e[0]){d=f;break}if(d==-1){if(!c)return;var b=new WPACS.MouseHandler;b.SetBindElem(e,c,g);a.push(b);b=null}else{var b=a[d];b.SetBindElem(e,c,g);if(!c)b=a.splice(d,1);b=null}}else{if(a.length==0)return;var d=a.length-1,b=a[d];b.SetBindElem(undefined,c,g);if(!c)b=a.splice(d,1);b=null}};this.UnBindElem=function(a){this.BindElem(a,null)};this.UnBindAll=function(){for(var b=0;b<a.length;b++){a[b].SetBindElem(undefined,null);a[b]=null}a=[]};this.BindElems=function(b,c,d){for(var a=0;a<b.length;a++)this.BindElem($(b[a]),c,d)};this.UnBindElems=function(b){for(var a=0;a<b.length;a++)this.UnBindElem($(b[a]))}};WPACS.OPTVIEWSIZE=true;WPACS.wp0b11=function(F){var j=new WPACS.MouseHandlers,a=null,h={idxref:0,opmode:0,onEvent:null};this.DestroyObj=function(){I()};this.GetContainer=function(){return g};this.BindContainer=function(a){v(a)};this.ReSize=function(){v(g)};this.Options=function(){return h};this.SetOpmode=function(a){D(a)};this.SetImage=function(a){k(-1,0);w(a)};this.wfn34=function(a,b,c,d){k(-1,0);return K(a,b,c,d)};this.RemoveMeta=function(b){if(a==null)return;var d=a.wfn31().metaItems.length;if(b==-1&&d>0)b=d-1;var c=a.wfn31().Remove(b);if(c==null)return;c.DestroyObj();c=null;l()};this.Cvt2ImageXY=function(c,d){return a==null||b==null?null:a.Cvt2ImageXY(b,c,d)};this.SaveAsImg=function(c){if(a==null||b==null)return null;var d="image/png";if(c==1||c=="1")d="image/jpg";else if(WPACS.wp0bj1.isStringType(c)&&c.toLowerCase()=="jpg")d="image/jpg";return b[0].toDataURL(d)};var s={ms:-1,dir:0};function k(c,d){if(c!=undefined)s.ms=c;else c=s.ms;if(d!=undefined)s.dir=d;else d=s.dir;if(c<0)return;var e=a!=null?a.GetFrames():0;if(e<2)return;var g=function(){return a.Options().vwmode==WPACS.CONSTDEF.VMODE_WADO?!f[0].complete:a.IfLoading()}();if(!g){var b=a.Options().iframe;if(d==0)b+=1;else b-=1;if(b>=e)b=0;else if(b<0)b=e-1;r(b);c>=0&&window.setTimeout(k,c)}else c>=0&&window.setTimeout(k,10)}var g=null,c=null,b=null,f=null,o=null,i=null,e=null,C='<img style="z-index:99;width:32px;height:32px;" src="./webpacs/images/loading1.gif" >';function J(){var a="";if(WPACS.wp0bj1.HasVideo&&WPACS.CONSTDEF.WSVIDURL)a='<video style="position:absolute;left:0px;top:0px;display:none;" controls autoplay /><img class="btnVid" src="./webpacs/images/video.png" title="\u64ad\u653e/\u5173\u95ed\u89c6\u9891\u6d41" style="position:absolute;display:none;z-index:999;width:36px;height:36px;left:10px;top:100%;margin-top:-70px;" >';var d=WPACS.wp0bj1.Canvas?'<canvas style="position:absolute;left:0px;top:0px;" />':"",j='<div style="position:absolute;display:none;background-color:#000000;" align="center"><img class="imgv" style="position:relative;">'+d+'<span class="huinfo" align="left" ></span><span class="progress" align="center" >'+C+"</span>"+a+"</div>";g.append(j);c=g.children("div");b=c.children("canvas");if(b.length==0)b=null;e=c.children("video");if(e.length==0)e=null;f=c.children("img.imgv");o=c.children("span.huinfo");i=c.children("span.progress");h.opmode!=0&&D(h.opmode)}function I(){x(false);w(null);h.onEvent=null;h={};b=null;f=null;o=null;i=null;e=null;if(c!=null){c.remove();c=null}if(g!=null){g.empty();g=null}j.UnBindAll(null);j=null}function x(k){if(c==null)return;var i=b!=null?b:c,a=c.children("img.nxtFrm"),d=c.children("img.preFrm"),h=c.children("img.btnVid");if(k){var g={mousedown:m,mousemove:m,mouseup:m,mouseclick:null,mousedblclick:null,mousewheel:m,mouseswipe:null,mouserotate:null,mousepinch:null};j.BindElem(i,g);g={mousedown:null,mousemove:null,mouseup:null,mouseclick:m,mousedblclick:m,mousewheel:null,mouseswipe:null,mouserotate:null,mousepinch:null};a&&a.length>0&&j.BindElem(a,g,"next");d&&d.length>0&&j.BindElem(d,g,"prev");h.length==1&&j.BindElem(h,g,"video");f.bind("load",function(){t(WPACS.CONSTDEF.wpu2,0)});f.bind("error",function(){t(WPACS.CONSTDEF.wpu2,0)});e&&e.bind("ended",function(){e.hide()})}else{j.UnBindElem(i);a&&a.length>0&&j.UnBindElem(a);d&&d.length>0&&j.UnBindElem(d);h.length==1&&j.UnBindElem(h);f.unbind("load");f.unbind("error");e&&e.unbind("ended")}}function v(h){x(false);if(WPACS.wp0bj1.isObject(h)){if(g==null||g[0]!=h[0]){g=h;c==null?J():c.appendTo(g)}var d=g.width()|0,a=g.height()|0;if(c.width()!=d||c.height()!=a){f.hide();c.height(a);c.width(d);if(b!=null){b[0].width=d;b[0].height=a}if(e!=null){e[0].width=d;e[0].height=a}}c.show();x(true);p()}else if(g!=null){c=null;b=null;f=null;o=null;i=null;e=null;g.empty();g=null}}function w(i){var b=false;if(a!=null){a.OnBindView(null);h.idxref==-1&&a._DestroyObj()}else if(WPACS.CONSTDEF.PREVIEWJPG)b=true;if(e!=null){c.children("img.btnVid").hide();e[0].pause();e[0].src="";e.hide()}h.idxref=-1;a=null;if((a=i)!=null){h.idxref=0;if(b&&c!=null){var g=Math.floor(c.width()),d=Math.floor(c.height());if(WPACS.OPTVIEWSIZE){g&=65528;d&=65528}a.PreView(f,g,d)}a.OnBindView(t)}else p()}function K(c,d,e,b){if(!WPACS.wp0bj1.isBooleanType(b))b=false;if(b)return false;var a=new WPACS.wp0b18;a.SetDicom(c,d,e);w(a);h.idxref=-1;a=null;return true}function t(b,d){if(c==null)return;if(b==WPACS.CONSTDEF.wps1){if(WPACS.wp0bj1.isNumberType(d)&&d>0)i.text(d+"%");else i.children("img").length==0&&i.html(C);!i.is(":visible")&&i.show();return}if(b==WPACS.CONSTDEF.wpu2)if(a==null)i.hide();else!a.IfLoading()&&i.hide();else i.hide();b==WPACS.CONSTDEF.wps3&&p()}function L(){if(e==null)return;var b=a!=null?a.wfn36():"";if(b=="")return;if(!e.is(":visible")){e[0].src=b;e.show()}else{e[0].pause();e.hide();u()}}function u(){if(a!=null){var b=a.GetFrames();e&&b>1&&window.setTimeout(function(){a.wfn36()!=""&&c.children("img.btnVid").show()},0)}else e&&c.children("img.btnVid").hide()}function y(){if(b==null)return;var a=b[0].getContext("2d");a.clearRect(0,0,b[0].width,b[0].height)}function l(){if(a.Options().vwmode==WPACS.CONSTDEF.VMODE_WADO){b[0].getContext("2d").clearRect(0,0,b[0].width,b[0].height);a.wfn06(b)}else p()}function p(){if(c==null)return;if(a==null){y();f.hide();u();return}if(a.IfLoading())return;y();var e=b!=null?b[0].width:c.width(),d=b!=null?b[0].height:c.height();if(WPACS.OPTVIEWSIZE){e&=65528;d&=65528}if(b!=null){if(!a.wfn05(b))a.wfn07(f,e,d)&&f.show();else{a.wfn08(b);f.hide()}a.wfn06(b)}else a.wfn07(f,e,d)&&f.show();u()}function r(b){var c=a!=null?a.GetFrames():0;if(c==0)return false;var d=a.Options().iframe;if(b==-1)b=d-1;else if(b==-2)b=d+1;else if(b==-3)b=c-1;if(b<0||b>=c)return false;a.SetFrame(b);return true}function D(a){h.opmode=a;c!=null&&WPACS.wpSetCursorMode(c,a)}function E(h,i){if(a==null)return;var g=b!=null?b[0].width:c.width(),f=b!=null?b[0].height:c.height(),d=a.GetPixel(g,f,h,i),e="out of range";if(d!=null)e="("+d.x+","+d.y+") "+d.pixel;o.text(e)}var n=null;function G(i,j){if(a==null)return;if(b==null){var x=WPACS.CONSTDEF.MGLASS_FILTER?3:1,h=c.width(),g=c.height();if(WPACS.OPTVIEWSIZE){i-=(h-(h&65528))/2|0;j-=(g-(g&65528))/2|0;h&=65528;g&=65528}var v="&areap="+i+","+j+","+x,t=a.Options().metav;a.Options().metav=false;a.wfn07(f,h,g,v)&&f.show();a.Options().metav=t;return}if(a.Options().vwmode==WPACS.CONSTDEF.VMODE_WADO){var x=WPACS.CONSTDEF.MGLASS_FILTER?3:1,h=b[0].width,g=b[0].height,v="&areac=1&areap="+i+","+j+","+x,t=a.Options().metav;a.Options().metav=false;var u=a.GetJpegUrl(h,g,v);a.Options().metav=t;if(u=="")return;if(n==null)n=new Image;n.onload=function(){var g=this.width,f=this.height;y();a.wfn06(b);var d=Math.floor(i-g/2),e=Math.floor(j-f/2),c=b[0].getContext("2d");c.drawImage(this,d,e);c.beginPath();c.lineWidth=1;c.strokeStyle="green";c.rect(d,e,g,f);c.stroke();n.onload=null;n=null};n.src=u;return}var s=b[0].width,r=b[0].height,d,e,w=WPACS.CONSTDEF.MGLASS_RATIO;if(WPACS.CONSTDEF.MGLASS_SIZE<1){d=WPACS.CONSTDEF.MGLASS_SIZE*s|0;e=WPACS.CONSTDEF.MGLASS_SIZE*r|0;if(d<e)e=d;else if(e<d)d=e;if(d>WPACS.CONSTDEF.MGLASS_MAXSIZE)d=WPACS.CONSTDEF.MGLASS_MAXSIZE;if(e>WPACS.CONSTDEF.MGLASS_MAXSIZE)e=WPACS.CONSTDEF.MGLASS_MAXSIZE}else d=WPACS.CONSTDEF.MGLASS_SIZE|0,e=d;if(d<WPACS.CONSTDEF.MGLASS_MINSIZE)d=WPACS.CONSTDEF.MGLASS_MINSIZE;if(e<WPACS.CONSTDEF.MGLASS_MINSIZE)e=WPACS.CONSTDEF.MGLASS_MINSIZE;if(WPACS.wp0bj1.IsMobile){i-=d/2|0;j-=e/2|0}var h=d/w|0,g=e/w|0,o=i-h/2|0,q=j-g/2|0,A=o+h,z=q+g,l=a.GetImageData(s,r,o,q,A,z);if(l==null)return;p();var m=document.createElement("canvas");m.width=l.width;m.height=l.height;m.getContext("2d").putImageData(l,0,0);var k=b[0].getContext("2d");o=i-d/2|0;q=j-e/2|0;k.drawImage(m,o,q,d,e);k.save();k.lineWidth=1;k.strokeStyle="green";k.strokeRect(o,q,d,e);k.restore();m=null;l=null}var d=null;function z(e,f,g){if(a==null||b==null)return;if(e==0){d!=null&&d.DestroyObj();d=null;var c=a.Cvt2ImageXY(b,f,g);if(c==null)return;d=WPACS.wp0b40(2,c.x,c.y);d.options.allowmm=false;return}if(d==null)return;var c=a.Cvt2ImageXY(b,f,g);d.ptArray[1].x=c.x;d.ptArray[1].y=c.y;if(e!=2){l();a.DrawMeta(b,d);return}if(d.IsValidMeta()){var h=d.ptArray[0].x,j=d.ptArray[0].y,i=d.ptArray[1].x,k=d.ptArray[1].y;a.ClipImage(h,j,i,k)}d.DestroyObj();d=null}function A(i,j,k){var e=h.opmode-WPACS.CONSTDEF.wpo10;if(a==null||b==null)return;if(i==0){d!=null&&d.DestroyObj();d=null;var c=a.Cvt2ImageXY(b,j,k);if(c!=null)d=WPACS.wp0b40(e,c.x,c.y);return}if(d==null)return;var c=a.Cvt2ImageXY(b,j,k);if(e==1||e==2||e==3||e==6){d.ptArray[1].x=c.x;d.ptArray[1].y=c.y}else if(e==4)d.ptArray[d.ptArray.length]={x:c.x,y:c.y};else if(e==5){d.ptArray[0].y=c.y;d.ptArray[2].x=c.x;d.ptArray[2].y=c.y}else e==8&&d.ModifyHCR(c.x,c.y);if(i!=2){l();a.DrawMeta(b,d);return}if(e==7){var g=prompt("\u8bf7\u8f93\u5165\u6807\u6ce8\u6587\u5b57","");g!=null&&g!=""&&a.wfn31().AddText(c.x,c.y,g);d.DestroyObj()}else if(d.IsValidMeta()){var o=b[0].width,n=b[0].height,m=a.wfn31();if(e==4){var f=m.MergePoly(d.ptArray);if(f){d=f;f=null}else d.options.closed=true}a.AutoText(d,o,n);a.wfn31().AddMeta(d)}else d.DestroyObj();l();d=null;return}function B(k,g,h){if(a==null||b==null)return false;if(k==0){if(!WPACS.wp0bj7.AllowMetaMove||!a.Options().metav)return false;d!=null&&d.DestroyObj();d=null;var f=a.Cvt2ImageXY(b,g,h),e=f!=null?a.wfn31().IfHit(f.x,f.y,true):null;if(e==null||e.pos<=0)return false;d=a.wfn31().Remove(e.idx);$.data(c,"oldCursor")==undefined&&$.data(c,"oldCursor",c.css("cursor"));c.css("cursor","move");d.UserTag=e.pos;e=null;return true}if(d==null||d.UserTag==undefined)return false;var m=d.UserTag;if(k!=2){var n=a.Options().iratio?g*100/a.Options().iratio|0:g,o=a.Options().iratio?h*100/a.Options().iratio|0:h,i=a.wfn32(true),j=i.calNewPoint(n,o);i=null;d.MoveMeta(m,j.x|0,j.y|0);l();a.DrawMeta(b,d);return true}var q=b[0].width,p=b[0].height;d.UserTag=undefined;if($.data(c,"oldCursor")!=undefined){c.css("cursor",$.data(c,"oldCursor"));$.removeData(c,"oldCursor")}a.AutoText(d,q,p);a.wfn31().AddMeta(d);l();d=null;return true}function H(g,h){if(a==null||b==null)return;if(!WPACS.wp0bj7.AllowMetaMove||!a.Options().metav)return;var d=a.Cvt2ImageXY(b,g,h),e=d!=null?a.wfn31().IfHit(d.x,d.y,true):null,f=e!=null&&e.pos>0;d=null;e=null;if(f){$.data(c,"oldCursor")==undefined&&$.data(c,"oldCursor",c.css("cursor"));c.css("cursor","move")}else if($.data(c,"oldCursor")!=undefined){c.css("cursor",$.data(c,"oldCursor"));$.removeData(c,"oldCursor")}}function m(b){var j=b.event.data,g=b.type,d=b.which;if(j==="next"){if(g=="click"){if(d==1){k(-1,0);r(-2)}}else if(g=="dblclick")d==1&&k(WPACS.CONSTDEF.SPEED_MS_FRAME,0)}else if(j==="prev"){if(g=="click"){if(d==1){k(-1,0);r(-1)}}else if(g=="dblclick")d==1&&k(WPACS.CONSTDEF.SPEED_MS_FRAME,-1)}else if(j==="video"){if(g=="click")d==1&&L()}else{var c=h.opmode>=WPACS.CONSTDEF.wpo10?WPACS.CONSTDEF.wpo10:h.opmode;if(g=="down"){if(d==1){if(B(0,b.x,b.y)){b.event.stopPropagation();return}if(c==WPACS.CONSTDEF.wpo1)G(b.x,b.y);else if(c==WPACS.CONSTDEF.wpo3)z(0,b.x,b.y);else if(c==WPACS.CONSTDEF.wpo2){o.show();E(b.x,b.y)}else c==WPACS.CONSTDEF.wpo10&&A(0,b.x,b.y)}}else if(g=="move"){if(d===0){H(b.x,b.y);return}if(a==null)return;var f=b.dx,e=b.dy;if(d==1){if(B(1,f,e)){b.event.stopPropagation();return}if(c==WPACS.CONSTDEF.wpo1)G(b.x,b.y);else if(c==WPACS.CONSTDEF.wpo3)z(1,b.x,b.y);else if(c==WPACS.CONSTDEF.wpo2)E(b.x,b.y);else if(c==WPACS.CONSTDEF.wpo10)A(1,b.x,b.y);else if(c==WPACS.CONSTDEF.wpo5){var m=WPACS.wpGetZoomRatio(a.Options().iratio);f=f*m|0;e=e*m|0;q(WPACS.CONSTDEF.wpe5,{iratio:0,dratio:e})}else if(c==WPACS.CONSTDEF.wpo7){var l=!a.IsSigned(),i=WPACS.wpGetWwwlRatio(a.GetBpp(),l);f=f*i|0;e=e*i|0;q(WPACS.CONSTDEF.wpe7,{ww:0,wc:0,dw:f,dc:e})}else c==WPACS.CONSTDEF.wpo6&&q(WPACS.CONSTDEF.wpe6,{dx:f,dy:e})}else if(d==3){var l=!a.IsSigned(),i=WPACS.wpGetWwwlRatio(a.GetBpp(),l);f=f*i|0;e=e*i|0;q(WPACS.CONSTDEF.wpe7,{ww:0,wc:0,dw:f,dc:e})}}else if(g=="up"){if(d==1){if(B(2,b.x,b.y)){b.event.stopPropagation();return}if(c==WPACS.CONSTDEF.wpo1)p();else if(c==WPACS.CONSTDEF.wpo3)z(2,b.x,b.y);else if(c==WPACS.CONSTDEF.wpo2)o.hide();else c==WPACS.CONSTDEF.wpo10&&A(2,b.x,b.y)}else if(d==3)b.dis>1&&b.event.stopPropagation()}else if(g=="wheel")!r(b.delta>0?-1:-2)&&q(WPACS.CONSTDEF.wpe9,b.delta)}}function q(d,b){var c=false;if(h.onEvent!=null)c=h.onEvent(d,b);if(c)return true;switch(d){case WPACS.CONSTDEF.wpe5:a!=null&&a.Action("zoom",b);return true;case WPACS.CONSTDEF.wpe6:a!=null&&a.Action("move",b);return true;case WPACS.CONSTDEF.wpe7:a!=null&&a.Action("wwwl",b);return true;case WPACS.CONSTDEF.wpe8:a!=null&&a.Action("rotate",b);return true;case WPACS.CONSTDEF.wpe9:r(b>0?-1:-2);return true}return false}WPACS.wp0bj1.isObject(F)&&v(F)};WPACS.wp0b12=function(r){var m=new WPACS.MouseHandlers,a={bdcolor:"#009F7F",ipage:0,idcmv:0,cascade:true,opmode:0,onEvent:null},c=new WPACS.fmtLayOut,d=[],b=null;this.DestroyObj=function(){t()};this.GetContainer=function(){return f};this.BindContainer=function(a){i(a)};this.ReSize=function(){i(f)};this.Options=function(){return a};this.GetPages=function(){return o()};this.SetPage=function(a){g(a)};this.SetFormat=function(b,a){l(b,a)};this.GetFormat=function(){return c};this.SetDcmSet=function(a){q(a)};this.GetDcmSet=function(){return b};this.SaveAsImg=function(e){if(b==null||b.Length==0)return null;var f=a.idcmv%c.options.n;return d[f].SaveAsImg(e)};this.ViewImage=function(i,f){if(b==null||b.Length()==0)return;if(f)if(b.Options().srsuid!=f)return;for(var e=b.Length(),d=0;d<e;d++){var h=b.GetImage(d);if(h.Options().imguid==i)break}if(d>=e)return;a.ipage=Math.floor(d/c.options.n);a.idcmv=d;g(a.ipage)};this.ViewSize=function(a){if(b==null||e==null)return null;if(a<0||a>=b.Length())return null;var f=a%c.options.n,d=e.find("div.dcmv[no='"+f+"']");return{w:d.width(),h:d.height()}};this.Action=function(b,a){k(b,a)};function k(h,f){switch(h){case"srsLayout":l(f.r,f.c);return;case"ipage":if(!WPACS.wp0bj1.isNumberType(f))f=parseInt(f);g(f);return;case"opmode":for(var i=0;i<d.length;i++)d[i].SetOpmode(f);a.opmode=f;return;case"delmeta":if(b!=null&&b.Length()>0){var o=a.idcmv%c.options.n;d[o].RemoveMeta(-1)}return}if(b==null)return;var e=b.GetImage(a.idcmv);if(h=="dcminfo"){if(e==null)return;var n=e.Options().imguid,m=e.Options().srsuid,j=e.Options().stuuid;WPACS.wp0b41.ViewInfo(n,m,j);return}else if(h=="dcmdown"){if(e==null)return;var k=false,n=e.Options().imguid,m=e.Options().srsuid,j=e.Options().stuuid;if(f=="study")WPACS.wp0b41.DownDicom("","",j,k);else if(f=="series")WPACS.wp0b41.DownDicom("",m,j,k);else WPACS.wp0b41.DownDicom(n,m,j,k);return}else if(h=="xasub"){e!=null&&e.Action(h,f);return}if(a.cascade)for(var i=0;i<b.Length();i++)(e=b.GetImage(i))!=null&&e.Action(h,f);else e!=null&&e.Action(h,f)}var f=null,e=null;function v(){var a='<table cellpadding="0" cellspacing="1" border="0" style="position:absolute;display:none;background-color:#000000;"></table>';f.append(a);e=f.children("table")}function t(){n(false);q(null);for(var b=0;b<d.length;b++){d[b].DestroyObj();d[b]=null}d=null;c.DestroyObj();c=null;a.onEvent=null;a={};if(e!=null){e.remove();e=null}if(f!=null){f.empty();f=null}m.UnBindAll(null);m=null}function n(b){if(e==null)return;if(b){var a={mousedown:j,mousemove:null,mouseup:null,mouseclick:null,mousedblclick:j,mousewheel:null,mouseswipe:j,mouserotate:j,mousepinch:j};m.BindElem(e,a)}else m.UnBindElem(e)}function i(a){n(false);if(WPACS.wp0bj1.isObject(a)){if(f==null||f[0]!=a[0]){f=a;e==null?v():e.appendTo(f)}u();e.show();n(true)}else if(f!=null){for(var b=0;b<d.length;b++)d[b].BindContainer(null);e=null;f.empty();f=null}}function u(){if(e==null)return;var s=f.width(),r=f.height(),u=a.bdcolor,t="",x=b?b.Options().mod.toUpperCase():"";if(x=="SR")t='<iframe src="" no="%d" style="margin:1px;width:%dpx;height:%dpx;border:thin solid '+u+';background-color:#ffffff;" frameborder="0" ></iframe>';else t='<div class="dcmv" no="%d" style="width:%dpx;height:%dpx;border:thin solid '+u+';" ></div>';var w=true;if(!w){switch(c.options.type){case 1:for(var l=c.options.nm[0],k=c.options.nm[1],q=(s-k*3)/k|0,p=(r-l*3)/l|0,i=0,n=0;i<l;i++)for(var o=0;o<k;o++,n++){var m=e.find("div.dcmv[no='"+n+"']");if(m.length==0)continue;m.width(q);m.height(p)}break;case 2:for(var k,l=c.options.nm.length,q,p=(r-l*5)/l|0,i=0,n=0;i<l;i++){k=c.options.nm[i];q=(s-k*3)/k|0;for(var o=0;o<k;o++,n++){var m=e.find("div.dcmv[no='"+n+"']");if(m.length==0)continue;m.width(q);m.height(p)}}break;case 3:for(var l,k=c.options.nm.length,p,q=(s-k*3)/k,v=r-3,i=0,n=0;i<k;i++){l=c.options.nm[i];p=(v-l*3)/l|0;for(var o=0;o<l;o++,n++){var m=e.find("div.dcmv[no='"+n+"']");if(m.length==0)continue;m.width(q);m.height(p)}}}for(var i=0;i<c.options.n;i++){var m=e.find("div.dcmv[no='"+i+"']");if(m.length==0)m=null;d[i].BindContainer(m)}}else{for(var i=0;i<d.length;i++){d[i].DestroyObj();d[i]=null}d=[];var j="";switch(c.options.type){case 1:for(var l=c.options.nm[0],k=c.options.nm[1],q=(s-k*3)/k|0,p=(r-l*3)/l|0,i=0,n=0;i<l;i++){j=j+"<tr>";for(var o=0;o<k;o++,n++)j+="<td>"+WPACS.wp0bj1.printf(t,n,q,p)+"</td>";j=j+"</tr>"}break;case 2:for(var k,l=c.options.nm.length,q,p=(r-l*5)/l|0,i=0,n=0;i<l;i++){k=c.options.nm[i];j=j+"<tr><td>";q=(s-k*3)/k|0;j=j+'<table class="normalize" style="border-spacing:0px;" ><tr>';for(var o=0;o<k;o++,n++)j+="<td>"+WPACS.wp0bj1.printf(t,n,q,p)+"</td>";j=j+"</tr></table></td></tr>"}break;case 3:var l,k=c.options.nm.length,p,q=(s-k*3)/k,v=r-3;j=j+"<tr>";for(var i=0,n=0;i<k;i++){l=c.options.nm[i];j=j+"<td>";p=(v-l*3)/l|0;j=j+'<table class="normalize" style="border-spacing:0px;" >';for(var o=0;o<l;o++,n++)j+="<tr><td>"+WPACS.wp0bj1.printf(t,n,q,p)+"</td></tr>";j=j+"</table></td>"}j=j+"</tr>"}if(j=="")return;else e.html(j);for(var i=0;i<c.options.n;i++){var m=e.find("div.dcmv[no='"+i+"']");if(m.length==0)m=null;d[i]=new WPACS.wp0b11(m);d[i].Options().onEvent=h;d[i].SetOpmode(a.opmode)}}b!=null&&b.Action("fitwnd");g(a.ipage)}function l(e,d,j){var g=new WPACS.fmtLayOut,k=b?b.Options().mod.toUpperCase():"";if(k=="SR"){e=1;d=1}var h=false;j=j||false;if(e!=undefined&&d==undefined)h=g.SetRows(e);else if(d!=undefined&&e==undefined)h=g.SetCols(d);else if(e!=undefined||d!=undefined){if(!WPACS.wp0bj1.isNumberType(e))e=parseInt(e);if(!WPACS.wp0bj1.isNumberType(d))d=parseInt(d);h=g.SetNormal(e,d)}if(!j){if(!h)return false;if(g.IsEqual(c))return false;c=g}else if(h)c=g;g=null;a.ipage=Math.floor(a.idcmv/c.options.n);i(f);return true}function s(){if(!c.IsOne_One()){c.save();c.SetNormal(1,1)}else c.restore();a.ipage=Math.floor(a.idcmv/c.options.n);i(f)}function o(){return b==null?0:Math.ceil(b.Length()/c.options.n)}function g(f){var k=o();if(f==-1)f=a.ipage-1;else if(f==-2)f=a.ipage+1;else if(f==-3)f=k-1;if(f<0||f>=k)return;for(var q=b.Options().mod.toUpperCase(),l=f*c.options.n,g=0;g<d.length;g++)if(q=="SR"){var j=e.find("iframe[no='"+g+"']"),i=b.GetImage(l+g);if(i&&j.length>0){var n=WPACS.wp0b41.ViewSRUrl(i.Options().imguid,i.Options().srsuid,i.Options().stuuid);j.attr("src",n)}d[g].SetImage(null)}else d[g].SetImage(b.GetImage(l+g));var m=a.idcmv-a.ipage*c.options.n,r=a.ipage;a.ipage=f;p(m);h(WPACS.CONSTDEF.wpe4,a.ipage)}function q(k){var i="";if(b!=null){b.StopLoad();b.Options().onEvent[1]=null;i=b.Options().mod.toUpperCase();for(var j=0;j<d.length;j++)d[j].SetImage(null)}a.ipage=a.idcmv=0;if(b=k){b.Options().onEvent[1]=h;b.Action("fitwnd");var c=b.Options().mod.toUpperCase();if(c!=i){var f=0,e=0;if(WPACS.wp0bj1.IsMobile)if(WPACS.mSRSLAYOUT&&WPACS.mSRSLAYOUT[c]){f=WPACS.SRSLAYOUT[c][0];e=WPACS.SRSLAYOUT[c][1]}else f=e=1;else if(WPACS.SRSLAYOUT&&WPACS.SRSLAYOUT[c]){f=WPACS.SRSLAYOUT[c][0];e=WPACS.SRSLAYOUT[c][1]}else if(c!="CT"&&c!="MR"&&c!="PT")f=e=1;else f=e=2;if(f==0)f=undefined;if(e==0)e=undefined;if(c=="SR"||i=="SR"){l(f,e,true);return}if(f||e)if(l(f,e))return}g(a.ipage)}else i=="SR"&&l(undefined,undefined,true)}function p(g){var f=b!=null?b.Length():0,d=a.ipage*c.options.n+g;if(d>=f)d=f-1;if(d<0)d=0;a.idcmv=d;if(e==null)return;if(c.options.n==1)return;e.find("div.dcmv").css("border","thin solid "+a.bdcolor);e.find("div.dcmv[no='"+g+"']").css("border","thin solid #FF0000")}function j(d){var i=d.type,g=d.which;if(i=="down"){var n=f.width(),m=f.height(),l=g==1?c.HitIndex(d.x,d.y,n,m):-1;l!=-1&&p(l)}else if(i=="swipe"){var k=a.opmode>=WPACS.CONSTDEF.wpo10?WPACS.CONSTDEF.wpo10:a.opmode;if(g==1&&k==0){var e=undefined;if(d.dir=="left")e=-2;else if(d.dir=="right")e=-1;else if(d.dir=="up")e=0;else if(d.dir=="down")e=-3;if(e!==undefined){if(c.IsOne_One()){var j=b?b.GetImage(a.idcmv):null;if(j&&j.GetFrames()>1&&j.SetFrame(e))return}h(WPACS.CONSTDEF.wpe3,e)}}}else if(i=="rotate"){var k=a.opmode>=WPACS.CONSTDEF.wpo10?WPACS.CONSTDEF.wpo10:a.opmode;if(g==1&&k==0)if(d.dir=="left")h(WPACS.CONSTDEF.wpe8,false);else d.dir=="right"&&h(WPACS.CONSTDEF.wpe8,true)}else if(i=="pinch"){var k=a.opmode>=WPACS.CONSTDEF.wpo10?WPACS.CONSTDEF.wpo10:a.opmode;if(g==1&&k==0){var o=d.dis*.5|0;h(WPACS.CONSTDEF.wpe5,{iratio:0,dratio:o})}}else if(i=="dblclick")g==1&&s()}function h(h,b){var f=false;if(a.onEvent!=null)f=a.onEvent(h,b);if(f)return true;switch(h){case WPACS.CONSTDEF.wpe1:var c=o();if(c==0)for(var e=0;e<d.length;e++)d[e].SetImage(null);else a.ipage>=c?g(c-1):g(a.ipage);return true;case WPACS.CONSTDEF.wpe3:g(b);return true;case WPACS.CONSTDEF.wpe4:return true;case WPACS.CONSTDEF.wpe5:k("zoom",b);return true;case WPACS.CONSTDEF.wpe6:k("move",b);return true;case WPACS.CONSTDEF.wpe7:k("wwwl",b);return true;case WPACS.CONSTDEF.wpe8:k("rotate",b);return true;case WPACS.CONSTDEF.wpe9:g(b>0?-1:-2);return true}return false}WPACS.wp0bj1.isObject(r)&&i(r)};WPACS.wp0b13=function(p){var j={showall:false,onclick:null},c={imguid:"",srsuid:"",stuuid:"",w:0,h:0},a=null,g=null,d=null;this.DestroyObj=function(){u()};this.GetContainer=function(){return h};this.BindContainer=function(a){l(a)};this.ReSize=function(){l(h)};this.Options=function(){return j};this.GetScout=function(){return c};this.SetScout=function(b,e,f){c={imguid:b,srsuid:e,stuuid:f,w:0,h:0};a=null;g=null;d!=null&&d.Clear();d=null;q()};this.ShowSelected=function(a){j.showall=!a;if(g!=null)b?o():n()};this.ShowLocalize=function(c,a){g={srsuid:c,imguid:a};b?o():n()};var h=null,e=null,b=null,f=null,i=null;function v(){var a=WPACS.wp0bj1.Canvas?'<canvas style="position:absolute;left:0px;top:0px;" />':"",c='<div style="position:absolute;background-color:#000000;" align="center"><img class="imgv" style="position:relative;">'+a+'<img class="wloading" src="./webpacs/images/loading.gif" ></div>';h.append(c);e=h.children("div");b=e.children("canvas");if(b.length==0)b=null;f=e.children("img.imgv");i=e.children("img.wloading")}function u(){m(false);c=null;a=null;g=null;d!=null&&d.Clear();d=null;j.onclick=null;j={};i=null;b=null;f=null;if(e!=null){e.remove();e=null}if(h!=null){h.empty();h=null}}function m(c){if(e==null)return;var a=!WPACS.wp0bj1.IsMobile?"mouseup":"touchend";if(c){b&&b.bind(a,s);f.bind("load",t);f.bind("error",function(){i.hide()})}else{b&&b.unbind(a);f.unbind("load");f.unbind("error")}}function l(a){m(false);if(WPACS.wp0bj1.isObject(a)){if(h==null||h[0]!=a[0]){h=a;e==null?v():e.appendTo(h)}var g=h.width()|0,c=h.height()|0;if(e.width()!=g||e.height()!=c){f.hide();e.height(c);e.width(g);if(b!=null){b[0].width=g;b[0].height=c}}e.show();m(true);b?q():n()}else if(h!=null){d!=null&&d.Clear();d=null;i=null;b=null;f=null;e=null;h.empty();h=null}}function t(){var e=f.width(),a=f.height();if(b!=null){var c=f.offset().left,d=f.offset().top;b.css({left:c,top:d});b[0].width=e;b[0].height=a;b.show();k()}f.show();i.hide()}function q(){if(e==null||c.imguid=="")return;var h=Math.floor(e.width())&65528,g=Math.floor(e.height())&65528,a="&recalsize=1&ovl=0";if(c.srsuid!="")a+="&srsuid="+c.srsuid;if(c.stuuid!="")a+="&stuuid="+c.stuuid;a+="&columns="+h+"&rows="+g;var d=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu5,b=d+"?requesttype=WADO&objectuid="+c.imguid+a;if(f.attr("src")==b)return;i.show();f.attr("src",b)}function n(){if(e==null||c.imguid=="")return;var h=Math.floor(e.width())&65528,d=Math.floor(e.height())&65528,a="&columns="+h+"&rows="+d+"&recalsize=1&ovl=0";if(c.srsuid!="")a+="&srsuid="+c.srsuid;if(c.stuuid!="")a+="&stuuid="+c.stuuid;if(g!=null){a+="&sliceuid="+g.imguid+"&slicesrs="+g.srsuid;if(j.showall)a+="&a=1"}i.show();var b=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu5;$.ajax({type:"POST",data:a,dataType:"text",async:true,url:b+"?requesttype=SCOUT_PATH&objectuid="+c.imguid,success:function(c){var a=b+"?requesttype=VURL"+c;if(f.attr("src")!=a)f.attr("src",a);else i.hide()},error:function(){i.hide()}})}function o(){function l(c){if(a==null)return-1;for(var b=0;b<a.length;b++)if(a[b].srsuid==c)return b;return-1}function m(c,d){if(a==null)return-1;for(var b=0;b<a[c].img.length;b++)if(a[c].img[b].uid==d)return b;return-1}var b="",f=g.srsuid,e=g.imguid,d=l(f),h=!j.showall;if(d!=-1)if(h||a[d].all==1){var o=m(d,e);if(o==-1)b=e}else b=undefined;else{if(a==null)a=[];d=a.length;a[d]={srsuid:f,all:0,img:[{uid:e,x0:0,y0:0,x1:0,y1:0}]};if(!h)b=undefined;else b=e}if(b==""){k();return}if(c.imguid=="")return;if(b==undefined)a[d].all=1;var i="&stuuid="+c.stuuid+"&srsuid="+c.srsuid+"&slicesrs="+f;if(b!=undefined)i+="&sliceuid="+b;var n=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu4;$.ajax({type:"POST",data:i,dataType:"json",async:true,url:n+"?requesttype=LOCALIZE&objectuid="+c.imguid,success:function(a){c.w=a.w;c.h=a.h;for(var b=0;b<a.lines.length;b++){var d=a.lines[b].x0,g=a.h-a.lines[b].y0,e=a.lines[b].x1,h=a.h-a.lines[b].y1;r(f,a.lines[b].uid,d,g,e,h)}k()}})}function r(k,d,e,g,f,h){if(a==null)return false;for(var j=a.length,b=0;b<j;b++){if(a[b].srsuid!=k)continue;for(var i=a[b].img.length,c=0;c<i;c++){if(a[b].img[c].uid!=d)continue;a[b].img[c].x0=e;a[b].img[c].y0=g;a[b].img[c].x1=f;a[b].img[c].y1=h;return true}a[b].img[i]={uid:d,x0:e,y0:g,x1:f,y1:h};return true}a[j]={srsuid:k,all:0,img:[{uid:d,x0:e,y0:g,x1:f,y1:h}]};return true}function k(){if(b==null)return;b[0].width=b[0].width;if(a==null||a.length==0)return;var p=g!=null?g.srsuid:"",o=g!=null?g.imguid:"";if(p==""&&o=="")return;d!=null&&d.Clear();d=new WPACS.wp0b39;for(var r=b[0].width,q=b[0].height,t=c.w,s=c.h,e=0;e<a.length;e++){if(a[e].srsuid!=p)continue;for(var f=0;f<a[e].img.length;f++){var n=a[e].img[f].uid==o;if(!j.showall&&!n)continue;var i=a[e].img[f].x0,l=a[e].img[f].y0,k=a[e].img[f].x1,m=a[e].img[f].y1;if(i==0&&l==0&&k==0&&m==0)continue;i=r*i/t|0;l=q*l/s|0;k=r*k/t|0;m=q*m/s|0;var h=new WPACS.wp0bj7;h.CreateLine(i,l,k,m);h.options.hitoff=.2;h.options.allowmm=false;h.UserTag={i:e,j:f};if(n)h.SetColor("#FF0000");else h.SetColor("#00AF00");d.AddMeta(h)}}d.metaItems.length>0&&d.DrawMetas(b,undefined)}function s(l){if(d==null)return;var i=WPACS.wp0bj1.IsMobile?event.changedTouches[0]:l,m=i.pageX-b.offset().left,n=i.pageY-b.offset().top,e=d.IfHit(m,n,false);if(e!=null&&e.pos>0){var k=d.metaItems[e.idx].UserTag,c=k.i,f=k.j;if(c>=0&&c<a.length&&f>=0&&f<a[c].img.length){g={srsuid:a[c].srsuid,imguid:a[c].img[f].uid};if(j.onclick!=null)j.onclick(WPACS.CONSTDEF.wpe13,{imguid:g.imguid,srsuid:g.srsuid})}for(var h=0;h<d.metaItems.length;h++)d.metaItems[h].SetColor("#00AF00");d.metaItems[e.idx].SetColor("#FF0000");b[0].width=b[0].width;d.DrawMetas(b,undefined)}return false}WPACS.wp0bj1.isObject(p)&&l(p)};WPACS.wp0b31=function(i){var d={horiz:false,showall:false,onEvent:null},a=[];this.DestroyObj=function(){k()};this.GetContainer=function(){return c};this.BindContainer=function(a){f(a)};this.ReSize=function(){f(c)};this.Options=function(){return d};this.AddScout=function(a,b,c){m(a,b,c)};this.DelScout=function(a,b,c){return n(a,b,c)};this.Clear=function(){h()};this.ShowLocalize=function(d,c){for(var b=0;b<a.length;b++)a[b].ShowLocalize(d,c)};this.ShowSelected=function(c){d.showall=!c;for(var b=0;b<a.length;b++)a[b].ShowSelected(!d.showall)};var c=null,b=null;function l(){var a='<div class="panel-bk" style="position:relative;overflow:auto;padding:0px;" ></div>';c.append(a);b=c.children("div")}function k(){g(false);h();a=null;d.onEvent=null;d={};if(b!=null){b.remove();b=null}if(c!=null){c.empty();c=null}}function g(a){if(b==null)return;if(a)!WPACS.wp0bj1.IsMobile;else!WPACS.wp0bj1.IsMobile}function f(d){g(false);if(WPACS.wp0bj1.isObject(d)){if(c==null||c[0]!=d[0]){c=d;b==null?l():b.appendTo(c)}var i=c.width(),h=c.height();b.width(i);b.height(h);e();b.show();g(true)}else if(c!=null){for(var f=0;f<a.length;f++)a[f].BindContainer(null);b=null;c.empty();c=null}}function e(){if(b==null)return;var k=b.width(),j=b.height(),n=18,f="",o=1,c=8;if(d.horiz){var h=j-2*c,g,i=false;if(a.length>0&&!WPACS.wp0bj1.IsMobile&&h*a.length+a.length*c>k)i=true;g=i?j-2*c-n:j-2*c;for(var e=0,l=c;e<a.length;e++){f+='<div class="scov" no="'+e+'" style="position:absolute;left:'+l+"px;top:"+c+"px;width:"+h+"px;height:"+g+'px;" ></div>';l+=h+c}f+='<div style="position:absolute;left:'+l+"px;top:0px;width:1px;height:"+g+'px;"></div>'}else{var g=k-2*c,h,i=false;if(a.length>0&&!WPACS.wp0bj1.IsMobile&&g*a.length+a.length*c>j)i=true;h=i?k-2*c-n:k-2*c;for(var e=0,m=c;e<a.length;e++){f+='<div class="scov" no="'+e+'" style="position:absolute;left:'+c+"px;top:"+m+"px;width:"+h+"px;height:"+g+'px;" ></div>';m+=g+c}f+='<div style="position:absolute;left:0px;top:'+m+"px;width:"+h+'px;height:1px;"></div>'}b.empty();if(f=="")return;b.html(f);for(var e=0;e<a.length;e++)a[e].BindContainer(b.children("div.scov[no='"+e+"']"))}function h(){for(var b=0;b<a.length;b++){a[b].DestroyObj();a[b]=null}a=[];e()}function m(c,f,g){if(c=="")return;var b=new WPACS.wp0b13;b.Options().onclick=j;b.Options().showall=d.showall;b.SetScout(c,f,g);a[a.length]=b;e()}function n(d){if(d=="")return false;for(var b=0;b<a.length;b++){var c=a[b];if(c.GetScout().imguid==d){a.splice(b,1);e();c.DestroyObj();c=null;return true}}return false}function j(b,c){var a=false;if(d.onEvent!=null)a=d.onEvent(b,c);if(a)return true;switch(b){case WPACS.CONSTDEF.wpe13:return true}return false}WPACS.wp0bj1.isObject(i)&&f(i)};eval(function(d,f,a,c,b,e){b=function(a){return a.toString(f)};if(!"".replace(/^/,String)){for(;a--;)e[b(a)]=c[a]||b(a);c=[function(a){return e[a]}];b=function(){return"\\w+"};a=1}for(;a--;)c[a]&&(d=d.replace(new RegExp("\\b"+b(a)+"\\b","g"),c[a]));return d}("(5(){2 a='7'+'f'+'4',1='\u975e\u6cd5'+'\u4f7f\u7528'+a;6{2 0=8(a);9(b 0!=='c'||!0.d)3(1)}g(e){3(1)}})();",17,17,"o warn var alert ACS function try W eval if  typeof object CONSTDEF  P catch".split(" "),0,{}));WPACS.wp0b14=function(o){var e={thumbuid:"",onclick:null},c=null;this.DestroyObj=function(){r()};this.GetContainer=function(){return d};this.BindContainer=function(a){l(a)};this.ReSize=function(){l(d)};this.Options=function(){return e};this.SetDcmSet=function(a){n(a)};this.GetDcmSet=function(){return c};var d=null,a=null,b=null,i,j,g=null,h=null,f=null;function s(){var c='<div style="position:absolute;display:none;background-color:#000000;" ><img class="imgv" style="position:relative;width:inherit;height:inherit;" ><span class="thmod" align="center" title="'+WPACS.CONSTDEF.STR_THUV_TEXT1+'" ></span><span class="thnum" align="center" title="'+WPACS.CONSTDEF.STR_THUV_TEXT2+'" ></span><img class="wloading" src="./webpacs/images/loading.gif" ><img class="sloading" src="./webpacs/images/loading1.gif" ><div class="progress" title="'+WPACS.CONSTDEF.STR_THUV_TEXT3+'" ></div></div>';d.append(c);a=d.children("div");b=a.children("img.imgv");i=a.children("span.thmod");j=a.children("span.thnum");h=a.children("img.sloading");g=a.children("div.progress");f=a.children("img.wloading")}function r(){m(false);n(null);e.onclick=null;e={};i=null;j=null;b=null;f=null;g=null;h=null;if(a!=null){a.remove();a=null}if(d!=null){d.empty();d=null}}function m(c){if(a==null)return;if(c){b.bind("load",function(){f.hide()});b.bind("error",function(){f.hide()});b.bind("click",q)}else{b.unbind("load");b.unbind("error");b.unbind("click")}}function l(c){m(false);if(WPACS.wp0bj1.isObject(c)){if(d==null||d[0]!=c[0]){d=c;a==null?s():a.appendTo(d)}var l=d.width()|0,n=d.height()|0;a.height(n);a.width(l);g.progressbar({width:l,height:5,text:""});a.show();m(true);k()}else if(d!=null){e.thumbuid="";i=null;j=null;b=null;f=null;g=null;h=null;a=null;d.empty();d=null}}function k(){if(a==null)return;if(c!=null){var n=c.Length(),q=c.Options().finish;n>0&&g.progressbar("setValue",100*q/n|0);c.IfLoading()>0?h.show():h.hide()}else{i.text("");j.text("");h.hide()}var l=c!=null?c.GetImage(0):null,d=l!=null?l.Options().imguid:"";if(e.thumbuid==d)return;if(d==""){e.thumbuid="";b.hide();return}j.text(""+c.Length());i.text(c.Options().mod);var p=c.Options().mod;if(!WPACS.wp0b41.IsVisible(p)){if(p=="SR"){b.attr("src","./webpacs/images/sr.jpg");g.progressbar("setValue",100)}else b.hide();return}var s=Math.floor(a.width())&65528,r=Math.floor(a.height())&65528,k="&columns="+s+"&rows="+r;if(l.Options().srsuid!="")k=k+"&srsuid="+l.Options().srsuid;if(l.Options().stuuid!="")k=k+"&stuuid="+l.Options().stuuid;var m=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu5;if(true){var o=m+"?requesttype=WADO&objectuid="+d+k;if(b.attr("src")!=o){f.show();b.attr("src",o)}e.thumbuid=d}else{f.show();$.ajax({type:"POST",data:k,dataType:"text",async:true,url:m+"?requesttype=WADO_PATH&objectuid="+d,success:function(c){if(!b)return;var a=m+"?requesttype=VURL"+c;if(b.attr("src")!=a)b.attr("src",a);else f.hide();e.thumbuid=d},error:function(){f.hide()}})}b.show();return}function n(a){if(c!=null)c.Options().onEvent[0]=null;if((c=a)!=null)c.Options().onEvent[0]=p;k()}function q(){if(c==null)return;if(e.onclick!=null){var a=e.onclick[1];e.onclick[0](WPACS.CONSTDEF.wpe11,a)}else c.ToggleLoad()}function p(a){switch(a){case WPACS.CONSTDEF.wpe1:k();return true;case WPACS.CONSTDEF.wpe2:k();return true}return false}WPACS.wp0bj1.isObject(o)&&l(o)};WPACS.wp0b32=function(o){var h=new WPACS.MouseHandlers,e={horiz:false,selected:-1,onEvent:null},a=[];this.DestroyObj=function(){r()};this.GetContainer=function(){return c};this.BindContainer=function(a){j(a)};this.ReSize=function(){j(c)};this.Options=function(){return e};this.Add=function(a){t(a)};this.Clear=function(){n()};this.Get=function(b){return b>=0&&b<a.length?a[b].GetDcmSet():null};this.SetPageInfo=function(a,b){q(a,b)};this.SetSelected=function(f){if(b==null)return;for(var c=0,c=0;c<a.length;c++){var d=a[c].GetDcmSet();if(d!=null&&d.Options().srsuid==f)break}if(c>=a.length)return;e.selected!=-1&&b.find("div.thuv[no='"+e.selected+"']").css("border","none");e.selected=c;b.find("div.thuv[no='"+e.selected+"']").css("border","thin solid #009F7F")};var c=null,d=null,b=null,f=null,g=null;function s(){var a='<div style="position:relative;display:none;overflow:hidden;padding:0px;"><div class="panel-bk" style="position:absolute;overflow:auto;padding:0px;"></div><div style="position:absolute;background-color:#EDF3FF"></div></div>';c.append(a);d=c.children("div");b=d.children("div:eq(0)");f=d.children("div:eq(1)")}function r(){k(false);n();a=null;e={};b=null;f=null;g=null;if(d!=null){d.remove();d=null}if(c!=null){c.empty();c=null}h.UnBindAll(null);h=null}function k(i){if(d==null)return;var e=f.find("img.preFrm"),c=f.find("img.nxtFrm");if(i){var a={mousedown:null,mousemove:l,mouseup:null,mouseclick:null,mousedblclick:null,mousewheel:null,mouseswipe:null,mouserotate:null,mousepinch:null};WPACS.wp0bj1.IsMobile&&h.BindElem(b,a);a={mousedown:null,mousemove:null,mouseup:null,mouseclick:l,mousedblclick:l,mousewheel:null,mouseswipe:null,mouserotate:null,mousepinch:null};h.BindElem(c,a,"next");h.BindElem(e,a,"prev");h.BindElem(g,a,"pinfo")}else{WPACS.wp0bj1.IsMobile&&h.UnBindElem(b);h.UnBindElem(c);h.UnBindElem(e);h.UnBindElem(g)}}function j(e){k(false);if(WPACS.wp0bj1.isObject(e)){if(c==null||c[0]!=e[0]){c=e;d==null?s():d.appendTo(c)}var j=c.width(),i=c.height();d.width(j);d.height(i);m();p();d.show();k(true)}else if(c!=null){for(var h=0;h<a.length;h++)a[h].BindContainer(null);b=null;f=null;g=null;d=null;c.empty();c=null}}function m(){if(d==null)return;var p=d.width(),t=d.height(),s=18,n=40,j="",h=1,c=8;if(e.horiz){var i=t,m=p-n;b.css({left:h,top:h});b.height(i);b.width(m);f.css({left:m+h,top:h});f.height(i);f.width(n);var l=i-2*c,k,o=false;if(a.length>0&&!WPACS.wp0bj1.IsMobile&&l*a.length+a.length*c>m)o=true;k=o?i-2*c-s:i-2*c;for(var g=0,q=c;g<a.length;g++){j+='<div class="thuv" no="'+g+'" style="position:absolute;left:'+q+"px;top:"+c+"px;width:"+l+"px;height:"+k+'px;" ></div>';q+=l+c}j+='<div style="position:absolute;left:'+q+"px;top:0px;width:1px;height:"+k+'px;"></div>'}else{var m=p,i=t-n;b.css({left:h,top:h});b.height(i);b.width(m);f.css({left:h,top:i+h});f.height(n);f.width(p);var k=p-2*c,l,o=false;if(a.length>0&&!WPACS.wp0bj1.IsMobile&&k*a.length+a.length*c>i)o=true;l=o?m-2*c-s:m-2*c;for(var g=0,r=c;g<a.length;g++){j+='<div class="thuv" no="'+g+'" style="position:absolute;left:'+c+"px;top:"+r+"px;width:"+l+"px;height:"+k+'px;" ></div>';r+=k+c}j+='<div style="position:absolute;left:0px;top:'+r+"px;width:"+l+'px;height:1px;"></div>'}b.empty();if(j=="")return;b.html(j);for(var g=0;g<a.length;g++)a[g].BindContainer(b.children("div.thuv[no='"+g+"']"));e.selected!=-1&&b.find("div.thuv[no='"+e.selected+"']").css("border","thin solid #009F7F")}function p(){var b=g!=null?g.attr("sinfo"):"",i=WPACS.wp0bj1.IsMobile?28:32,c=WPACS.CONSTDEF.STR_THUW_TEXT2,d=WPACS.CONSTDEF.STR_THUW_TEXT3,h=WPACS.CONSTDEF.STR_THUW_TEXT4,a="";if(e.horiz)a+='<table class="normalize" style="font-family:\u534e\u6587\u9ed1\u4f53;font-size:18px;color:#B3B9Bb;" ><tr height="32px"><td><img class="preFrm" src="./webpacs/images/preFrm.png" title="'+c+'" style="width:28px;height:28px;margin-left:2px;"></td></tr><tr><td id="pagev" title="'+h+'" style="word-break:break-all"> 0/0 </td></tr><tr height="32px"><td><img class="nxtFrm" src="./webpacs/images/nxtFrm.png" title="'+d+'" style="width:28px;height:28px;margin-left:2px;"></td></tr></table>';else a+='<table class="normalize" style="font-family:\u534e\u6587\u9ed1\u4f53;font-size:18px;color:#B3B9Bb;" ><tr><td width="32px"><img class="preFrm" src="./webpacs/images/preFrm.png" title="'+c+'" style="width:28px;height:28px;margin-left:2px;"></td><td id="pagev" align="center"  title="'+h+'">0/0 </td><td width="32px"><img class="nxtFrm" src="./webpacs/images/nxtFrm.png" title="'+d+'" style="width:28px;height:28px;"></td></tr></table>';f.html(a);g=f.find("#pagev");g.attr("sinfo",b);g.text(b)}function q(c,a){if(g==null)return;var b="";if(a>0)c+=1;if(e.horiz)if(a>=10)b=c+"/ "+a;else b=c+"/"+a;else b=c+"/"+a;g.attr("sinfo",b);g.text(b)}function n(){for(var b=0;b<a.length;b++){a[b].DestroyObj();a[b]=null}a=[];e.selected=-1;m()}function t(c){if(!c)return;var b=new WPACS.wp0b14,d=a.length;b.SetDcmSet(c);b.Options().onclick=[i,d];a[a.length]=b;m()}function i(f,d){var b=false;if(e.onEvent!=null)b=e.onEvent(f,d);if(b)return true;switch(f){case WPACS.CONSTDEF.wpe11:var c=a[d].GetDcmSet();c!=null&&c.ToggleLoad();return true;case WPACS.CONSTDEF.wpe3:return true}return false}function l(c){var f=c.event.data,a=c.type,d=c.which;if(f=="prev"){if(a=="click"||a=="dblclick")d==1&&i(WPACS.CONSTDEF.wpe3,-1)}else if(f=="next"){if(a=="click"||a=="dblclick")d==1&&i(WPACS.CONSTDEF.wpe3,-2)}else if(f=="pinfo"){if(a=="dblclick")d==1&&i(WPACS.CONSTDEF.wpe14,"playbar")}else if(a=="move"&&d==1)if(e.horiz)b.scrollLeft(b.scrollLeft()-c.dx);else b.scrollTop(b.scrollTop()-c.dy)}WPACS.wp0bj1.isObject(o)&&j(o)};WPACS.wpLayoutSelect=function(d,e){var m=4,l=4,c=e,b=d,a=null;function g(){for(var c='<div id="div_layoutselect" style="z-index:99999;">',d=0;d<m;d++){c+="<div>";for(var e=0;e<l;e++)c+='<div class="item" row="'+(d+1)+'" col="'+(e+1)+'"></div>';c+="</div>"}c+="</div>";$("body").append(c);a=$("#div_layoutselect");a.find("div.item").bind("mousemove",h);a.find("div.item").bind("click",i);var f=b.offset(),j=f.top+b.height()+5,g=f.left-5;a.css({left:g,top:j});a.show()}function f(){c=null;b=null;a!=null&&a.remove();a=null}var k=0,j=0;function h(){var f=parseInt($(this).attr("row")),e=parseInt($(this).attr("col"));if(f==k&&e==j)return;var b=a.find("div.item");b.removeClass("hover");for(var c=0;c<f;c++){b=a.children("div").eq(c);for(var d=0;d<e;d++)b.children("div").eq(d).addClass("hover")}}function i(){var d=$(this).attr("row"),a=$(this).attr("col");b.attr("vl",d+","+a);c!=null&&c(b);f()}if($("#div_layoutselect").length>0){$("#div_layoutselect").hide();$("#div_layoutselect").remove()}else WPACS.wp0bj1.isObject(d)&&g()};WPACS.wp0bj1Bar=function(p){var g=new WPACS.MouseHandlers,d={stuview:null};this.DestroyObj=function(){q()};this.GetContainer=function(){return c};this.BindContainer=function(a){k(a)};this.ReSize=function(){k(c)};this.Options=function(){return d};this.IsEmpty=function(){return a!=null?a.children("a").length==0:true};this.SetSelected=function(a){m(a)};this.SwitchBar=function(b,a){o(b);m(a)};this.ShowLogo=function(){};var c=null,b=null,a=null;function r(){var d='<div style="position:relative;width:inherit;height:inherit;overflow:hidden;padding:3px;"><div style="width:inherit;height:40px;"></div><span class="syslogo" fnid="fnOpenDlg" vl="options" >'+WPACS.CONSTDEF.STR_IMPL_MARK+" </span></div>";c.append(d);b=c.children("div");a=b.children("div:eq(0)")}function q(){l(false);d.stuview=null;d={};a=null;if(b!=null){b.remove();b=null}if(c!=null){c.empty();c=null}g.UnBindAll(null);g=null}function l(d){if(b==null)return;var e=!WPACS.wp0bj1.IsMobile?"click":"touchend";if(d){b.children("span").bind("click",h);var c={mousedown:null,mousemove:null,mouseup:null,mouseclick:null,mousedblclick:n,mousewheel:null,mouseswipe:n,mouserotate:null,mousepinch:null};g.BindElem(a,c)}else{b.children("span").unbind("click");g.UnBindElem(a)}}function k(d){l(false);if(WPACS.wp0bj1.isObject(d)){if(c==null||c[0]!=d[0]){c=d;b==null?r():b.appendTo(c)}o();b.show();l(true)}else if(c!=null){a=null;b=null;c.empty();c=null}}var i=0,f=0,e=0;function o(u){var c,n="";if(u!="ECG")c=WPACS.wp0bj1.IsMobile?WPACS.TOOLSBAR_MOBILE:WPACS.TOOLSBAR;else c=WPACS.wp0bj1.IsMobile?WPACS.TOOLSBAR_ECG_MOBILE:WPACS.TOOLSBAR_ECG;var p="size:'large',plain:true,iconCls:'"+(WPACS.wp0bj1.Browser.Versions.ie?"wptoolbar_ie":"wptoolbar")+" ",s=WPACS.wp0bj1.IsMobile?"easyui-menubutton":"easyui-splitbutton",m=0,q=a.width();i=f=e=0;for(var g=0;g<c.length;g++)if(c[g].title!="-"){var j="",o="",l="",t=c[g].selected!="true"?p+c[g].icon+"'":p+c[g].icon+" toolbar-selected'";if(c[g].fnid!="")o='fnid="'+c[g].fnid+'" vl="'+c[g].vl+'"';if(c[g].disabled=="true")j=",disabled:true";else if(c[g].disabled=="canvas"&&!WPACS.wp0bj1.Canvas)j=",disabled:true";if(c[g].menu!="")l=",menu:'"+d.stuview.MenuSets().GetMenuName("#"+c[g].menu)+"'";var k="";if(l!="")k=o==""?"easyui-menubutton":s;else k="easyui-linkbutton";var r="";m+=c[g].menu!=""?60:45;if(m>q)r='style="display:none;"';else e++;n+='<a id="toolbtn'+i+'" class="'+k+'" data-options="'+t+j+l+'" '+r+' title="'+c[g].title+'" '+o+"></a>";i++}else n+='<div class="toolbar-separator" ></div>';a.html(n);a.children("a.easyui-linkbutton").linkbutton({onClick:h});a.children("a.easyui-splitbutton").splitbutton({onClick:h});a.children("a.easyui-menubutton").menubutton({onClick:h});marginLeft=parseInt(b.children("span").css("margin-left"));if(q-m>Math.abs(marginLeft))b.children("span").show();else b.children("span").hide()}function h(){var b=$(this).attr("fnid"),a=d.stuview!=null?d.stuview.Action:null;if(b=="fnLayout")!WPACS.wp0bj1.IsMobile&&new WPACS.wpLayoutSelect($(this),a);else b&&a!=null&&a($(this))}function m(b){if(a==null)return;function c(c){var b="",a=c.split(" ");for(j=0;j<a.length;j++)if(a[j]!=""&&a[j]!="toolbar-selected")b+=j==0?a[j]:" "+a[j];return b}a.children("a[fnid='fnOpmode']").each(function(){var f="",d=parseInt($(this).attr("vl")),g=$(this).attr("class"),a=0;if(g.indexOf("easyui-menubutton")!=-1)a=1;else if(g.indexOf("easyui-splitbutton")!=-1)a=2;if(a==1)f=$(this).menubutton("options").iconCls;else if(a==2)f=$(this).splitbutton("options").iconCls;else f=$(this).linkbutton("options").iconCls;var e=c(f);if(d==1)d=WPACS.CONSTDEF.wpo5;if(b==1)b=WPACS.CONSTDEF.wpo5;if(d>WPACS.CONSTDEF.wpo10&&d<WPACS.CONSTDEF.wpo30)d=WPACS.CONSTDEF.wpo2;if(b>WPACS.CONSTDEF.wpo10&&b<WPACS.CONSTDEF.wpo30)b=WPACS.CONSTDEF.wpo2;if(d==b)e+=" toolbar-selected";if(a==1)$(this).menubutton({iconCls:e});else if(a==2)$(this).splitbutton({iconCls:e});else $(this).linkbutton({iconCls:e})})}function n(b){var c=b.type,g=b.which;if(c=="dblclick")g==1&&d.stuview&&d.stuview.Action($('<a fnid="fnFloatBtn" vl="" ></a>'));else if(c=="swipe")if(b.dir=="left"){if(e<i){a.children("#toolbtn"+f).hide();a.children("#toolbtn"+e).show();f+=1;e+=1}}else if(b.dir=="right")if(f>0){f-=1;e-=1;a.children("#toolbtn"+e).hide();a.children("#toolbtn"+f).show()}}WPACS.wp0bj1.isObject(p)&&k(p)};WPACS.wpFloatBtn=function(f){var c={stuview:null,srsmod:""};this.DestroyObj=function(){j()};this.GetContainer=function(){return b};this.BindContainer=function(a){d(a)};this.ReSize=function(){d(b)};this.Options=function(){return c};this.SetFloatBtn=function(a){i(a)};var b=null,a=null;function k(){var c='<a class="wptoolbar1 icon-toolbar-default1 toolbar-selected" fnid="fnOpmode" vl="0" style="margin-top:17px;"></a>';b.append(c);a=b.children("a")}function j(){e(false);c.stuview=null;c={};if(a!=null){a.remove();a=null}if(b!=null){b.empty();b=null}}function e(c){if(a==null)return;var b=!WPACS.wp0bj1.IsMobile?"click":"touchend";if(c)a.bind(b,function(){var a=$(this);WPACS.ClickEvent(function(){h(a)},function(){g(a)})});else a.bind(b)}function d(c){e(false);if(WPACS.wp0bj1.isObject(c)){if(b==null||b[0]!=c[0]){b=c;a==null?k():a.appendTo(b)}e(true)}else if(b!=null){a=null;b.empty();b=null}}function i(c){if(a==null)return;var d=parseInt(a.attr("vl"));b(a,d,false);b(a,c,true);a.attr("vl",c);return;function b(a,b,c){if(b==WPACS.CONSTDEF.wpo2||b>WPACS.CONSTDEF.wpo10&&b<WPACS.CONSTDEF.wpo30)c?a.addClass("icon-toolbar-measu1"):a.removeClass("icon-toolbar-measu1");else if(b==WPACS.CONSTDEF.wpo5||b==1)c?a.addClass("icon-toolbar-zoom1"):a.removeClass("icon-toolbar-zoom1");else if(b==WPACS.CONSTDEF.wpo6)c?a.addClass("icon-toolbar-move1"):a.removeClass("icon-toolbar-move1");else if(b==WPACS.CONSTDEF.wpo7)c?a.addClass("icon-toolbar-wwwl1"):a.removeClass("icon-toolbar-wwwl1");else c?a.addClass("icon-toolbar-default1"):a.removeClass("icon-toolbar-default1")}}function h(e){if(!e.attr)e=$(this);var g=e.attr("fnid");if(g!="fnOpmode")return;var b=parseInt(e.attr("vl")),k=c.srsmod=="ECG";if(c.srsmod=="ECG")if(b==0)b=11;else b=0;else{function f(a){return a==WPACS.CONSTDEF.wpo5||a==1?WPACS.CONSTDEF.wpo5:a==WPACS.CONSTDEF.wpo2||a>WPACS.CONSTDEF.wpo10&&a<WPACS.CONSTDEF.wpo30?WPACS.CONSTDEF.wpo2:a}var a=WPACS.CONSTDEF.FLOATORDER;if(!a||a.length<1)a=[0,7,5,6,2];for(var h=f(b),d=0;d<a.length;d++){var i=f(a[d]);if(i==h)break}if(++d>=a.length)d=0;b=a[d]}var j=$('<a fnid="'+g+'" vl="'+b+'" ></a>');c.stuview!=null&&c.stuview.Action(j)}function g(d){if(!d.attr)d=$(this);var g=d.attr("fnid");if(g!="fnOpmode")return;var b=parseInt(d.attr("vl")),a="",e=c.srsmod=="ECG";if(b==0)a="mnuFloatBar";else if(b==WPACS.CONSTDEF.wpo7)a=e?"mnuFloatEcg":"mnuFloatWwwl";else if(b==WPACS.CONSTDEF.wpo5||b==1)a=e?"mnuFloatEcg":"mnuFloatZoom";else if(b==WPACS.CONSTDEF.wpo6)a=e?"mnuFloatEcg":"mnuFloatImg";else if(b==WPACS.CONSTDEF.wpo2||b>WPACS.CONSTDEF.wpo10&&b<WPACS.CONSTDEF.wpo30)a=e?"mnuFloatEcg":"mnuFloatMeasu";else if(e)a="mnuFloatEcg";if(a==""||c.stuview==null)return;var f=c.stuview.MenuSets().GetMenu(a);if(f.length==0)return;f.menu("show",{left:d.offset().left+d.width(),top:d.offset().top,alignTo:null})}WPACS.wp0bj1.isObject(f)&&d(f)};WPACS.wp0b15=function(L,w){var a=$.extend(false,{},{isrsv:0,cascade:1,toolbh:false,thumbh:false,textv:true,metav:true,opmode:0,view3d:true,vwmode:WPACS.wp0bj1.Canvas?1:WPACS.CONSTDEF.VMODE_WADO},w||{}),d=[],i=new WPACS.fmtLayOut(1,1),K=["#009F7F","#9F7F00","#9F8F7F"],c=[],j=new WPACS.wp0b31,k=new WPACS.wp0b32,n=new WPACS.wp0bj1Bar,o=new WPACS.wpFloatBtn,f=new WPACS.wpContextMenu,z=this;this.DestroyObj=function(){O()};this.GetContainer=function(){return e};this.BindContainer=function(a){u(a)};this.ReSize=function(){u(e)};this.SetSize=function(b,a){if(e==null)return;e.width(b);e.height(a);u(e)};this.Options=function(){return a};this.MenuSets=function(){return f};this.SetFormat=function(b,a){J(b,a)};this.ViewStudy=function(a,b){B(a,"","","",b)};this.ViewSeries=function(b,a,d,c){B(b,a,"",d,c)};this.ViewImage=function(c,b,a,e,d){B(c,b,a,e,d)};this.GetSrsDcm=function(b){return b==-1?c[a.isrsv].GetDcmSet():b<0||b>=d.length?null:d[b]};this.GetCurDcm=function(){return r()};this.SaveAsImg=function(b,a){I(b,a)};this.BindHotKey=function(){if(WPACS.wp0bj1.IsMobile)return;if(!WPACS.HOTKEYDEF||WPACS.HOTKEYDEF.length==0)return;for(var a=0;a<WPACS.HOTKEYDEF.length;a++){var b=WPACS.HOTKEYDEF[a].hotkey;if(b=="")continue;(function(a){$.hotkeys.add(b,function(){var b=$('<a fnid="'+WPACS.HOTKEYDEF[a].fnid+'" vl="'+WPACS.HOTKEYDEF[a].vl+'" ></a>');v(b)})})(a)}};this.Action=function(a,b){typeof a=="string"?g(a,b):v(a)};function g(f,b){if(h.is(":visible")){var i=$.data(h,"rtview");!WPACS.wp0bj1.isUndefined(i)&&i.Action(f,b)}var j=a.isrsv;switch(f){case"stuLayout":J(b.r,b.c);return;case"cascade":if(!WPACS.wp0bj1.isNumberType(b))return;if(b!=0&&b!=1&&b!=2)return;a.cascade=b;for(var e=0;e<c.length;e++)c[e].Options().cascade=a.cascade!=0;M();return;case"opmode":if(WPACS.wp0bj1.isNumberType(b)&&b>=0){a.opmode=b;for(var e=0;e<c.length;e++)c[e].Action("opmode",b);n.SetSelected(a.opmode);o.SetFloatBtn(a.opmode)}return;case"textv":if(WPACS.wp0bj1.isBooleanType(b))a.textv=b;else a.textv=!a.textv;for(var e=0;e<d.length;e++)d[e].Action("textv",a.textv);return;case"metav":if(WPACS.wp0bj1.isBooleanType(b))a.metav=b;else a.metav=!a.metav;for(var e=0;e<d.length;e++)d[e].Action("metav",a.metav);return;case"vwmode":if(WPACS.wp0bj1.isNumberType(b))a.vwmode=b==WPACS.CONSTDEF.VMODE_WADO?WPACS.CONSTDEF.VMODE_WADO:1;else a.vwmode=a.vwmode==WPACS.CONSTDEF.VMODE_WADO?1:WPACS.CONSTDEF.VMODE_WADO;for(var e=0;e<d.length;e++)d[e].Action("vwmode",a.vwmode);return;case"dlossy":if(WPACS.wp0bj1.isNumberType(b))WPACS.CONSTDEF.DATALOSSY=b!=0;else WPACS.CONSTDEF.DATALOSSY=!WPACS.CONSTDEF.DATALOSSY;for(var e=0;e<d.length;e++)d[e].Action("dlossy");return;case"iframe":var g=r();if(!g)return;if(WPACS.wp0bj1.isNumberType(b))g.SetFrame(b);else g.SetFrame(parseInt(b));return;case"delmeta":case"dcminfo":case"dcmdown":case"petct":case"xasub":c[j].Action(f,b);return}if(a.cascade==2)for(var e=0;e<c.length;e++)c[e].Action(f,b);else c[j].Action(f,b)}var e=null,b=null,s=null,l=null,m=null,p=null,h=null,t=["qrystu","prndcm","view3d","d3view","histgram","playbar","options","fusion","rtview","framebar"];function R(){var d='<div class="toolbar"></div><div class="stuv" '+WPACS.CONSTDEF.STR_SETS1+' ></div><div class="scov" '+WPACS.CONSTDEF.STR_SETS1+' ></div><div class="dlgwin" '+WPACS.CONSTDEF.STR_SETS2+' ></div><div class="easyui-draggable" style="position:absolute;background:#EDF3FF;display:none;width:80px;height:80px;border-radius:40px;" align="center"></div>';e.append(d);b=e.children("div.stuv");s=e.children("div.scov");l=e.children("div.toolbar");h=e.children("div.dlgwin");p=e.children("div.easyui-draggable");p.draggable();b.layout({border:false});b.layout("add",{region:"center",noheader:true,border:false,onResize:H});var c=b.layout("panel","center");c.css("overflow","hidden");n.BindContainer(l);if(n.IsEmpty())l.hide();else a.toolbh?l.hide():l.show();o.BindContainer(p);o.SetFloatBtn(a.opmode);WPACS.wp0bj1.IsMobile&&WPACS.CONSTDEF.AUTOSHOWFLOAT&&v($('<a fnid="fnFloatBtn" vl="" ></a>'))}function O(){x(false);F();d=null;j!=null&&j.DestroyObj();j=null;k!=null&&k.DestroyObj();k=null;n!=null&&n.DestroyObj();n=null;o!=null&&o.DestroyObj();o=null;f!=null&&f.Destroy();f=null;h!=null&&G();h=null;a={};z=null;s=null;l=null;m=null;p=null;if(b!=null){b.remove();b=null}if(e!=null){e.empty();e=null}}function G(){for(var a=0;a<t.length;a++){var b=$.data(h,t[a]);b&&b.DestroyObj();$.data(h,t[a],undefined)}}function x(c){if(b==null)return;var a=!WPACS.wp0bj1.IsMobile?"mousedown":"touchstart",d=WPACS.wp0bj1.IsMobile;if(c){b.find("div.srsv").bind(a,function(){A(parseInt($(this).attr("no")))});WPACS.wp0bj1.IsMobile&&e.bind("touchmove",function(a){a.preventDefault()})}else{b.find("div.srsv").unbind(a);WPACS.wp0bj1.IsMobile&&e.unbind("touchmove")}}function C(){if(b==null)return;for(var g=b.layout("panel","center"),a=0;a<c.length;a++){var e=g.find("div.srsv[no='"+a+"']");!WPACS.wp0bj1.IsMobile&&WPACS.BindContextMenu(e,"");var d=c[a].GetDcmSet();if(d==null)continue;var i=d.Options().mod,h=i!="ECG"?f.GetMenuName("mnuContextImg"):f.GetMenuName("mnuContextEcg");!WPACS.wp0bj1.IsMobile&&WPACS.BindContextMenu(e,"rightclick",h)}}function u(f){if(WPACS.wp0bj1.isObject(f)){if(e==null||e[0]!=f[0]){e=f;b==null?R():b.appendTo(e)}var v=e.width()|0,t=e.height()|0,u=b.offset().left-e.offset().left,r=l.offset().top-e.offset().top,d,i=v-2*u;if(l&&l.is(":visible"))d=t-l.height()-2*r;else d=t-2*r;l.width(i);n.ReSize();var q=c[a.isrsv].GetDcmSet();if(q)n.SwitchBar(q.Options().mod,a.opmode);else n.SetSelected(a.opmode);b.height(d);b.width(i);P();b.show();return}x(false);if(e==null)return;j!=null&&j.BindContainer(null);k!=null&&k.BindContainer(null);n!=null&&n.BindContainer(null);o!=null&&o.BindContainer(null);for(var g=0;g<c.length;g++)c[g].BindContainer(null);h!=null&&G();h=null;s=null;l=null;m=null;p=null;b=null;e.empty();e=null}function P(){var i=b.width(),h=b.height(),d=true,e=0;if(!a.thumbh)e=i/h>1.1?1:2;var g=WPACS.wp0bj1.IsMobile?WPACS.CONSTDEF.THUMBWND_SIZE-30:WPACS.CONSTDEF.THUMBWND_SIZE,c="icon-casecade0";if(a.cascade==1)c="icon-casecade1";else if(a.cascade==2)c="icon-casecade2";if(e==1)if(b.layout("panel","west").length==0){b.layout("remove","south");b.layout("add",{region:"west",iconCls:c,split:true,width:g,title:WPACS.CONSTDEF.STR_THUW_TEXT1});m=b.layout("panel","west");m.css("overflow","hidden");k.Options().horiz=false}else d=false;else if(e==2)if(b.layout("panel","south").length==0){b.layout("remove","west");b.layout("remove","east");b.layout("add",{region:"south",iconCls:c,split:true,height:g,title:WPACS.CONSTDEF.STR_THUW_TEXT1});m=b.layout("panel","south");m.css("overflow","hidden");k.Options().horiz=true}else d=false;else if(e==3)if(b.layout("panel","east").length==0){b.layout("remove","south");b.layout("add",{region:"east",iconCls:c,split:true,width:g,title:WPACS.CONSTDEF.THUMBWND_TIPS});m=b.layout("panel","east");m.css("overflow","hidden");k.Options().horiz=false}else d=false;else{m=null;b.layout("remove","west");b.layout("remove","south")}if(m!=null&&d){var l=f.GetMenuName("#mnuThumbPanel"),j=f.GetMenuTitle("mnuThumbPanel"),n='<a class="icon-menu" title="'+j+'" onclick="$(\''+l+"').menu('show',{left:$(this).offset().left,top:$(this).offset().top+$(this).height()});\" ></a>",o=m.panel("header").find("div.panel-tool");o.prepend(n)}b.layout("resize",{width:i,height:h})}function H(){k.BindContainer(m);if(b==null)return;x(false);var l=b.layout("panel","center"),t=l.width(),u=l.height(),y=l.offset().left+10,z=l.offset().top+l.height()-p.height()-60;p.css({left:y,top:z});var v='<div class="srsv" no="%d" style="width:%dpx;height:%dpx;" ></div>',w=l.children("table").length==0;if(!w)switch(i.options.type){case 1:for(var f=i.options.nm[0],e=i.options.nm[1],r=(t-e*3)/e|0,o=(u-f*3)/f|0,d=0,h=0;d<f;d++)for(var j=0;j<e;j++,h++){var s=l.find("div.srsv[no='"+h+"']");s.width(r);s.height(o)}break;case 2:for(var e,f=i.options.nm.length,r,o=(u-f*3)/f|0,d=0,h=0;d<f;d++){e=i.options.nm[d];r=(t-e*3)/e|0;for(var j=0;j<e;j++,h++){var s=l.find("div.srsv[no='"+h+"']");s.width(r);s.height(o)}g+="</tr></table></td></tr>"}break;case 3:for(var f,e=i.options.nm.length,o,r=(t-e*3)/e,d=0,h=0;d<e;d++){f=i.options.nm[d];o=(_myHeight-f*3)/f|0;for(var j=0;j<f;j++,h++){var s=l.find("div.srsv[no='"+h+"']");s.width(r);s.height(o)}}}else{var g='<table cellpadding="0" cellspacing="1" border="0" style="position:absolute;background-color:#000000;">';switch(i.options.type){case 1:for(var f=i.options.nm[0],e=i.options.nm[1],r=(t-e*3)/e|0,o=(u-f*3)/f|0,d=0,h=0;d<f;d++){g+="<tr>";for(var j=0;j<e;j++,h++)g+="<td>"+WPACS.wp0bj1.printf(v,h,r,o)+"</td>";g+="</tr>"}break;case 2:for(var e,f=i.options.nm.length,r,o=(u-f*3)/f|0,d=0,h=0;d<f;d++){e=i.options.nm[d];r=(t-e*3)/e|0;g+="<tr><td>";g+='<table class="normalize" style="border-spacing:0px;" ><tr>';for(var j=0;j<e;j++,h++)g+="<td>"+WPACS.wp0bj1.printf(v,h,r,o)+"</td>";g+="</tr></table></td></tr>"}break;case 3:var f,e=i.options.nm.length,o,r=(t-e*3)/e;g+="<tr>";for(var d=0,h=0;d<e;d++){f=i.options.nm[d];o=(_myHeight-f*3)/f|0;g+="<td>";g+='<table class="normalize" style="border-spacing:0px;" >';for(var j=0;j<f;j++,h++)g+="<tr><td>"+WPACS.wp0bj1.printf(v,h,r,o)+"</td></tr>";g+="</table></td>"}g+="</tr>"}g+="</table>";l.html(g)}for(var d=0;d<i.options.n;d++){var n,s=l.find("div.srsv[no='"+d+"']");if(d>=c.length){n=new WPACS.wp0b12;n.Options().bdcolor=K[d%K.length];n.Options().cascade=a.cascade!=0;n.Options().onEvent=q;n.Options().opmode=a.opmode;c[d]=n}else n=c[d];n.BindContainer(s);n=null}if(c.length>i.options.n){for(var d=i.options.n;d<c.length;d++)c[d].DestroyObj();c.length=i.options.n}if(a.isrsv>=c.length)a.isrsv=0;x(true);C()}function M(){if(m==null)return;var c="icon-casecade0";if(a.cascade==1)c="icon-casecade1";else if(a.cascade==2)c="icon-casecade2";var b=m.panel("header").find("div.panel-icon");b.removeClass("icon-casecade0");b.removeClass("icon-casecade1");b.removeClass("icon-casecade2");b.addClass(c)}function J(c,a){var d=new WPACS.fmtLayOut;if(c!=undefined&&a==undefined){if(!d.SetRows(c))return false}else if(a!=undefined&&c==undefined){if(!d.SetCols(a))return false}else{if(c==undefined&&a==undefined)return false;if(!WPACS.wp0bj1.isNumberType(c))c=parseInt(c);if(!WPACS.wp0bj1.isNumberType(a))a=parseInt(a);if(!d.SetNormal(c,a))return false}if(d.IsEqual(i))return false;i=d;d=null;var e=b?b.layout("panel","center"):null;e&&e.length==1&&e.html("");H();return true}function F(){k.Clear();for(var a=0;a<c.length;a++)c[a].SetDcmSet(null);for(var a=0;a<d.length;a++){d[a].DestroyObj();d[a]=null}d=[];f.SetMenuState(false,"fnOpenDlg","rtview")}function B(c,b,g,e,h){if(!WPACS.wp0bj1.isBooleanType(h))h=false;!h&&F();if(g!=""){var a=new WPACS.wp0b20;a.Options().onCreate=q;var m=e!=undefined?e.toUpperCase():"",j=m=="ECG";j?a.AddEcg(g,b,c):a.AddDicom(g,b,c);d[d.length]=a;k.Add(a);a=null;d.length==1&&window.setTimeout(function(){q(WPACS.CONSTDEF.wpe11,0)},500)}else if(b!=""){var i=!WPACS.wp0bj1.IsMobile&&WPACS.CONSTDEF.AUTOLOAD_SERIES,a=new WPACS.wp0b20;a.Options().onCreate=q;a.AddSeries(b,c,e,true,i);d[d.length]=a;k.Add(a);a=null;d.length==1&&window.setTimeout(function(){q(WPACS.CONSTDEF.wpe11,0)},500)}else if(c!=""){var l=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu6,n=l+"?itype=3&stuuid="+c;$.ajax({type:"GET",url:n,dataType:"xml",async:true,success:function(g){var a=d.length==0;$(g).find("record").each(function(j,h){e=$(h).find("machine").attr("modality");b=$(h).find("series").attr("uid");var i=!WPACS.wp0bj1.IsMobile&&WPACS.CONSTDEF.AUTOLOAD_SERIES,a=new WPACS.wp0b20;a.Options().onCreate=q;a.AddSeries(b,c,e,true,i);d[d.length]=a;var g=e.toUpperCase();(WPACS.wp0b41.IsVisible(g)||g=="SR")&&k.Add(a);a=null;g=="RTSTRUCT"&&f.SetMenuState(true,"fnOpenDlg","rtview")});a&&d.length>0&&window.setTimeout(function(){q(WPACS.CONSTDEF.wpe11,0)},500)}})}}function Q(d){for(var a=0;a<c.length;a++){var b=c[a].GetDcmSet();if(b!=null&&b.Options().srsuid==d)return a}return-1}function r(){var d=c[a.isrsv],e=d.Options().idcmv,b=d.GetDcmSet();return b==null?null:b.GetImage(e)}function y(i){if(h==null)return;var g=$.data(h,i);if(!g){for(var u=0;u<t.length;u++){var K=$.data(h,t[u]);if(!K)continue;K.DestroyObj();h.panel("body").empty();$.removeData(h,t[u])}if(i=="qrystu")g=new WPACS.wpStudyList;else if(i=="histgram")g=new WPACS.wpHistgram;else if(i=="options")g=new WPACS.wpOptions;else if(i=="playbar")g=new WPACS.wpPlayBar;else if(i=="framebar")g=new WPACS.wpFrameBar;else if(i=="view3d")g=new WPACS.wp0b37;else if(i=="d3view")g=new WPACS.wp0b33;else if(i=="fusion")g=new WPACS.wpFusionWnd;else if(i=="prndcm")g=new WPACS.wp0b34;else if(i=="rtview")g=new WPACS.wp0b35;if(!g)return;f.SetMenuState(i=="prndcm","fnAddFilm");g.Options().stuview=z;$.data(h,i,g)}var C=g.Options().tools;if(C!=""){$(C).children("a").unbind("click");$(C).children("a").bind("click",function(){v($(this))})}var p=20,y=true,A=true,B=false,k=e.width(),s=e.height(),q,j,n=.8*k|0,o=.95*s|0;if(i=="histgram"){var w=r(),L=w!=null?w.GetHistgram():null;g.SetHistgram(L);n=k+p>300?300:k-p;o=s+p>300?300:s-p;q=k-n-p;j=p}else if(i=="options"){n=k>490?490:k;o=s>250?250:s;y=A=false;B=true}else if(i=="playbar"||i=="framebar"){if(i=="playbar"){var O=c[a.isrsv].Options().ipage,M=c[a.isrsv].GetPages();g.SetPages(M,O)}else{var w=r(),J=0,G=0;if(w){J=w.Options().iframe;G=w.GetFrames()}g.SetFrames(G,J)}o=110;n=265;if(b.layout("panel","south").length!=0){q=1;j=m.panel("options").top+b.offset().top;if(s-j<o)j=s-o}else{j=50;q=k-n-p}y=true;A=false;B=true}else if(i=="fusion"){n=k+p>260?260:k-p;q=k-n-p;o=80;j=50;y=A=false}else if(i=="view3d"||i=="d3view"){var x=c[a.isrsv].GetDcmSet(),E=x?x.Options().srsuid:"",N=E!=""?x.GetImage(0).Options().stuuid:"",P=x?x.Options().mod:"";E!=""&&g.View3d(E,N,P);q=0;j=l.is(":visible")?45:1;n=k;o=s-j}else if(i=="rtview"){for(var I="",H="",F="",u=0;u<d.length;u++){var D=d[u].GetImage(0);if(D==null)continue;if(d[u].Options().mod=="RTSTRUCT")I=D.Options().imguid;else if(d[u].Options().mod=="RTPLAN")H=D.Options().imguid;else if(d[u].Options().mod=="RTDOSE")F=D.Options().imguid}g.wfn18(I,H,F);g.Action("opmode",a.opmode);g.Action("textv",a.textv);q=0;j=l.is(":visible")?45:1;n=k;o=s-j}if(!q&&!j){q=(k-n)/2|0;j=(s-o)/2|0}q+=e.offset().left;j+=e.offset().top;h.window({title:g.Options().title,iconCls:g.Options().icon,minimizable:false,shadow:false,tools:C,collapsible:y,maximizable:A,modal:B,width:n,height:o,left:q,top:j,onResize:function(){g.BindContainer(h.panel("body"))},onBeforeClose:function(){if(!g.onBeforeClose())return false;f.SetMenuState(false,"fnAddFilm");$(this).window("expand");return true}});h.window("open");B&&(i=="playbar"||i=="framebar")&&$(".window-mask").css({opacity:0})}function A(j){var g=c[j].GetDcmSet();if(g==null)return;a.isrsv=j;k.SetSelected(g.Options().srsuid);var e=g.Options().mod,h=o.Options().srsmod!="ECG"?"":"ECG";if(e!="ECG"){f.SetMenuState(true,"fnOpenDlg","histgram");f.SetMenuState(true,"fnOpenDlg","prndcm");var b=e=="CT"||e=="MR";f.SetMenuState(b,"fnScout","show1");b=WPACS.wp0bj1.Canvas&&a.view3d&&b&&g.Length()>10;f.SetMenuState(b,"fnOpenDlg","view3d");f.SetMenuState(b,"fnOpenDlg","d3view");b=l(e);f.SetMenuState(b,"fnPetct","");b=m(e);f.SetMenuState(b,"fnXasub","");h=="ECG"&&n.SwitchBar(e,a.opmode)}else if(h!=e){f.SetMenuState(false,"fnOpenDlg","histgram");f.SetMenuState(false,"fnOpenDlg","view3d");f.SetMenuState(false,"fnOpenDlg","prndcm");f.SetMenuState(false,"fnScout","show1");n.SwitchBar(e,a.opmode)}var i=r();f.SetMenuState(i&&i.GetFrames()>1,"fnOpenDlg","framebar");o.Options().srsmod=e;E();function l(b){if(b=="CT"){for(var a=0;a<d.length;a++)if(d[a].Options().mod=="PT")return true}else if(b=="PT")for(var a=0;a<d.length;a++)if(d[a].Options().mod=="CT")return true;return false}function m(c){if(c!="XA")return false;if(!WPACS.wp0bj1.Canvas||a.vwmode==WPACS.CONSTDEF.VMODE_WADO)return false;var b=r();return b&&b.GetFrames()>1}}function E(){var d=c[a.isrsv].Options().ipage,b=c[a.isrsv].GetPages();k.SetPageInfo(d,b);D("localizer")}function N(b){b.Options().textv=a.textv;b.Options().metav=a.metav;b.SetViewMode(a.vwmode)}function v(j){if(j.disabled)return;var k="",b="";if(j.target){k=!WPACS.wp0bj1.isUndefined(j.target.attributes.fnid)?j.target.attributes.fnid.value:"";b=!WPACS.wp0bj1.isUndefined(j.target.attributes.vl)?j.target.attributes.vl.value:""}else{k=j.attr("fnid");b=j.attr("vl")}function s(f){for(var b="",a=0;a<c.length;a++){var e=c[a].GetDcmSet();if(!e||e.Options().mod!=f)continue;b=e.Options().srsuid;break}if(b!="")return b;for(a=0;a<d.length;a++){if(d[a].Options().mod!=f)continue;b=d[a].Options().srsuid;break}return b}function w(h){var f=c[a.isrsv],b,e=f.GetDcmSet();if(e==null)return;if(h=="series")for(var d=0;d<e.Length();d++){b=e.GetImage(d);b!=null&&n.AddDicom(b)}else if(h=="page")for(var i=f.Options().ipage,g=f.GetFormat().options.n,d=i*g;d<i*g+g;d++){b=e.GetImage(d);b!=null&&n.AddDicom(b)}else{b=e.GetImage(f.Options().idcmv);b!=null&&n.AddDicom(b)}}switch(k){case"fnLayout":k="srsLayout";case"srsLayout":case"stuLayout":var i=b.split(",");g(k,{r:i[0],c:i[1]});return;case"fnZoom":var i=b.split(","),A=parseInt(i[0]),z=i.length>1?parseInt(i[1]):0;g("zoom",{iratio:A,dratio:z});return;case"fnCascade":g("cascade",parseInt(b));return;case"fnOpmode":g("opmode",parseInt(b));return;case"fnReload":g("reload",b);return;case"fnInvert":g("invert");return;case"fnFlip":g("flip",b=="1");return;case"fnRotate":g("rotate",b=="1");return;case"fnPsuedo":g("psuedo",parseInt(b));return;case"fnEnhance":var i=b.split(",");g("enhance",{n:parseInt(i[0]),f:parseFloat(i[1])});return;case"fnPetct":var m="",v=c[a.isrsv].GetDcmSet(),t=v?v.Options().mod:"";if(t=="CT")m=s("PT");else if(t=="PT")m=s("CT");if(m=="")return;g("petct",m);WPACS.CONSTDEF.FUSION_MODE!=0&&y("fusion");return;case"fnXasub":g("xasub","");return;case"fnFumode":if(WPACS.CONSTDEF.FUSION_MODE==0)WPACS.CONSTDEF.FUSION_MODE=1;else WPACS.CONSTDEF.FUSION_MODE=0;return;case"fnVwmode":g("vwmode",b==""?undefined:parseInt(b));var q=a.vwmode!=WPACS.CONSTDEF.VMODE_WADO?WPACS.CONSTDEF.STR_VMODE_TEXT1:WPACS.CONSTDEF.STR_VMODE_TEXT2;f.SetMenuText(q,"fnVwmode",undefined);return;case"fnTextv":g("textv",undefined);var q=a.textv?WPACS.CONSTDEF.STR_TEXTV_HIDE:WPACS.CONSTDEF.STR_TEXTV_SHOW;f.SetMenuText(q,"fnTextv",undefined);return;case"fnMetav":g("metav",undefined);var q=a.metav?WPACS.CONSTDEF.STR_METAV_HIDE:WPACS.CONSTDEF.STR_METAV_SHOW;f.SetMenuText(q,"fnMetav",undefined);return;case"fnWwwl":if(b=="")if(!(b=prompt("\u8bf7\u8f93\u5165\u7a97\u5bbd \u7a97\u4f4d\u503c","")))return;var B=/[ ,;]/,r=b.split(B);r.length==2&&g("wwwl",{ww:parseInt(r[0]),wc:parseInt(r[1]),dw:0,dc:0});return;case"fnOpenDlg":y(b);return;case"fnCache":localStorage.clear();WPACS.wp0b16.Clear();return;case"fnFloatBtn":if(p.is(":visible")){p.hide();l.show()}else{p.show();WPACS.CONSTDEF.AUTOHIDETBAR&&l.hide()}u(e);return;case"fnScout":D(b);return;case"fnPage":g("ipage",b);return;case"fnFrame":g("iframe",b);return;case"fnSaveAs":var i=b.split(","),x=i[0],o=i.length>1?eval(i[1]):null;if(o==null)o=function(a){if(a==null)return;a=a.replace(/^data:image\/(png|jpg)/,"data:image/octet-stream");document.location.href=a};I(o,x);return;case"fnOpenUrl":b!=""&&window.open(b,"_blank");return;case"fnAddFilm":if(h){var n=$.data(h,"prndcm");!WPACS.wp0bj1.isUndefined(n)&&w(b)}return}k!=""&&g(k,b)}function I(e,d){var h=2,f="image/png";if(d==1||d=="1")f="image/jpg";else if(WPACS.wp0bj1.isStringType(d)&&d.toLowerCase()=="jpg")f="image/jpg";if(h){var g=b.layout("panel","center");if(h==1)g=g.find("div.srsv[no='"+a.isrsv+"']");html2canvas(g).then(function(b){var a=b.toDataURL(f);e&&e(a);a=null})}else{var i=c[a.isrsv].SaveAsImg(d);e&&e(i);i=null}}function D(p){function i(){var g=b.width(),d=b.height(),n=j.Options().showall?"icon-localizer1":"icon-localizer0",a,c,h,i;if(g/d>1.1){a=WPACS.CONSTDEF.THUMBWND_SIZE;c=d>400?400:d;i=e.offset().top+10;h=e.offset().left+e.width()-a-10;j.Options().horiz=false}else{c=WPACS.CONSTDEF.THUMBWND_SIZE;a=g>400?400:g;h=e.offset().left;i=e.offset().top+10;j.Options().horiz=true}s.window({title:WPACS.CONSTDEF.STR_SCOW_TEXT1,iconCls:n,maximizable:false,minimizable:false,modal:false,shadow:false,left:h,top:i,width:a,height:c,onResize:function(){j.BindContainer(s.panel("body"))},onBeforeClose:function(){$(this).window("expand");return true}});var l=f.GetMenuName("#mnuScoutPanel"),k=f.GetMenuTitle("mnuScoutPanel"),m='<a class="icon-menu" title="'+k+'" onclick="$(\''+l+"').menu('show',{left:$(this).offset().left,top:$(this).offset().top+$(this).height()});\" ></a>",o=s.panel("header").find("div.panel-tool");o.prepend(m);s.window("open")}function h(){var b=j.Options().showall?"icon-localizer1":"icon-localizer0",a=s.panel("header").find("div.panel-icon");a.removeClass("icon-localizer0");a.removeClass("icon-localizer1");a.addClass(b)}function n(){j.Clear();var b=c[a.isrsv].GetDcmSet();if(b==null&&d.length>0)b=d[0];if(b==null||b.Length==0)return;var e=b.GetImage(0).Options().stuuid,f=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu5;$.ajax({type:"GET",dataType:"json",async:false,url:f+"?requesttype=JSON&findscout=&objectuid="+e,success:function(b){for(var a=0;a<b.length;a++)j.AddScout(b[a].uid,b[a].srsuid,e)}})}function o(){var a=r();if(a==null)return;var b=a.Options().imguid,c=a.Options().srsuid;j.ShowLocalize(c,b)}switch(p){case"show":i();return;case"show1":i();case"auto":n();case"localizer":o();return;case"clear":j.Clear();return;case"add":var g=r();if(g==null)return;var k=g.Options().imguid,l=g.Options().srsuid,m=g.Options().stuuid;!j.DelScout(k,l,m)&&j.AddScout(k,l,m);return;case"view0":j.ShowSelected(true);h();return;case"view1":j.ShowSelected(false);h();return}}function q(i,b){switch(i){case WPACS.CONSTDEF.wpe11:var d=k.Get(b);if(d==null)return true;var j=Q(d.Options().srsuid);if(j==-1){var h=d.Options().mod;if(h=="RTSTRUCT")y("rtview");else if(WPACS.wp0b41.IsVisible(h)||h=="SR"){d.StartLoad();for(var e=a.isrsv,f=0;f<c.length;f++)if(c[f].GetDcmSet()==null){e=f;break}c[e].SetDcmSet(d);C();if(WPACS.wp0bj1.Browser.Versions.ie)A(e);else window.setTimeout(function(a){A(a)},200,e)}}else d.ToggleLoad();return true;case WPACS.CONSTDEF.wpe3:g("ipage",b);return true;case WPACS.CONSTDEF.wpe4:E();return true;case WPACS.CONSTDEF.wpe5:g("zoom",b);return true;case WPACS.CONSTDEF.wpe6:g("move",b);return true;case WPACS.CONSTDEF.wpe7:g("wwwl",b);return true;case WPACS.CONSTDEF.wpe8:g("rotate",b);return true;case WPACS.CONSTDEF.wpe9:if(a.cascade!=2||c.length==1)return false;g("ipage",b>0?-1:-2);return true;case WPACS.CONSTDEF.wpe12:N(b);return true;case WPACS.CONSTDEF.wpe13:c[a.isrsv].ViewImage(b.imguid,b.srsuid);return true;case WPACS.CONSTDEF.wpe14:y(b);return true}return false}$.ajax({type:"GET",dataType:"text",async:true,url:WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu6,success:function(a){if(!a){WPACS.CONSTDEF.STR_IMPL_MARK="WPACS";WPACS.RegName="\u672a\u6ce8\u518c"}else WPACS.RegName=a}});f.InitMainMenu(v);n.Options().stuview=z;o.Options().stuview=z;j.Options().onEvent=q;k.Options().onEvent=q;w&&w.noquery&&f.SetMenuState(false,"fnOpenDlg","qrystu");w&&w.nodcmdown&&f.SetMenuState(false,"dcmdown",undefined);f.SetMenuState(false,"fnOpenDlg","view3d");f.SetMenuState(false,"fnOpenDlg","d3view");WPACS.wp0bj1.isObject(L)&&u(L)};(function(a){a.fn.wpDcmview=function(c,d){if(typeof c=="string")return a.fn.wpDcmview.methods[c](this,d);c=c||{};return this.each(function(){var e=a.data(this,"wpdcmv");if(!e){var d=a.fn.wpDcmview.parseOptions(this),f=a.extend({},a.fn.wpDcmview.defaults,d,c),g=new WPACS.wp0b15(a(this),f);a.data(this,"wpdcmv",{options:f,stuview:g});d.open&&b(this,d.open)}else a.extend(e.options,c)})};function b(f,b){var e=a.data(f,"wpdcmv");if(e){var c=e.stuview,d=!!b.append?b.append:false;if(b.imguid)c.ViewImage(b.stuuid,b.srsuid,b.imguid,b.modality,d);else if(b.srsuid)c.ViewSeries(b.stuuid,b.srsuid,b.modality,d);else b.stuuid&&c.ViewStudy(b.stuuid,d)}}a.fn.wpDcmview.methods={options:function(c){var b=a.data(c[0],"wpdcmv");return b?b.options:{}},resize:function(c,b){return c.each(function(){var c=a.data(this,"wpdcmv");if(c)!b?c.stuview.ReSize():c.stuview.SetSize(b.width,b.height)})},open:function(c,a){return c.each(function(){b(this,a)})},saveas:function(c,b){return c.each(function(){var c=a.data(this,"wpdcmv"),d=b&&b.itype?b.itype:0,e=b&&b.onsaved?b.onsaved:null;c&&c.stuview.SaveAsImg(e,d)})},action:function(c,b){return c.each(function(){var c=a.data(this,"wpdcmv");if(c&&b&&b.fnid){var d=b.fnid,e=b.vl;if(d.substr(0,2)=="fn")c.stuview.Action(a('<a fnid="'+d+'" vl="'+e+'" ></a>'));else c.stuview.Action(d,e)}})},getobj:function(d,b){if(!(typeof b==="number"&&isFinite(b)))b=0;if(b>=0&&b<d.length){var c=a.data(d[b],"wpdcmv");return c?c.stuview:null}return null}};a.fn.wpDcmview.parseOptions=function(b){var c=a(b);return a.extend({},a.parser.parseOptions(b,["thumbh","toolbh","vwmode","view3d","noquery","nodcmdown"]))};a.fn.wpDcmview.defaults={thumbh:false,toolbh:false,view3d:true};a.parser.plugins.push("wpDcmview")})(jQuery);$(document).ready(function(){$(document).bind("contextmenu",function(){return false});document.onmousemove=function(b){var a=b||event;a.cancelBubble=true;if(a.preventDefault)a.preventDefault();else a.returnValue=false}});var WPACS=WPACS||{};WPACS.wp0b22=function(w){var a={fx:1,fy:1,z:[],x0:0,y0:0,pp:"HFS",min:0,max:0,scaling:1,doseunit:100,onStatus:w?w:null};this.Options=function(){return a};this.DestroyObj=function(){this.FreeData();a.z=[];a.onStatus=null;a={}};this.FreeData=function(){if(c!=null&&h==WPACS.CONSTDEF.wps1)c.readyState!=undefined?c.abort():(c.src="");c=null;h=WPACS.CONSTDEF.wps0;b=null};this.IfLoaded=function(){return h==WPACS.CONSTDEF.wpu2};this.IfLoading=function(){return c!=null&&h==WPACS.CONSTDEF.wps1};this.Init=function(i,c,b,h){this.FreeData();g=i;f=c;e=h;d=b;a.fx=a.fy=1;a.z=[];a.min=a.max=0;a.scaling=1;a.doseunit=100;return d!=0};this.wfn13=function(a,c,d,b){this.FreeData();var e=r(a,b,undefined);y=(new Date).getTime();if(e!=""){o(e);WPACS.CONSTDEF.FAILRELOAD>0&&window.setTimeout(function(){h==-1&&t(a,c,d,b)},WPACS.CONSTDEF.FAILRELOAD)}else t(a,c,d,b)};this.wfn14=function(b){var a=z(b);return a?{w:g,h:f,data:a}:null};this.wfn15=function(c){var a=A(c),b=m();return a?{w:g,h:b,data:a}:null};this.wfn16=function(c){var a=B(c),b=m();return a?{w:f,h:b,data:a}:null};this.wfn17=function(t,u,d){if(b==null||a.z.length!=e)return 0;var s,r,i,w,m,x,v=k();if(v){s=a.z[0];r=a.z[a.z.length-1]}else{r=a.z[0];s=a.z[a.z.length-1]}i=a.x0;w=i+a.fx*g;m=a.y0;x=m+a.fy*f;if(d<s||d>r||(t<i||t>w)||(u<m||u>x))return 0;var c=0,h=-1;if(v){for(;c<a.z.length-1;c++)if(d>=a.z[c]&&d<a.z[c+1])break}else for(;c<a.z.length-1;c++)if(d<=a.z[c]&&d>a.z[c+1])break;if(Math.abs(d-a.z[c])>.5)h=c+1;var q,o=(t-i)/a.fx,p=(u-m)/a.fy;if(h!=-1){var C=Math.abs(a.z[h]-a.z[c]),y=Math.abs(d-a.z[c])/C,z=1-y,A=n(c,o,p),B=n(h,o,p);q=A*z+B*y}else q=n(c,o,p);return q;function n(u,o,p){var h=l(),v=e+3>>2,c=o|0,d=p|0,r=j(u,v,h),a=r+d*h+c;if(c<g-1&&d<f-1){var i=o-c,n=1-i,q=a+1,w=b[a]*n+b[q]*i,m=r+d*h+c+h,t=m+1,x=b[m]*n+b[t]*i,k=p-d,s=1-k;return w*s+x*k}else if(c<g-1){var i=o-c,n=1-i,q=a+1;return b[a]*n+b[q]*i}else if(d<f-1){var k=p-d,s=1-k,m=a+h;return b[a]*s+b[m]*k}else return b[a]}};function l(){return g*4}function m(){var b=a.fx;return Math.abs(a.z[a.z.length-1]-a.z[0])/b+1|0}function x(){if(b==null||e<1)return null;for(var d=2147483647,c=0-2147483647,j=l(),i=0;i<e;i++)for(var k=(i>>2)*f*j+(i&3)*g,m=0;m<f;m++){for(var o=k,n=0;n<g;n++){var h=b[o++];if(h>c)c=h;if(h<d)d=h}k+=j}a.max=c;a.min=d;return{max:c,min:d}}var s=false;function j(b,d,c){if(s)b=a.z.length-1-b;return(d-1-(b>>2))*f*c+(b&3)*g}function k(){return a.pp&&a.pp.substr(0,2)=="FF"}function C(){var b=a.z.length;if(k()){if(a.z[0]<a.z[b-1])return false;a.z.sort(function(a,b){return a-b})}else{if(a.z[0]>a.z[b-1])return false;a.z.sort(function(a,b){return b-a})}return true}function n(c){if(k()){for(var b=0;b<a.z.length-1;b++)if(c>=a.z[b]&&c<a.z[b+1])return[b,b+1]}else for(var b=0;b<a.z.length-1;b++)if(c<=a.z[b]&&c>a.z[b+1])return[b,b+1];return[a.z.length-1,-1]}function B(E){if(b==null||e<2)return null;if(a.z.length!=e)return null;var q="u8";if(d>8&&d<=16)q="u16";else if(d==32)q="u32";for(var o=f,w=m(),h=WPACS.wp0bj8(o*w,q),u=(E-a.x0)/a.fx,r=0,v=a.z[0],C=a.fx*(k()?1:-1),y=0;y<w;y++,v+=C){var s=n(v);if(s[0]!=-1){var i=s[0],t=s[1];if(t!=-1)for(var D=Math.abs(a.z[t]-a.z[i]),x=Math.abs(v-a.z[i])/D,z=1-x,c=0;c<o;c++){var A=p(i,u,c),B=p(t,u,c);h[r++]=A*z+B*x}else for(var c=0;c<o;c++)h[r++]=p(i,u,c)}else for(var c=0;c<o;c++)h[r++]=0}return h;function p(i,f,p){var d=l(),m=e+3>>2,c=f|0,a=j(i,m,d);a+=p*d+c;if(c<g-1){var h=f-c,k=1-h,n=b[a],o=b[a+1];return n*k+o*h}else return b[a]}}function A(E){if(b==null||e<2)return null;if(a.z.length!=e)return null;var q="u8";if(d>8&&d<=16)q="u16";else if(d==32)q="u32";for(var o=g,w=m(),h=WPACS.wp0bj8(o*w,q),u=(E-a.y0)/a.fy,r=0,v=a.z[0],C=a.fx*(k()?1:-1),y=0;y<w;y++,v+=C){var s=n(v);if(s[0]!=-1){var i=s[0],t=s[1];if(t!=-1)for(var D=Math.abs(a.z[t]-a.z[i]),x=Math.abs(v-a.z[i])/D,z=1-x,c=0;c<o;c++){var A=p(i,c,u),B=p(t,c,u);h[r++]=A*z+B*x}else for(var c=0;c<o;c++)h[r++]=p(i,c,u)}else for(var c=0;c<o;c++)h[r++]=0}return h;function p(i,p,g){var c=l(),m=e+3>>2,d=g|0,a=j(i,m,c);a+=d*c+p;if(d<f-1){var h=g-d,k=1-h,n=b[a],o=b[a+c];return n*k+o*h}else return b[a]}}function z(A){if(b==null||e<2)return null;if(a.z.length!=e)return null;var q=n(A);if(q[0]==-1)return null;var i=q[0],r=q[1],o="u8";if(d>8&&d<=16)o="u16";else if(d==32)o="u32";var t=g,s=f,p=WPACS.wp0bj8(t*s,o),c=l(),w=0,u=e+3>>2;if(r==-1)for(var h=j(i,u,c),k=0;k<s;k++){for(var x=h,m=0;m<t;m++)p[w++]=b[x++];h+=c}else for(var z=Math.abs(a.z[r]-a.z[i]),y=(z-Math.abs(A-a.z[i]))/z,C=1-y,h=j(i,u,c),v=j(r,u,c),k=0;k<s;k++){for(var x=h,B=v,m=0;m<t;m++)p[w++]=b[x++]*y+b[B++]*C|0;h+=c;v+=c}return p}function r(d,e,c){var b=WPACS.wp0b16.MakeKey("rtdose",d,e);if(WPACS.wp0bj1.ifStorage()&&!WPACS.wp0bj1.NoLocalStorage)if(c==undefined)return localStorage[b]?localStorage[b]:"";else localStorage[b]=c;else{a.pngvkey==undefined&&$.extend(a,{pngvkey:"",pngvurl:""});if(c==undefined)return b==a.pngvkey?a.pngvurl:"";else{a.pngvkey=b;a.pngvurl=c}}}function q(){(window.URL||window.webkitURL).revokeObjectURL(this.src);b=this.PixelData;this.DestroyObj();s=C();i(WPACS.CONSTDEF.wpu2)}function o(b){var a=false;c=a?new Image:new XMLHttpRequest;i(WPACS.CONSTDEF.wps1);c.onerror=v;c.onabort=u;c.onprogress=p;if(a){c.onload=q;c.SetSource(b,false,d==32?-32:d,false)}else{c.open("GET",b,true);c.responseType="blob";c.onload=function(){if(this.status==200){var a=new Image;a.onload=q;a.SetSource((window.URL||window.webkitURL).createObjectURL(this.response),false,d==32?-32:d,false)}else h=-1};c.send()}}function t(k,g,h,f){c=new XMLHttpRequest;i(WPACS.CONSTDEF.wps1);var e=true,m="RTDOSE",j=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu4,a="",l=j+"?requesttype="+m+"&objectuid="+k;if(WPACS.wp0bj1.isStringType(g)&&g!="")a+="&srsuid="+g;if(WPACS.wp0bj1.isStringType(h)&&h!="")a+="&stuuid="+h;if(WPACS.wp0bj1.isStringType(f)&&f!="")a+=f;if(!e){l+=a;a=""}c.open(e?"POST":"GET",l,true);e&&c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.responseType="arraybuffer";c.onerror=v;c.onabort=u;c.onprogress=p;c.onload=function(){if(this.status==200){var c=this.response;if(d>8&&d<=16)b=new Uint16Array(c);else if(d==32)b=new Uint32Array(c);else b=new Uint8Array(c);i(WPACS.CONSTDEF.wpu2)}else if(this.status==202){var a=this.getResponseHeader("vpath");if(a.substr(0,3).toLowerCase()=="&p=")a=j+"?requesttype=IMGPATH"+a;r(k,f,a);o(a);a==WPACS.CONSTDEF.DATAFAILED&&i(WPACS.CONSTDEF.wpu2)}else{i(-3);window.console&&console.log("[DOSEDATA] \u83b7\u53d6\u5242\u91cf\u6570\u636e\u5931\u8d25\uff0cstatus: "+this.status)}};e?c.send(a):c.send()}function i(b){h=b;if(h==WPACS.CONSTDEF.wpu2)a.max==0&&a.min==0&&x();if(a.onStatus!=null){var d=h==WPACS.CONSTDEF.wps1&&c.readyState!=undefined?0:-1;a.onStatus(h,d)}if(h!=WPACS.CONSTDEF.wps1)c=null}function v(){i(-1);window.console&&console.log("[DOSEDATA] \u8bf7\u6c42\u53d1\u751f\u9519\u8bef!")}function u(){i(-2);window.console&&console.log("[DOSEDATA] \u8c03\u7528abort()\u65b9\u6cd5\u7ec8\u6b62!")}function p(b){if(a.onStatus==null||!b.lengthComputable)return;if(this.status!=200)return;var c=100*b.loaded/b.total|0;a.onStatus(WPACS.CONSTDEF.wps1,c)}var g=0,f=0,d=0,e=0,b=null,c=null,h=WPACS.CONSTDEF.wps0,y=0};WPACS.wp0b23=function(E){var b={textv:true,rtssuid:"",planuid:"",doseuid:"",thickness:1,rxdose:0,maxdose:0,planname:"",rtinfo:null},a=null,d={dvh0:null,dvh1:null,sidx:0},k=new WPACS.wp0b20,g=new WPACS.wp0b12,e=new WPACS.wp0b24,m=new WPACS.wp0b30(false),F=this;this.DestroyObj=function(){S()};this.GetContainer=function(){return f};this.BindContainer=function(a){p(a)};this.ReSize=function(){p(f)};this.SetSize=function(b,a){if(f==null)return;f.width(b);f.height(a);p(f)};this.Options=function(){return b};this.wfn18=function(c,i,f){k.Clear();b.rtinfo=null;d.dvh0=d.dvh1=null;d.sidx=0;a!=null&&a.DestroyObj();a=null;if(l==null)return;b.rtssuid=c;b.planuid=i;b.doseuid=f;if(b.rtssuid=="")return;l.show();h("\u6b63\u5728\u4e0b\u8f7dROISETS...");var j=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu4,m=j+"?requesttype=RTINFO&objectuid="+c+"&rtplan="+i+"&rtdose="+f;$.ajax({type:"GET",url:m,dataType:"xml",async:true,xhr:function(){var a=new XMLHttpRequest;a.addEventListener("progress",function(a){if(!a.lengthComputable)return;var b=100*a.loaded/a.total|0;h("\u6b63\u5728\u4e0b\u8f7dROISETS..."+b+"%")},false);return a},success:function(a){h("\u6b63\u5728\u89e3\u6790ROISETS\u6570\u636e...");$(a).find("study").each(function(c,a){var b=$(a).attr("uid");$(a).find("series").each(function(d,a){var c=$(a).attr("uid");$(a).find("image").each(function(e,d){var a=$(d).attr("uid");k.AddDicom(a,c,b)})})});b.rtinfo=a;k.SortSlice(2,true);window.setTimeout(function(){g.SetPage(0)},100);H();l.hide();h("");e.Refresh();if(I())window.setTimeout(function(){N()},100);else window.setTimeout(function(){u()},100)},error:function(){l.hide();b.rtssuid=b.planuid=""}})};this.Action=function(a,b){typeof a=="string"?C(a,b):W(a)};function C(c,a){switch(c){case"dvhswitch":if(d.dvh0){d.sidx=d.sidx?0:1;o()}return;case"dcminfo":case"dcmdown":case"delmeta":case"petct":case"xasub":case"enhance":case"vwmode":case"ipage":case"metav":return;case"textv":if(WPACS.wp0bj1.isBooleanType(a))b.textv=a;else b.textv=!b.textv;a=b.textv}g&&g.Action(c,a);m&&m.Action(c,a)}var f=null,c=null,n=null,i=null,l=null;function V(){var a='<div class="rtview" '+WPACS.CONSTDEF.STR_SETS1+' ><label style="position:absolute;z-index:999;top:10px;width:150px;" align="right"></label></div><img class="wloading" src="./webpacs/images/loading.gif" >';f.append(a);c=f.children("div.rtview");n=c.children("label");l=f.children("img.wloading");c.layout({border:false});c.layout("add",{region:"center",noheader:true,border:false,onResize:R});WPACS.wp0bj1.Browser.Mobile.iOS&&c.bind("touchmove",function(a){a.preventDefault()})}function S(){r(false);a!=null&&a.DestroyObj();a=null;g!=null&&g.DestroyObj();g=null;m!=null&&m.DestroyObj();m=null;k!=null&&k.DestroyObj();k=null;e!=null&&e.DestroyObj();e=null;b.rtinfo=null;b.DVH=[];d=null;b={};F=null;i=null;l=null;n=null;if(c!=null){c.remove();c=null}if(f!=null){f.empty();f=null}}function r(a){if(c==null)return;a}function p(a){if(WPACS.wp0bj1.isObject(a)){if(f==null||f[0]!=a[0]){f=a;c==null?V():c.appendTo(f)}var j=f.width(),h=f.height(),d=j,b=h;c.height(b);c.width(d);T();c.show();return}r(false);if(f==null)return;g!=null&&g.BindContainer(null);e!=null&&e.BindContainer(null);i=null;l=null;n=null;c=null;f.empty();f=null}function T(){var g=c.width(),f=c.height(),a=3,b="\u5de5\u5177\u680f",d="";if(a==1){if(c.layout("panel","west").length==0){e.Options().horiz=false;i=null;c.layout("remove","south");c.layout("add",{region:"west",iconCls:d,split:false,width:WPACS.CONSTDEF.TPANELPRN_SIZE,title:b});i=c.layout("panel","west");i.css("overflow","hidden")}}else if(a==2){if(c.layout("panel","south").length==0){e.Options().horiz=true;i=null;c.layout("remove","west");c.layout("remove","east");c.layout("add",{region:"south",iconCls:d,split:true,height:WPACS.CONSTDEF.TPANELPRN_SIZE,title:b});i=c.layout("panel","south");i.css("overflow","hidden")}}else if(a==3){if(c.layout("panel","east").length==0){e.Options().horiz=false;i=null;c.layout("remove","south");c.layout("add",{region:"east",iconCls:d,split:false,width:WPACS.CONSTDEF.TPANELPRN_SIZE,title:b});i=c.layout("panel","east");i.css("overflow","hidden")}}else{i=null;c.layout("remove","east");c.layout("remove","west");c.layout("remove","south")}c.layout("resize",{width:g,height:f})}function R(){e.BindContainer(i);if(c==null)return;r(false);var a=c.layout("panel","center"),d=a.width(),f=a.height(),h=a.position().left+d-n.width()-10;n.css({left:h});var q,k,l,p;l=p=0;q=d-5;k=f-2;var b=a.children("div.easyui-tabs");if(b.length==0){var j='<div class="easyui-tabs"><div title="2DView" style="padding:2px"></div><div title="DVH" style="padding:5px"></div><div title="3DView" style="padding:2px"></div></div>';a.html(j);b=a.children("div.easyui-tabs");b.tabs({fit:true,onSelect:function(){o()}});b.tabs("getTab",0).panel({onResize:function(){g.BindContainer($(this))}});b.tabs("getTab",1).panel({onResize:function(){o()}});b.tabs("getTab",2).panel({onResize:function(){m.BindContainer($(this))}})}r(true)}function h(a){n&&n.text(a)}function U(f,g){if(f==WPACS.CONSTDEF.wpu2){var j=a.Options().scaling,i=a.Options().doseunit;b.maxdose=a.Options().max*i*j;e.wfn19(b.rxdose,b.maxdose)}var d=c?c.layout("panel","center").children("div.easyui-tabs"):null;if(d&&d.length>0)if(f==WPACS.CONSTDEF.wpu2){h("");d.tabs("getTab",1).html("");var k=d.tabs("getSelected");d.tabs("getTabIndex",k)==1&&o()}else if(f==WPACS.CONSTDEF.wps1)if(WPACS.wp0bj1.isNumberType(g)&&g>0)h("\u6b63\u5728\u4e0b\u8f7d\u5242\u91cf\u6570\u636e..."+g+"%");else h("\u6b63\u5728\u4e0b\u8f7d\u5242\u91cf\u6570\u636e...\u8bf7\u7b49\u5f85");else h("\u4e0b\u8f7d\u5242\u91cf\u6570\u636e\u5931\u8d25:(")}function O(){var f=g.Options().ipage,d=g.GetPages();e.SetPageInfo(f,d);var b=c.layout("panel","center"),a=b.children("div.easyui-tabs"),h=a.tabs("getSelected");a.tabs("getTabIndex",h)==0&&A()}function M(a){a.Options().textv=b.textv;if(a.Options().objname=="slice")a.Options().vimgHandle=K;else a.Options().vimgHandle=J}function W(a){if(a.disabled)return;var c="",g="";if(a.target){c=!WPACS.wp0bj1.isUndefined(a.target.attributes.fnid)?a.target.attributes.fnid.value:"";g=!WPACS.wp0bj1.isUndefined(a.target.attributes.vl)?a.target.attributes.vl.value:""}else{c=a.attr("fnid");g=a.attr("vl")}switch(c){case"fnCheckROI":case"fnShowIso":o();return;case"fnShowVol":var f=g,h=a.text(),i=h+f,b=null;if(d.dvh0&&d.sidx==0)b=d.dvh0[i];else if(d.dvh1)b=d.dvh1[i];if(!b){var j=Q(f);e.SetRoiInfo({no:f,name:h,vol:j})}else e.SetRoiInfo({no:f,name:h,vol:b.vol,mindose:b.mindose,maxdose:b.maxdose,meandose:b.meandose});return}c!=""&&C(c,g)}function q(b,a){switch(b){case WPACS.CONSTDEF.wpe4:O();return true;case WPACS.CONSTDEF.wpe12:M(a);return true;case WPACS.CONSTDEF.wpe3:g.SetPage(a);return true}return false}function o(){var i=b.rtinfo;if(i==null)return;var g=c.layout("panel","center"),f=g.children("div.easyui-tabs"),e=f.tabs("getSelected");if(f.tabs("getTabIndex",e)==1)if(d.dvh0&&d.sidx==0)G(e);else if(a!=null){if(a.IfLoaded()){l.show();h("\u6b63\u5728\u8ba1\u7b97DVH\u6570\u636e...");window.setTimeout(w,50,e)}}else e.html("\u5242\u91cf\u6570\u636e\u672a\u4e0b\u8f7d\u6216\u6ca1\u6709\u5242\u91cf\u6570\u636e");else if(f.tabs("getTabIndex",e)==2)if(m.Options().status==0)m.SetDcmSet(k);else m.Action("refresh",true);else{A();k.Action("refresh",true)}}function j(c,b){var a=$(c).find(b);return a.length>0?a[0]:null}var v,s,t=null,z=null;function P(){t=null;var a=z,g=v.getAxes();if(a.x<g.xaxis.min||a.x>g.xaxis.max||a.y<g.yaxis.min||a.y>g.yaxis.max)return;for(var e,i=v.getData(),d=0;d<i.length;++d){var b=i[d];for(e=0;e<b.data.length;++e)if(b.data[e][0]>a.x)break;var f,c=b.data[e-1],h=b.data[e];if(c==null)f=h[1];else if(h==null)f=c[1];else f=c[1]+(h[1]-c[1])*(a.x-c[0])/(h[0]-c[0]);if(d<i.length-1)s.eq(d).text(b.label.replace(/:.*/,": "+f.toFixed(1))+"%");else s.eq(d).text(b.label.replace(/:.*/,": "+f.toFixed(1))+"%  dose="+a.x.toFixed(1))}}function D(a,c){var b={series:{lines:{show:true}},legend:{backgroundOpacity:.3},crosshair:{mode:"x"},grid:{hoverable:true,autoHighlight:false},xaxis:{ticks:5,min:0},yaxis:{ticks:[[0,"0%"],[20,"20%"],[40,"40%"],[60,"60%"],[80,"80%"],[100,"100%"]],min:0,max:100}};v=$.plot(a,c,b);a.unbind("plothover");a.bind("plothover",function(b,a){z=a;if(!t)t=setTimeout(P,50)});s=a.find(".legendLabel");s.each(function(){$(this).css("width",$(this).width())})}function G(f){if(!f){var i=c.layout("panel","center"),k=i.children("div.easyui-tabs");f=k.tabs("getTab",1)}for(var a=[],j=e.wfn20(),h=j.split(";"),g=0;g<h.length;g++){var b=d.dvh0[h[g]];if(b)a[a.length]={label:b.roiname+": 100.0%",color:b.color,data:b.hist}}D(f,a);a=[];l.hide();return}function w(i){if(!i){var j=c.layout("panel","center"),m=j.children("div.easyui-tabs");i=m.tabs("getTab",1)}for(var f=[],k=e.wfn20(),g=k.split(";"),b=0;b<g.length;b++){var a=d.dvh1?d.dvh1[g[b]]:null;if(!a){if(!(a=L(g[b])))continue;if(!d.dvh1)d.dvh1=[];d.dvh1[g[b]]=a;f[f.length]={label:a.roiname+": 100.0%",color:a.color,data:a.hist};a=null;break}else f[f.length]={label:a.roiname+": 100.0%",color:a.color,data:a.hist}}D(i,f);f=[];if(b<g.length){window.setTimeout(w,10,i);return}l.hide();h("");return}function x(c,g){var i=c.Options().objname=="slice"?1:0,a=c.DicomInfo(),f=a.image.fx,d="roimeta",e=c.wfn31();e.RemoveMetas(d);var h=0;$(b.rtinfo).find("roiset").each(function(j,b){$(b).find("roi").each(function(m,j){var k=$(j).attr("number"),l=$(j).attr("name"),b=0+h++*.08;if(b>.6)b=.6;g.indexOf(l+k)!=-1&&$(j).find("contours").each(function(k,h){var g=$(h).attr("color").split("\\"),j="#"+WPACS.wp0bj1.rgbToHex(g[0],g[1],g[2]);$(h).find("contour").each(function(u,h){var r=$(h).attr("type");if(r=="CLOSED_PLANAR"){var l=false;if(i==1){var s=c.Options().z0,t=parseFloat($(h).attr("z"));l=Math.abs(s-t)<=f}else l=a.image.uid==$(h).attr("refuid");if(l){for(var o=$(h).attr("points"),p=$(h).text().split(","),q=new Array(o),k=0;k<o;k++){var m=p[k*2],n=p[k*2+1];m=(m-a.image.x0)/a.image.fx|0;n=(n-a.image.y0)/a.image.fy|0;q[k]={x:m,y:n}}var g=new WPACS.wp0bj7;g.UserTag=d;g.CreatePolygon(q);g.options.allowmm=false;g.options.alpha=b;g.options.metaclr=j;e.AddMeta(g);g=null}}})})})})}function A(){var c=e.wfn20();if(!c)return;for(var b=g.GetFormat().options.n,f=g.Options().ipage,a=0;a<b;a++){var h=f*b+a,d=k.GetImage(h);if(!d)continue;x(d,c)}}function Q(d){var a=b.rtinfo;if(a==null)return 0;var c=0;$(a).find("roiset").each(function(f,a){$(a).find("roi").each(function(g,a){var f=$(a).attr("number");f==d&&$(a).find("contours").each(function(g,d){var a=[];$(d).find("contour").each(function(j,c){var i=parseFloat($(c).attr("z")),h=$(c).attr("type");if(h=="CLOSED_PLANAR"){for(var d=$(c).attr("points"),f=$(c).text().split(","),g=new Array(d),b=0;b<d;b++)g[b]={x:parseFloat(f[b*2]),y:parseFloat(f[b*2+1])};a[i]=e(g)}});a.sort();for(var f in a)c+=a[f]*b.thickness})})});return c/1e3;function e(b){for(var c=0,a=0;a<b.length-1;a++)c+=(b[a].y+b[a+1].y)*(b[a].x-b[a+1].x);return Math.abs(c/2)}}function L(E){var p=b.rtinfo;if(p==null)return null;var H=(new Date).getTime(),B=C();if(B==null)return null;var m=a.Options().scaling,k=a.Options().doseunit,h=a.Options().min,g=a.Options().max,x="",w,f=0,o=g-h+1,d=WPACS.wp0bj8(o,"u32");$(p).find("roiset").each(function(b,a){$(a).find("roi").each(function(e,a){var c=$(a).attr("number"),b=$(a).attr("name");if(E==b+c){x=b;$(a).find("contours").each(function(c,b){var a=$(b).attr("color").split("\\");w="#"+WPACS.wp0bj1.rgbToHex(a[0],a[1],a[2]);$(b).find("contour").each(function(j,b){var i=$(b).attr("z"),h=$(b).attr("type");if(h=="CLOSED_PLANAR"){for(var c=$(b).attr("points"),e=$(b).text().split(","),g=new Array(c),a=0;a<c;a++)g[a]={x:parseFloat(e[a*2]),y:parseFloat(e[a*2+1])};f+=D(g,i,B,d)}})})}})});if(f==0){d=null;return null}for(var r=o,e=0,l=0,I=b.rxdose,c=0;c<o;c++){if(d[c]==0)continue;if(c<r)r=c;if(c>e)e=c;l+=c*d[c]}h=r*m*k;g=e*m*k;l=l*m*k/f;var F=f*a.Options().fx*a.Options().fy*b.thickness/1e3,A=Math.ceil(h),z=Math.floor(g),q=z-A+2,i=new Array(q),G=m*k,v=100/f;i[--q]=[g,d[e]*v];for(var y=d[e],t=e,c=z;c>A;c--){for(var u=Math.floor(c/G),n=y,s=u;s<t;s++)n+=d[s];i[--q]=[c,n*v];y=n;t=u}i[0]=[h,100];d=null;return{roiname:x,color:w,vol:F,mindose:h,maxdose:g,meandose:l,hist:i};function C(){var a=j(p,"rtdose");if(!a||!(a=j(a,"info")))return null;for(var f=parseInt($(a).attr("w")),e=parseInt($(a).attr("h")),i=parseFloat($(a).attr("x0")),k=parseFloat($(a).attr("y0")),g=parseFloat($(a).attr("fx")),h=parseFloat($(a).attr("fy")),c=new Array(f),d=new Array(e),b=0;b<f;b++)c[b]=i+g*b;for(var b=0;b<e;b++)d[b]=k+h*b;return{x:c,y:d}}function D(i,q,l,p){var d=a.wfn14(q);if(d==null)return 0;for(var m=d.data,k=d.w,n=d.h,j=0,f=WPACS.wp0bj2.OutRect(i),e=WPACS.wp0bj2.InnerRect(i),g=0;g<n;g++)for(var h=0;h<k;h++){var b=l.x[h],c=l.y[g];if(b>=f.l&&b<=f.r&&c>=f.t&&c<=f.b)if(b>=e.l&&b<=e.r&&c>=e.t&&c<=e.b||WPACS.wp0bj2.InPolygon(b,c,i)){var o=m[g*k+h];p[o]++;j++}}return j}}function H(){b.thickness=1;b.rxdose=0;b.doseunit=100;var c=b.rtinfo;if(c==null)return;var a;if(a=j(c,"rtplan")){b.planname=$(a).attr("name");if(a=j(a,"refdose")){var e=$(a).attr("rx"),d=$(a).attr("unit");if(d&&d.toLowerCase()=="cgy")b.rxdose=parseInt(e);else b.rxdose=parseFloat(e)*100|0}}if(a=j(c,"roiset"))(a=j(a,"roi"))&&$(a).find("contours").each(function(h,g){var a=[];$(g).find("contour").each(function(c,b){a[a.length]=parseFloat($(b).attr("z"))});a.sort(function(a,b){return a-b});for(var d=0,i,e=0,c=0;c<a.length-1;c++){var f=Math.abs(a[c+1]-a[c]);if(f<.01)continue;e+=f;d++}b.thickness=d?e/d:1})}function I(){var c=b.rtinfo;if(c==null)return false;var a=j(c,"rtdose");return a&&parseInt($(a).attr("dvh"))==1}function N(){h("\u6b63\u5728\u4e0b\u8f7dCDVH\u6570\u636e...");var c=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu4,e=c+"?requesttype=RTCDVH&objectuid="+b.doseuid;$.ajax({type:"GET",url:e,dataType:"json",async:true,xhr:function(){var a=new XMLHttpRequest;a.addEventListener("progress",function(a){if(!a.lengthComputable)return;var b=100*a.loaded/a.total|0;h("\u6b63\u5728\u4e0b\u8f7d CDVH..."+b+"%")},false);return a},success:function(e){for(var c=0;c<e.length;c++){var k=e[c].roi,g=a(k);if(!g)continue;var r=g.name+k,n=e[c].dvh[0],f,m,l;if(e[c].mindose>=0)f=e[c].mindose*b.rxdose/100;if(e[c].maxdose>=0)m=e[c].maxdose*b.rxdose/100;if(e[c].meandose>=0)l=e[c].meandose*b.rxdose/100;for(var s=e[c].stdose?e[c].stdose:0,q=f?Math.floor(f):0,p=e[c].dvh.length,j=[],i=q;i<p;i++)j.push([s+i,e[c].dvh[i]*100/n]);if(!d.dvh0)d.dvh0=[];d.dvh0[r]={roiname:g.name,color:g.color,vol:n,mindose:f,maxdose:m,meandose:l,hist:j}}h("\u4e0b\u8f7dCDVH\u6570\u636e\u6210\u529f");o();window.setTimeout(function(){u()},100)},error:function(){h("\u4e0b\u8f7dCDVH\u6570\u636e\u5931\u8d25");window.setTimeout(function(){u()},500)}});function a(d){var a=b.rtinfo;if(a==null)return null;var c=null;$(a).find("roiset").each(function(b,a){$(a).find("roi").each(function(h,a){var f=$(a).attr("number");if(f==d){var e="#000000";if($(a).find("contours").length>0){var g=$(a).find("contours")[0],b=$(g).attr("color").split("\\");e="#"+WPACS.wp0bj1.rgbToHex(b[0],b[1],b[2])}c={name:$(a).attr("name"),color:e};return false}})});return c}}function u(){var k=b.rtinfo;if(k==null)return;var c,e;if(!(e=j(k,"rtdose")))return;var s=$(e).attr("pp");if(!(c=j(e,"info")))return;var z=parseInt($(c).attr("w")),x=parseInt($(c).attr("h")),w=parseInt($(c).attr("b")),y=parseInt($(c).attr("n"));a!=null&&a.DestroyObj();a=new WPACS.wp0b22(U);a.Init(z,x,w,y);var q,r,t,u,h,g,l,i,f=0,n=0,m=0;q=parseFloat($(c).attr("fx"));r=parseFloat($(c).attr("fy"));t=parseFloat($(c).attr("x0"));u=parseFloat($(c).attr("y0"));h=parseFloat($(c).attr("z0"));f=parseInt($(c).attr("n"));if(f>0)g=new Array(f);c=j(e,"dose");if($(c).attr("min"))n=parseInt($(c).attr("min"));if($(c).attr("max"))m=parseInt($(c).attr("max"));l=parseFloat($(c).attr("scaling"));var p=$(c).attr("unit");i=p&&p.toLowerCase()=="cgy"?1:100;c=j(e,"frameoffset");if($(c).attr("thickness"))for(var v=parseFloat($(c).attr("thickness")),d=0;d<f;d++)g[d]=h+d*v;else for(var o=$(c).text().split("\\"),d=0;d<f;d++)g[d]=d<o.length?h+parseInt(o[d]):h;a.Options().fx=q;a.Options().fy=r;a.Options().min=n;a.Options().max=m;a.Options().scaling=l;a.Options().doseunit=i;a.Options().x0=t;a.Options().y0=u;a.Options().z=g;if(s)a._options.pp=s;a.wfn13(b.doseuid,"","","")}function y(f,d,k,j,s,t,u,v,m,l,w,o,p,q,r){for(var b={x:new Array(k),y:new Array(j)},a=0;a<k;a++){b.x[a]=(u-q+s*a)/o|0;if(b.x[a]>=l)b.x[a]=-1}for(var a=0;a<j;a++){b.y[a]=(v-r+t*a)/p|0;if(b.y[a]>=w)b.y[a]=-1}for(var g=.3,i=1-g,c=0,a=0;a<j;a++)for(var h=0;h<k;h++,c+=4)if(b.x[h]>=0&&b.y[a]>=0)for(var n=b.y[a]*l+b.x[h],x=m[n],e=0;e<f.length;e++)if(x>=f[e].dose){d.data[c]=d.data[c]*i+f[e].r*g|0;d.data[c+1]=d.data[c+1]*i+f[e].g*g|0;d.data[c+2]=d.data[c+2]*i+f[e].b*g|0;break}}function B(){for(var g=e.wfn21(),h=g?g.split(";"):[],d=[],f=0;f<h.length;f++){var c=h[f].split(",");if(c.length!=4)continue;var i=c[0]*b.rxdose/100/a.Options().doseunit/a.Options().scaling|0;d[d.length]={dose:i,r:c[1],g:c[2],b:c[3]}}return d}function J(g,e){if(a==null||!a.IfLoaded())return;var b=g?g.DicomInfo():null,f=B();if(b==null||f.length==0)return;var c=a.wfn14(b.image.z0);if(c==null||c.data==null)return;var k=c.data,u=c.w,t=c.h,n=a.Options().x0,o=a.Options().y0,l=a.Options().fx,m=a.Options().fy,r=b.image.x0,s=b.image.y0,p=b.image.fx,q=b.image.fy,d,i=e.width,h=e.height,j=e.getContext("2d");d=j.getImageData(0,0,i,h);y(f,d,i,h,p,q,r,s,k,u,t,l,m,n,o);j.putImageData(d,0,0);d=null}function K(c,k){var j=c.Options().vtype;if(j==1){var o=e.wfn20();o&&x(c,o)}var p=B();if(p.length==0)return;var l=c.Options().x0,m=c.Options().y0,n=c.Options().z0,w=c.DicomInfo().image.fx,z=c.DicomInfo().image.fy,h,i,d,r=k.width,q=k.height,s=k.getContext("2d");d=s.getImageData(0,0,r,q);var b=null,f,g,u=a.Options().fx,v=a.Options().fy;if(j==1){h=l;i=m;f=a.Options().x0;g=a.Options().y0;b=a.wfn14(n)}else if(j==2){h=l;i=n;f=a.Options().x0;g=a.Options().z[0];b=a.wfn15(m)}else if(j==3){h=m;i=n;f=a.Options().y0;g=a.Options().z[0];b=a.wfn16(l)}if(b==null||b.data==null)return;var t=b.data,C=b.w,A=b.h;y(p,d,r,q,w,z,h,i,t,C,A,u,v,f,g);s.putImageData(d,0,0);d=null}e.Options().rtview=F;e.Options().onEvent=q;k.Options().onCreate=q;m.Options().onEvent=q;g.Options().onEvent=q;g.SetDcmSet(k);WPACS.wp0bj1.IsMobile&&g.SetFormat(1,1);WPACS.wp0bj1.isObject(E)&&p(E)};eval(function(d,f,a,c,b,e){b=function(a){return a.toString(f)};if(!"".replace(/^/,String)){for(;a--;)e[b(a)]=c[a]||b(a);c=[function(a){return e[a]}];b=function(){return"\\w+"};a=1}for(;a--;)c[a]&&(d=d.replace(new RegExp("\\b"+b(a)+"\\b","g"),c[a]));return d}("(5(){2 a='7'+'f'+'4',1='\u975e\u6cd5'+'\u4f7f\u7528'+a;6{2 0=8(a);9(b 0!=='c'||!0.d)3(1)}g(e){3(1)}})();",17,17,"o warn var alert ACS function try W eval if  typeof object CONSTDEF  P catch".split(" "),0,{}));WPACS.wp0b24=function(l){var a={horiz:false,rtview:null,rxdose:0,maxdose:0,isocolor:[1,1,255],onEvent:null};this.DestroyObj=function(){s()};this.GetContainer=function(){return e};this.BindContainer=function(a){h(a)};this.ReSize=function(){h(e)};this.Options=function(){return a};this.SetPageInfo=function(a,b){r(a,b)};this.SetRoiInfo=function(a){q(a)};this.Refresh=function(){a.rxdose=a.maxdose=0;m()};this.wfn19=function(d,c){if(b==null)return;var e=c*100/d|0;a.rxdose=d;a.maxdose=c;b.find("#ssIsodose").slider({max:e,value:0});b.find("#chkIsodose").attr("disabled",false)};this.wfn20=function(){if(b==null)return"";var a=b.find("input[fnid='fnCheckROI']:checked").map(function(){return $(this).val()}).get().join(";");return a};this.wfn21=function(){if(b==null)return"";if(!b.find("#chkIsodose").prop("checked"))return"";var c=b.find("#ssIsodose").slider("getValue"),f=a.isocolor[0],e=a.isocolor[1],d=a.isocolor[2];return c>0?c+","+f+","+e+","+d:""};var e=null,c=null,d=null,f=null,g=null,b=null;function u(){var a='<div style="position:relative;display:none;overflow:hidden;padding:0px;"><div style="position:absolute;overflow:hidden;padding:0px;"><div class="easyui-accordion"><div data-options="selected:true" style="padding:5px;"></div></div></div><div style="position:absolute;background-color:#EDF3FF"></div></div>';e.append(a);c=e.children("div");d=c.children("div:eq(0)");f=c.children("div:eq(1)");d.children(".easyui-accordion").accordion({fit:true,animate:false});b=d.children(".easyui-accordion").accordion("getPanel",0)}function j(){if(d==null)return;b!=null&&b.empty();b=null;d.empty()}function s(){i(false);a.rtview=null;a={};j();d=null;f=null;g=null;if(c!=null){c.remove();c=null}if(e!=null){e.empty();e=null}}function i(e){if(c==null)return;var d=f.find("img.preFrm"),b=f.find("img.nxtFrm"),a=!WPACS.wp0bj1.IsMobile?"click":"touchend";if(e){d.bind(a,function(){k(WPACS.CONSTDEF.wpe3,-1)});b.bind(a,function(){k(WPACS.CONSTDEF.wpe3,-2)})}else{d.unbind(a);b.unbind(a)}}function h(a){i(false);if(WPACS.wp0bj1.isObject(a)){if(e==null||e[0]!=a[0]){e=a;c==null?u():c.appendTo(e)}var h=e.width(),b=e.height();if(c.width()!=h||c.height()!=b){c.width(h);c.height(b);t();o()}c.show();i(true)}else if(e!=null){j();d=null;f=null;g=null;c=null;e.empty();e=null}}function t(){if(c==null)return;var i=c.width(),j=c.height(),k=18,h=40,m="",b=1,l=8;if(a.horiz){var g=i-h,e=j;d.css({left:b,top:b});d.height(e);d.width(g);f.css({left:g+b,top:b});f.height(e);f.width(h);d.children(".easyui-accordion").accordion({width:g,height:e})}else{var e=j-h,g=i;d.css({left:b,top:b});d.height(e);d.width(g);f.css({left:b,top:e+b});f.height(h);f.width(i);d.children(".easyui-accordion").accordion({width:g,height:e})}d.show()}function o(){var c=g!=null?g.attr("sinfo"):"",b="";if(a.horiz)b+='<table class="normalize" style="font-family:\u534e\u6587\u9ed1\u4f53;font-size:18px;color:#B3B9Bb;" ><tr height="36px"><td><img class="preFrm" src="./webpacs/images/preFrm.png" title="'+WPACS.CONSTDEF.STR_THUW_TEXT2+'" style="width:32px;height:32px;margin-left:2px;"></td></tr><tr><td id="pagev" title="'+WPACS.CONSTDEF.STR_THUW_TEXT4+'" style="word-break:break-all"> 0/0 </td></tr><tr height="36px"><td><img class="nxtFrm" src="./webpacs/images/nxtFrm.png" title="'+WPACS.CONSTDEF.STR_THUW_TEXT3+'" style="width:32px;height:32px;margin-left:2px;"></td></tr></table>';else b+='<table class="normalize" style="font-family:\u534e\u6587\u9ed1\u4f53;font-size:18px;color:#B3B9Bb;" ><tr><td width="36px"><img class="preFrm" src="./webpacs/images/preFrm.png" title="'+WPACS.CONSTDEF.STR_THUW_TEXT2+'" style="width:32px;height:32px;margin-left:5px;"></td><td id="pagev" align="center"  title="'+WPACS.CONSTDEF.STR_THUW_TEXT4+'">0/0 </td><td width="36px"><img class="nxtFrm" src="./webpacs/images/nxtFrm.png" title="'+WPACS.CONSTDEF.STR_THUW_TEXT3+'" style="width:32px;height:32px;"></td></tr></table>';f.html(b);g=f.find("#pagev");g.attr("sinfo",c);g.text(c)}function r(d,b){if(g==null)return;var c="";if(b>0)d+=1;if(a.horiz)if(b>=10)c=d+"/ "+b;else c=d+"/"+b;else c=d+"/"+b;g.attr("sinfo",c);g.text(c)}function m(){if(b==null)return;b.find(".fnRtvCall").unbind("click");b.empty();if(a.rtview==null)return;if(a.rtview.Options().rtinfo==null)return;function g(c,b){var a=$(c).find(b);return a.length>0?a[0]:null}var e=a.rtview.Options().rtinfo,d=g(e,"rtdose"),f=d&&parseInt($(d).attr("dvh"))==1,c="<lable>PlanName: "+a.rtview.Options().planname+"</lable><br><lable>\u5904\u65b9\u5242\u91cf: "+a.rtview.Options().rxdose+" cGY </lable>";if(!f)c+="<hr>";else c+='&nbsp;<lable id="lblDVH"> [DVH]</lable><hr>';$(e).find("roiset").each(function(e,d){var b=0,a=4;$(d).find("roi").each(function(k,d){var f=$(d).attr("number"),g=$(d).attr("name");if($(d).find("contours").length>0){var j=$(d).find("contours")[0],e=$(j).attr("color").split("\\"),i="#"+WPACS.wp0bj1.rgbToHex(e[0],e[1],e[2]),h=b++<a?"checked":"";c+='<div style="display: inline-block;width:14px;height:14px;background-color:'+i+';"></div><input type="checkbox" class="fnRtvCall" fnid="fnCheckROI" value="'+g+f+'" '+h+' /><label class="label-font fnRtvCall" fnid="fnShowVol" vl="'+f+'" >'+g+"</label><br>"}})});var h="#"+WPACS.wp0bj1.rgbToHex(a.isocolor[0],a.isocolor[1],a.isocolor[2]);c+='<hr><div style="width:140px;height:50px;margin-left:10px;"><div style="margin-left:-10px;display:inline-block;width:14px;height:14px;background-color:'+h+';"></div><input id="chkIsodose" type="checkbox" class="fnRtvCall" fnid="fnShowIso" disabled />Isodose\u7b49\u5242\u91cf\u7ebf<br><br><div id="ssIsodose" title="\u5242\u91cf\u9608\u503c%" ></div></div><hr>';c+='<span id="ssinfo" ></span>';b.html(c);b.find(".fnRtvCall").bind("click",n);b.find("#lblDVH").bind("dblclick",function(){a.rtview.Action("dvhswitch")});b.find("#ssIsodose").slider({mode:"h",onChange:p,min:0,max:100,value:0,showTip:true,tipFormatter:function(b){return b+"%/"+(b*a.rxdose/100|0)}})}function q(c){if(b==null)return;var e=a.rtview.Options().rxdose,f=b.find("span#ssinfo"),d=c.no+" "+c.name+"<br>  Volume: "+c.vol.toFixed(2)+" CM3<br>";if(c.maxdose){d+="Min Dose: "+c.mindose.toFixed(1)+" / "+(c.mindose*100/e).toFixed(1)+"%<br>";d+="Max Dose: "+c.maxdose.toFixed(1)+" / "+(c.maxdose*100/e).toFixed(1)+"%<br>";d+="MeanDose: "+c.meandose.toFixed(1)+" / "+(c.meandose*100/e).toFixed(1)+"%<br>"}else d+="Min Dose: - %<br>Max Dose: - %<br>MeanDose: - %<br>";f.html(d)}function n(){var c=$(this).attr("fnid"),b=a.rtview!=null?a.rtview.Action:null;c&&b!=null&&b($(this))}function p(){var c=$('<a fnid="fnShowIso" vl="" ></a>'),b=a.rtview!=null?a.rtview.Action:null;b!=null&&b(c)}function k(d,c){var b=false;if(a.onEvent!=null)b=a.onEvent(d,c);return b?true:false}WPACS.wp0bj1.isObject(l)&&h(l)};WPACS.wp0b36=function(i){var d=new WPACS.wp0b38,b=new WPACS.wp0b30(!WPACS.CONSTDEF.DAT3NATIV),q=this;this.DestroyObj=function(){m()};this.GetContainer=function(){return c};this.BindContainer=function(a){g(a)};this.ReSize=function(){g(c)};this.SetSize=function(b,a){if(c==null)return;c.width(b);c.height(a);g(c)};this.Options=function(){return b.Options()};this.GetSeries=function(){return b?b.GetSeries():""};this.View3d=function(a,c,d){b&&b.SetSeries(a,c,d)};this.Action=function(a,b){typeof a=="string"&&l(a,b)};function l(c,a){if(!b)return;switch(c){case"d3type":WPACS.wp0bj1.isObject(a)&&(b.Options().d3type!=a.d3type||b.Options().subtype!=a.subtype)&&b.SetD3Type(a.d3type,a.subtype);return;case"vrset":if(WPACS.wp0bj1.isNumberType(a)){if(a==-1)o();else if(a>=0&&a<WPACS.PREVRTHRESHOLD.length){b.Options().vrset=a;b.Options().vroff=0;b.Action("refresh")}}else if(!WPACS.wp0bj1.isStringType(a)){b.Options().vrset=a;b.Options().vroff=0;b.Action("refresh")}return;case"mprth":if(WPACS.wp0bj1.isNumberType(a)){b.Options().mprth=a;b.Action("refresh","MPR")}return;case"mprfn":if(WPACS.wp0bj1.isNumberType(a)){b.Options().mprfn=a;b.Action("refresh","MPR")}return}b.Action(c,a)}var c=null,a=null,e=null,f=null;function p(){var b='<div class="d3view" '+WPACS.CONSTDEF.STR_SETS1+" ></div>";c.append(b);a=c.children("div.d3view");a.layout({border:false});a.layout("add",{region:"center",noheader:true,border:false,onResize:k});WPACS.wp0bj1.IsMobile&&c.bind("touchmove",function(a){a.preventDefault()})}function m(){h(false);b!=null&&b.DestroyObj();b=null;d!=null&&d.DestroyObj();d=null;if(f!=null){var g=$.data(f,"vrset");g&&g.DestroyObj();$.data(f,"vrset",undefined)}e=null;f=null;if(a!=null){a.remove();a=null}if(c!=null){c.empty();c=null}}function h(){if(a==null)return void 0}function g(b){if(WPACS.wp0bj1.isObject(b)){if(c==null||c[0]!=b[0]){c=b;a==null?p():a.appendTo(c)}var j=c.width(),i=c.height(),g=j,f=i;a.height(f);a.width(g);n();a.show();return}h(false);if(c==null)return;d!=null&&d.BindContainer(null);e=null;a=null;c.empty();c=null}function n(){var h=a.width(),g=a.height(),b=3,c="\u4e09\u7ef4\u5de5\u5177\u680f",f=165,i="";if(b==3){if(a.layout("panel","east").length==0){if(d!=null)d.Options().horiz=false;e=null;a.layout("remove","south");a.layout("add",{region:"east",iconCls:i,split:false,width:f,title:c});e=a.layout("panel","east");e.css("overflow","hidden");WPACS.wp0bj1.IsMobile&&window.setTimeout(function(){a.layout("collapse","east")},0)}}else{e=null;a.layout("remove","east");a.layout("remove","west");a.layout("remove","south")}a.layout("resize",{width:h,height:g})}function k(){d.BindContainer(e);if(a==null)return;h(false);var c=a.layout("panel","center");b&&b.BindContainer(c);h(true)}function j(){return false}function o(){if(f==null)return void 0}d.Options().d3view=q;d.Options().onEvent=j;WPACS.wp0bj1.isObject(i)&&g(i)};WPACS.wp0b38=function(k){var b={horiz:false,d3view:null,onEvent:null},e=new WPACS.wpContextMenu;this.DestroyObj=function(){m()};this.GetContainer=function(){return d};this.BindContainer=function(a){h(a)};this.ReSize=function(){h(d)};this.Options=function(){return b};var d=null,a=null,c=null,f=null;function o(){var b='<div style="position:relative;display:none;overflow:hidden;padding:0px;"><div class="panel-bk" style="position:absolute;overflow:hidden;padding:1px;"></div><div class="panel-bk"  style="position:absolute;overflow:hidden;padding:1px;"></div>';d.append(b);a=d.children("div");c=a.children("div:eq(0)");f=a.children("div:eq(1)");i();h();e();k();j();c.find(".fnD3Call").bind("click",function(){g($(this))});f.find(".fnD3Call").bind("click",function(){g($(this))});f.find("img.fnD3Call[fnid='fnD3Type'][vl='3']").bind("contextmenu",function(){l($(this))});function i(){var c=[{icon:"mip.png",fnid:"fnD3Type",vl:"2",text:"MIP\u6700\u5927\u5bc6\u5ea6"},{icon:"ssd.png",fnid:"fnD3Type",vl:"3",text:"SSD\u8868\u9762\u91cd\u5efa"},{icon:"vr.png",fnid:"fnD3Type",vl:"4",text:"VR \u5bb9\u79ef\u91cd\u5efa"},{icon:"vr.png",fnid:"fnD3Type",vl:"5",text:"VR1\u5bb9\u79ef\u91cd\u5efa"},{fnid:"-"},{icon:"3dmode2.png",fnid:"fnLayout",vl:"2",text:"\u663e\u793a\u6a21\u5f0f2"},{icon:"",fnid:"",vl:"",text:""},{icon:"text.png",fnid:"fnTextv",vl:"",text:"\u6587\u5b57\u6807\u5c3a\u663e\u9690"},{icon:"reload.png",fnid:"fnReload",vl:"",text:"\u91cd\u8f7d"}];b='<div style="width:100%;height:160px;" ><table style="width:100%; border:none; cellspacing:0px; cellpadding:0px;"><tr>';for(var a=0;a<c.length;a++)if(c[a].fnid!="-")if(c[a].icon!="")b+='<td><img width="32px" height="32px" class="fnD3Call" fnid="'+c[a].fnid+'" vl="'+c[a].vl+'" title="'+c[a].text+'" src="./webpacs/images/3d/'+c[a].icon+'" /></td>';else b+='<td width="32px" height="32px" ></td>';else b+="</tr><tr>";b+="</tr></table></div>";f.append(b)}function h(){var d=[{icon:"mpr_crossLine.png",fnid:"fnD3Type",vl:"0",text:"MPR\u77e2\u51a0\u4f4d"},{icon:"mpr_line.png",fnid:"fnD3Type",vl:"1,1",text:"CPR\u76f4\u7ebf\u622a\u9762"},{icon:"mpr_curve.png",fnid:"fnD3Type",vl:"1,2",text:"CPR\u66f2\u7ebf\u622a\u9762"},{icon:"Windowing.png",fnid:"fnOpMode",vl:"7",text:"MPR\u7a97\u5bbd\u8c03\u8282"}],e="mpr"+Math.random()*1e3|0;b='<div id="'+e+'" class="easyui-panel panel-bk" title="MPR/CPR\u5de5\u5177\u680f" style="width:100%;height:80px;" ><table style="width:100%; border:none; cellspacing:0px; cellpadding:0px;"><tr>';for(var a=0;a<d.length;a++)if(d[a].fnid!="-")b+='<td><img width="32px" height="32px" class="fnD3Call" fnid="'+d[a].fnid+'" vl="'+d[a].vl+'" title="'+d[a].text+'" src="./webpacs/images/3d/'+d[a].icon+'" /></td>';else b+="</tr><tr>";b+="</tr></table></div>";c.append(b);var f=c.children("#"+e);f.panel({iconCls:"",collapsible:true,collapsed:false})}function e(){var d=[{icon:"Rotate3D.png",fnid:"fnD3Mode",vl:"1",text:"\u4e09\u7ef4\u65cb\u8f6c"},{icon:"zoom.png",fnid:"fnD3Mode",vl:"2",text:"\u4e09\u7ef4\u7f29\u653e"},{icon:"pan.png",fnid:"fnD3Mode",vl:"3",text:"\u6f2b\u6e38\u79fb\u52a8"},{icon:"Clip.png",fnid:"fnD3Mode",vl:"4",text:"\u88c1\u526a\u5207\u5272"},{fnid:"-"},{icon:"Windowing.png",fnid:"fnD3Mode",vl:"5",text:"SSD\u9608\u503c/MIP|VR1\u8c03\u7a97"},{fnid:" "},{fnid:"fnStep"}],e="mpr"+Math.random()*1e3|0;b='<div id="'+e+'" class="easyui-panel panel-bk" title="MIP/SSD/VR\u5de5\u5177\u680f" style="width:100%;height:110px;" ><table style="width:100%; border:none; cellspacing:0px; cellpadding:0px;"><tr>';for(var a=0;a<d.length;a++)if(d[a].fnid==" ")b+="<td></td>";else if(d[a].fnid=="fnStep")b+='<td colspan="2" title="\u91cd\u5efa\u8d28\u91cf: \u5dee<--->\u9ad8"><div id="d3step" ></div></td>';else if(d[a].fnid=="fnLight")b+='<td colspan="2" title=""><div id="d3light" ></div></td>';else if(d[a].fnid!="-")b+='<td><img width="32px" height="32px" class="fnD3Call" fnid="'+d[a].fnid+'" vl="'+d[a].vl+'" title="'+d[a].text+'" src="./webpacs/images/3d/'+d[a].icon+'" /></td>';else b+="</tr><tr>";b+="</tr></table></div>";c.append(b);var f=c.children("#"+e);f.panel({iconCls:"",collapsible:true,collapsed:false})}function k(){var b=a.find("div#d3step");b.length==1&&b.slider({mode:"h",showTip:false,min:-2,max:2,value:0,onComplete:function(a){g($('<a fnid="fnStep" vl="'+a+'" ></a>'))}});b=a.find("div#d3light");b.length==1&&b.slider({mode:"h",showTip:false,min:0,max:5,value:0,onComplete:function(a){g($('<a fnid="fnLight" vl="'+a+'" ></a>'))}})}}function m(){i(false);e!=null&&e.Destroy();e=null;b.d3view=null;b={};c.find(".easyui-panel").panel("destroy",true);c.empty();c=null;f=null;if(a!=null){a.remove();a=null}if(d!=null){d.empty();d=null}}function i(b){if(a==null)return;b}function h(b){i(false);if(WPACS.wp0bj1.isObject(b)){if(d==null||d[0]!=b[0]){d=b;a==null?o():a.appendTo(d)}var f=d.width(),e=d.height();a.width(f);a.height(e);n();a.show();i(true)}else if(d!=null){_DestroyEasyui();c=null;a=null;d.empty();d=null}}function n(){if(a==null)return;var k=a.width(),j=a.height(),l=18,e=90,m="",d=1,i=8;if(b.horiz){var h=k-e,g=j;c.css({left:d,top:d});c.height(g);c.width(h);f.css({left:h+d,top:d});f.height(g);f.width(e-i)}else{var g=j-e,h=k-5;c.css({left:d,top:d});c.height(g);c.width(h);f.css({left:d,top:g+d});f.height(e-i);f.width(h)}c.show();f.show()}function l(a){var c=a.attr("fnid"),b=a.attr("vl");if(c!="fnD3Type")return;if(b=="3"){a.attr("vl","6");a.attr("title","VE \u865a\u62df\u5185\u7aa5");a.attr("src","./webpacs/images/3d/ve.png")}else if(b=="6"){a.attr("vl","3");a.attr("title","SSD\u8868\u9762\u91cd\u5efa");a.attr("src","./webpacs/images/3d/ssd.png")}else return;g(a)}function g(d){var c=b.d3view!=null?b.d3view.Action:null;if(c==null||d.disabled)return;var f="",a="";if(d.target){f=!WPACS.wp0bj1.isUndefined(d.target.attributes.fnid)?d.target.attributes.fnid.value:"";a=!WPACS.wp0bj1.isUndefined(d.target.attributes.vl)?d.target.attributes.vl.value:""}else{f=d.attr("fnid");a=d.attr("vl")}switch(f){case"fnTextv":c("textv","");break;case"fnReload":c("reset","");break;case"fnLayout":var i=b.d3view.Options().d3type;if(i!=WPACS.CONSTDEF.wpdt0){var m=b.d3view.Options().layout;if(m>3)c("layout",parseInt(a));else c("layout",m%3+1)}else c("toggle");break;case"fnOpMode":var l=parseInt(a);if(b.d3view.Options().opmode==l)l=0;c("opmode",l);break;case"fnD3Mode":if(a!="")if(b.d3view.Options().d3mode==parseInt(a)){var n=e.GetMenuName("v3dm"+a),p=d.offset().left,q=d.offset().top+30;$("#"+n).menu("show",{left:p,top:q})}else{c("d3mode",parseInt(a));var r=""+b.d3view.Options().cliptype;e.SetMenuGroupIcon("v3dm4","fnClipType",r)}break;case"fnD3Type":if(a!=""){var i=b.d3view.Options().d3type;if(i!=1&&i==parseInt(a)){var n=e.GetMenuName("v3dt"+a),p=d.offset().left-10,q=d.offset().top;$("#"+n).menu("show",{left:p,top:q})}else{var h=a.split(","),s=h.length>1?parseInt(h[1]):0;i=h.length>0?parseInt(h[0]):0;c("d3type",{d3type:i,subtype:s})}}break;case"fnStep":var g=1;if(a=="-2")g=2;else if(a=="-1")g=1.5;else if(a=="0")g=1;else if(a=="1")g=.5;else if(a=="2")g=.3;b.d3view.Options().step=g;c("refresh");break;case"fnRotate":if(a!=""&&a.indexOf(",")!=-1){var h=a.split(","),o=3.14159,t=parseInt(h[0]),u=parseInt(h[1]),v=[t*o/180,u*o/180];c("matrix",{id:0,param:1});c("matrix",{id:WPACS.CONSTDEF.wpd1,param:v});c("refresh")}break;case"fnLight":var k=parseInt(a);if(k>0&&k<=5)k*=50;b.d3view.Options().light=k;c("refresh");e.SetMenuGroupIcon("v3dm"+b.d3view.Options().d3mode,f,a);break;case"fnVrset":c("vrset",WPACS.wp0bj1.isNumberType(a)?a:parseInt(a));e.SetMenuGroupIcon("v3dt"+b.d3view.Options().d3type,f,a);break;case"fnD3clut":c("d3clut",parseInt(a));e.SetMenuGroupIcon("v3dt"+b.d3view.Options().d3type,f,a);break;case"fnMprTh":c("mprth",parseInt(a));e.SetMenuGroupIcon("v3dt"+b.d3view.Options().d3type,f,a);break;case"fnMprFn":c("mprfn",parseInt(a));e.SetMenuGroupIcon("v3dt"+b.d3view.Options().d3type,f,a);break;case"fnClipType":c("cliptype",parseInt(a));e.SetMenuGroupIcon("v3dm"+b.d3view.Options().d3mode,f,a);break;default:return}j()}function j(){if(!b.d3view||!c)return;var h,g=b.d3view.Options().d3type,i=b.d3view.Options().subtype;h=g==WPACS.CONSTDEF.wpdt1?g+","+i:""+g;a.find("img.fnD3Call[fnid='fnD3Type']").attr("style","border:none;");a.find("img.fnD3Call[fnid='fnD3Type'][vl='"+h+"']").attr("style","border:thin solid #FF0000;");var j=b.d3view.Options().d3mode,n=b.d3view.Options().opmode;a.find("img.fnD3Call[fnid='fnD3Mode']").attr("style","border:none;");a.find("img.fnD3Call[fnid='fnOpMode']").attr("style","border:none;");a.find("img.fnD3Call[fnid='fnD3Mode'][vl='"+j+"']").attr("style","border:thin solid #FF0000;");a.find("img.fnD3Call[fnid='fnOpMode'][vl='"+n+"']").attr("style","border:thin solid #FF0000;");var l=b.d3view.Options().layout;a.find("img.fnD3Call[fnid='fnLayout']").attr("style","border:none;");a.find("img.fnD3Call[fnid='fnLayout'][vl='"+l+"']").attr("style","border:thin solid #FF0000;");var f=b.d3view.Options().step,e=0,k=b.d3view.Options().light,m=k/50|0;if(f==2)e=-2;else if(f==1.5)e=-1;else if(f==.5)e=1;else if(f==.3)e=2;var d=a.find("div#d3step");d.length==1&&d.slider("setValue",e);d=a.find("div#d3light");d.length==1&&d.slider("setValue",m)}e.Init3dMenu(g);WPACS.wp0bj1.isObject(k)&&h(k)};WPACS.prToolsWnd=function(n){var d={horiz:false,prnview:null,onEvent:null};this.DestroyObj=function(){r()};this.GetContainer=function(){return c};this.BindContainer=function(a){j(a)};this.ReSize=function(){j(c)};this.Options=function(){return d};this.SetPageInfo=function(a,b){q(a,b)};var c=null,b=null,a=null,e=null,f=null,h=[];function t(){var f='<div style="position:relative;display:none;overflow:hidden;padding:0px;"><div class="panel-bk" style="position:absolute;overflow:hidden;padding:1px;"></div><div style="position:absolute;background-color:#EDF3FF"></div></div>';c.append(f);b=c.children("div");a=b.children("div:eq(0)");e=b.children("div:eq(1)");j();l();k();m();a.find(".fnPrnCall").bind("click",g);a.find("#txtFilmFmt").textbox("textbox").bind("keydown",p);var n="0,2,2",o=a.find("img.fnPrnCall[fnid='fnFilmFmt'][vl='"+n+"']");g.bind(o)();function j(){var c=Math.random()*1e3|0,d='<div id="prnswitch'+c+'"><a href="#" fnid="fnPrnSwitch" vl="" class="icon-reload" title="\u76f8\u673a\u6253\u5370\u673a\u5207\u6362" ></a></div>';$("body").append(d);$("#prnswitch"+c).children("a").bind("click",g);h[h.length]="#prnswitch"+c;var e="pan"+c;d='<div id="'+e+'" class="easyui-panel panel-bk" title=" \u76f8\u673a&\u6253\u5370\u673a" style="width:100%;height:130px;" ><div id="PrnFilm" style="display:block;"><label><b>\u76f8\u673a:</b> </label><select id="PrinterList" class="easyui-combobox" style="width:100px;" ></select>&nbsp;<label style="cursor:pointer;" class="fnPrnCall" fnid="fnPrnTest" vl="">\u6d4b\u8bd5</label><p><label><b>\u5c3a\u5bf8:</b> </label><select id="PrnFilmSize" class="easyui-combobox" style="width:130px;" ></select></div><div id="PrnPaper" style="display:none;"><label><b>&nbsp;</b> </label><p><label><b>\u7eb8\u5f20:</b> </label><select id="PrnPaperSize" dpi="'+WPACS.CONSTDEF.PRNPAPER_DPI+'" class="easyui-combobox" style="width:130px;" ></select></div><p><label><b>\u65b9\u5411:</b></label><input type="radio" name="fnFilmOri" class="fnPrnCall" fnid="fnFilmOri" vl="0" checked>\u7eb5\u5411<input type="radio" name="fnFilmOri" class="fnPrnCall" fnid="fnFilmOri" vl="1">\u6a2a\u5411</P></div>';a.append(d);var b=a.children("#"+e);b.panel({iconCls:"icon-page",collapsible:true,tools:"#prnswitch"+c});b.find("#PrinterList").combobox({valueField:"id",textField:"name",editable:false});b.find("#PrnFilmSize").combobox({valueField:"val",textField:"text",data:WPACS.FILMLIST,editable:false,onSelect:i});WPACS.FILMLIST.length>0&&b.find("#PrnFilmSize").combobox("select",WPACS.FILMLIST[0].val);b.find("#PrnPaperSize").combobox({valueField:"val",textField:"text",data:WPACS.PAPERLIST,editable:false,onSelect:i});WPACS.PAPERLIST.length>0&&b.find("#PrnPaperSize").combobox("select",WPACS.PAPERLIST[0].val);var f=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu1;b.find("#PrinterList").combobox("reload",f+"?naction=1")}function l(){var d="pan"+Math.random()*1e3|0,c=[{val:"0,1,1",png:"layout_11.png"},{val:"0,1,2",png:"layout_12.png"},{val:"0,2,1",png:"layout_21.png"},{val:"0,2,2",png:"layout_22.png"},{val:"-",png:""},{val:"0,2,3",png:"layout_23.png"},{val:"0,3,2",png:"layout_32.png"},{val:"1,1,2",png:"layout_r12.png"},{val:"2,1,2",png:"layout_c12.png"}];f='<div id="'+d+'" class="easyui-panel panel-bk" title=" \u80f6\u7247\u5e03\u5c40" style="width:100%;height:160px;" ><table style="width:100%; border:none; cellspacing:0px; cellpadding:0px;"><tr>';for(var b=0;b<c.length;b++)if(c[b].val!="-")f+='<td><img width="32px" height="32px" class="fnPrnCall" fnid="fnFilmFmt" vl="'+c[b].val+'" src="webpacs/images/film/'+c[b].png+'" /></td>';else f+="</tr><tr>";f+='</tr></table><input type="radio" name="fnFilmUserFmt" class="fnPrnCall" fnid="fnFilmUserFmt" vl="0" checked>\u884cX\u5217<input type="radio" name="fnFilmUserFmt" class="fnPrnCall" fnid="fnFilmUserFmt" vl="1">\u591a\u884c<input type="radio" name="fnFilmUserFmt" class="fnPrnCall" fnid="fnFilmUserFmt" vl="2">\u591a\u5217<input id="txtFilmFmt" class="easyui-textbox" style="width:100%;height:20px"></div>';a.append(f);var e=a.children("#"+d);e.panel({iconCls:"icon-layout",collapsible:true});e.find("#txtFilmFmt").textbox({prompt:"\u8f93\u5165\u884c\u5217\u6570\u503c\u4ee5\u9017\u53f7\u5206\u9694..."})}function k(){var j="pan"+Math.random()*1e3|0;f='<div id="'+j+'" class="easyui-panel panel-bk1" title=" \u56fe\u50cf\u5904\u7406" style="width:100%;height:140px;" >';for(var b=0;b<WPACS.PRNTOOLS.length;b++){var k=WPACS.PRNTOOLS[b].fnid,m=WPACS.PRNTOOLS[b].vl,h="easyui-linkbutton",c=WPACS.PRNTOOLS[b].menu?WPACS.PRNTOOLS[b].menu:"";if(c&&d.prnview){var i=d.prnview.MenuSets();if(i.GetMenu(c).length!=0){h=k?"easyui-splitbutton":"easyui-menubutton";c=",menu:'"+i.GetMenuName("#"+c)+"'"}else c=""}else c="";var l=WPACS.PRNTOOLS[b].title?WPACS.PRNTOOLS[b].title:"";f+='<a href="#" class="'+h+'" title="'+l+'" fnid="'+k+'" vl="'+m+'" data-options="plain:true,iconCls:\''+WPACS.PRNTOOLS[b].icon+"'"+c+'" >'+WPACS.PRNTOOLS[b].text+"</a>"}f+='<br><input type="checkbox" class="fnPrnCall" fnid="fnCascade" vl="" checked>\u8054\u52a8\u5904\u7406<input type="checkbox" class="fnPrnCall" fnid="fnViewtxt" vl="" checked>\u6587\u5b57\u663e\u9690</div>';a.append(f);var e=a.children("#"+j);e.panel({iconCls:"icon-tools",collapsible:true,collapsed:true});e.children("a.easyui-linkbutton").linkbutton({onClick:g});e.children("a.easyui-splitbutton").splitbutton({onClick:g});e.children("a.easyui-menubutton").menubutton({onClick:g})}function m(){var c="div"+(Math.random()*1e3|0),d='<div id="'+c+'" style="position:absolute;top:100%;margin-top:-30px;height:25px;width:100%;">&nbsp;<a class="easyui-linkbutton fnPrnCall" fnid="fnDcmPrint" vl="" style="width:100px" ><label id="PrintText" >\u80f6\u7247\u6253\u5370</label></a>&nbsp;&nbsp;<a href="#" title="\u6253\u5370\u4efd\u6570" class="easyui-tooltip" data-options="position:\'top\'"><input class="easyui-numberspinner" id="FilmCopies" value="1" data-options="min:1,max:10" style="width:40px;"></input></a></div>';a.append(d);var b=a.children("#"+c);b.find("a.easyui-linkbutton").linkbutton({iconCls:"icon-print"});b.find("a.easyui-tooltip").tooltip();b.find("input.easyui-numberspinner").numberspinner()}}function l(){for(var b=0;b<h.length;b++)$(h[b]).remove();h=[];if(a==null)return;a.find(".easyui-combobox").combobox("destroy");a.find(".easyui-splitbutton").splitbutton("destroy");a.find(".easyui-menubutton").menubutton("destroy");a.find(".easyui-panel").panel("destroy",true);a.empty()}function r(){k(false);d.prnview=null;d={};l();a=null;e=null;f=null;if(b!=null){b.remove();b=null}if(c!=null){c.empty();c=null}}function k(f){if(b==null)return;var d=e.find("img.preFrm"),c=e.find("img.nxtFrm"),a=!WPACS.wp0bj1.IsMobile?"click":"touchend";if(f){d.bind(a,function(){m(WPACS.CONSTDEF.wpe3,-1)});c.bind(a,function(){m(WPACS.CONSTDEF.wpe3,-2)})}else{d.unbind(a);c.unbind(a)}}function j(d){k(false);if(WPACS.wp0bj1.isObject(d)){if(c==null||c[0]!=d[0]){c=d;b==null?t():b.appendTo(c)}var h=c.width(),g=c.height();if(b.width()!=h||b.height()!=g){b.width(h);b.height(g);s();o()}b.show();k(true)}else if(c!=null){l();a=null;e=null;f=null;b=null;c.empty();c=null}}function s(){if(b==null)return;var i=b.width(),j=b.height(),k=18,f=40,m="",c=1,l=8;if(d.horiz){var h=i-f,g=j;a.css({left:c,top:c});a.height(g);a.width(h);e.css({left:h+c,top:c});e.height(g);e.width(f)}else{var g=j-f,h=i-5;a.css({left:c,top:c});a.height(g);a.width(h);e.css({left:c,top:g+c});e.height(f);e.width(i)}a.show()}function o(){var b=f!=null?f.attr("sinfo"):"",a="";if(d.horiz)a+='<table class="normalize" style="font-family:\u534e\u6587\u9ed1\u4f53;font-size:18px;color:#B3B9Bb;" ><tr height="36px"><td><img class="preFrm" src="./webpacs/images/preFrm.png" title="'+WPACS.CONSTDEF.STR_THUW_TEXT2+'" style="width:32px;height:32px;margin-left:2px;"></td></tr><tr><td id="pagev" title="'+WPACS.CONSTDEF.STR_THUW_TEXT4+'" style="word-break:break-all"> 0/0 </td></tr><tr height="36px"><td><img class="nxtFrm" src="./webpacs/images/nxtFrm.png" title="'+WPACS.CONSTDEF.STR_THUW_TEXT3+'" style="width:32px;height:32px;margin-left:2px;"></td></tr></table>';else a+='<table class="normalize" style="font-family:\u534e\u6587\u9ed1\u4f53;font-size:18px;color:#B3B9Bb;" ><tr><td width="36px"><img class="preFrm" src="./webpacs/images/preFrm.png" title="'+WPACS.CONSTDEF.STR_THUW_TEXT2+'" style="width:32px;height:32px;margin-left:5px;"></td><td id="pagev" align="center"  title="'+WPACS.CONSTDEF.STR_THUW_TEXT4+'">0/0 </td><td width="36px"><img class="nxtFrm" src="./webpacs/images/nxtFrm.png" title="'+WPACS.CONSTDEF.STR_THUW_TEXT3+'" style="width:32px;height:32px;"></td></tr></table>';e.html(a);f=e.find("#pagev");f.attr("sinfo",b);f.text(b)}function q(c,a){if(f==null)return;var b="";if(a>0)c+=1;if(d.horiz)if(a>=10)b=c+"/ "+a;else b=c+"/"+a;else b=c+"/"+a;f.attr("sinfo",b);f.text(b)}function i(){var c=$(this).combobox("getValue"),a=d.prnview!=null?d.prnview.Action:null,b=$('<a fnid="fnFilmSize" vl="'+c+'" ></a>');a&&a(b)}function p(g){if(g.keyCode!=13)return;var b=0,e=a.find("#txtFilmFmt").textbox("getValue");if(e=="")return;if(a.find("input.fnPrnCall[fnid='fnFilmUserFmt'][vl='1']").prop("checked"))b=1;else if(a.find("input.fnPrnCall[fnid='fnFilmUserFmt'][vl='2']").prop("checked"))b=2;var c=d.prnview!=null?d.prnview.Action:null,f=$('<a fnid="fnFilmFmt" vl="'+b+","+e+'" ></a>');c&&c(f)}function g(){var g=$(this).attr("fnid"),b=d.prnview!=null?d.prnview.Action:null;switch(g){case"fnPrnSwitch":if(a.find("#PrnFilm").is(":visible")){a.find("#PrnFilm").hide();a.find("#PrnPaper").show();a.find("#PrintText").html("\u7eb8\u5f20\u6253\u5370");i.bind($("#PrnPaperSize"))()}else{a.find("#PrnFilm").show();a.find("#PrnPaper").hide();a.find("#PrintText").html("\u80f6\u7247\u6253\u5370");i.bind($("#PrnFilmSize"))()}return;case"fnPrnTest":var f=a.find("#PrinterList").combobox("getValue");b&&b("prntest",f);return;case"fnDcmPrint":var c={type:1,copies:1,dpi:0,prnsize:"",prnid:"",prnname:""};c.copies=a.find("#FilmCopies").val();if(a.find("#PrnFilm").is(":visible")){c.type=1;c.dpi=parseInt(a.find("#PrnFilmSize").attr("dpi"));c.prnsize=a.find("#PrnFilmSize").combobox("getValue");c.prnid=a.find("#PrinterList").combobox("getValue");c.prnname=a.find("#PrinterList").combobox("getText")}else{c.type=0;c.dpi=parseInt(a.find("#PrnPaperSize").attr("dpi"));c.prnsize=a.find("#PrnPaperSize").combobox("getValue")}b&&b("print",c);return;case"fnCascade":var f=$(this).prop("checked")?1:0;b&&b("cascade",f);return;case"fnViewtxt":var f=$(this).prop("checked")?true:false;b&&b("textv",f);return;case"fnFilmFmt":a.find("img.fnPrnCall[fnid='fnFilmFmt']").attr("style","border:none;");$(this).attr("style","border:thin solid #FF0000;");var e=$(this).attr("vl").split(",");if(e.length<3)return;a.find("input.fnPrnCall[fnid='fnFilmUserFmt'][vl='"+e[0]+"']").attr("checked",true);e.splice(0,1);a.find("#txtFilmFmt").textbox("setValue",e.join(","))}g&&b!=null&&b($(this))}function m(b,c){var a=false;if(d.onEvent!=null)a=d.onEvent(b,c);if(a)return true;switch(b){case WPACS.CONSTDEF.wpe3:return true}return false}WPACS.wp0bj1.isObject(n)&&j(n)};WPACS.wp0b25=function(p){var d={filmsize:[14,17],orient:0,textv:true},f=new WPACS.wp0b20,b=new WPACS.wp0b12,h=new WPACS.prToolsWnd,k=new WPACS.wpContextMenu,q=this;this.DestroyObj=function(){v()};this.GetContainer=function(){return c};this.BindContainer=function(a){i(a)};this.ReSize=function(){i(c)};this.SetSize=function(b,a){if(c==null)return;c.width(b);c.height(a);i(c)};this.Options=function(){return d};this.MenuSets=function(){return k};this.AddDicom=function(a){if(!WPACS.wp0bj1.isObject(a))return;if(a.Options().vfmt)return;f.CloneDicom(a)};this.Action=function(a,b){typeof a=="string"?e(a,b):o(a)};function e(e,a){switch(e){case"cascade":if(!WPACS.wp0bj1.isNumberType(a))return;if(a!=0&&a!=1&&a!=2)return;if(b)b.Options().cascade=a;return;case"textv":if(WPACS.wp0bj1.isBooleanType(a))d.textv=a;else d.textv=!d.textv;f&&f.Action("textv",d.textv);return;case"orient":if(WPACS.wp0bj1.isNumberType(a)){d.orient=a;i(c)}return;case"filmsize":d.filmsize[0]=a.w;d.filmsize[1]=a.h;i(c);return;case"layout":b&&b.SetFormat(a.r,a.c);return;case"prntest":WPACS.wp0bj1.isStringType(a)&&u(a);return;case"print":if(WPACS.wp0bj1.isObject(a))a.type==1?z(a):x(a);return}b&&b.Action(e,a)}var c=null,a=null,g=null,j=null;function y(){var d='<div class="prnv" '+WPACS.CONSTDEF.STR_SETS1+' ></div><div class="paperprn" style="display:block;width:100%;height:100%;"></div>';c.append(d);a=c.children("div.prnv");j=c.children("div.paperprn");a.layout({border:false});a.layout("add",{region:"center",noheader:true,border:false,onResize:t});var b=a.layout("panel","center");b.css({overflow:"hidden","background-color":"#9F9F9F"})}function v(){l(false);b!=null&&b.DestroyObj();b=null;f!=null&&f.DestroyObj();f=null;h!=null&&h.DestroyObj();h=null;k!=null&&k.Destroy();k=null;d={};q=null;g=null;j=null;if(a!=null){a.remove();a=null}if(c!=null){c.empty();c=null}}function l(b){if(a==null)return;b}function i(d){if(WPACS.wp0bj1.isObject(d)){if(c==null||c[0]!=d[0]){c=d;a==null?y():a.appendTo(c)}var k=c.width(),i=c.height(),f=k,e=i;a.height(e);a.width(f);w();a.show();return}l(false);if(c==null)return;b!=null&&b.BindContainer(null);h!=null&&h.BindContainer(null);g=null;j=null;a=null;c.empty();c=null}function w(){var f=a.width(),e=a.height(),b=3,c="\u5de5\u5177\u680f",d="";if(b==1){if(a.layout("panel","west").length==0){h.Options().horiz=false;g=null;a.layout("remove","south");a.layout("add",{region:"west",iconCls:d,split:false,width:WPACS.CONSTDEF.TPANELPRN_SIZE,title:c});g=a.layout("panel","west");g.css("overflow","hidden")}}else if(b==2){if(a.layout("panel","south").length==0){h.Options().horiz=true;g=null;a.layout("remove","west");a.layout("remove","east");a.layout("add",{region:"south",iconCls:d,split:true,height:WPACS.CONSTDEF.TPANELPRN_SIZE,title:c});g=a.layout("panel","south");g.css("overflow","hidden")}}else if(b==3){if(a.layout("panel","east").length==0){h.Options().horiz=false;g=null;a.layout("remove","south");a.layout("add",{region:"east",iconCls:d,split:false,width:WPACS.CONSTDEF.TPANELPRN_SIZE,title:c});g=a.layout("panel","east");g.css("overflow","hidden")}}else{g=null;a.layout("remove","east");a.layout("remove","west");a.layout("remove","south")}a.layout("resize",{width:f,height:e})}function t(){h.BindContainer(g);if(a==null)return;l(false);var i=a.layout("panel","center"),f=i.width(),j=i.height(),e,c,k,m;if(d.orient!=2){if(d.orient!=0){e=d.filmsize[1];c=d.filmsize[0]}else{e=d.filmsize[0];c=d.filmsize[1]}var n=Math.floor(j*e/c);if(n<=f){e=n;c=j-2}else{c=Math.floor(f*c/e);e=f-5}k=(f-e)/2|0;m=(j-c)/2|0}else{k=m=0;e=f-5;c=j-2}var o='<div style="position:absolute;padding:0px;left:'+k+"px;top:"+m+"px;width:"+e+"px;height:"+c+'px;"></div>';i.html(o);b!=null&&b.BindContainer(i.children("div"));l(true)}function n(q,p,e){if(!WPACS.wp0bj1.isNumberType(e))e=0;var c=p.split(","),i,h,o=""+c[0]+c[2]+"X"+c[1]+c[2];if(c[2]=="MM"){i=Math.floor(c[0]*e/25.4);h=Math.floor(c[1]*e/25.4)}else if(c[2]=="CM"){i=Math.floor(c[0]*e/2.54);h=Math.floor(c[1]*e/2.54)}else{i=Math.floor(c[0]*e);h=Math.floor(c[1]*e)}if(d.orient!=0){var x=i;i=h;h=x}var s=d.orient==0?"PORTRAIT":"LANDSCAPE",r=b.GetFormat().toString(),n=a.layout("panel","center"),u=n.children("div").width(),t=n.children("div").height(),y,m="",j="<printjob>";j=j+'<setting copies="'+q+'" filmsize="'+o+'" format="'+r+'" orientation="'+s+'" ownerid="" label="" />';for(var l=0;l<f.Length();l++){var g=f.GetImage(l),k=b.ViewSize(l);if(g==null||k==null)break;if(e>0){var w=k.w*i/u&65528,v=k.h*h/t&65528;m=g.wfn35(w,v,"")}else m=g.wfn35(k.w,k.h,"")+"&recalsize=2";j+='<image instuid="'+g.Options().imguid+'" srsuid="'+g.Options().srsuid+'" stuuid="'+g.Options().stuuid+'" optstr="'+encodeURIComponent(m)+'" />'}j+="</printjob>";return j}function u(c){var d=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu1;if(c!=""){var f=d+"?naction=2&prnid="+c,e={type:"GET",url:f,dataType:"json",async:false},b=$.ajax(e);if(b.status!=200)return;try{var a=eval("("+b.responseText+")");if(a.code>0)alert("\u6d4b\u8bd5\u6210\u529f,\u76f8\u673a\u4fe1\u606f\u5982\u4e0b:"+a.desc);else alert("\u6d4b\u8bd5\u5931\u8d25,\u9519\u8bef\u7801: "+a.code+"\r\n\u9519\u8bef\u63cf\u8ff0: "+a.desc)}catch(g){alert(g.name+" : "+g.message+"\r\n"+b.responseText)}}else alert("\u8bf7\u9009\u62e9\u76f8\u673a")}function z(a){if(!f||f.Length()<1){alert("\u6ca1\u6709\u8981\u6253\u5370\u8f93\u51fa\u7684\u56fe\u50cf");return}var d=a.copies,m=a.dpi,j=a.prnsize,e=a.prnid,i=a.prnname,g=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu1;if(e!=""){if(!confirm("\u786e\u5b9a\u6253\u5370 "+d+" \u4efd\u80f6\u7247\u5230\u76f8\u673a '"+i+"' ?"))return;var k=n(d,j,m),l=g+"?naction=3&prnid="+e,h={type:"POST",url:l,data:k,dataType:"json",async:false,headers:{"content-type":"text/xml;"}},c=$.ajax(h);if(c.status!=200)return;try{var b=eval("("+c.responseText+")");if(b.code==0)alert("\u6253\u5370\u6210\u529f "+b.desc);else alert("\u6253\u5370\u5931\u8d25,\u9519\u8bef\u7801: "+b.code+"\r\n\u9519\u8bef\u63cf\u8ff0: "+b.desc)}catch(o){alert(o.name+" : "+o.message+"\r\n"+c.responseText)}}else alert("\u8bf7\u9009\u62e9\u76f8\u673a")}function x(c){if(!f||f.Length()<1){alert("\u6ca1\u6709\u8981\u6253\u5370\u8f93\u51fa\u7684\u56fe\u50cf");return}var g=c.copies,r=c.dpi,m=c.prnsize;if(!confirm("\u786e\u5b9a\u6253\u5370 "+g+" \u4efd\u7eb8\u8d28\u80f6\u7247?"))return;var o=n(g,m,r),p=b.Options().ipage,h=b.GetFormat().options.n,i=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu1,d=i+"?naction=4&idxfb="+p+"&imginp="+h+"&maxsize=1200",l={type:"POST",url:d,data:o,dataType:"json",async:false,headers:{"content-type":"text/xml;"}},e=$.ajax(l);if(e.status!=200)return;try{var a=eval("("+e.responseText+")");if(a.code==0){var k=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu5;d=k+"?requesttype=VURL"+a.vurl;var q='<img src="'+d+'" />';if(j){j.html(q);j.jqprint({debug:false})}}else alert("\u6253\u5370\u5931\u8d25,\u9519\u8bef\u7801: "+a.code+"\r\n\u9519\u8bef\u63cf\u8ff0: "+a.desc)}catch(s){alert(s.name+" : "+s.message+"\r\n"+e.responseText)}}function s(){var c=b.Options().ipage,a=b.GetPages();h.SetPageInfo(c,a)}function r(a){a.Options().textv=d.textv;a.SetViewMode(WPACS.CONSTDEF.VMODE_WADO);window.setTimeout(function(){b.SetPage(b.GetPages()-1)},500)}function o(d){if(d.disabled)return;var g="",a="";if(d.target){g=!WPACS.wp0bj1.isUndefined(d.target.attributes.fnid)?d.target.attributes.fnid.value:"";a=!WPACS.wp0bj1.isUndefined(d.target.attributes.vl)?d.target.attributes.vl.value:""}else{g=d.attr("fnid");a=d.attr("vl")}switch(g){case"fnClear":f.Clear();return;case"fnDelete":f.DelImage(b.Options().idcmv);return;case"fnFilmOri":e("orient",parseInt(a));return;case"fnFilmSize":var c=a.split(",");e("filmsize",{w:c[0],h:c[1]});return;case"fnFilmFmt":var c=a.split(",");if(c.length<3)return;if(c[0]=="1"){c.splice(0,1);e("layout",{r:c,c:undefined})}else if(c[0]=="2"){c.splice(0,1);e("layout",{r:undefined,c:c})}else e("layout",{r:c[1],c:c[2]});return;case"fnCascade":e("cascade",parseInt(a));return;case"fnOpmode":e("opmode",parseInt(a));return;case"fnReload":e("reload",a);return;case"fnInvert":e("invert");return;case"fnFlip":e("flip",a=="1");return;case"fnRotate":e("rotate",a=="1");return;case"fnPsuedo":e("psuedo",parseInt(a));return;case"fnZoom":var c=a.split(","),j=parseInt(c[0]),i=c.length>1?parseInt(c[1]):0;e("zoom",{iratio:j,dratio:i});return;case"fnEnhance":var c=a.split(",");e("enhance",{n:parseInt(c[0]),f:parseFloat(c[1])});return;case"fnWwwl":if(a=="")if(!(a=prompt("\u8bf7\u8f93\u5165\u7a97\u5bbd \u7a97\u4f4d\u503c","")))return;var k=/[ ,;]/,h=a.split(k);h.length==2&&e("wwwl",{ww:parseInt(h[0]),wc:parseInt(h[1]),dw:0,dc:0});return}g!=""&&e(g,a)}function m(c,a){switch(c){case WPACS.CONSTDEF.wpe3:b.Action("ipage",a);return true;case WPACS.CONSTDEF.wpe5:b.Action("zoom",a);return true;case WPACS.CONSTDEF.wpe6:b.Action("move",a);return true;case WPACS.CONSTDEF.wpe7:b.Action("wwwl",a);return true;case WPACS.CONSTDEF.wpe4:s();return true;case WPACS.CONSTDEF.wpe12:r(a);return true}return false}k.InitPrnMenu(o);h.Options().prnview=q;h.Options().onEvent=m;f.Options().onCreate=m;b.Options().onEvent=m;b.SetDcmSet(f);b.Action("opmode",7);WPACS.wp0bj1.isObject(p)&&i(p)};(function(a){a.fn.wpPrnview=function(b,c){if(typeof b=="string")return a.fn.wpPrnview.methods[b](this,c);b=b||{};return this.each(function(){var c=a.data(this,"wpprnv");if(!c){var e=a.fn.wpPrnview.parseOptions(this),d=a.extend({},a.fn.wpPrnview.defaults,e,b),f=new WPACS.wp0b25(a(this),d);a.data(this,"wpprnv",{options:d,prnview:f})}else a.extend(c.options,b)})};a.fn.wpPrnview.methods={options:function(c){var b=a.data(c[0],"wpprnv");return b?b.options:{}},resize:function(c,b){return c.each(function(){var c=a.data(this,"wpprnv");if(c)!b?c.prnview.ReSize():c.prnview.SetSize(b.width,b.height)})},action:function(b){return b.each(function(){var b=a.data(this,"wpprnv");b&&b.prnview.Action(name,params)})},getobj:function(d,b){if(!(typeof b==="number"&&isFinite(b)))b=0;if(b>=0&&b<d.length){var c=a.data(d[b],"wpprnv");return c?c.prnview:null}return null}};a.fn.wpPrnview.parseOptions=function(b){var c=a(b);return a.extend({},a.parser.parseOptions(b,[]))};a.fn.wpPrnview.defaults={};a.parser.plugins.push("wpPrnview")})(jQuery);var WPACS=WPACS||{};WPACS.RegName="";WPACS.wpOptions=function(g){var c={title:"WPACS",icon:"",tools:"",stuview:null};this.DestroyObj=function(){i()};this.GetContainer=function(){return b};this.BindContainer=function(a){d(a)};this.ReSize=function(){d(b)};this.Options=function(){return c};this.onBeforeClose=function(){return true};var b=null,a=null;function j(){var e=new WPACS.wp0b21,d=e.GetOrthoProj()!=null;if(!d)WPACS.CONSTDEF.DAT3NATIV=false;e.DestroyObj();e=null;var c='<div style="width:inherit;height:inherit;background-color:#EDF3FF" ><img src="./webpacs/images/wpacs.png" width=466 height=53 ><br><span style="font-family:\u534e\u6587\u9ed1\u4f53;font-size:14px;color:#FF7F27;">'+WPACS.CONSTDEF.STR_IMPL_TEXT+'</span><br><br><a href="#" fnid="fnCache" vl="" >\u6e05\u7a7a\u672c\u5730\u7f13\u5b58</a>&nbsp;&nbsp;&nbsp;<a href="#" fnid="fnMglass" vl="" ></a>';if(WPACS.wp0bj1.Canvas){c+='&nbsp;&nbsp;&nbsp;<a href="#" fnid="fnVwmode" vl="" ></a>';if(b.width()<450){c+='<hr><a href="#" fnid="fnDLossy" vl="" ></a>&nbsp;&nbsp;&nbsp;';if(d)c+='<a href="#" fnid="fnD3mode" vl="" ></a>'}else{c+='&nbsp;&nbsp;&nbsp;<a href="#" fnid="fnDLossy" vl="" ></a>';if(d)c+='<hr><a href="#" fnid="fnD3mode" vl="" ></a>'}}c+='<br><br><span style="font-family:\u534e\u6587\u9ed1\u4f53;font-size:12px;">'+(WPACS.wp0bj1.IsMobile?"\u79fb\u52a8\u7aef\u6d4f\u89c8\u5668: ":"PC\u7aef\u6d4f\u89c8\u5668: ")+navigator.userAgent+"<br>Canvas: "+WPACS.wp0bj1.Canvas+" , localStorage: "+WPACS.wp0bj1.Storage+" , ArrayBuffer: "+WPACS.wp0bj1.ArrayBuff+"</span></div>";b.append(c);a=b.children("div")}function i(){e(false);c.tools!=""&&$(c.tools).remove();c.stuview=null;c={};if(a!=null){a.remove();a=null}if(b!=null){b.empty();b=null}}function e(b){if(a==null)return;if(b)a.children("a").bind("click",h);else a.children("a").unbind("click")}function d(c){e(false);if(WPACS.wp0bj1.isObject(c)){if(b==null||b[0]!=c[0]){b=c;a==null?j():a.appendTo(b)}f();e(true)}else if(b!=null){a=null;b.empty();b=null}}function f(){var d=c.stuview!=null?c.stuview.Options().vwmode:1,b=d!=WPACS.CONSTDEF.VMODE_WADO?WPACS.CONSTDEF.STR_VMODE_TEXT1:WPACS.CONSTDEF.STR_VMODE_TEXT2;a.children("a[fnid='fnVwmode']").text(b);if(d!=WPACS.CONSTDEF.VMODE_WADO){b=WPACS.CONSTDEF.DATALOSSY?WPACS.CONSTDEF.STR_DLOSSY_TEXT1:WPACS.CONSTDEF.STR_DLOSSY_TEXT2;a.children("a[fnid='fnDLossy']").text(b)}else a.children("a[fnid='fnDLossy']").text("");b=WPACS.CONSTDEF.MGLASS_FILTER?WPACS.CONSTDEF.STR_MGLASS_TEXT1:WPACS.CONSTDEF.STR_MGLASS_TEXT2;a.children("a[fnid='fnMglass']").text(b);if(a.children("a[fnid='fnD3mode']").length>0){b=WPACS.CONSTDEF.DAT3NATIV?WPACS.CONSTDEF.STR_D3MODE_TEXT1:WPACS.CONSTDEF.STR_D3MODE_TEXT2;a.children("a[fnid='fnD3mode']").text(b)}}function h(){if(c.stuview==null)return;var a=$(this).attr("fnid");if(a=="fnMglass")WPACS.CONSTDEF.MGLASS_FILTER=!WPACS.CONSTDEF.MGLASS_FILTER;else if(a=="fnDLossy")c.stuview.Action("dlossy");else if(a=="fnD3mode")WPACS.CONSTDEF.DAT3NATIV=!WPACS.CONSTDEF.DAT3NATIV;else c.stuview.Action($(this));f();if(WPACS.CONSTDEF.USERSETTINGS)if(a!="fnCache")WPACS.SaveSetting();else WPACS.DeleSetting()}c.title=WPACS.CONSTDEF.STR_IMPL_MARK+" ("+WPACS.RegName+")";WPACS.wp0bj1.isObject(g)&&d(g)};WPACS.wpFusionWnd=function(g){var c={title:"PETCT\u878d\u5408",icon:"icon_fu",tools:"",stuview:null};this.DestroyObj=function(){i()};this.GetContainer=function(){return a};this.BindContainer=function(a){e(a)};this.ReSize=function(){e(a)};this.Options=function(){return c};this.onBeforeClose=function(){c.stuview!=null&&c.stuview.Action("petct","");return true};var a=null,b=null,d=null;function j(){var c='<div style="position:relative;width:250px;height:80px;padding-left:10px;padding-top:10px;" ><div id="ssFusion" style="aligne:center;width:220px;" title="\u878d\u5408\u7cfb\u6570" ></div></div>';a.append(c);b=a.children("div");d=b.children("#ssFusion");d.slider({mode:"h",onChange:h,min:1,max:10,value:5,showTip:true})}function i(){c.stuview!=null&&c.stuview.Action("petct","");f(false);c.tools!=""&&$(c.tools).remove();c.stuview=null;c={};d=null;if(b!=null){b.remove();b=null}if(a!=null){a.empty();a=null}}function f(a){if(b==null)return;a}function e(c){f(false);if(WPACS.wp0bj1.isObject(c)){if(a==null||a[0]!=c[0]){a=c;b==null?j():b.appendTo(a)}var e=a.width(),g=a.height();b.height(g);b.width(e);d.width(e-40);b.show();f(true)}else if(a!=null){d=null;b=null;a.empty();a=null}}function h(a){c.ipage=a;var b=","+a/10;c.stuview!=null&&c.stuview.Action("petct",b)}WPACS.wp0bj1.isObject(g)&&e(g)};WPACS.wpPlayBar=function(i){var a={title:"\u5e8f\u5217\u64ad\u653e\u63a7\u5236",icon:"icon-cine",tools:"",stuview:null,npages:1,ipage:1,status:false,mspeed:1e3},e=[100,300,1e3,2e3,3e3];this.DestroyObj=function(){m()};this.GetContainer=function(){return c};this.BindContainer=function(a){g(a)};this.ReSize=function(){g(c)};this.Options=function(){return a};this.onBeforeClose=function(){a.status=false;var c=b!=null?b.children(".easyui-linkbutton[fnid='stop']"):undefined;if(c!=undefined&&c.length>0){c.attr("fnid","play");c.linkbutton({text:"\u64ad\u653e"})}return true};this.SetPages=function(b,c){a.npages=b;a.ipage=c+1;if(d!=null){d.slider({min:1,max:a.npages});d.slider("setValue",a.ipage)}};function j(){if(!a.status||a.npages<2)return;var b=a.ipage+1;if(b>a.npages)b=1;d.slider("setValue",b);a.tt=window.setTimeout(j,a.mspeed)}var c=null,b=null,d=null,f=null;function n(){var e='<div style="position:relative;width:250px;height:80px;padding-left:10px;padding-top:10px;" ><div id="ssPage" style="aligne:center;width:220px;"></div><span class="easyui-linkbutton" fnid="spsub" data-options="iconCls:\'icon-remove\'">\u51cf\u901f</span>&nbsp;<span class="easyui-linkbutton" fnid="spadd" data-options="iconCls:\'icon-add\'">\u52a0\u901f</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="easyui-linkbutton" fnid="play" data-options="iconCls:\'icon-cine\'">\u64ad\u653e</span></div>';c.append(e);b=c.children("div");f=null;d=b.children("#ssPage");d.slider({mode:"h",onChange:k,min:1,max:a.npages,value:a.ipage,showTip:true});b.children(".easyui-linkbutton").linkbutton({onClick:l})}function m(){a.status=false;h(false);a.tools!=""&&$(a.tools).remove();a.stuview=null;a={};d=null;f=null;if(b!=null){b.remove();b=null}if(c!=null){c.empty();c=null}}function h(a){if(b==null)return;a}function g(a){h(false);if(WPACS.wp0bj1.isObject(a)){if(c==null||c[0]!=a[0]){c=a;b==null?n():b.appendTo(c)}var e=c.width(),g=c.height();b.height(g);b.width(e);d.width(e-40);b.show();h(true)}else if(c!=null){d=null;f=null;b=null;c.empty();c=null}}function k(b){a.ipage=b;a.stuview!=null&&a.stuview.Action("ipage",b-1)}function l(){var d=$(this).attr("fnid");switch(d){case"play":a.status=true;$(this).attr("fnid","stop");$(this).linkbutton({text:"\u505c\u6b62"});j();break;case"stop":a.status=false;$(this).attr("fnid","play");$(this).linkbutton({text:"\u64ad\u653e"});break;case"spadd":case"spsub":for(var c=0;c<e.length;c++)if(a.mspeed<=e[c])break;if(d=="spadd")c-=1;else c+=1;if(c<0)c=0;else if(c>=e.length)c=e.length-1;a.mspeed=e[c];b.children(".easyui-linkbutton[fnid='spadd']").linkbutton({disabled:c==0});b.children(".easyui-linkbutton[fnid='spsub']").linkbutton({disabled:c==e.length-1});f&&f.text(a.mspeed+"ms")}}WPACS.wp0bj1.isObject(i)&&g(i)};WPACS.wpFrameBar=function(i){var a={title:"\u591a\u5e27\u56fe\u50cf\u64ad\u653e\u63a7\u5236",icon:"icon-cine",tools:"",stuview:null,nframes:1,iframe:1,status:false,mspeed:500},e=[50,200,500,1e3,2e3];this.DestroyObj=function(){m()};this.GetContainer=function(){return c};this.BindContainer=function(a){g(a)};this.ReSize=function(){g(c)};this.Options=function(){return a};this.onBeforeClose=function(){a.status=false;var c=b!=null?b.children(".easyui-linkbutton[fnid='stop']"):undefined;if(c!=undefined&&c.length>0){c.attr("fnid","play");c.linkbutton({text:"\u64ad\u653e"})}return true};this.SetFrames=function(b,c){a.nframes=b;a.iframe=c+1;if(d!=null){d.slider({min:1,max:a.nframes});d.slider("setValue",a.iframe)}};function j(){if(!a.status||a.npages<2)return;var b=a.iframe+1;if(b>a.nframes)b=1;d.slider("setValue",b);a.tt=window.setTimeout(j,a.mspeed)}var c=null,b=null,d=null,f=null;function n(){var e='<div style="position:relative;width:250px;height:80px;padding-left:10px;padding-top:10px;" ><div id="ssFrame" style="aligne:center;width:220px;"></div><span class="easyui-linkbutton" fnid="spsub" data-options="iconCls:\'icon-remove\'">\u51cf\u901f</span>&nbsp;<span class="easyui-linkbutton" fnid="spadd" data-options="iconCls:\'icon-add\'">\u52a0\u901f</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="easyui-linkbutton" fnid="play" data-options="iconCls:\'icon-cine\'">\u64ad\u653e</span></div>';c.append(e);b=c.children("div");f=null;d=b.children("#ssFrame");d.slider({mode:"h",onChange:k,min:1,max:a.nframes,value:a.iframe,showTip:true});b.children(".easyui-linkbutton").linkbutton({onClick:l})}function m(){a.status=false;h(false);a.tools!=""&&$(a.tools).remove();a.stuview=null;a={};d=null;f=null;if(b!=null){b.remove();b=null}if(c!=null){c.empty();c=null}}function h(a){if(b==null)return;a}function g(a){h(false);if(WPACS.wp0bj1.isObject(a)){if(c==null||c[0]!=a[0]){c=a;b==null?n():b.appendTo(c)}var e=c.width(),g=c.height();b.height(g);b.width(e);d.width(e-40);b.show();h(true)}else if(c!=null){d=null;f=null;b=null;c.empty();c=null}}function k(b){a.iframe=b;a.stuview!=null&&a.stuview.Action("iframe",b-1)}function l(){var d=$(this).attr("fnid");switch(d){case"play":a.status=true;$(this).attr("fnid","stop");$(this).linkbutton({text:"\u505c\u6b62"});j();break;case"stop":a.status=false;$(this).attr("fnid","play");$(this).linkbutton({text:"\u64ad\u653e"});break;case"spadd":case"spsub":for(var c=0;c<e.length;c++)if(a.mspeed<=e[c])break;if(d=="spadd")c-=1;else c+=1;if(c<0)c=0;else if(c>=e.length)c=e.length-1;a.mspeed=e[c];b.children(".easyui-linkbutton[fnid='spadd']").linkbutton({disabled:c==0});b.children(".easyui-linkbutton[fnid='spsub']").linkbutton({disabled:c==e.length-1});f&&f.text(a.mspeed+"ms")}}WPACS.wp0bj1.isObject(i)&&g(i)};WPACS.wpHistgram=function(o){var j=new WPACS.MouseHandlers,f={title:"\u7070\u5ea6\u76f4\u65b9\u56fe",icon:"icon-hist",tools:"",stuview:null},a=null,e={pt:[{x:0,y:0},{x:0,y:0},{x:0,y:0}],dx:0};this.DestroyObj=function(){p()};this.GetContainer=function(){return b};this.BindContainer=function(a){k(a)};this.ReSize=function(){k(b)};this.Options=function(){return f};this.onBeforeClose=function(){return true};this.SetHistgram=function(b){if(a!=null)a.hsg=null;a=b;h()};var b=null,d=null,c=null;function q(){var a='<div style="position:relative;width:inherit;" ><canvas style="position:relative;" title="'+WPACS.CONSTDEF.STR_HISTG_TEXT1+'" /><div style="position:relative;height:25px;width:inherit;background-color:#354B66;padding:5px;font-weight:bold;font-family:\u534e\u6587\u9ed1\u4f53;font-size:16px;color:#B3B9Bb;"></div></div>';b.append(a);d=b.children("div");c=d.children("canvas")}function p(){l(false);if(a!=null){a.hsg=null;a=null}f.tools!=""&&$(f.tools).remove();f.stuview=null;f={};c=null;if(d!=null){d.remove();d=null}if(b!=null){b.empty();b=null}j.UnBindAll(null);j=null}function l(b){if(d==null)return;if(b){var a={mousedown:i,mousemove:i,mouseup:i,mouseclick:null,mousedblclick:null,mousewheel:i,mouseswipe:null,mouserotate:null,mousepinch:null};j.BindElem(c,a)}else j.UnBindElem(c)}function k(a){l(false);if(WPACS.wp0bj1.isObject(a)){if(b==null||b[0]!=a[0]){b=a;d==null?q():d.appendTo(b)}var f=b.width(),e=b.height();d.height(e);d.width(f);c[0].width=f;c[0].height=e-25;h();d.show();l(true)}else if(b!=null){c=null;d=null;b.empty();b=null}}function h(){if(c==null)return;var u=c[0].width,v=c[0].height,b=c[0].getContext("2d");c[0].width=c[0].width;if(a==null)return;var y="#aabb00",x="#00aabb",r="#000000",k=5,i=v-15,j=a.wc-(a.ww/2|0),p=j+a.ww,m=j>a.minVal?a.minVal:j,w=p<a.maxVal?a.maxVal:p;b.save();b.lineWidth=1;b.strokeStyle=r;b.beginPath();b.moveTo(0,i);b.lineTo(u,i);b.moveTo(k,0);b.lineTo(k,v);b.stroke();b.restore();WPACS.wp0bj7.DrawMetaText(b,""+m,r,k+5,i+12,"start","","12px arial");WPACS.wp0bj7.DrawMetaText(b,""+w,r,u-5,i+12,"end","","12px arial");var l=u-2*k,s=i-5,o=w-m+1,h=5,q=-3,A=a.hsg.length;b.save();b.translate(k,i);b.lineWidth=1;b.strokeStyle=r;b.beginPath();b.moveTo(h,0);b.lineTo(h,5);b.moveTo(h+l-1,0);b.lineTo(h+l-1,5);b.stroke();b.strokeStyle=x;b.beginPath();for(var z=a.minVal-m,n=0;n<A;n++){var f=h+(n+z)*l/o|0,g=q-a.hsg[n]*s/a.maxCount|0;b.lineTo(f,g)}b.stroke();b.restore();if(a.ww!=0){b.save();b.translate(k,i);b.lineWidth=1;b.strokeStyle=y;b.beginPath();var f=h+(j-m)*l/o|0,g=q;b.moveTo(f,g);for(var n=j+1;n<p;n++){var f=h+(n-m)*l/o|0,g=q-Math.floor(s*Math.pow((n-j)/a.ww,a.gamma));b.lineTo(f,g)}b.stroke();e.dx=o/l;f=h+(j-m)*l/o|0;g=q;t(f,g);e.pt[0].x=f+k;e.pt[0].y=g+i;f=h+((p+j)/2-m)*l/o|0;g=q-Math.floor(s*Math.pow((p-j)/2/a.ww,a.gamma));t(f,g);e.pt[1].x=f+k;e.pt[1].y=g+i;f=h+(p-m)*l/o|0;g=q-s;t(f,g);e.pt[2].x=f+k;e.pt[2].y=g+i;b.restore()}d.children("div").text("WW:"+a.ww+" WC:"+a.wc+" Gamma:"+a.gamma.toFixed(1));function t(d,e){var c="#00dd00",a=5;b.strokeStyle=c;b.beginPath();b.rect(d-a,e-a,2*a,2*a);b.stroke()}}var g=-1;function m(j,i,k){if(c==null||a==null)return false;if(j==0){g=l(i,k);return g!=-1}if(g==-1)return false;if(j!=2){var b=a.wc-(a.ww/2|0),d=b+a.ww;if(g==0){b+=i*e.dx|0;a.ww=d-b+1;a.wc=b+a.ww/2|0}else if(g==1)n(k);else if(g==2){d+=i*e.dx|0;a.ww=d-b+1;a.wc=b+a.ww/2|0}else return false;h();var m={ww:a.ww,wc:a.wc,gamma:a.gamma};f.stuview!=null&&f.stuview.Action("gamma",m)}else g=-1;return true;function l(f,g){for(var a=0;a<e.pt.length;a++){var b=e.pt[a].x-f,c=e.pt[a].y-g,d=Math.sqrt(b*b+c*c);if(d<(WPACS.wp0bj1.IsMobile?30:10))return a}return-1}}function i(b){var c=b.type,d=b.which;if(c=="down"){if(d==1)if(m(0,b.x,b.y)){b.event.stopPropagation();return}}else if(c=="move"){if(d==1)if(m(1,b.dx,b.dy)){b.event.stopPropagation();return}}else if(c=="up"){if(d==1)if(m(2,b.x,b.y)){b.event.stopPropagation();return}}else if(c=="wheel"){if(a==null)return;n(0-b.delta);h();var e={ww:a.ww,wc:a.wc,gamma:a.gamma};f.stuview!=null&&f.stuview.Action("gamma",e)}}function n(b){if(a.gamma==1)if(b>0)a.gamma+=.5;else a.gamma-=.1;else if(a.gamma>1)a.gamma+=b>0?.5:-.5;else a.gamma+=b>0?.1:-.1;if(a.gamma>10)a.gamma=10;else if(a.gamma<.1)a.gamma=.1}WPACS.wp0bj1.isObject(o)&&k(o)};WPACS.wp0b37=function(g){var c={title:"\u4e09\u7ef4\u5904\u7406\u663e\u793a",icon:"icon-3d",tools:"",stuview:null,srsuid:"",stuuid:""},d=null;this.DestroyObj=function(){i()};this.GetContainer=function(){return b};this.BindContainer=function(a){e(a)};this.ReSize=function(){e(b)};this.Options=function(){return c};this.onBeforeClose=function(){if(a==null)return true;if(!WPACS.wp0bj1.isObject(d)){var b=a[0].contentWindow;if(!b.BeforeUnload())return false;a.attr("src","");return true}return true};this.View3d=function(a,b){c.srsuid=a;c.stuuid=b;h()};var b=null,a=null;function j(){if(!WPACS.wp0bj1.isObject(d)){var c='<iframe src="" style="scrolling="no" frameborder="0" ></iframe>';b.append(c);a=b.children("iframe")}else{var c='<div style="position:relative;overflow:hidden;padding:0px;" ></div>';b.append(c);a=b.children("div")}}function i(){f(false);d&&d.DestroyObj();d=null;c.tools!=""&&$(c.tools).remove();c.stuview=null;c={};if(a!=null){a.remove();a=null}if(b!=null){b.empty();b=null}}function f(d){if(a==null)return;function c(a){if(a.preventDefault)a.preventDefault();else a.returnValue=false}var b=WPACS.wp0bj1.Browser.Mobile.iOS;if(d)b&&a.bind("touchmove",c);else b&&a.unbind("touchmove")}function e(c){f(false);if(WPACS.wp0bj1.isObject(c)){if(b==null||b[0]!=c[0]){b=c;a==null?j():a.appendTo(b)}var g=b.width(),e=b.height();if(a.width()!=g||a.height()!=e){a.height(e);a.width(g);h()}a.show();f(true)}else if(b!=null){d&&d.BindContainer(null);a=null;b.empty();b=null}}function h(){if(a==null)return;if(!WPACS.wp0bj1.isObject(d)){var f=a.attr("src"),e=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu2,b=e+"?srsuid="+c.srsuid+"&stuuid="+c.stuuid;f!=b&&a.attr("src",b)}}WPACS.wp0bj1.isObject(g)&&e(g)};WPACS.wp0b33=function(g){var c={title:"WPACS\u4e09\u7ef4\u5904\u7406",icon:"icon-3d",tools:"",stuview:null,srsuid:"",stuuid:"",mod:""},d=new WPACS.wp0b36;this.DestroyObj=function(){i()};this.GetContainer=function(){return a};this.BindContainer=function(a){e(a)};this.ReSize=function(){e(a)};this.Options=function(){return c};this.onBeforeClose=function(){d&&d.View3d("","");return true};this.View3d=function(a,b,d){c.srsuid=a;c.stuuid=b;c.mod=d.toUpperCase();h()};var a=null,b=null;function j(){if(!WPACS.wp0bj1.isObject(d)){var c='<iframe src="" style="scrolling="no" frameborder="0" ></iframe>';a.append(c);b=a.children("iframe")}else{var c='<div style="position:relative;overflow:hidden;padding:0px;" ></div>';a.append(c);b=a.children("div")}}function i(){f(false);d&&d.DestroyObj();d=null;c.tools!=""&&$(c.tools).remove();c.stuview=null;c={};if(b!=null){b.remove();b=null}if(a!=null){a.empty();a=null}}function f(d){if(b==null)return;function c(a){if(a.preventDefault)a.preventDefault();else a.returnValue=false}var a=WPACS.wp0bj1.Browser.Mobile.iOS;if(d)a&&b.bind("touchmove",c);else a&&b.unbind("touchmove")}function e(c){f(false);if(WPACS.wp0bj1.isObject(c)){if(a==null||a[0]!=c[0]){a=c;b==null?j():b.appendTo(a)}var g=a.width(),e=a.height();if(b.width()!=g||b.height()!=e){b.height(e);b.width(g);d&&d.BindContainer(b)}h();b.show();f(true)}else if(a!=null){d&&d.BindContainer(null);b=null;a.empty();a=null}}function h(){if(d==null)return;if(c.srsuid!="")c.srsuid!=d.GetSeries()&&d.View3d(c.srsuid,c.stuuid,c.mod)}c.title=WPACS.CONSTDEF.STR_IMPL_MARK+"\u4e09\u7ef4\u5904\u7406";WPACS.wp0bj1.isObject(g)&&e(g)};WPACS.wp0b34=function(g){var d={title:"\u80f6\u7247\u6392\u7248\u6253\u5370",icon:"icon-print",tools:"",stuview:null},c=null;this.DestroyObj=function(){i()};this.GetContainer=function(){return b};this.BindContainer=function(a){e(a)};this.ReSize=function(){e(b)};this.Options=function(){return d};this.onBeforeClose=function(){return true};this.AddDicom=function(b){if(a==null)return;if(!WPACS.wp0bj1.isObject(c)){var d=a[0].contentWindow;d.AddDicom2Print(b)}else c.AddDicom(b)};var b=null,a=null;function j(){if(!WPACS.wp0bj1.isObject(c)){var d='<iframe src="" style="scrolling="no" frameborder="0" ></iframe>';b.append(d);a=b.children("iframe")}else{var d='<div style="position:relative;overflow:hidden;padding:0px;" ></div>';b.append(d);a=b.children("div")}}function i(){f(false);c&&c.DestroyObj();c=null;d.tools!=""&&$(d.tools).remove();d.stuview=null;d={};if(a!=null){a.remove();a=null}if(b!=null){b.empty();b=null}}function f(d){if(a==null)return;function c(a){if(a.preventDefault)a.preventDefault();else a.returnValue=false}var b=WPACS.wp0bj1.Browser.Mobile.iOS;if(d)b&&a.bind("touchmove",c);else b&&a.unbind("touchmove")}function e(d){f(false);if(WPACS.wp0bj1.isObject(d)){if(b==null||b[0]!=d[0]){b=d;a==null?j():a.appendTo(b)}var h=b.width(),g=b.height();if(a.width()!=h||a.height()!=g){a.height(g);a.width(h);if(!WPACS.wp0bj1.isObject(c)){var i=a.attr("src"),e=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu1;i!=e&&a.attr("src",e)}else c.BindContainer(a)}a.show();f(true)}else if(b!=null){c&&c.BindContainer(null);a=null;b.empty();b=null}}function h(){var b=Math.random()*1e3|0,a="dlgtt"+b,c='<div id="'+a+'"><a href="#" fnid="fnAddFilm" vl="" class="icon-add" title="'+WPACS.CONSTDEF.STR_PRINT_ADDTIP+'" ></a></div>';$("body").append(c);d.tools="#"+a}h();WPACS.wp0bj1.isObject(g)&&e(g)};WPACS.wp0b35=function(g){var d={title:"DICOM RT\u6d4f\u89c8",icon:"icon-rtview",tools:"",stuview:null,rtssuid:"",planuid:"",doseuid:""},c=new WPACS.wp0b23;this.DestroyObj=function(){i()};this.GetContainer=function(){return a};this.BindContainer=function(a){e(a)};this.ReSize=function(){e(a)};this.Options=function(){return d};this.onBeforeClose=function(){c&&c.wfn18("","","");return true};this.wfn18=function(a,c,b){d.rtssuid=a;d.planuid=c;d.doseuid=b;h()};this.Action=function(b,a){c&&c.Action(b,a)};var a=null,b=null;function j(){var c='<div style="position:relative;overflow:hidden;padding:0px;" ></div>';a.append(c);b=a.children("div")}function i(){f(false);c&&c.DestroyObj();c=null;d.tools!=""&&$(d.tools).remove();d.stuview=null;d={};if(b!=null){b.remove();b=null}if(a!=null){a.empty();a=null}}function f(d){if(b==null)return;function c(a){if(a.preventDefault)a.preventDefault();else a.returnValue=false}var a=WPACS.wp0bj1.Browser.Mobile.iOS;if(d)a&&b.bind("touchmove",c);else a&&b.unbind("touchmove")}function e(d){f(false);if(WPACS.wp0bj1.isObject(d)){if(a==null||a[0]!=d[0]){a=d;b==null?j():b.appendTo(a)}var g=a.width(),e=a.height();if(b.width()!=g||b.height()!=e){b.height(e);b.width(g);c.BindContainer(b)}h();b.show();f(true)}else if(a!=null){c&&c.BindContainer(null);b=null;a.empty();a=null}}function h(){if(c==null)return;if(d.rtssuid!="")d.rtssuid!=c.Options().rtssuid&&c.wfn18(d.rtssuid,d.planuid,d.doseuid)}WPACS.wp0bj1.isObject(g)&&e(g)};WPACS.wpStudyList=function(g){var c={title:"\u68c0\u67e5\u5217\u8868\u67e5\u8be2",icon:"icon-user",tools:"",stuview:null};this.DestroyObj=function(){h()};this.GetContainer=function(){return a};this.BindContainer=function(a){d(a)};this.ReSize=function(){d(a)};this.Options=function(){return c};this.onBeforeClose=function(){return true};var a=null,b=null;function k(){var c='<table style="width:100%;height:100%" ></table><div id="tb_qrystu" style="padding:5px;height:60px;">\u65e5\u671f:<select id="studate" style="width:80px;" ></select>&nbsp;\u7c7b\u578b:<select id="stumod" style="width:80px;" ></select>&nbsp;&nbsp;<a id="search" >\u67e5\u8be2</a>&nbsp;<input id="chkAppend" type="checkbox">\u8ffd\u52a0\u6253\u5f00\u68c0\u67e5&nbsp;&nbsp;&nbsp;&nbsp;<span id="txtMessage" class="tipmsg"></span><p>&nbsp;PID:<input id="pid" style="width:80px"  >&nbsp;\u59d3\u540d:<input id="pname" style="width:80px" >&nbsp;\u68c0\u67e5\u53f7:<input id="accessno" style="width:80px" >&nbsp;&nbsp;<a href="#" id="shareit" title="\u9009\u4e2d\u6307\u5b9a\u68c0\u67e5\u521b\u5efa\u79c1\u5bc6\u5206\u4eab\u8fde\u63a5">\u5206\u4eab</a></div>';a.append(c);b=a.children("table");b.datagrid({loadMsg:"\u6b63\u5728\u52a0\u8f7d\u6570\u636e",toolbar:"#tb_qrystu",rownumbers:true,singleSelect:true,collapsible:false,striped:true,onClickRow:l,columns:[[{field:"pid",title:"\u60a3\u8005ID",width:80},{field:"name",title:"\u59d3\u540d",width:80},{field:"gender",title:"\u6027\u522b",width:40},{field:"age",title:"\u5e74\u9f84",width:60},{field:"mod",title:"\u7c7b\u578b",width:60},{field:"studate",title:"\u68c0\u67e5\u65f6\u95f4",width:100},{field:"accessno",title:"\u68c0\u67e5\u53f7",width:80},{field:"stuuid",title:"\u68c0\u67e5UID",width:150,align:"left"}]]});a.find("#pid").textbox();a.find("#accessno").textbox();a.find("#pname").textbox({prompt:"\u652f\u6301\u901a\u914d\u7b26%_"});a.find("#search").linkbutton({iconCls:"icon-search"});a.find("#studate").combobox({editable:false,valueField:"val",textField:"txt"}).combobox("loadData",[{val:0,txt:"\u4eca\u5929"},{val:7,txt:"\u6700\u8fd1\u4e00\u5468"},{val:30,txt:"\u6700\u8fd1\u4e00\u6708"},{val:-1,txt:"\u4e0d\u9650"}]).combobox("select",-1);a.find("#stumod").combobox({editable:true,prompt:"\u8bf7\u8f93\u5165",valueField:"val",textField:"txt"}).combobox("loadData",[{val:"CT",txt:"CT"},{val:"CR",txt:"CR"},{val:"US",txt:"US"},{val:"ECG",txt:"ECG"},{val:"",txt:"\u5168\u90e8"}]).combobox("select","")}function f(){if(a==null)return;a.find("#studate").combobox("destroy");a.find("#stumod").combobox("destroy")}function h(){e(false);c.tools!=""&&$(c.tools).remove();c.stuview=null;c={};f();if(b!=null){b.remove();b=null}c.tools!=""&&$(c.tools).remove()}function e(c){if(b==null)return;if(c){a.find("#search").bind("click",i);a.find("#shareit").bind("click",j)}else{a.find("#search").unbind("click");a.find("#shareit").unbind("click")}}function d(c){e(false);if(WPACS.wp0bj1.isObject(c)){if(a==null||a[0]!=c[0]){a=c;b==null?k():b.appendTo(a)}b.show();e(true)}else if(a!=null){f();b=null;a.empty();a=null}}function i(){var d=-1,j="",g="",i="",h="",e="",c="";elem=a.find("#studate");d=parseInt(a.find("#studate").combobox("getValue"));h=a.find("#stumod").combobox("getValue");j=a.find("#pid").textbox("getValue");g=a.find("#accessno").textbox("getValue");i=a.find("#pname").textbox("getValue");if(d>0)e=(new Date).DateAdd("d",0-d).Format("yyyyMMdd")+"-"+(new Date).Format("yyyyMMdd");else if(d==0)e=(new Date).Format("yyyyMMdd");if(i!="")c+="&name="+i;if(j!="")c+="&pid="+j;if(g!="")c+="&accessno="+g;if(h!="")c+="&modality="+h;if(e!="")c+="&studate="+e;var f=null,l=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu6,m=l+"?itype=2"+c;b.datagrid("loading");var k="--";$.ajax({type:"GET",url:m,dataType:"xml",async:true,success:function(c){var d,a=[];$(c).find("record").each(function(l,b){var j=$(b).find("patient").attr("pid"),e=$(b).find("patient").attr("name");if(e=="")e=k;var c=$(b).find("patient").attr("gender");if(c=="M"||c=="m")c="\u7537";else if(c=="F"||c=="f")c="\u5973";var d=$(b).find("patient").attr("age");if(d==null||d=="")d=k;else d=parseInt(d);var f=$(b).find("machine").attr("modality"),h=$(b).find("studate").attr("d"),i=$(b).find("study").attr("uid"),g=$(b).find("study").attr("accessno");a[a.length]={pid:j,name:e,gender:c,age:d,mod:f,studate:h,stuuid:i,accessno:g}});if(a.length>0){b.datagrid("loadData",{total:a.length,rows:a});f!=null&&f.text("\u5171\u67e5\u8be2\u5230 "+a.length+" \u6761\u8bb0\u5f55")}else b.datagrid("loadData",{total:0,rows:{}});b.datagrid("loaded")},error:function(){b.datagrid("loaded");f!=null&&f.text("\u83b7\u53d6\u68c0\u67e5\u5217\u8868\u5931\u8d25\uff0c\u670d\u52a1\u53ef\u80fd\u5df2\u5173\u95ed")}})}function l(){var d=b.datagrid("getSelected");if(!d)return;var e=a.find("#chkAppend").prop("checked"),f=d.stuuid;c.stuview!=null&&c.stuview.ViewStudy(f,e)}function j(){var f=null,c=b.datagrid("getSelected");if(!c)return;var a=c.stuuid,d=2*24*3600,e="./webpacs/wpswsd.asmx/ShareKey?user=&pswd=&expired="+d+"&stuuid="+a;$.ajax({type:"GET",url:e,async:false,dataType:"xml",success:function(b){$(b).find("string").each(function(d,c){var b="./wpacs.aspx?"+$(c).text()+"&stuuid="+a;window.clipboardData&&window.clipboardData.setData("Text",b);window.open(b)})}})}WPACS.wp0bj1.isObject(g)&&d(g)};WPACS.wp0b26=function(){var a={objname:"slice",vwmode:1,vtype:0,x0:0,y0:0,z0:0,xdir:[0,0,0],ydir:[0,0,0],xps_coef:1,yps_coef:1,iframe:0,flip:0,rotate:0,offX:0,offY:0,iratio:0,dratio:0,invert:false,psuedo:0,textv:true,metav:true,ww:0,wc:0,dw:0,dc:0,vimgHandle:null,onViewText:null,onstatus:null},e=null,c=null,f=new WPACS.wp0b39,b=null,d=null,o=this;this.DestroyObj=function(){v()};this.Options=function(){return a};this.IfLoading=function(){return false};this.SetViewMode=function(){};this.OnBindView=function(b){if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps4,0);a.onstatus=b;a.onstatus!=null&&n()};this.wfn31=function(){return f};this.GetFrames=function(){return b!=null?1:0};this.SetFrame=function(){return};this.GetPixel=function(b,a,c,d){return t(b,a,c,d)};this.wfn22=function(){return b?b.wfn22():null};this.IsSigned=function(){return c!=null?c.image.is!=0:true};this.GetBpp=function(){return c!=null?c.image.b:0};this.DicomInfo=function(){return c};this.GetImageData=function(f,b,c,e,d,a){return q(f,b,c,e,d,a)};this.wfn32=function(a){return h(a)};this.GetClipRect=function(){return e};this.AutoText=function(d){if(c==null||b==null)return false;var a=c.image.fx;if(c.image.fu&&c.image.fu.toLowerCase()=="pt")a=undefined;d.AutoText(a,b.wfn28);return true};this.InitSliceData=function(j,h,d,g,e){l();i();s();c=g;a.vtype=WPACS.wp0bj1.isNumberType(e)?e:0;if(!d)d=c.image.b;var f=c.image.is!=0;b=new WPACS.wp0b17(k);b.Init(j,h,d,f,false)};this.SetSliceData=function(g,f){if(b==null)return;if(WPACS.wp0bj1.isBooleanType(f)&&f){var h=b.GetSize()[2];if(h>8&&h<=16&&a.ww==0&&a.wc==0){var e=b.GetSize(),c=WPACS.wp0b10.MaxValue(g,e[0],e[1]);a.ww=c.max-c.min+1;a.wc=c.min+Math.floor(a.ww/2)}}d=null;b.wfn23(g)};this.Clone=function(){return};this.wfn36=function(){return""};this.wfn35=function(){return""};this.GetJpegUrl=function(){return""};this.PreView=function(){return false};this.wfn07=function(){return false};this.wfn05=function(f){if(d==null&&!r())return false;var i=f[0].width,g=f[0].height;p(i,g);var k=a.iratio*d.width/100|0,j=a.iratio*d.height/100|0,e=new WPACS.wpRect(-k/2|0,-j/2|0,k,j),c=f[0].getContext("2d");c.save();c.setTransform(1,0,0,1,0,0);c.translate(i/2,g/2);var b=h();c.transform(b.a,b.b,b.c,b.d,b.e,b.f);c.drawImage(d,e.left,e.top,e.width,e.height);c.restore();e=null;b=null;return true};this.wfn08=function(n){if(!a.textv||c==null)return;var f=n[0].width,e=n[0].height,d=n[0].getContext("2d"),j=a.iratio/100,p=c.image.fx*a.xps_coef,q=c.image.fy*a.xps_coef;if(c.image.fu&&c.image.fu.toLowerCase()=="pt"){WPACS.wp0bj7.DrawMetaHScale(d,f,e,j,undefined);WPACS.wp0bj7.DrawMetaVScale(d,f,e,j,undefined)}else{WPACS.wp0bj7.DrawMetaHScale(d,f,e,j,p);WPACS.wp0bj7.DrawMetaVScale(d,f,e,j,q)}var l="",m="",i=WPACS.wfn37(a.xdir[0],a.xdir[1],a.xdir[2]);if(i!="")l="["+i+"]";i=WPACS.wfn37(a.ydir[0],a.ydir[1],a.ydir[2]);if(i!="")m="["+i+"]";var h=WPACS.CONSTDEF.FNT_TEXT4,g=WPACS.CONSTDEF.CLR_SCALE;l!=""&&WPACS.wp0bj7.DrawMetaText(d,l,g,f-40,e/2-6|0,"end","",h);m!=""&&WPACS.wp0bj7.DrawMetaText(d,m,g,f/2-15|0,e-40,"center","",h);g=WPACS.CONSTDEF.CLR_TEXT4;var k="";if(a.onViewText)k=a.onViewText(a.vtype,k);c.lttext!=""&&WPACS.wp0bj7.DrawMetaText(d,c.lttext,g,5,15,"start","",h);c.rttext!=""&&WPACS.wp0bj7.DrawMetaText(d,c.rttext,g,f-5,15,"end","",h);k!=""&&WPACS.wp0bj7.DrawMetaText(d,k,g,5,e-5,"start","bottom",h);var o=c.rbtext;if(b!=null)o+="\r\n"+a.iratio+"%"+(WPACS.CONSTDEF.DATALOSSY?"  LS":"");if(b.wob1.ww!=0)o+="\r\nW / L:  "+b.wob1.ww+" / "+b.wob1.wc;WPACS.wp0bj7.DrawMetaText(d,o,g,f-5,e-5,"end","bottom",h);return};this.wfn06=function(b){if(!a.metav)return;f!=null&&f.DrawMetas(b,j)};this.DrawMeta=function(a,b){b.DrawMeta(a,j)};this.Cvt2ImageXY=function(a,d,e){var c=a[0].width,b=a[0].height;return g(c,b,d,e)};this.ClipImage=function(c,f,g,h){if(b==null)return;var m=b.GetSize(),l=m[0],k=m[1];if(c<0)c=0;else if(c>=l)c=l-1;if(f<0)f=0;else if(f>=k)f=k-1;if(g<0)g=0;else if(g>=l)g=l-1;if(h<0)h=0;else if(h>=k)h=k-1;var n,o,j=g-c,i=h-f,p=c+j/2,q=f+i/2;j=Math.abs(j);i=Math.abs(i);n=p-j/2|0,o=q-i/2|0;e=new WPACS.wpRect(n,o,j,i);a.iratio=a.dratio=0;d=null;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0)};this.GetHistgram=function(){return b!=null?b.wfn27():null};this.Action=function(b,a){u(b,a)};function u(k,c){switch(k){case"reload":l();c=="1"&&i();a.onstatus!=null&&n();return;case"review":return;case"refresh":if(WPACS.wp0bj1.isBooleanType(c)&&c)d=null;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"psuedo":if(c>-2&&c<WPACS.wpPsuedoTable.length)a.psuedo=a.psuedo==c?0:c;d=null;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"invert":a.invert=!a.invert;d=null;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"flip":if(WPACS.wp0bj1.isBooleanType(c)&&c)a.flip=WPACS.wpSetBitVal(a.flip,1);else a.flip=WPACS.wpSetBitVal(a.flip,0);if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"rotate":var h=WPACS.wp0bj1.isBooleanType(c)&&c,j=a.rotate+(h?90:-90);a.rotate=j%360;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"zoom":var g=c.iratio,e=c.dratio;if(g>0){a.iratio=g;a.dratio=e}else a.dratio+=e;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"move":if(c.dx==0&&c.dy==0)return;a.offX+=c.dx;a.offY+=c.dy;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"wwwl":if(c.ww!=0){a.ww=c.ww;a.wc=c.wc;a.dw=c.dw;a.dc=c.dc}else{a.dw+=c.dw;a.dc+=c.dc}b!=null&&b.wob1.DestroyObj();d=null;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"gamma":if(a.vwmode!=WPACS.CONSTDEF.VMODE_WADO){if(b==null)return;var o=c.ww,m=c.wc,f=c.gamma;if(Math.abs(f-1)<.02)b.wob1.LutType(0,undefined);else b.wob1.LutType(1,f);b.wob1.Create(o,m);d=null;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0)}return;case"textv":if(WPACS.wp0bj1.isBooleanType(c))a.textv=c;else a.textv=!a.textv;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"metav":if(WPACS.wp0bj1.isBooleanType(c))a.metav=c;else a.metav=!a.metav;d=null;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"clearmetas":i();if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return;case"fitwnd":a.iratio=a.dratio=0;if(a.onstatus!=null)a.onstatus(WPACS.CONSTDEF.wps3,0);return}}function v(){i();f=null;b!=null&&b.DestroyObj();d=null;b=null;c=null;o=null;a.vimgHandle=null;a.onViewText=null;a.onstatus=null;a={}}function l(){a.iframe=0;e=null;a.offX=a.offY=0;a.iratio=a.dratio=0;a.flip=a.rotate=0;a.psuedo=0;a.invert=false;a.ww=a.wc=a.dw=a.dc=0;if(c!=null&&c.image.ww!=0){a.ww=c.image.ww;a.wc=c.image.wc}d=null}function i(){f.Clear()}function s(){b!=null&&b.DestroyObj();b=null;d=null}function n(){k(WPACS.CONSTDEF.wpu2,0)}function k(c,d){if(b==null)return;if(a.onstatus==null)return;if(c==WPACS.CONSTDEF.wpu2){m();a.onstatus(WPACS.CONSTDEF.wps3,0)}else a.onstatus(c,d)}function p(i,h){if(a.iratio==0){var f=0,c=0;if(d!=null){f=d.width;c=d.height}else if(e!=null||b!=null){var g=b.GetSize();f=e==null?g[0]:e.width;c=e==null?g[1]:e.height}if(f==0||c==0)return;var j=Math.floor(h*f/c);a.iratio=j<=i?h*100/c|0:i*100/f|0}if(a.iratio==0||a.dratio==0)return;a.iratio+=a.dratio;a.dratio=0;if(a.iratio<WPACS.CONSTDEF.ZOOM_MIN)a.iratio=WPACS.CONSTDEF.ZOOM_MIN;else if(a.iratio>WPACS.CONSTDEF.ZOOM_MAX)a.iratio=WPACS.CONSTDEF.ZOOM_MAX}function m(){if(b==null)return;var d=b.GetSize()[2];if(d<=8||d>16)return;if(a.ww==0)if(c.image.ww==0){b.wfn30();a.ww=_dicomdata.wob1.ww;a.wc=_dicomdata.wob1.wc}else{a.ww=c.image.ww;a.wc=c.image.wc}if(a.ww==0)return;a.ww+=a.dw;a.wc+=a.dc;a.dw=a.dc=0;b.wob1.LutType(0,1);b.wob1.Create(a.ww,a.wc)}function r(){if(b==null||b.wfn22()==null)return false;var g=a.psuedo,f=a.invert;if(c!=null&&c.image.iv!=0)f=!f;!b.wob1.IsValid()&&m();d=b.wfn29(g,f,e,false,0,null);if(d==null)return false;a.vimgHandle&&a.vimgHandle(o,d);return true}function t(f,e,h,i){if(a.vwmode==WPACS.CONSTDEF.VMODE_WADO)return;var c=g(f,e,h,i);if(c==null)return null;var d=b!=null?b.GetPixel(c.x,c.y):undefined;return d==undefined?null:{x:c.x,y:c.y,pixel:d}}function q(i,h,m,o,n,l){if(d==null)return null;var b=g(i,h,m,o),f=g(i,h,n,l),k=d.getContext("2d"),e=k.getImageData(b.x,b.y,f.x-b.x,f.y-b.y);WPACS.CONSTDEF.MGLASS_FILTER&&a.psuedo==0&&c.image.b<=16&&j(e);return e;function j(d){var k=d.width,j=d.height,a,e,b,c,f=255,g=0;for(b=0,a=0;a<j;a++)for(e=0;e<k;e++){c=d.data[b];if(f>c)f=c;if(g<c)g=c;b+=4}if(g==255&&f==0)return;var h=g-f;if(h<1)return;var i=WPACS.wp0bj8(h+1,"u8");for(a=0;a<=h;a++)i[a]=a*255/h;for(b=0,a=0;a<j;a++)for(e=0;e<k;e++){c=d.data[b];c=i[c-f];d.data[b]=d.data[b+1]=d.data[b+2]=c;b+=4}dataBuffer=null;i=null}}function h(c){var b=new WPACS.Matrix("1,0,0,1,0,0");(a.flip&1)!=0&&b.postConcat(new WPACS.Matrix("-1,0,0,1,0,0"));(a.flip&2)!=0&&b.postConcat(new WPACS.Matrix("1,0,0,-1,0,0"));if(a.rotate!=0){var d=new WPACS.Matrix;d.setRotation(a.rotate);b.postConcat(d)}b.e+=a.offX;b.f+=a.offY;WPACS.wp0bj1.isBooleanType(c)&&c&&b.inverse();return b}function g(n,l,j,k){if(b==null)return null;var d=b.GetSize(),o=d[0],m=d[1],r=e==null?o/2|0:e.xCenter(),s=e==null?m/2|0:e.yCenter(),p=n/2|0,q=l/2|0;j-=p;k-=q;var f=h(true),c=f.calNewPoint(j,k),g=c.x*100/a.iratio|0,i=c.y*100/a.iratio|0;g+=r;i+=s;f=null;c=null;return new WPACS.wp0bj2(g,i)}function j(n,l,j,k){if(b==null)return null;var g=b.GetSize(),o=g[0],m=g[1],r=e==null?o/2|0:e.xCenter(),s=e==null?m/2|0:e.yCenter();j-=r;k-=s;var c=j*a.iratio/100|0,d=k*a.iratio/100|0,i=h(false),f=i.calNewPoint(c,d);c=f.x|0;d=f.y|0;var p=n/2|0,q=l/2|0;c+=p;d+=q;i=null;f=null;return new WPACS.wp0bj2(c,d)}};WPACS.wp0b27=function(){this.DestroyObj=function(){this.d3Matrix=null;b=a=f=null};this.wfn10=function(){return j};this.wfn11=function(){return k};this.Reset=function(){this.d3Matrix=WPACS.wp0bj6.identity()};this.d3Matrix=WPACS.wp0bj6.identity();this.wfn12=function(j,c){switch(j){case 0:if(c===1){var f=this.d3Matrix[0],g=this.d3Matrix[4],h=this.d3Matrix[8],e=Math.sqrt(f*f+g*g+h*h);WPACS.wp0bj6.identity(this.d3Matrix);WPACS.wp0bj6.scale(this.d3Matrix,[e,e,e],this.d3Matrix)}else WPACS.wp0bj6.identity(this.d3Matrix);break;case WPACS.CONSTDEF.wpd1:c[0]&&WPACS.wp0bj6.rotate(this.d3Matrix,c[0],[a.x,a.y,a.z],this.d3Matrix);c[1]&&WPACS.wp0bj6.rotate(this.d3Matrix,c[1],[-b.x,b.y,b.z],this.d3Matrix);break;case WPACS.CONSTDEF.wpd2:WPACS.wp0bj6.scale(this.d3Matrix,[c,c,c],this.d3Matrix);break;case WPACS.CONSTDEF.wpd3:var d=new WPACS.wp0bj5(c[0],c[1],0);WPACS.wp0bj6.vecxmul(d,i(),d);WPACS.wp0bj6.translate(this.d3Matrix,[d.x,d.y,d.z],this.d3Matrix)}};this.GetLook=function(){var a=WPACS.wp0bj6.vecxmul(f,this.d3Matrix,null,true);a.Normalize();return a};this.GetRight=function(){var a=WPACS.wp0bj6.vecxmul(b,this.d3Matrix,null,true);a.Normalize();return a};this.GetUp=function(){var b=WPACS.wp0bj6.vecxmul(a,this.d3Matrix,null,true);b.Normalize();return b};this.GetSizeX=function(){var a=this.d3Matrix[0],b=this.d3Matrix[4],c=this.d3Matrix[8],d=Math.sqrt(a*a+b*b+c*c);return h*d};this.GetSizeY=function(){var a=this.d3Matrix[1],b=this.d3Matrix[5],c=this.d3Matrix[9],d=Math.sqrt(a*a+b*b+c*c);return h*d};this.GetOrgin=function(){var a=WPACS.wp0bj6.vecxmul(g,this.d3Matrix,null);a.Translate(e/2,c/2,d/2);return a};this.wfn09=function(g,j,k){var g=2*g/e-1,j=2*j/c-1,k=2*k/d-1,f=new WPACS.wp0bj5(g,j,k),l=WPACS.wp0bj6.inverse(this.d3Matrix);WPACS.wp0bj6.vecxmul(f,l,f);WPACS.wp0bj6.vecxmul(f,i(),f);var m=h/(b.x*e+b.y*c+b.z*d),n=h/(a.x*e+a.y*c+a.z*d);return{x:f.x/m,y:f.y/n}};this.Init=function(m,l,k){e=m;c=l;d=k;var j=e>c?e:c;if(j<d)j=d;WPACS.wp0bj6.identity(this.d3Matrix);f=new WPACS.wp0bj5(0,1,0);a=new WPACS.wp0bj5(0,0,1);b=WPACS.wp0bj5.CrossMul(f,a);h=2*j;g=new WPACS.wp0bj5(-1,-1,0);g.Scale(j);g=WPACS.wp0bj6.vecxmul(g,i(),null)};function i(){var c=WPACS.wp0bj6.Create();c[0]=b.x;c[1]=a.x;c[2]=f.x;c[3]=0;c[4]=b.y;c[5]=a.y;c[6]=f.y;c[7]=0;c[8]=b.z;c[9]=a.z;c[10]=f.z;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c}var b,a,f,h,g,e,c,d,j=-1e4,k=+1e4};WPACS.wp0b28=function(){this.DestroyObj=function(){this.d3Matrix=null;c=a=d=null};this.wfn10=function(){return h};this.wfn11=function(){return i};this.Reset=function(){this.d3Matrix=WPACS.wp0bj6.identity()};this.d3Matrix=WPACS.wp0bj6.identity();this.wfn12=function(e,b){switch(e){case 0:WPACS.wp0bj6.identity(this.d3Matrix);return;case WPACS.CONSTDEF.wpd1:b[0]&&WPACS.wp0bj6.rotate(this.d3Matrix,b[0],[a.x,a.y,a.z],this.d3Matrix);b[1]&&WPACS.wp0bj6.rotate(this.d3Matrix,b[1],[-c.x,c.y,c.z],this.d3Matrix);return;case WPACS.CONSTDEF.wpd2:return;case WPACS.CONSTDEF.wpd3:var d=new WPACS.wp0bj5(b[0],b[1],0);WPACS.wp0bj6.vecxmul(d,f(),d);WPACS.wp0bj6.translate(this.d3Matrix,[d.x,d.y,d.z],this.d3Matrix);return}};this.GetLook=function(){var a=WPACS.wp0bj6.vecxmul(d,this.d3Matrix,null,true);a.Normalize();return a};this.GetRight=function(){var a=WPACS.wp0bj6.vecxmul(c,this.d3Matrix,null,true);a.Normalize();return a};this.GetUp=function(){var b=WPACS.wp0bj6.vecxmul(a,this.d3Matrix,null,true);b.Normalize();return b};this.GetSizeX=function(){var a=this.d3Matrix[0],b=this.d3Matrix[4],c=this.d3Matrix[8],d=Math.sqrt(a*a+b*b+c*c);return g*d};this.GetSizeY=function(){var a=this.d3Matrix[1],b=this.d3Matrix[5],c=this.d3Matrix[9],d=Math.sqrt(a*a+b*b+c*c);return g*d};this.GetOrgin=function(){var a=WPACS.wp0bj6.vecxmul(e,this.d3Matrix,null);a.Translate(b.x,b.y,b.z);return a};this.GetFocal=function(){return b};this.SetFocal=function(a,c,d){b=new WPACS.wp0bj5(a,c,d)};this.wfn09=function(c,d,e){var c=c-b.x,d=d-b.y,e=e-b.z,a=new WPACS.wp0bj5(c,d,e),g=WPACS.wp0bj6.inverse(this.d3Matrix);WPACS.wp0bj6.vecxmul(a,g,a);WPACS.wp0bj6.vecxmul(a,f(),a);return{x:a.x,y:a.y}};this.Init=function(k,j,i){var h=k>j?k:j;if(h<i)h=i;b=new WPACS.wp0bj5(k/2,j/2,i/2);WPACS.wp0bj6.identity(this.d3Matrix);d=new WPACS.wp0bj5(0,0,1);a=new WPACS.wp0bj5(0,1,0);c=WPACS.wp0bj5.CrossMul(d,a);g=2*h;e=new WPACS.wp0bj5(-1,-1,-1);e.Scale(h);e=WPACS.wp0bj6.vecxmul(e,f(),null)};function f(){var b=WPACS.wp0bj6.Create();b[0]=c.x;b[1]=a.x;b[2]=d.x;b[3]=0;b[4]=c.y;b[5]=a.y;b[6]=d.y;b[7]=0;b[8]=c.z;b[9]=a.z;b[10]=d.z;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b}var c,a,d,g,e,b,h=10,i=210};WPACS.wp0b29=function(){var a={onstatus:null,reconW:512,reconH:512},h=null,b=null,d=new WPACS.wp0b27,g=new WPACS.wp0b28,n=WPACS.CONSTDEF.WPURL_ROOT+WPACS.CONSTDEF.wpu3;this.DestroyObj=function(){b&&b.DestroyObj();b=null;h=null;k=i=j=0;o=false;u=1;d&&d.DestroyObj();d=null;g&&g.DestroyObj();g=null;a.onstatus=null;a={};m(true);c&&c.close();c=null};this.Options=function(){return a};this.DicomInfo=function(){return h};this.IfLoaded=function(){return e!=0};this.GetVolSize=function(){return{x:k,y:i,z:j}};this.GetSliceSize=function(e,d){var c=a.reconW,b=a.reconH;switch(e){case WPACS.CONSTDEF.wpdt0:if(d==1)return[k,i];else if(d==2)return[k,j];else if(d==3)return[i,j];break;case WPACS.CONSTDEF.wpdt2:return[c,b,0];case WPACS.CONSTDEF.wpdt3:return[c,b,8];case WPACS.CONSTDEF.wpdt4:return[c,b,24];case WPACS.CONSTDEF.wpdt5:return[c,b,8];case WPACS.CONSTDEF.wpdt6:return[c,b,8]}return[0,0,0]};this.SetSeries=function(c,d,e){b&&b.DestroyObj();b=null;m(true);h=null;if(c=="")return false;b=new WPACS.wp0b20;b.Options().onEvent[0]=t;b.AddSeries(c,d,e,false,false);if(b.Length()<10)return false;if(a.onstatus)a.onstatus(WPACS.CONSTDEF.wps0,-1);b.GetImage(0).wfn34();return true};this.SetDcmSet=function(c){b&&b.DestroyObj();b=null;m(true);h=null;if(!c||c.Length()<10)return false;b=new WPACS.wp0b20;b.Options().mod=c.Options().mod;b.Options().onEvent[0]=t;for(var e=0;e<c.Length();e++){var d=c.GetImage(e).Options();b.AddDicom(d.imguid,d.srsuid,d.stuuid)}if(a.onstatus)a.onstatus(WPACS.CONSTDEF.wps0,-1);b.GetImage(0).wfn34();return true};this.ReSet=function(){d&&d.Reset();g&&g.Reset();s("&clip=clear",false)};this.SetClipPoly=function(a,d){var b="&step=0.6";if(WPACS.wp0bj1.isBooleanType(d)&&d)b+="&outer=1";b+="&clip="+a[0].x+","+a[0].y;for(var c=1;c<a.length;c++)b+=","+a[c].x+","+a[c].y;s(b,false)};this.wfn01=function(a,i){var c,e,f=1,b="",h=a.mprth?a.mprth:0,g=a.mprfn?a.mprfn:0;if(a.pts){c=WPACS.CONSTDEF.wpdt1;b="&params="+a.pts[0].x+","+a.pts[0].y;for(var d=1;d<a.pts.length;d++)b+=","+a.pts[d].x+","+a.pts[d].y}else{c=WPACS.CONSTDEF.wpdt0;e=a.loc;b="&params="+e;if(h!=0||g!=0)b+=","+h+","+g}l(i,"&d3type="+c+"&subtype="+f+b,c,f,e)};this.wfn02=function(a,i){var c,e,f=2,b="",h=a.mprth?a.mprth:0,g=a.mprfn?a.mprfn:0;if(a.pts){c=WPACS.CONSTDEF.wpdt1;b="&params="+a.pts[0].x+","+a.pts[0].y;for(var d=1;d<a.pts.length;d++)b+=","+a.pts[d].x+","+a.pts[d].y}else{c=WPACS.CONSTDEF.wpdt0;e=a.loc;b="&params="+e;if(h!=0||g!=0)b+=","+h+","+g}l(i,"&d3type="+c+"&subtype="+f+b,c,f,e)};this.wfn03=function(a,i){var c,e,f=3,b="",h=a.mprth?a.mprth:0,g=a.mprfn?a.mprfn:0;if(a.pts){c=WPACS.CONSTDEF.wpdt1;b="&params="+a.pts[0].x+","+a.pts[0].y;for(var d=1;d<a.pts.length;d++)b+=","+a.pts[d].x+","+a.pts[d].y}else{c=WPACS.CONSTDEF.wpdt0;e=a.loc;b="&params="+e;if(h!=0||g!=0)b+=","+h+","+g}l(i,"&d3type="+c+"&subtype="+f+b,c,f,e)};this.wfn04=function(h,i,p){var n=a.reconW,m=a.reconH,o={skip:2,step:1,inp:true},b=$.extend({},o,i||{}),q=b.skip>.1&&b.skip<1?-(1/b.skip|0):b.skip>1?b.skip|0:1,e=null,c="&d3type="+h;c+="&rays="+q+","+b.step.toFixed(1)+","+(b.inp?1:0)+","+(b.light?b.light:0);if(n!=512||m!=512)c+=","+n+","+m;if(h==WPACS.CONSTDEF.wpdt6)e=g?g.d3Matrix:null;else e=d?d.d3Matrix:null;if(!e)return;else c+="&matrix="+WPACS.wp0bj1.ToFixed(e[0],3);for(var f=1;f<e.length;f++)c+=","+WPACS.wp0bj1.ToFixed(e[f],3);switch(h){case WPACS.CONSTDEF.wpdt3:c+="&params="+b.thre;break;case WPACS.CONSTDEF.wpdt4:var k=i.vrset;i.vrset=null;c+="&params=";for(var f=0;f<k.length;f++)for(var j=0;j<6;j++)c+=k[f][j]+",";break;case WPACS.CONSTDEF.wpdt5:c+="&params="+b.vrww+","+b.vrwl;break;case WPACS.CONSTDEF.wpdt6:if(b.vrww&&b.vrww>0)c+="&params="+b.vrww+","+b.vrwl;else c+="&params="+b.vethre;if(b.focal)c+=","+b.focal[0]+","+b.focal[1]+","+b.focal[2]}l(p,c,h,0)};this.GetPerspProj=function(){return g};this.GetOrthoProj=function(){return d};this.GetScaleOfCast=function(){var b=d.GetSizeX()/a.reconW,c=d.GetSizeY()/a.reconH;return[b,c]};this.GetCoordOfCast=function(f,b){var i=a.reconW,h=a.reconH,e=f==WPACS.CONSTDEF.wpdt6?g:d,c=e.wfn09(b.x,b.y,b.z),j=(1+c.x)*i/2,k=(1+c.y)*h/2;return{x:j,y:k}};this.GetSliceSorted=function(){return y()};function y(a){if(!a&&h)a=h.image.pp;return a&&a.substr(0,2)=="FF"?true:false}function t(r){if(r==WPACS.CONSTDEF.wpe2){var t=b.Length(),f=b.Options().finish,q=b.Options().success;if(f==1){if(q==f){e!=0&&m(true);e=0;for(var c=b.GetImage(0),n=c.Options().stuuid,l=c.Options().srsuid,g="&stuuid="+n+"&srsuid="+l+"&imguid="+c.Options().imguid,d=1;d<b.Length();d++)g+=","+b.GetImage(d).Options().imguid;h=c.DicomInfo();p=h.image.b;o=h.image.is!=0;k=i=j=0;u=1;if(x(g,true)){if(a.onstatus)a.onstatus(WPACS.CONSTDEF.wpu2,0)}else if(a.onstatus)a.onstatus(WPACS.CONSTDEF.wpu2,1)}else if(a.onstatus)a.onstatus(WPACS.CONSTDEF.wps5,"\u5207\u7247\u672a\u5168\u4e0b\u8f7d");window.setTimeout(function(){b.DestroyObj();b=null},10)}}}function r(b){if(!b)return;var c=parseInt(b.retcode);if(c==0){k=b.w;i=b.h;j=b.d;e=b.id;d&&d.Init(k,i,j);g&&g.Init(k,i,j);if(a.onstatus)a.onstatus(WPACS.CONSTDEF.wpu2,1)}else if(a.onstatus)a.onstatus(WPACS.CONSTDEF.wps5,b.retinfo)}function v(e,l,b,h,k,d){var c=p,g=o;if(b==WPACS.CONSTDEF.wpdt3)c=8;else if(b==WPACS.CONSTDEF.wpdt4)c=24;else if(b==WPACS.CONSTDEF.wpdt5)c=8;else if(b==WPACS.CONSTDEF.wpdt6)c=8;e.onload=i;e.onerror=e.onabort=j;e.SetSource(l,false,c,g);function i(){if(d!=-1)f[d]=null;var i=this.PixelData;this.DestroyObj();if(!a.onstatus)return;var e=!i?null:{w:this.width,h:this.height,b:c,s:g,d:i};if(b==WPACS.CONSTDEF.wpdt0)a.onstatus(WPACS.CONSTDEF.wps3,{data:e,type:b,subtype:h,location:k});else a.onstatus(WPACS.CONSTDEF.wps3,{data:e,type:b});if(e)e.d=null;e=null;i=null}function j(){if(d!=-1)f[d]=null;if(!a.onstatus)return;a.onstatus(WPACS.CONSTDEF.wps3,{data:null,type:b,subtype:h})}}function q(r,b,i,m,q,e){var c=p,h=o;if(b==WPACS.CONSTDEF.wpdt3)c=8;else if(b==WPACS.CONSTDEF.wpdt4)c=24;else if(b==WPACS.CONSTDEF.wpdt5)c=8;else if(b==WPACS.CONSTDEF.wpdt6)c=8;var n=WPACS.CONSTDEF.DAT3LOSSY||WPACS.CONSTDEF.DATALOSSY,g=window.URL||window.webkitURL,j=g.createObjectURL(r),d=new Image;d.onload=k;d.onerror=d.onabort=l;d.SetSource(j,n,c,h,q);d=null;j=null;function k(){if(e!=-1)f[e]=null;g.revokeObjectURL(this.src);var j=this.PixelData;this.DestroyObj();if(!a.onstatus)return;var d=!j?null:{w:this.width,h:this.height,b:c,s:h,d:j};if(b==WPACS.CONSTDEF.wpdt0)a.onstatus(WPACS.CONSTDEF.wps3,{data:d,type:b,subtype:i,location:m});else a.onstatus(WPACS.CONSTDEF.wps3,{data:d,type:b});if(d)d.d=null;d=null;j=null}function l(){if(e!=-1)f[e]=null;if(!a.onstatus)return;a.onstatus(WPACS.CONSTDEF.wps3,{data:null,type:b,subtype:i})}}function w(a){var a;try{a=WSOCK_D3VURI}catch(b){}if(typeof a!="string"||a.substr(0,5).toLowerCase()!="ws://")return;c=new WebSocket(a);c.onmessage=function(a){if(typeof a.data!="string"){var b=new FileReader;b.onload=function(g){if(g.target.readyState==FileReader.DONE){var b=new Uint8Array(g.target.result),a=b.length-12,f,e,c,d=new Int32Array(b.buffer.slice(a+4,a+12));f=b[a];e=b[a+1];c=new Int16Array(b.buffer.slice(a+2,a+4))[0];var h={minv:d[0],maxv:d[1]};q(new Blob([b]),f,e,c,h,-1)}};b.readAsArrayBuffer(a.data)}else if(e==0)r(JSON.parse(a.data));else WPACS.DEBUGLOG("Unknowed Data: "+a.data)};c.onopen=function(){WPACS.DEBUGLOG("WS\u8fde\u63a5\u5df2\u6253\u5f00...")};c.onerror=function(){WPACS.DEBUGLOG("error...")};c.onclose=function(){WPACS.DEBUGLOG("WS\u8fde\u63a5\u5df2\u5173\u95ed...");c=null}}function x(f,b){if(e!=0)return false;var d="d3id=0&d3act=1";if(!c){b=b||false;$.ajax({type:"POST",data:f,dataType:"json",async:b,url:n+"?"+d,success:function(a){r(a)},error:function(d,c,b){WPACS.DEBUGLOG("AjaxError: "+b);if(a.onstatus)a.onstatus(WPACS.CONSTDEF.wps5,"\u901a\u8baf\u9519\u8bef")}})}else c.send(d+f);return true}function s(d,a){if(e==0)return false;var b="d3id="+e+"&d3act=4";if(!c){a=a||false;var g=n+"?"+b,f={type:"POST",data:d,url:g,dataType:"text",async:a};$.ajax(f)}else c.send(b+d);return true}function m(d){if(e==0)return;var g="d3id="+e+"&d3act=2";e=0;if(!c){for(var b=0;b<f.length;b++){var a=f[b];if(a)a.readyState?a.abort():(a.src="");a=null;f[b]=null}d=d||false;var i=n+"?"+g,h={type:"GET",url:i,dataType:"text",async:d};$.ajax(h)}else c.send(g)}var f=[null,null,null,null];function l(t,i,h,g,m){if(e==0)return;var d=h!=WPACS.CONSTDEF.wpdt0?3:g-1;if(!t&&f[d])return;var k=window.URL||window.webkitURL,o=!k?false:WPACS.CONSTDEF.DAT3LOSSY||WPACS.CONSTDEF.DATALOSSY,p="d3id="+e+"&d3act=3"+(o?"&datalossy=1":"");if(!c){var r=n+"?"+p,b=f[d];if(!b)if(k){b=new XMLHttpRequest;b.onload=s;b.onerror=b.onabort=l}else b=new Image;else if(b.readyState)b.abort();else b.src="";if(k){var j=i?true:false;b.open(j?"POST":"GET",r,true);j&&b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.responseType="blob";j?b.send(i):b.send()}else v(b,r+i,h,g,m,d);f[d]=b;b=null}else c.send(p+i);function s(){if(this.status==200){var c,f=0,e=0;if(o){var b=this.getResponseHeader("lsdata"),a=b?eval("("+b+")"):null;f=a?a.minv:0;e=a?a.maxv:0;c={minv:f,maxv:e}}q(this.response,h,g,m,c,d);return}WPACS.DEBUGLOG("[Voxel3D] \u83b7\u53d6\u91cd\u5efa\u6570\u636e\u5931\u8d25\uff0cstatus: "+this.status);l();return}function l(){f[d]=null;if(!a.onstatus)return;a.onstatus(WPACS.CONSTDEF.wps3,{data:null,type:h,subtype:g})}}var c=null;if(!window.WebSocket&&window.MozWebSocket)window.WebSocket=window.MozWebSocket;window.WebSocket&&w();var k=0,i=0,j=0,p=0,u=1,o=false,e=0};WPACS.wp0b30=function(L,C){for(var q=new WPACS.MouseHandlers,D=L||false,a={layout:4,wndidx:0,mprpt:[0,0,0],mprth:0,mprfn:0,d3type:0,subtype:0,d3mode:0,opmode:0,cliptype:0,status:0,step:1,light:0,thre:160,vrset:0,vroff:0,vrww:0,vrwl:0,vethre:-160,filter:WPACS.CONSTDEF.DAT3FILTER,onEvent:null},c=D?new WPACS.wp0b29:new WPACS.wp0b21,b=[null,null,null,null],f=["#DF0000","#00DF00","#00AFBF","#BFAFAF"],d=[null,null,null,null],l=0;l<d.length;l++){d[l]=new WPACS.wp0b11;d[l].Options().onEvent=l==3?null:G;d[l].SetOpmode(l==3?a.d3mode:a.opmode)}this.DestroyObj=function(){I()};this.GetContainer=function(){return e};this.BindContainer=function(a){n(a)};this.ReSize=function(){n(e)};this.SetSize=function(b,a){if(e==null)return;e.width(b);e.height(a);n(e)};this.Options=function(){return a};this.SetSeries=function(f,g,h){for(var e=0;e<d.length;e++)d[e]&&d[e].SetImage(null);for(var e=0;e<b.length;e++){b[e]&&b[e].DestroyObj();b[e]=null}a.mprpt=[0,0,0];a.status=f?1:0;return c.SetSeries(f,g,h)};this.SetDcmSet=function(f){for(var e=0;e<d.length;e++)d[e]&&d[e].SetImage(null);for(var e=0;e<b.length;e++){b[e]&&b[e].DestroyObj();b[e]=null}a.mprpt=[0,0,0];a.status=f?1:0;return c.SetDcmSet(f)};this.GetSeries=function(){return c.IfLoaded()?c.DicomInfo().series.uid:""};this.SetD3Type=function(b,a){B(b,a)};this.Action=function(b,a){k(b,a)};function k(k,g){switch(k){case"reset":for(var f=0;f<b.length;f++)b[f]&&b[f].Action("reload");a.d3type==WPACS.CONSTDEF.wpdt6&&b[3]&&b[3].Action("psuedo",WPACS.CONSTDEF.VE_PSUEDO);var h=c.GetVolSize();p(h.x/2|0,h.y/2|0,h.z/2|0);a.step=1;a.light=0;a.thre=160;a.vrset=0;a.vroff=0;a.vrww=a.vrwl=0;u();c.ReSet();case"refresh":if(WPACS.wp0bj1.isBooleanType(g)&&g)for(var f=0;f<3;f++)b[f]&&b[f].Action("refresh",true);else if(g==="MPR"){var o=a.mprpt[0],q=a.mprpt[1],r=a.mprpt[2];a.mprpt[0]=a.mprpt[1]=a.mprpt[2]=0;p(o,q,r);a.mprpt[0]=o;a.mprpt[1]=q;a.mprpt[2]=r}else j(2,0,0,WPACS.CONSTDEF.wpd3);return;case"opmode":if(WPACS.wp0bj1.isNumberType(g)){for(var m=a.d3type==WPACS.CONSTDEF.wpdt1?d.length:3,f=0;f<m;f++)d[f]&&d[f].SetOpmode(g);a.opmode=g}return;case"d3mode":if(WPACS.wp0bj1.isNumberType(g)){if(d[3])a.d3type==WPACS.CONSTDEF.wpdt2&&g==WPACS.CONSTDEF.wpd5?d[3].SetOpmode(WPACS.CONSTDEF.wpo7):d[3].SetOpmode(0);a.d3mode=g;a.cliptype=0}return;case"cliptype":if(WPACS.wp0bj1.isNumberType(g))a.cliptype=g;return;case"layout":if(WPACS.wp0bj1.isNumberType(g)){a.layout=g;if(a.wndidx!=0)i(-1);else n(e)}return;case"toggle":z();return;case"wwwl":for(var m=a.d3type==WPACS.CONSTDEF.wpdt1?d.length:3,f=0;f<m;f++)b[f]&&b[f].Action(k,g);return;case"d3clut":b[3]&&b[3].Action("psuedo",g);return;case"matrix":var l=!c?null:a.d3type==WPACS.CONSTDEF.wpdt6?c.GetPerspProj():c.GetOrthoProj();l&&g&&l.wfn12(g.id,g.param);return}for(var f=0;f<b.length;f++)b[f]&&b[f].Action(k,g)}var e=null,g=null,h=null;function K(){var a='<table cellpadding="1" cellspacing="1" border="0" style="position:absolute;display:none;background-color:#000000;"></table><div class="d3loadUI" ><div class="easyui-progressbar" style="width:inherit;" ></div><span></span><hr/><div class="d3tips"></div></div>';e.append(a);g=e.children("table");h=e.children("div");h.children(".easyui-progressbar").progressbar({value:0});h.hide()}function I(){s(false);for(var a=0;a<d.length;a++){d[a]&&d[a].DestroyObj();d[a]=null}for(var a=0;a<b.length;a++){b[a]&&b[a].DestroyObj();b[a]=null}c&&c.DestroyObj();c=null;h=null;if(g!=null){g.remove();g=null}if(e!=null){e.empty();e=null}q.UnBindAll(null);q=null}function s(c){if(g==null)return;var a=g.find("div.win3d");if(c){var b={mousedown:o,mousemove:o,mouseup:o,mouseclick:null,mousedblclick:o,mousewheelx:o,mouseswipe:o,mouserotate:null,mousepinch:null};q.BindElem(a,b)}else q.UnBindElem(a);a=null}function n(a){s(false);if(WPACS.wp0bj1.isObject(a)){if(e==null||e[0]!=a[0]){e=a;g==null?K():g.appendTo(e)}J();g.show();s(true)}else if(e!=null){h=null;g=null;A(-1);e.empty();e=null}}function J(){if(g==null)return;var j=e.width(),i=e.height(),c="";if(a.wndidx!=0){var m=a.wndidx-1;c+='<tr><td><div class="win3d" no="'+m+'" style="width:'+(j-2)+"px;height:"+(i-2)+"px;border:thin solid "+f[m]+';"></div></td></tr>'}else{var o=a.layout;switch(o){case 1:var d=Math.floor(j/2-5),h=Math.floor(i/2-5);c=c+'<tr><td><div class="win3d" no="0" style="width:'+d+"px;height:"+h+"px;border:thin solid "+f[0]+';"></div></td><td><div class="win3d" no="2" style="width:'+d+"px;height:"+h+"px;border:thin solid "+f[2]+';"></div></td></tr><tr><td><div class="win3d" no="1" style="width:'+d+"px;height:"+h+"px;border:thin solid "+f[1]+';"></div></td><td><div class="win3d" no="3" style="width:'+d+"px;height:"+h+"px;border:thin solid "+f[3]+';"></div></td></tr>';break;case 2:var d=Math.floor(j/3-3),h=Math.floor(i/3-5),n=d*2,l=i-5;c=c+'<tr><td><div class="win3d" no="0" style="width:'+d+"px;height:"+h+"px;border:thin solid "+f[0]+';"></div></td><td rowspan="3"><div class="win3d" no="3" style="width:'+n+"px;height:"+l+"px;border:thin solid "+f[3]+';"></div></td></tr>';c=c+'<tr><td><div class="win3d" no="1" style="width:'+d+"px;height:"+h+"px;border:thin solid "+f[1]+';"></div></td></tr>';c=c+'<tr><td><div class="win3d" no="2" style="width:'+d+"px;height:"+h+"px;border:thin solid "+f[2]+';"></div></td></tr>';break;case 3:var d=Math.floor(j/3-5),h=Math.floor(i/3-4),n=j-5,l=h*2;c=c+'<tr><td><div class="win3d" no="0" style="width:'+d+"px;height:"+h+"px;border:thin solid "+f[0]+';"></div></td><td><div class="win3d" no="1" style="width:'+d+"px;height:"+h+"px;border:thin solid "+f[1]+';"></div></td><td><div class="win3d" no="2" style="width:'+d+"px;height:"+h+"px;border:thin solid "+f[2]+';"></div></td></tr>';c=c+'<tr><td colspan="3"><div class="win3d" no="3" style="width:'+n+"px;height:"+l+"px;border:thin solid "+f[3]+';"></div></td></tr>';break;case 4:var d=Math.floor(j/3-3),h=Math.floor(i/2-5),q=d*2,p=i-5;c=c+'<tr><td><div class="win3d" no="1" style="width:'+d+"px;height:"+h+"px;border:thin solid "+f[1]+';"></div></td><td rowspan="2"><div class="win3d" no="0" style="width:'+q+"px;height:"+p+"px;border:thin solid "+f[0]+';"></div></td></tr>';c=c+'<tr><td><div class="win3d" no="2" style="width:'+d+"px;height:"+h+"px;border:thin solid "+f[2]+';"></div></td></tr>'}}if(c=="")return;else g.html(c);A(-1);for(var k=0;k<b.length;k++)b[k]&&b[k].Action("fitwnd")}function A(b){if(b>=0&&b<d.length){if(!d[b])return;var a=g?g.find("div.win3d[no='"+b+"']"):null;if(!a||a.length==0)a=null;d[b].BindContainer(a);return}for(var c=0;c<d.length;c++){if(!d[c])continue;var a=g?g.find("div.win3d[no='"+c+"']"):null;if(!a||a.length==0)a=null;d[c].BindContainer(a)}}function B(e,g){b[3]&&b[3].DestroyObj();b[3]=null;d[3]&&d[3].SetImage(b[3]);a.d3type=e;a.subtype=WPACS.wp0bj1.isNumberType(g)?g:0;if(a.status!=2||c==null)return;y();var m,h=c.DicomInfo();switch(e){case WPACS.CONSTDEF.wpdt1:b[3]=new WPACS.wp0b26;break;case WPACS.CONSTDEF.wpdt2:case WPACS.CONSTDEF.wpdt3:case WPACS.CONSTDEF.wpdt4:case WPACS.CONSTDEF.wpdt5:case WPACS.CONSTDEF.wpdt6:var f=c.GetSliceSize(e),l=f[2];b[3]=new WPACS.wp0b26;b[3].InitSliceData(f[0],f[1],l,h,0);if(!a.d3mode)a.d3mode=WPACS.CONSTDEF.wpd1;k("d3mode",a.d3mode)}d[3]&&d[3].SetImage(b[3]);if(a.wndidx!=0)if(e!=WPACS.CONSTDEF.wpdt0)a.wndidx!=4&&i(3);else a.wndidx==4&&i(0);else if(e==WPACS.CONSTDEF.wpdt0)a.layout!=4&&k("layout",4);else if(a.layout==4)WPACS.wp0bj1.IsMobile?i(3):k("layout",2);if(!b[3]){a.d3type=0;return}if(e==WPACS.CONSTDEF.wpdt6){a.vrww==0&&u();b[3].Action("psuedo",WPACS.CONSTDEF.VE_PSUEDO)}else e==WPACS.CONSTDEF.wpdt5&&a.vrww==0&&u();b[3].Options().ww=b[3].Options().wc=0;b[3].Options().onViewText=r;j(2,0,0,WPACS.CONSTDEF.wpd3)}function u(){if(b[0]){a.vrww=b[0].Options().ww;a.vrwl=b[0].Options().wc}else if(c){var d=c.DicomInfo();a.vrww=d.image.ww;a.vrwl=d.image.wc}if(a.vrww==0){a.vrww=300;a.vrwl=40}}function H(){var f=a.d3type==WPACS.CONSTDEF.wpdt6?c.GetPerspProj():c.GetOrthoProj();if(!f)return;var d=f.GetRight(),e=f.GetUp();b[3].Options().xdir=[d.x,d.y,-d.z];d=null;b[3].Options().ydir=[e.x,e.y,-e.z];e=null;var g=c.GetScaleOfCast();b[3].Options().xps_coef=g[0];b[3].Options().yps_coef=g[1]}function t(){var i="mprpt",j=b[3].wfn31();j.RemoveMetas(i);if(a.d3type!=WPACS.CONSTDEF.wpdt6)for(var k=c.GetCoordOfCast(a.d3type,{x:a.mprpt[0],y:a.mprpt[1],z:a.mprpt[2]}),d=k.x,e=k.y,h=[[d-10,e-10,d-3,e-3],[d-10,e+10,d-3,e+3],[d+10,e+10,d+3,e+3],[d+10,e-10,d+3,e-3]],g=0;g<h.length;g++){var f=new WPACS.wp0bj7;f.UserTag=i;f.CreateLine(h[g][0],h[g][1],h[g][2],h[g][3]);f.options.allowmm=false;f.options.metaclr="#00FF00";j.AddMeta(f);f=null}b[3].Action("refresh")}function E(){var g="mprmeta",n=c.GetVolSize(),o=a.mprpt[0],p=a.mprpt[1],q=a.mprpt[2];if(b[0]!=null){var m=[{x0:0,y0:p,x1:n.x-1,y1:p},{x0:o,y0:0,x1:o,y1:n.y-1}],h=b[0].wfn31(),e=h.FindMeta(g);if(e.length!=2){h.RemoveMetas(g);var k=new WPACS.wp0bj7;k.UserTag=g;k.CreateLine(0,0,0,0);k.options.allowmm=false;k.options.metaclr=f[1];h.AddMeta(k);k=null;var l=new WPACS.wp0bj7;l.UserTag=g;l.CreateLine(0,0,0,0);l.options.allowmm=false;l.options.metaclr=f[2];h.AddMeta(l);l=null;e=h.FindMeta(g);if(e.length!=2)return}for(var d=0;d<e.length;d++){e[d].ptArray[0].x=m[d].x0;e[d].ptArray[0].y=m[d].y0;e[d].ptArray[1].x=m[d].x1;e[d].ptArray[1].y=m[d].y1}b[0].Action("refresh")}if(b[1]!=null){var m=[{x0:0,y0:q,x1:n.x-1,y1:q},{x0:o,y0:0,x1:o,y1:n.z-1}],h=b[1].wfn31(),e=h.FindMeta(g);if(e.length!=2){h.RemoveMetas(g);var i=new WPACS.wp0bj7;i.UserTag=g;i.CreateLine(0,0,0,0);i.options.allowmm=false;i.options.metaclr=f[0];h.AddMeta(i);i=null;var l=new WPACS.wp0bj7;l.UserTag=g;l.CreateLine(0,0,0,0);l.options.allowmm=false;l.options.metaclr=f[2];h.AddMeta(l);l=null;e=h.FindMeta(g);if(e.length!=2)return}for(var d=0;d<e.length;d++){e[d].ptArray[0].x=m[d].x0;e[d].ptArray[0].y=m[d].y0;e[d].ptArray[1].x=m[d].x1;e[d].ptArray[1].y=m[d].y1}b[1].Action("refresh")}if(b[2]!=null){var m=[{x0:0,y0:q,x1:n.y-1,y1:q},{x0:p,y0:0,x1:p,y1:n.z-1}],h=b[2].wfn31(),e=h.FindMeta(g);if(e.length!=2){h.RemoveMetas(g);var i=new WPACS.wp0bj7;i.UserTag=g;i.CreateLine(0,0,0,0);i.options.allowmm=false;i.options.metaclr=f[0];h.AddMeta(i);i=null;var k=new WPACS.wp0bj7;k.UserTag=g;k.CreateLine(0,0,0,0);k.options.allowmm=false;k.options.metaclr=f[1];h.AddMeta(k);k=null;e=h.FindMeta(g);if(e.length!=2)return}for(var d=0;d<e.length;d++){e[d].ptArray[0].x=m[d].x0;e[d].ptArray[0].y=m[d].y0;e[d].ptArray[1].x=m[d].x1;e[d].ptArray[1].y=m[d].y1}b[2].Action("refresh")}if(a.d3type>=WPACS.CONSTDEF.wpdt2&&b[3])if(a.d3type==WPACS.CONSTDEF.wpdt6)j(2,0,0,WPACS.CONSTDEF.wpd3);else t();a.d3type>=WPACS.CONSTDEF.wpdt2&&b[3]&&t()}function r(j,b){if(!c)return b;var d=c.DicomInfo(),e=d.image.x0,f=d.image.y0,g=d.image.z0,h=d.image.fx;d=null;var k=-1;switch(j){case 1:g=g+k*(a.mprpt[2]*h);b+="Axis z0: "+g.toFixed(2)+"\nx0: "+e.toFixed(2)+" y0: "+f.toFixed(2);break;case 2:f=f+a.mprpt[1]*h;b+="Coro y0: "+f.toFixed(2)+"\nx0: "+e.toFixed(2)+" z0: "+g.toFixed(2);break;case 3:e=e+a.mprpt[0]*h;b+="Sagi x0: "+e.toFixed(2)+"\ny0: "+f.toFixed(2)+" z0: "+g.toFixed(2);break;case 0:if(a.d3type==WPACS.CONSTDEF.wpdt3)b+="SSD Thre: "+a.thre;else if(a.d3type==WPACS.CONSTDEF.wpdt5)b+="VR W/L: "+a.vrww+"/"+a.vrwl;else if(a.d3type==WPACS.CONSTDEF.wpdt6){var i=c.GetPerspProj().GetLook();b+="LookAt: "+WPACS.wfn37(i.x,i.y,i.z)+"-->\n";if(WPACS.CONSTDEF.VE_THREFN)b+="VE W/L: "+a.vrww+"/"+a.vrwl;else b+="VE Thre: "+a.vethre}}return b}function m(m,e){if(m!=WPACS.CONSTDEF.wps3){if(h==null)return;var o=h.children(".easyui-progressbar"),l=h.children("span");if(m==WPACS.CONSTDEF.wps0){o.progressbar("setValue",0);if(e<0){h.children("div.d3tips").hide();o.hide();h.height(30);l.text("\u6b63\u5728\u521d\u59cb\u5316\u4e09\u7ef4\u6570\u636e,\u8bf7\u7b49\u5f85...")}else{h.children("div.d3tips").show();o.show();h.height(100);l.text("\u6b63\u5728\u4e0b\u8f7d\u5207\u7247\u6570\u636e,\u8bf7\u7b49\u5f85...")}h.show();a.status=1}else if(m==WPACS.CONSTDEF.wpu2){a.status=0;if(e==0){a.status=1;l.text("\u6b63\u5728\u521d\u59cb\u5316\u4e09\u7ef4\u6570\u636e,\u8bf7\u7b49\u5f85...")}else if(e>0&&c.IfLoaded()){a.status=2;l.text("\u521d\u59cb\u5316\u4e09\u7ef4\u6570\u636e\u6210\u529f");var i=c.GetVolSize(),g=c.DicomInfo();b[0]=new WPACS.wp0b26;if(a.onEvent!=null)a.onEvent(WPACS.CONSTDEF.wpe12,b[0]);b[0].InitSliceData(i.x,i.y,0,g,1);b[0].Options().xdir=[1,0,0];b[0].Options().ydir=[0,1,0];b[0].Options().onViewText=r;b[1]=new WPACS.wp0b26;if(a.onEvent!=null)a.onEvent(WPACS.CONSTDEF.wpe12,b[1]);b[1].InitSliceData(i.x,i.z,0,g,2);b[1].Options().xdir=[1,0,0];b[1].Options().ydir=[0,0,-1];b[1].Options().onViewText=r;b[2]=new WPACS.wp0b26;if(a.onEvent!=null)a.onEvent(WPACS.CONSTDEF.wpe12,b[2]);b[2].InitSliceData(i.y,i.z,0,g,3);b[2].Options().xdir=[0,1,0];b[2].Options().ydir=[0,0,-1];b[2].Options().onViewText=r;for(var n=0;n<d.length;n++)d[n]&&d[n].SetImage(b[n]);p(i.x/2|0,i.y/2|0,i.z/2|0);a.d3type!=0&&B(a.d3type,a.subtype);g=null;h.hide()}else l.text("\u521d\u59cb\u5316\u4e09\u7ef4\u6570\u636e\u5931\u8d25")}else if(m==WPACS.CONSTDEF.wps5){a.status=0;l.text("\u521d\u59cb\u5316\u4e09\u7ef4\u6570\u636e\u5931\u8d25("+e+")")}else m==WPACS.CONSTDEF.wps1&&o.progressbar("setValue",e)}else{var f=null;switch(e.type){case WPACS.CONSTDEF.wpdt0:f=e.subtype>=1&&e.subtype<=3?b[e.subtype-1]:null;if(!f)break;if(e.data){var g=c.DicomInfo(),u=g.image.x0,v=g.image.y0,w=g.image.z0,s=g.image.fx;g=null;var x=-1;if(e.subtype==1){var j=f.Options();j.x0=u;j.y0=v;j.z0=w+x*(e.location*s);a.mprpt[2]=e.location}else if(e.subtype==2){var j=f.Options();j.x0=u;j.z0=w;j.y0=v+e.location*s;a.mprpt[1]=e.location}else{var j=f.Options();j.y0=v;j.z0=w;j.x0=u+e.location*s;a.mprpt[0]=e.location}f.SetSliceData(e.data.d);E()}else if(f.Options().onstatus!=null)f.Options().onstatus(WPACS.CONSTDEF.wpu2);break;case WPACS.CONSTDEF.wpdt1:if(!(f=b[3]))break;if(e.data){var g=c.DicomInfo(),k=e.data;f.InitSliceData(k.w,k.h,k.b,g,4);f.SetSliceData(k.d);g=null;k.d=null;k=null}else if(f.Options().onstatus!=null)f.Options().onstatus(WPACS.CONSTDEF.wpu2);break;case WPACS.CONSTDEF.wpdt2:case WPACS.CONSTDEF.wpdt3:case WPACS.CONSTDEF.wpdt4:case WPACS.CONSTDEF.wpdt5:case WPACS.CONSTDEF.wpdt6:if(!(f=b[3]))break;F();if(e.data){H();t();a.filter&&q.GetHandler(0).GetBtnStatus()==0&&WPACS.wp0b10.AvFilter(e.data.d,e.data.w,e.data.h,e.data.b,3);f.SetSliceData(e.data.d,true)}else if(f.Options().onstatus!=null)f.Options().onstatus(WPACS.CONSTDEF.wpu2)}f=null;if(e.data)e.data.d=null;e.data=null}}c.Options().onstatus=m;function y(){var a="cprmeta";if(b[0]!=null)b[0].wfn31().RemoveMetas(a)>0&&b[0].Action("refresh");if(b[1]!=null)b[1].wfn31().RemoveMetas(a)>0&&b[1].Action("refresh");if(b[2]!=null)b[2].wfn31().RemoveMetas(a)>0&&b[2].Action("refresh")}function F(){var a="clipmeta";b[3]!=null&&b[3].wfn31().RemoveMetas(a)>0&&b[3].Action("refresh")}function p(e,f,g,h){var i=c.GetVolSize();if(g>=0&&g<i.z&&a.mprpt[2]!=g){if(b[0].Options().onstatus!=null)b[0].Options().onstatus(WPACS.CONSTDEF.wps1,-1);var j={loc:g,mprth:a.mprth,mprfn:a.mprfn},d=c.wfn01(j,h);d&&m(WPACS.CONSTDEF.wps3,{data:d,type:WPACS.CONSTDEF.wpdt0,subtype:1,location:g});if(d)d.d=null;d=null}if(f>=0&&f<i.y&&a.mprpt[1]!=f){if(b[1].Options().onstatus!=null)b[1].Options().onstatus(WPACS.CONSTDEF.wps1,-1);var j={loc:f,mprth:a.mprth,mprfn:a.mprfn},d=c.wfn02(j,h);d&&m(WPACS.CONSTDEF.wps3,{data:d,type:WPACS.CONSTDEF.wpdt0,subtype:2,location:f});if(d)d.d=null;d=null}if(e>=0&&e<i.x&&a.mprpt[0]!=e){if(b[2].Options().onstatus!=null)b[2].Options().onstatus(WPACS.CONSTDEF.wps1,-1);var j={loc:e,mprth:a.mprth,mprfn:a.mprfn},d=c.wfn03(j,h);d&&m(WPACS.CONSTDEF.wps3,{data:d,type:WPACS.CONSTDEF.wpdt0,subtype:3,location:e});if(d)d.d=null;d=null}}function x(j,c,h,i){var e=-1,f=-1,g=-1;if(c==0&&d[0]){var b=d[0].Cvt2ImageXY(h,i);if(b){e=b.x;f=b.y}}if(c==1&&d[1]){var b=d[1].Cvt2ImageXY(h,i);if(b){e=b.x;g=b.y}}if(c==2&&d[2]){var b=d[2].Cvt2ImageXY(h,i);if(b){f=b.x;g=b.y}}a.status==2&&p(e,f,g,j==2)}function w(n,h,o,p){var j="cprmeta",l=a.subtype==1?1:4,g=d[h].Cvt2ImageXY(o,p);if(g==null)return;var e,k=b[h].wfn31();if(n==0){y();e=WPACS.wp0b40(l,g.x,g.y);e.UserTag=j;e.options.allowmm=false;e.options.metaclr="#FFFF00";k.AddMeta(e);e=null;return}e=k.FindMeta(j);if(e.length==0)return;if(l==1){e[0].ptArray[1].x=g.x;e[0].ptArray[1].y=g.y}else e[0].ptArray[e[0].ptArray.length]={x:g.x,y:g.y};if(n==2&&b[3]){if(b[3].Options().onstatus!=null)b[3].Options().onstatus(WPACS.CONSTDEF.wps1,-1);var f=null,q=c.DicomInfo(),i={pts:e[0].ptArray,mprth:a.mprth,mprfn:a.mprfn};if(h==0)f=c.wfn01(i,true);else if(h==1)f=c.wfn02(i,true);else if(h==2)f=c.wfn03(i,true);f&&m(WPACS.CONSTDEF.wps3,{data:f,type:WPACS.CONSTDEF.wpdt1});if(f)f.d=null;f=null}else b[h].Action("refresh")}function v(k,m,n){if(a.d3type<WPACS.CONSTDEF.wpdt2||b[3]==null)return;var i=a.cliptype,f=d[3].Cvt2ImageXY(m,n);if(f==null)return;var g="clipmeta",e,h=b[3].wfn31();if(k==0){h.RemoveMetas(g);if(i==2)e=WPACS.wp0b40(2,f.x,f.y);else e=WPACS.wp0b40(4,f.x,f.y);e.UserTag=g;e.options.allowmm=false;e.options.metaclr="#FFFF00";h.AddMeta(e);e=null;return}e=h.FindMeta(g);if(e.length==0)return;if(i==2)e[0].ptArray[1]={x:f.x,y:f.y};else e[0].ptArray[e[0].ptArray.length]={x:f.x,y:f.y};if(k==2){e[0].options.closed=true;b[3].Action("refresh");if(confirm("\u786e\u8ba4\u88c1\u526a\u6307\u5b9a\u7684\u533a\u57df?")){if(b[3].Options().onstatus!=null)b[3].Options().onstatus(WPACS.CONSTDEF.wps1,-1);var l=i==1;window.setTimeout(function(){c.SetClipPoly(e[0].ptArray,l);j(2,0,0)},0);return}else h.RemoveMetas(g)}b[3].Action("refresh")}function j(y,e,d,j){if(a.d3type<WPACS.CONSTDEF.wpdt2||b[3]==null)return;var n=a.d3type==WPACS.CONSTDEF.wpdt6?c.GetPerspProj():c.GetOrthoProj();if(n==null)return;var k=true;if(!j)j=a.d3mode;switch(j){case WPACS.CONSTDEF.wpd1:if(e||d){var B=3.14159,t=Math.abs(e),u=Math.abs(d),w=0,x=0;if(t>u){if(t<3*u&&u>2)x=d>0?-10:10;w=e>0?-10:10}else{if(u<3*t&&t>2)w=e>0?-10:10;x=d>0?-10:10}n.wfn12(j,[w*B/180,x*B/180])}break;case WPACS.CONSTDEF.wpd2:if(a.d3type==WPACS.CONSTDEF.wpdt6){if(d&&Math.abs(d)>Math.abs(e)){var r=n.GetLook();r.Scale(d>0?-5:5);var C=Math.round(a.mprpt[0]+r.x),E=Math.round(a.mprpt[1]+r.y),F=Math.round(a.mprpt[2]+r.z);p(C,E,F,y==2)}else if(e)k=false}else if(d&&Math.abs(d)>Math.abs(e))n.wfn12(j,d>0?.8:1.2);else if(e)k=false;break;case WPACS.CONSTDEF.wpd3:(e||d)&&n.wfn12(j,[-e,-d]);break;case WPACS.CONSTDEF.wpd4:break;case WPACS.CONSTDEF.wpd5:if(a.d3type==WPACS.CONSTDEF.wpdt3)if(Math.abs(e)>Math.abs(d))a.thre+=e>0?50:-50;else a.thre+=d>0?10:-10;else if(a.d3type==WPACS.CONSTDEF.wpdt4)if(Math.abs(e)>Math.abs(d))a.vroff+=e>0?50:-50;else a.vroff+=d>0?10:-10;else if(a.d3type==WPACS.CONSTDEF.wpdt5){var o=c.DicomInfo(),q=WPACS.wpGetWwwlRatio(o.image.b,!o.image.is);e=e*q|0;d=d*q|0;a.vrww+=e;a.vrwl+=d}else if(a.d3type==WPACS.CONSTDEF.wpdt6)if(WPACS.CONSTDEF.VE_THREFN){var o=c.DicomInfo(),q=WPACS.wpGetWwwlRatio(o.image.b,!o.image.is);e=e*q|0;d=d*q|0;a.vrww+=e;a.vrwl+=d}else if(Math.abs(e)>Math.abs(d))a.vethre+=e>0?50:-50;else a.vethre+=d>0?10:-10;else k=false;break;default:k=false}if(!k)return;if(b[3].Options().onstatus!=null)b[3].Options().onstatus(WPACS.CONSTDEF.wps1,-1);var s=4,z=false;nStep=2;if(y==2){z=true;nStep=a.step;s=2;a.filter=a.step<1?false:WPACS.CONSTDEF.DAT3FILTER;if(a.step==.5){nStep=1;s=1}else if(a.step==.3){nStep=.6;s=D?.5:1}}var i={skip:s,step:nStep,inp:z,light:a.light};if(a.d3type==WPACS.CONSTDEF.wpdt3)d3params=$.extend({},i,{thre:a.thre});else if(a.d3type==WPACS.CONSTDEF.wpdt4){var g=WPACS.PREVRTHRESHOLD,h=g[0].data;if(WPACS.wp0bj1.isStringType(a.vrset)){for(var f=0;f<g.length;f++)if(g[f].name==a.vrset){h=g[f].data;break}}else if(WPACS.wp0bj1.isNumberType(a.vrset))h=a.vrset>=0&&a.vrset<g.length?g[a.vrset].data:g[0].data;else h=a.vrset;if(a.vroff!=0){for(var v=[],f=0,A=h.length;f<A;f++)v[f]=h[f].slice(0);for(f=0;f<A;f++){v[f][0]+=a.vroff;v[f][1]+=a.vroff}h=v}d3params=$.extend({},i,{vrset:h,vroff:a.vroff})}else if(a.d3type==WPACS.CONSTDEF.wpdt5)d3params=$.extend({},i,{vrww:a.vrww,vrwl:a.vrwl});else if(a.d3type==WPACS.CONSTDEF.wpdt6)if(WPACS.CONSTDEF.VE_THREFN)d3params=$.extend({},i,{vrww:a.vrww,vrwl:a.vrwl,focal:[a.mprpt[0],a.mprpt[1],a.mprpt[2]]});else d3params=$.extend({},i,{thre:a.vethre,focal:[a.mprpt[0],a.mprpt[1],a.mprpt[2]]});else d3params=i;var l=c.wfn04(a.d3type,d3params,y==2);l&&m(WPACS.CONSTDEF.wps3,{data:l,type:a.d3type});if(l)l.d=null;l=null}function o(b){var d=b.type,m=b.which,n=$(this),c=parseInt(n.attr("no")),f=WPACS.CONSTDEF.wpd4,g=WPACS.CONSTDEF.wpdt1;if(m==1)if(d=="down"){if(!(a.wndidx>0&&a.wndidx<4))if(c==3)a.d3mode==f&&v(0,b.x,b.y);else if(a.opmode==0)a.d3type==g&&w(0,c,b.x,b.y)}else if(d=="move"){if(a.wndidx>0&&a.wndidx<4){if(Math.abs(b.dx)<5){d="wheel";b.delta=b.dy>0?-1:1}}else if(c==3)if(a.d3mode==f)v(1,b.x,b.y);else j(1,b.dx,b.dy);else if(a.opmode==0)if(a.d3type==g)w(1,c,b.x,b.y);else x(1,c,b.x,b.y)}else if(d=="up"){if(a.wndidx>0&&a.wndidx<4){d="wheel";b.delta=0}else if(c==3){if(b.dis<=1)return;if(a.d3mode==f)v(2,b.x,b.y);else j(2,0,0)}else if(a.opmode==0)if(a.d3type==g){if(b.dis<=1)return;w(2,c,b.x,b.y)}else x(2,c,b.x,b.y)}else if(d=="dblclick")z.call(this);else if(d=="swipe")if(a.wndidx>0&&a.wndidx<4){var e=a.wndidx;if(b.dir=="left")e+=1;else if(b.dir=="right")e-=1;else return;if(e<1)e=3;else if(e>3)e=1;i(e-1)}if(d=="wheel")if(c==3)if(b.delta!=0)j(1,0,-b.delta,WPACS.CONSTDEF.wpd2);else j(2,0,0,WPACS.CONSTDEF.wpd2);else{if(b.delta==0)return;var h=-1,k=-1,l=-1;if(c==0)l=a.mprpt[2]-b.delta;else if(c==1)k=a.mprpt[1]-b.delta;else if(c==2)h=a.mprpt[0]-b.delta;a.status==2&&p(h,k,l,true)}}function z(){if(a.wndidx==0){var b=$(this).attr("no");if(b===undefined)i(0);else i(parseInt(b))}else i(-1)}function i(g){if(a.wndidx==0){a.wndidx=g+1;for(var d=b[g]?b[g].wfn31():null,f=d?d.FindMeta("mprmeta"):[],c=0;c<f.length;c++)f[c].options.visible=false}else if(a.wndidx!=g+1){var d=null,f;if(b[a.wndidx-1])d=b[a.wndidx-1].wfn31();f=d?d.FindMeta("mprmeta"):[];for(var c=0;c<f.length;c++)f[c].options.visible=true;if((a.wndidx=g+1)>0){d=!b[a.wndidx-1]?null:b[a.wndidx-1].wfn31();f=d?d.FindMeta("mprmeta"):[];for(var c=0;c<f.length;c++)f[c].options.visible=false}else a.wndidx=0}n(e)}function G(d,b){var c=false;if(a.onEvent!=null)c=a.onEvent(d,b);if(c)return true;switch(d){case WPACS.CONSTDEF.wpe5:k("zoom",b);return true;case WPACS.CONSTDEF.wpe6:k("move",b);return true;case WPACS.CONSTDEF.wpe7:k("wwwl",b);return true}return false}WPACS.wp0bj1.isObject(C)&&n(C)};